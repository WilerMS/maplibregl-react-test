(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))v(b);new MutationObserver(b=>{for(const I of b)if(I.type==="childList")for(const O of I.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&v(O)}).observe(document,{childList:!0,subtree:!0});function h(b){const I={};return b.integrity&&(I.integrity=b.integrity),b.referrerPolicy&&(I.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?I.credentials="include":b.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function v(b){if(b.ep)return;b.ep=!0;const I=h(b);fetch(b.href,I)}})();var Pm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var cv={exports:{}},Qd={},hv={exports:{}},Jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ph=Symbol.for("react.element"),ww=Symbol.for("react.portal"),bw=Symbol.for("react.fragment"),Tw=Symbol.for("react.strict_mode"),Sw=Symbol.for("react.profiler"),Ew=Symbol.for("react.provider"),Pw=Symbol.for("react.context"),Cw=Symbol.for("react.forward_ref"),Iw=Symbol.for("react.suspense"),kw=Symbol.for("react.memo"),Mw=Symbol.for("react.lazy"),Jg=Symbol.iterator;function zw(n){return n===null||typeof n!="object"?null:(n=Jg&&n[Jg]||n["@@iterator"],typeof n=="function"?n:null)}var dv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pv=Object.assign,fv={};function dc(n,s,h){this.props=n,this.context=s,this.refs=fv,this.updater=h||dv}dc.prototype.isReactComponent={};dc.prototype.setState=function(n,s){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,s,"setState")};dc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function mv(){}mv.prototype=dc.prototype;function Cm(n,s,h){this.props=n,this.context=s,this.refs=fv,this.updater=h||dv}var Im=Cm.prototype=new mv;Im.constructor=Cm;pv(Im,dc.prototype);Im.isPureReactComponent=!0;var Qg=Array.isArray,_v=Object.prototype.hasOwnProperty,km={current:null},gv={key:!0,ref:!0,__self:!0,__source:!0};function yv(n,s,h){var v,b={},I=null,O=null;if(s!=null)for(v in s.ref!==void 0&&(O=s.ref),s.key!==void 0&&(I=""+s.key),s)_v.call(s,v)&&!gv.hasOwnProperty(v)&&(b[v]=s[v]);var u=arguments.length-2;if(u===1)b.children=h;else if(1<u){for(var H=Array(u),q=0;q<u;q++)H[q]=arguments[q+2];b.children=H}if(n&&n.defaultProps)for(v in u=n.defaultProps,u)b[v]===void 0&&(b[v]=u[v]);return{$$typeof:Ph,type:n,key:I,ref:O,props:b,_owner:km.current}}function Aw(n,s){return{$$typeof:Ph,type:n.type,key:s,ref:n.ref,props:n.props,_owner:n._owner}}function Mm(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ph}function Lw(n){var s={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(h){return s[h]})}var ey=/\/+/g;function rf(n,s){return typeof n=="object"&&n!==null&&n.key!=null?Lw(""+n.key):s.toString(36)}function gd(n,s,h,v,b){var I=typeof n;(I==="undefined"||I==="boolean")&&(n=null);var O=!1;if(n===null)O=!0;else switch(I){case"string":case"number":O=!0;break;case"object":switch(n.$$typeof){case Ph:case ww:O=!0}}if(O)return O=n,b=b(O),n=v===""?"."+rf(O,0):v,Qg(b)?(h="",n!=null&&(h=n.replace(ey,"$&/")+"/"),gd(b,s,h,"",function(q){return q})):b!=null&&(Mm(b)&&(b=Aw(b,h+(!b.key||O&&O.key===b.key?"":(""+b.key).replace(ey,"$&/")+"/")+n)),s.push(b)),1;if(O=0,v=v===""?".":v+":",Qg(n))for(var u=0;u<n.length;u++){I=n[u];var H=v+rf(I,u);O+=gd(I,s,h,H,b)}else if(H=zw(n),typeof H=="function")for(n=H.call(n),u=0;!(I=n.next()).done;)I=I.value,H=v+rf(I,u++),O+=gd(I,s,h,H,b);else if(I==="object")throw s=String(n),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return O}function Qh(n,s,h){if(n==null)return n;var v=[],b=0;return gd(n,v,"","",function(I){return s.call(h,I,b++)}),v}function Dw(n){if(n._status===-1){var s=n._result;s=s(),s.then(function(h){(n._status===0||n._status===-1)&&(n._status=1,n._result=h)},function(h){(n._status===0||n._status===-1)&&(n._status=2,n._result=h)}),n._status===-1&&(n._status=0,n._result=s)}if(n._status===1)return n._result.default;throw n._result}var Lr={current:null},yd={transition:null},Rw={ReactCurrentDispatcher:Lr,ReactCurrentBatchConfig:yd,ReactCurrentOwner:km};Jt.Children={map:Qh,forEach:function(n,s,h){Qh(n,function(){s.apply(this,arguments)},h)},count:function(n){var s=0;return Qh(n,function(){s++}),s},toArray:function(n){return Qh(n,function(s){return s})||[]},only:function(n){if(!Mm(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Jt.Component=dc;Jt.Fragment=bw;Jt.Profiler=Sw;Jt.PureComponent=Cm;Jt.StrictMode=Tw;Jt.Suspense=Iw;Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rw;Jt.cloneElement=function(n,s,h){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var v=pv({},n.props),b=n.key,I=n.ref,O=n._owner;if(s!=null){if(s.ref!==void 0&&(I=s.ref,O=km.current),s.key!==void 0&&(b=""+s.key),n.type&&n.type.defaultProps)var u=n.type.defaultProps;for(H in s)_v.call(s,H)&&!gv.hasOwnProperty(H)&&(v[H]=s[H]===void 0&&u!==void 0?u[H]:s[H])}var H=arguments.length-2;if(H===1)v.children=h;else if(1<H){u=Array(H);for(var q=0;q<H;q++)u[q]=arguments[q+2];v.children=u}return{$$typeof:Ph,type:n.type,key:b,ref:I,props:v,_owner:O}};Jt.createContext=function(n){return n={$$typeof:Pw,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Ew,_context:n},n.Consumer=n};Jt.createElement=yv;Jt.createFactory=function(n){var s=yv.bind(null,n);return s.type=n,s};Jt.createRef=function(){return{current:null}};Jt.forwardRef=function(n){return{$$typeof:Cw,render:n}};Jt.isValidElement=Mm;Jt.lazy=function(n){return{$$typeof:Mw,_payload:{_status:-1,_result:n},_init:Dw}};Jt.memo=function(n,s){return{$$typeof:kw,type:n,compare:s===void 0?null:s}};Jt.startTransition=function(n){var s=yd.transition;yd.transition={};try{n()}finally{yd.transition=s}};Jt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Jt.useCallback=function(n,s){return Lr.current.useCallback(n,s)};Jt.useContext=function(n){return Lr.current.useContext(n)};Jt.useDebugValue=function(){};Jt.useDeferredValue=function(n){return Lr.current.useDeferredValue(n)};Jt.useEffect=function(n,s){return Lr.current.useEffect(n,s)};Jt.useId=function(){return Lr.current.useId()};Jt.useImperativeHandle=function(n,s,h){return Lr.current.useImperativeHandle(n,s,h)};Jt.useInsertionEffect=function(n,s){return Lr.current.useInsertionEffect(n,s)};Jt.useLayoutEffect=function(n,s){return Lr.current.useLayoutEffect(n,s)};Jt.useMemo=function(n,s){return Lr.current.useMemo(n,s)};Jt.useReducer=function(n,s,h){return Lr.current.useReducer(n,s,h)};Jt.useRef=function(n){return Lr.current.useRef(n)};Jt.useState=function(n){return Lr.current.useState(n)};Jt.useSyncExternalStore=function(n,s,h){return Lr.current.useSyncExternalStore(n,s,h)};Jt.useTransition=function(){return Lr.current.useTransition()};Jt.version="18.2.0";hv.exports=Jt;var ji=hv.exports;const zf=uv(ji);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bw=ji,Ow=Symbol.for("react.element"),Fw=Symbol.for("react.fragment"),Nw=Object.prototype.hasOwnProperty,Uw=Bw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Vw={key:!0,ref:!0,__self:!0,__source:!0};function vv(n,s,h){var v,b={},I=null,O=null;h!==void 0&&(I=""+h),s.key!==void 0&&(I=""+s.key),s.ref!==void 0&&(O=s.ref);for(v in s)Nw.call(s,v)&&!Vw.hasOwnProperty(v)&&(b[v]=s[v]);if(n&&n.defaultProps)for(v in s=n.defaultProps,s)b[v]===void 0&&(b[v]=s[v]);return{$$typeof:Ow,type:n,key:I,ref:O,props:b,_owner:Uw.current}}Qd.Fragment=Fw;Qd.jsx=vv;Qd.jsxs=vv;cv.exports=Qd;var Ys=cv.exports,Af={},xv={exports:{}},So={},wv={exports:{}},bv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function s(Re,kt){var He=Re.length;Re.push(kt);e:for(;0<He;){var St=He-1>>>1,Rt=Re[St];if(0<b(Rt,kt))Re[St]=kt,Re[He]=Rt,He=St;else break e}}function h(Re){return Re.length===0?null:Re[0]}function v(Re){if(Re.length===0)return null;var kt=Re[0],He=Re.pop();if(He!==kt){Re[0]=He;e:for(var St=0,Rt=Re.length,ti=Rt>>>1;St<ti;){var Ct=2*(St+1)-1,Zt=Re[Ct],zt=Ct+1,Bi=Re[zt];if(0>b(Zt,He))zt<Rt&&0>b(Bi,Zt)?(Re[St]=Bi,Re[zt]=He,St=zt):(Re[St]=Zt,Re[Ct]=He,St=Ct);else if(zt<Rt&&0>b(Bi,He))Re[St]=Bi,Re[zt]=He,St=zt;else break e}}return kt}function b(Re,kt){var He=Re.sortIndex-kt.sortIndex;return He!==0?He:Re.id-kt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var I=performance;n.unstable_now=function(){return I.now()}}else{var O=Date,u=O.now();n.unstable_now=function(){return O.now()-u}}var H=[],q=[],ke=1,_e=null,Ce=3,Ue=!1,We=!1,Fe=!1,Bt=typeof setTimeout=="function"?setTimeout:null,pe=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ye(Re){for(var kt=h(q);kt!==null;){if(kt.callback===null)v(q);else if(kt.startTime<=Re)v(q),kt.sortIndex=kt.expirationTime,s(H,kt);else break;kt=h(q)}}function Ne(Re){if(Fe=!1,ye(Re),!We)if(h(H)!==null)We=!0,hi(tt);else{var kt=h(q);kt!==null&&kn(Ne,kt.startTime-Re)}}function tt(Re,kt){We=!1,Fe&&(Fe=!1,pe(dt),dt=-1),Ue=!0;var He=Ce;try{for(ye(kt),_e=h(H);_e!==null&&(!(_e.expirationTime>kt)||Re&&!ei());){var St=_e.callback;if(typeof St=="function"){_e.callback=null,Ce=_e.priorityLevel;var Rt=St(_e.expirationTime<=kt);kt=n.unstable_now(),typeof Rt=="function"?_e.callback=Rt:_e===h(H)&&v(H),ye(kt)}else v(H);_e=h(H)}if(_e!==null)var ti=!0;else{var Ct=h(q);Ct!==null&&kn(Ne,Ct.startTime-kt),ti=!1}return ti}finally{_e=null,Ce=He,Ue=!1}}var ht=!1,rt=null,dt=-1,Ut=5,ct=-1;function ei(){return!(n.unstable_now()-ct<Ut)}function ri(){if(rt!==null){var Re=n.unstable_now();ct=Re;var kt=!0;try{kt=rt(!0,Re)}finally{kt?xn():(ht=!1,rt=null)}}else ht=!1}var xn;if(typeof ue=="function")xn=function(){ue(ri)};else if(typeof MessageChannel<"u"){var sn=new MessageChannel,Rr=sn.port2;sn.port1.onmessage=ri,xn=function(){Rr.postMessage(null)}}else xn=function(){Bt(ri,0)};function hi(Re){rt=Re,ht||(ht=!0,xn())}function kn(Re,kt){dt=Bt(function(){Re(n.unstable_now())},kt)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){We||Ue||(We=!0,hi(tt))},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ut=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return Ce},n.unstable_getFirstCallbackNode=function(){return h(H)},n.unstable_next=function(Re){switch(Ce){case 1:case 2:case 3:var kt=3;break;default:kt=Ce}var He=Ce;Ce=kt;try{return Re()}finally{Ce=He}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,kt){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var He=Ce;Ce=Re;try{return kt()}finally{Ce=He}},n.unstable_scheduleCallback=function(Re,kt,He){var St=n.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?St+He:St):He=St,Re){case 1:var Rt=-1;break;case 2:Rt=250;break;case 5:Rt=1073741823;break;case 4:Rt=1e4;break;default:Rt=5e3}return Rt=He+Rt,Re={id:ke++,callback:kt,priorityLevel:Re,startTime:He,expirationTime:Rt,sortIndex:-1},He>St?(Re.sortIndex=He,s(q,Re),h(H)===null&&Re===h(q)&&(Fe?(pe(dt),dt=-1):Fe=!0,kn(Ne,He-St))):(Re.sortIndex=Rt,s(H,Re),We||Ue||(We=!0,hi(tt))),Re},n.unstable_shouldYield=ei,n.unstable_wrapCallback=function(Re){var kt=Ce;return function(){var He=Ce;Ce=kt;try{return Re.apply(this,arguments)}finally{Ce=He}}}})(bv);wv.exports=bv;var Zw=wv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tv=ji,To=Zw;function $e(n){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+n,h=1;h<arguments.length;h++)s+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sv=new Set,uh={};function _u(n,s){oc(n,s),oc(n+"Capture",s)}function oc(n,s){for(uh[n]=s,n=0;n<s.length;n++)Sv.add(s[n])}var La=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lf=Object.prototype.hasOwnProperty,$w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ty={},iy={};function jw(n){return Lf.call(iy,n)?!0:Lf.call(ty,n)?!1:$w.test(n)?iy[n]=!0:(ty[n]=!0,!1)}function qw(n,s,h,v){if(h!==null&&h.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return v?!1:h!==null?!h.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Gw(n,s,h,v){if(s===null||typeof s>"u"||qw(n,s,h,v))return!0;if(v)return!1;if(h!==null)switch(h.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Dr(n,s,h,v,b,I,O){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=v,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=n,this.type=s,this.sanitizeURL=I,this.removeEmptyString=O}var Qn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Qn[n]=new Dr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var s=n[0];Qn[s]=new Dr(s,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Qn[n]=new Dr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Qn[n]=new Dr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Qn[n]=new Dr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Qn[n]=new Dr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Qn[n]=new Dr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Qn[n]=new Dr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Qn[n]=new Dr(n,5,!1,n.toLowerCase(),null,!1,!1)});var zm=/[\-:]([a-z])/g;function Am(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var s=n.replace(zm,Am);Qn[s]=new Dr(s,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var s=n.replace(zm,Am);Qn[s]=new Dr(s,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var s=n.replace(zm,Am);Qn[s]=new Dr(s,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Qn[n]=new Dr(n,1,!1,n.toLowerCase(),null,!1,!1)});Qn.xlinkHref=new Dr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Qn[n]=new Dr(n,1,!1,n.toLowerCase(),null,!0,!0)});function Lm(n,s,h,v){var b=Qn.hasOwnProperty(s)?Qn[s]:null;(b!==null?b.type!==0:v||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Gw(s,h,b,v)&&(h=null),v||b===null?jw(s)&&(h===null?n.removeAttribute(s):n.setAttribute(s,""+h)):b.mustUseProperty?n[b.propertyName]=h===null?b.type===3?!1:"":h:(s=b.attributeName,v=b.attributeNamespace,h===null?n.removeAttribute(s):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,v?n.setAttributeNS(v,s,h):n.setAttribute(s,h))))}var Oa=Tv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ed=Symbol.for("react.element"),Vu=Symbol.for("react.portal"),Zu=Symbol.for("react.fragment"),Dm=Symbol.for("react.strict_mode"),Df=Symbol.for("react.profiler"),Ev=Symbol.for("react.provider"),Pv=Symbol.for("react.context"),Rm=Symbol.for("react.forward_ref"),Rf=Symbol.for("react.suspense"),Bf=Symbol.for("react.suspense_list"),Bm=Symbol.for("react.memo"),bl=Symbol.for("react.lazy"),Cv=Symbol.for("react.offscreen"),ny=Symbol.iterator;function Zc(n){return n===null||typeof n!="object"?null:(n=ny&&n[ny]||n["@@iterator"],typeof n=="function"?n:null)}var Qi=Object.assign,of;function Kc(n){if(of===void 0)try{throw Error()}catch(h){var s=h.stack.trim().match(/\n( *(at )?)/);of=s&&s[1]||""}return`
`+of+n}var sf=!1;function af(n,s){if(!n||sf)return"";sf=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(q){var v=q}Reflect.construct(n,[],s)}else{try{s.call()}catch(q){v=q}n.call(s.prototype)}else{try{throw Error()}catch(q){v=q}n()}}catch(q){if(q&&v&&typeof q.stack=="string"){for(var b=q.stack.split(`
`),I=v.stack.split(`
`),O=b.length-1,u=I.length-1;1<=O&&0<=u&&b[O]!==I[u];)u--;for(;1<=O&&0<=u;O--,u--)if(b[O]!==I[u]){if(O!==1||u!==1)do if(O--,u--,0>u||b[O]!==I[u]){var H=`
`+b[O].replace(" at new "," at ");return n.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",n.displayName)),H}while(1<=O&&0<=u);break}}}finally{sf=!1,Error.prepareStackTrace=h}return(n=n?n.displayName||n.name:"")?Kc(n):""}function Ww(n){switch(n.tag){case 5:return Kc(n.type);case 16:return Kc("Lazy");case 13:return Kc("Suspense");case 19:return Kc("SuspenseList");case 0:case 2:case 15:return n=af(n.type,!1),n;case 11:return n=af(n.type.render,!1),n;case 1:return n=af(n.type,!0),n;default:return""}}function Of(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Zu:return"Fragment";case Vu:return"Portal";case Df:return"Profiler";case Dm:return"StrictMode";case Rf:return"Suspense";case Bf:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Pv:return(n.displayName||"Context")+".Consumer";case Ev:return(n._context.displayName||"Context")+".Provider";case Rm:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Bm:return s=n.displayName||null,s!==null?s:Of(n.type)||"Memo";case bl:s=n._payload,n=n._init;try{return Of(n(s))}catch{}}return null}function Hw(n){var s=n.type;switch(n.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=s.render,n=n.displayName||n.name||"",s.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Of(s);case 8:return s===Dm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Bl(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Iv(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Xw(n){var s=Iv(n)?"checked":"value",h=Object.getOwnPropertyDescriptor(n.constructor.prototype,s),v=""+n[s];if(!n.hasOwnProperty(s)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,I=h.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return b.call(this)},set:function(O){v=""+O,I.call(this,O)}}),Object.defineProperty(n,s,{enumerable:h.enumerable}),{getValue:function(){return v},setValue:function(O){v=""+O},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function td(n){n._valueTracker||(n._valueTracker=Xw(n))}function kv(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var h=s.getValue(),v="";return n&&(v=Iv(n)?n.checked?"true":"false":n.value),n=v,n!==h?(s.setValue(n),!0):!1}function kd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Ff(n,s){var h=s.checked;return Qi({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??n._wrapperState.initialChecked})}function ry(n,s){var h=s.defaultValue==null?"":s.defaultValue,v=s.checked!=null?s.checked:s.defaultChecked;h=Bl(s.value!=null?s.value:h),n._wrapperState={initialChecked:v,initialValue:h,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Mv(n,s){s=s.checked,s!=null&&Lm(n,"checked",s,!1)}function Nf(n,s){Mv(n,s);var h=Bl(s.value),v=s.type;if(h!=null)v==="number"?(h===0&&n.value===""||n.value!=h)&&(n.value=""+h):n.value!==""+h&&(n.value=""+h);else if(v==="submit"||v==="reset"){n.removeAttribute("value");return}s.hasOwnProperty("value")?Uf(n,s.type,h):s.hasOwnProperty("defaultValue")&&Uf(n,s.type,Bl(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(n.defaultChecked=!!s.defaultChecked)}function oy(n,s,h){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var v=s.type;if(!(v!=="submit"&&v!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+n._wrapperState.initialValue,h||s===n.value||(n.value=s),n.defaultValue=s}h=n.name,h!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,h!==""&&(n.name=h)}function Uf(n,s,h){(s!=="number"||kd(n.ownerDocument)!==n)&&(h==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+h&&(n.defaultValue=""+h))}var Yc=Array.isArray;function Qu(n,s,h,v){if(n=n.options,s){s={};for(var b=0;b<h.length;b++)s["$"+h[b]]=!0;for(h=0;h<n.length;h++)b=s.hasOwnProperty("$"+n[h].value),n[h].selected!==b&&(n[h].selected=b),b&&v&&(n[h].defaultSelected=!0)}else{for(h=""+Bl(h),s=null,b=0;b<n.length;b++){if(n[b].value===h){n[b].selected=!0,v&&(n[b].defaultSelected=!0);return}s!==null||n[b].disabled||(s=n[b])}s!==null&&(s.selected=!0)}}function Vf(n,s){if(s.dangerouslySetInnerHTML!=null)throw Error($e(91));return Qi({},s,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function sy(n,s){var h=s.value;if(h==null){if(h=s.children,s=s.defaultValue,h!=null){if(s!=null)throw Error($e(92));if(Yc(h)){if(1<h.length)throw Error($e(93));h=h[0]}s=h}s==null&&(s=""),h=s}n._wrapperState={initialValue:Bl(h)}}function zv(n,s){var h=Bl(s.value),v=Bl(s.defaultValue);h!=null&&(h=""+h,h!==n.value&&(n.value=h),s.defaultValue==null&&n.defaultValue!==h&&(n.defaultValue=h)),v!=null&&(n.defaultValue=""+v)}function ay(n){var s=n.textContent;s===n._wrapperState.initialValue&&s!==""&&s!==null&&(n.value=s)}function Av(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zf(n,s){return n==null||n==="http://www.w3.org/1999/xhtml"?Av(s):n==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var id,Lv=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,h,v,b){MSApp.execUnsafeLocalFunction(function(){return n(s,h,v,b)})}:n}(function(n,s){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=s;else{for(id=id||document.createElement("div"),id.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=id.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;s.firstChild;)n.appendChild(s.firstChild)}});function ch(n,s){if(s){var h=n.firstChild;if(h&&h===n.lastChild&&h.nodeType===3){h.nodeValue=s;return}}n.textContent=s}var eh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Kw=["Webkit","ms","Moz","O"];Object.keys(eh).forEach(function(n){Kw.forEach(function(s){s=s+n.charAt(0).toUpperCase()+n.substring(1),eh[s]=eh[n]})});function Dv(n,s,h){return s==null||typeof s=="boolean"||s===""?"":h||typeof s!="number"||s===0||eh.hasOwnProperty(n)&&eh[n]?(""+s).trim():s+"px"}function Rv(n,s){n=n.style;for(var h in s)if(s.hasOwnProperty(h)){var v=h.indexOf("--")===0,b=Dv(h,s[h],v);h==="float"&&(h="cssFloat"),v?n.setProperty(h,b):n[h]=b}}var Yw=Qi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $f(n,s){if(s){if(Yw[n]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error($e(137,n));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error($e(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error($e(61))}if(s.style!=null&&typeof s.style!="object")throw Error($e(62))}}function jf(n,s){if(n.indexOf("-")===-1)return typeof s.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qf=null;function Om(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Gf=null,ec=null,tc=null;function ly(n){if(n=kh(n)){if(typeof Gf!="function")throw Error($e(280));var s=n.stateNode;s&&(s=rp(s),Gf(n.stateNode,n.type,s))}}function Bv(n){ec?tc?tc.push(n):tc=[n]:ec=n}function Ov(){if(ec){var n=ec,s=tc;if(tc=ec=null,ly(n),s)for(n=0;n<s.length;n++)ly(s[n])}}function Fv(n,s){return n(s)}function Nv(){}var lf=!1;function Uv(n,s,h){if(lf)return n(s,h);lf=!0;try{return Fv(n,s,h)}finally{lf=!1,(ec!==null||tc!==null)&&(Nv(),Ov())}}function hh(n,s){var h=n.stateNode;if(h===null)return null;var v=rp(h);if(v===null)return null;h=v[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(n=n.type,v=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!v;break e;default:n=!1}if(n)return null;if(h&&typeof h!="function")throw Error($e(231,s,typeof h));return h}var Wf=!1;if(La)try{var $c={};Object.defineProperty($c,"passive",{get:function(){Wf=!0}}),window.addEventListener("test",$c,$c),window.removeEventListener("test",$c,$c)}catch{Wf=!1}function Jw(n,s,h,v,b,I,O,u,H){var q=Array.prototype.slice.call(arguments,3);try{s.apply(h,q)}catch(ke){this.onError(ke)}}var th=!1,Md=null,zd=!1,Hf=null,Qw={onError:function(n){th=!0,Md=n}};function eb(n,s,h,v,b,I,O,u,H){th=!1,Md=null,Jw.apply(Qw,arguments)}function tb(n,s,h,v,b,I,O,u,H){if(eb.apply(this,arguments),th){if(th){var q=Md;th=!1,Md=null}else throw Error($e(198));zd||(zd=!0,Hf=q)}}function gu(n){var s=n,h=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,s.flags&4098&&(h=s.return),n=s.return;while(n)}return s.tag===3?h:null}function Vv(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function uy(n){if(gu(n)!==n)throw Error($e(188))}function ib(n){var s=n.alternate;if(!s){if(s=gu(n),s===null)throw Error($e(188));return s!==n?null:n}for(var h=n,v=s;;){var b=h.return;if(b===null)break;var I=b.alternate;if(I===null){if(v=b.return,v!==null){h=v;continue}break}if(b.child===I.child){for(I=b.child;I;){if(I===h)return uy(b),n;if(I===v)return uy(b),s;I=I.sibling}throw Error($e(188))}if(h.return!==v.return)h=b,v=I;else{for(var O=!1,u=b.child;u;){if(u===h){O=!0,h=b,v=I;break}if(u===v){O=!0,v=b,h=I;break}u=u.sibling}if(!O){for(u=I.child;u;){if(u===h){O=!0,h=I,v=b;break}if(u===v){O=!0,v=I,h=b;break}u=u.sibling}if(!O)throw Error($e(189))}}if(h.alternate!==v)throw Error($e(190))}if(h.tag!==3)throw Error($e(188));return h.stateNode.current===h?n:s}function Zv(n){return n=ib(n),n!==null?$v(n):null}function $v(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var s=$v(n);if(s!==null)return s;n=n.sibling}return null}var jv=To.unstable_scheduleCallback,cy=To.unstable_cancelCallback,nb=To.unstable_shouldYield,rb=To.unstable_requestPaint,dn=To.unstable_now,ob=To.unstable_getCurrentPriorityLevel,Fm=To.unstable_ImmediatePriority,qv=To.unstable_UserBlockingPriority,Ad=To.unstable_NormalPriority,sb=To.unstable_LowPriority,Gv=To.unstable_IdlePriority,ep=null,ea=null;function ab(n){if(ea&&typeof ea.onCommitFiberRoot=="function")try{ea.onCommitFiberRoot(ep,n,void 0,(n.current.flags&128)===128)}catch{}}var ws=Math.clz32?Math.clz32:cb,lb=Math.log,ub=Math.LN2;function cb(n){return n>>>=0,n===0?32:31-(lb(n)/ub|0)|0}var nd=64,rd=4194304;function Jc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Ld(n,s){var h=n.pendingLanes;if(h===0)return 0;var v=0,b=n.suspendedLanes,I=n.pingedLanes,O=h&268435455;if(O!==0){var u=O&~b;u!==0?v=Jc(u):(I&=O,I!==0&&(v=Jc(I)))}else O=h&~b,O!==0?v=Jc(O):I!==0&&(v=Jc(I));if(v===0)return 0;if(s!==0&&s!==v&&!(s&b)&&(b=v&-v,I=s&-s,b>=I||b===16&&(I&4194240)!==0))return s;if(v&4&&(v|=h&16),s=n.entangledLanes,s!==0)for(n=n.entanglements,s&=v;0<s;)h=31-ws(s),b=1<<h,v|=n[h],s&=~b;return v}function hb(n,s){switch(n){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function db(n,s){for(var h=n.suspendedLanes,v=n.pingedLanes,b=n.expirationTimes,I=n.pendingLanes;0<I;){var O=31-ws(I),u=1<<O,H=b[O];H===-1?(!(u&h)||u&v)&&(b[O]=hb(u,s)):H<=s&&(n.expiredLanes|=u),I&=~u}}function Xf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Wv(){var n=nd;return nd<<=1,!(nd&4194240)&&(nd=64),n}function uf(n){for(var s=[],h=0;31>h;h++)s.push(n);return s}function Ch(n,s,h){n.pendingLanes|=s,s!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,s=31-ws(s),n[s]=h}function pb(n,s){var h=n.pendingLanes&~s;n.pendingLanes=s,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=s,n.mutableReadLanes&=s,n.entangledLanes&=s,s=n.entanglements;var v=n.eventTimes;for(n=n.expirationTimes;0<h;){var b=31-ws(h),I=1<<b;s[b]=0,v[b]=-1,n[b]=-1,h&=~I}}function Nm(n,s){var h=n.entangledLanes|=s;for(n=n.entanglements;h;){var v=31-ws(h),b=1<<v;b&s|n[v]&s&&(n[v]|=s),h&=~b}}var _i=0;function Hv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Xv,Um,Kv,Yv,Jv,Kf=!1,od=[],Il=null,kl=null,Ml=null,dh=new Map,ph=new Map,Sl=[],fb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hy(n,s){switch(n){case"focusin":case"focusout":Il=null;break;case"dragenter":case"dragleave":kl=null;break;case"mouseover":case"mouseout":Ml=null;break;case"pointerover":case"pointerout":dh.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":ph.delete(s.pointerId)}}function jc(n,s,h,v,b,I){return n===null||n.nativeEvent!==I?(n={blockedOn:s,domEventName:h,eventSystemFlags:v,nativeEvent:I,targetContainers:[b]},s!==null&&(s=kh(s),s!==null&&Um(s)),n):(n.eventSystemFlags|=v,s=n.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),n)}function mb(n,s,h,v,b){switch(s){case"focusin":return Il=jc(Il,n,s,h,v,b),!0;case"dragenter":return kl=jc(kl,n,s,h,v,b),!0;case"mouseover":return Ml=jc(Ml,n,s,h,v,b),!0;case"pointerover":var I=b.pointerId;return dh.set(I,jc(dh.get(I)||null,n,s,h,v,b)),!0;case"gotpointercapture":return I=b.pointerId,ph.set(I,jc(ph.get(I)||null,n,s,h,v,b)),!0}return!1}function Qv(n){var s=su(n.target);if(s!==null){var h=gu(s);if(h!==null){if(s=h.tag,s===13){if(s=Vv(h),s!==null){n.blockedOn=s,Jv(n.priority,function(){Kv(h)});return}}else if(s===3&&h.stateNode.current.memoizedState.isDehydrated){n.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}n.blockedOn=null}function vd(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var h=Yf(n.domEventName,n.eventSystemFlags,s[0],n.nativeEvent);if(h===null){h=n.nativeEvent;var v=new h.constructor(h.type,h);qf=v,h.target.dispatchEvent(v),qf=null}else return s=kh(h),s!==null&&Um(s),n.blockedOn=h,!1;s.shift()}return!0}function dy(n,s,h){vd(n)&&h.delete(s)}function _b(){Kf=!1,Il!==null&&vd(Il)&&(Il=null),kl!==null&&vd(kl)&&(kl=null),Ml!==null&&vd(Ml)&&(Ml=null),dh.forEach(dy),ph.forEach(dy)}function qc(n,s){n.blockedOn===s&&(n.blockedOn=null,Kf||(Kf=!0,To.unstable_scheduleCallback(To.unstable_NormalPriority,_b)))}function fh(n){function s(b){return qc(b,n)}if(0<od.length){qc(od[0],n);for(var h=1;h<od.length;h++){var v=od[h];v.blockedOn===n&&(v.blockedOn=null)}}for(Il!==null&&qc(Il,n),kl!==null&&qc(kl,n),Ml!==null&&qc(Ml,n),dh.forEach(s),ph.forEach(s),h=0;h<Sl.length;h++)v=Sl[h],v.blockedOn===n&&(v.blockedOn=null);for(;0<Sl.length&&(h=Sl[0],h.blockedOn===null);)Qv(h),h.blockedOn===null&&Sl.shift()}var ic=Oa.ReactCurrentBatchConfig,Dd=!0;function gb(n,s,h,v){var b=_i,I=ic.transition;ic.transition=null;try{_i=1,Vm(n,s,h,v)}finally{_i=b,ic.transition=I}}function yb(n,s,h,v){var b=_i,I=ic.transition;ic.transition=null;try{_i=4,Vm(n,s,h,v)}finally{_i=b,ic.transition=I}}function Vm(n,s,h,v){if(Dd){var b=Yf(n,s,h,v);if(b===null)vf(n,s,v,Rd,h),hy(n,v);else if(mb(b,n,s,h,v))v.stopPropagation();else if(hy(n,v),s&4&&-1<fb.indexOf(n)){for(;b!==null;){var I=kh(b);if(I!==null&&Xv(I),I=Yf(n,s,h,v),I===null&&vf(n,s,v,Rd,h),I===b)break;b=I}b!==null&&v.stopPropagation()}else vf(n,s,v,null,h)}}var Rd=null;function Yf(n,s,h,v){if(Rd=null,n=Om(v),n=su(n),n!==null)if(s=gu(n),s===null)n=null;else if(h=s.tag,h===13){if(n=Vv(s),n!==null)return n;n=null}else if(h===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null);return Rd=n,null}function ex(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ob()){case Fm:return 1;case qv:return 4;case Ad:case sb:return 16;case Gv:return 536870912;default:return 16}default:return 16}}var Pl=null,Zm=null,xd=null;function tx(){if(xd)return xd;var n,s=Zm,h=s.length,v,b="value"in Pl?Pl.value:Pl.textContent,I=b.length;for(n=0;n<h&&s[n]===b[n];n++);var O=h-n;for(v=1;v<=O&&s[h-v]===b[I-v];v++);return xd=b.slice(n,1<v?1-v:void 0)}function wd(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function sd(){return!0}function py(){return!1}function Eo(n){function s(h,v,b,I,O){this._reactName=h,this._targetInst=b,this.type=v,this.nativeEvent=I,this.target=O,this.currentTarget=null;for(var u in n)n.hasOwnProperty(u)&&(h=n[u],this[u]=h?h(I):I[u]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?sd:py,this.isPropagationStopped=py,this}return Qi(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=sd)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=sd)},persist:function(){},isPersistent:sd}),s}var pc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$m=Eo(pc),Ih=Qi({},pc,{view:0,detail:0}),vb=Eo(Ih),cf,hf,Gc,tp=Qi({},Ih,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jm,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Gc&&(Gc&&n.type==="mousemove"?(cf=n.screenX-Gc.screenX,hf=n.screenY-Gc.screenY):hf=cf=0,Gc=n),cf)},movementY:function(n){return"movementY"in n?n.movementY:hf}}),fy=Eo(tp),xb=Qi({},tp,{dataTransfer:0}),wb=Eo(xb),bb=Qi({},Ih,{relatedTarget:0}),df=Eo(bb),Tb=Qi({},pc,{animationName:0,elapsedTime:0,pseudoElement:0}),Sb=Eo(Tb),Eb=Qi({},pc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Pb=Eo(Eb),Cb=Qi({},pc,{data:0}),my=Eo(Cb),Ib={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zb(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Mb[n])?!!s[n]:!1}function jm(){return zb}var Ab=Qi({},Ih,{key:function(n){if(n.key){var s=Ib[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=wd(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?kb[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jm,charCode:function(n){return n.type==="keypress"?wd(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?wd(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Lb=Eo(Ab),Db=Qi({},tp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_y=Eo(Db),Rb=Qi({},Ih,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jm}),Bb=Eo(Rb),Ob=Qi({},pc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fb=Eo(Ob),Nb=Qi({},tp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Ub=Eo(Nb),Vb=[9,13,27,32],qm=La&&"CompositionEvent"in window,ih=null;La&&"documentMode"in document&&(ih=document.documentMode);var Zb=La&&"TextEvent"in window&&!ih,ix=La&&(!qm||ih&&8<ih&&11>=ih),gy=String.fromCharCode(32),yy=!1;function nx(n,s){switch(n){case"keyup":return Vb.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rx(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var $u=!1;function $b(n,s){switch(n){case"compositionend":return rx(s);case"keypress":return s.which!==32?null:(yy=!0,gy);case"textInput":return n=s.data,n===gy&&yy?null:n;default:return null}}function jb(n,s){if($u)return n==="compositionend"||!qm&&nx(n,s)?(n=tx(),xd=Zm=Pl=null,$u=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return ix&&s.locale!=="ko"?null:s.data;default:return null}}var qb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vy(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!qb[n.type]:s==="textarea"}function ox(n,s,h,v){Bv(v),s=Bd(s,"onChange"),0<s.length&&(h=new $m("onChange","change",null,h,v),n.push({event:h,listeners:s}))}var nh=null,mh=null;function Gb(n){_x(n,0)}function ip(n){var s=Gu(n);if(kv(s))return n}function Wb(n,s){if(n==="change")return s}var sx=!1;if(La){var pf;if(La){var ff="oninput"in document;if(!ff){var xy=document.createElement("div");xy.setAttribute("oninput","return;"),ff=typeof xy.oninput=="function"}pf=ff}else pf=!1;sx=pf&&(!document.documentMode||9<document.documentMode)}function wy(){nh&&(nh.detachEvent("onpropertychange",ax),mh=nh=null)}function ax(n){if(n.propertyName==="value"&&ip(mh)){var s=[];ox(s,mh,n,Om(n)),Uv(Gb,s)}}function Hb(n,s,h){n==="focusin"?(wy(),nh=s,mh=h,nh.attachEvent("onpropertychange",ax)):n==="focusout"&&wy()}function Xb(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ip(mh)}function Kb(n,s){if(n==="click")return ip(s)}function Yb(n,s){if(n==="input"||n==="change")return ip(s)}function Jb(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var Ts=typeof Object.is=="function"?Object.is:Jb;function _h(n,s){if(Ts(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var h=Object.keys(n),v=Object.keys(s);if(h.length!==v.length)return!1;for(v=0;v<h.length;v++){var b=h[v];if(!Lf.call(s,b)||!Ts(n[b],s[b]))return!1}return!0}function by(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Ty(n,s){var h=by(n);n=0;for(var v;h;){if(h.nodeType===3){if(v=n+h.textContent.length,n<=s&&v>=s)return{node:h,offset:s-n};n=v}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=by(h)}}function lx(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?lx(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function ux(){for(var n=window,s=kd();s instanceof n.HTMLIFrameElement;){try{var h=typeof s.contentWindow.location.href=="string"}catch{h=!1}if(h)n=s.contentWindow;else break;s=kd(n.document)}return s}function Gm(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}function Qb(n){var s=ux(),h=n.focusedElem,v=n.selectionRange;if(s!==h&&h&&h.ownerDocument&&lx(h.ownerDocument.documentElement,h)){if(v!==null&&Gm(h)){if(s=v.start,n=v.end,n===void 0&&(n=s),"selectionStart"in h)h.selectionStart=s,h.selectionEnd=Math.min(n,h.value.length);else if(n=(s=h.ownerDocument||document)&&s.defaultView||window,n.getSelection){n=n.getSelection();var b=h.textContent.length,I=Math.min(v.start,b);v=v.end===void 0?I:Math.min(v.end,b),!n.extend&&I>v&&(b=v,v=I,I=b),b=Ty(h,I);var O=Ty(h,v);b&&O&&(n.rangeCount!==1||n.anchorNode!==b.node||n.anchorOffset!==b.offset||n.focusNode!==O.node||n.focusOffset!==O.offset)&&(s=s.createRange(),s.setStart(b.node,b.offset),n.removeAllRanges(),I>v?(n.addRange(s),n.extend(O.node,O.offset)):(s.setEnd(O.node,O.offset),n.addRange(s)))}}for(s=[],n=h;n=n.parentNode;)n.nodeType===1&&s.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<s.length;h++)n=s[h],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var e2=La&&"documentMode"in document&&11>=document.documentMode,ju=null,Jf=null,rh=null,Qf=!1;function Sy(n,s,h){var v=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Qf||ju==null||ju!==kd(v)||(v=ju,"selectionStart"in v&&Gm(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),rh&&_h(rh,v)||(rh=v,v=Bd(Jf,"onSelect"),0<v.length&&(s=new $m("onSelect","select",null,s,h),n.push({event:s,listeners:v}),s.target=ju)))}function ad(n,s){var h={};return h[n.toLowerCase()]=s.toLowerCase(),h["Webkit"+n]="webkit"+s,h["Moz"+n]="moz"+s,h}var qu={animationend:ad("Animation","AnimationEnd"),animationiteration:ad("Animation","AnimationIteration"),animationstart:ad("Animation","AnimationStart"),transitionend:ad("Transition","TransitionEnd")},mf={},cx={};La&&(cx=document.createElement("div").style,"AnimationEvent"in window||(delete qu.animationend.animation,delete qu.animationiteration.animation,delete qu.animationstart.animation),"TransitionEvent"in window||delete qu.transitionend.transition);function np(n){if(mf[n])return mf[n];if(!qu[n])return n;var s=qu[n],h;for(h in s)if(s.hasOwnProperty(h)&&h in cx)return mf[n]=s[h];return n}var hx=np("animationend"),dx=np("animationiteration"),px=np("animationstart"),fx=np("transitionend"),mx=new Map,Ey="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fl(n,s){mx.set(n,s),_u(s,[n])}for(var _f=0;_f<Ey.length;_f++){var gf=Ey[_f],t2=gf.toLowerCase(),i2=gf[0].toUpperCase()+gf.slice(1);Fl(t2,"on"+i2)}Fl(hx,"onAnimationEnd");Fl(dx,"onAnimationIteration");Fl(px,"onAnimationStart");Fl("dblclick","onDoubleClick");Fl("focusin","onFocus");Fl("focusout","onBlur");Fl(fx,"onTransitionEnd");oc("onMouseEnter",["mouseout","mouseover"]);oc("onMouseLeave",["mouseout","mouseover"]);oc("onPointerEnter",["pointerout","pointerover"]);oc("onPointerLeave",["pointerout","pointerover"]);_u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_u("onBeforeInput",["compositionend","keypress","textInput","paste"]);_u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n2=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qc));function Py(n,s,h){var v=n.type||"unknown-event";n.currentTarget=h,tb(v,s,void 0,n),n.currentTarget=null}function _x(n,s){s=(s&4)!==0;for(var h=0;h<n.length;h++){var v=n[h],b=v.event;v=v.listeners;e:{var I=void 0;if(s)for(var O=v.length-1;0<=O;O--){var u=v[O],H=u.instance,q=u.currentTarget;if(u=u.listener,H!==I&&b.isPropagationStopped())break e;Py(b,u,q),I=H}else for(O=0;O<v.length;O++){if(u=v[O],H=u.instance,q=u.currentTarget,u=u.listener,H!==I&&b.isPropagationStopped())break e;Py(b,u,q),I=H}}}if(zd)throw n=Hf,zd=!1,Hf=null,n}function Di(n,s){var h=s[rm];h===void 0&&(h=s[rm]=new Set);var v=n+"__bubble";h.has(v)||(gx(s,n,2,!1),h.add(v))}function yf(n,s,h){var v=0;s&&(v|=4),gx(h,n,v,s)}var ld="_reactListening"+Math.random().toString(36).slice(2);function gh(n){if(!n[ld]){n[ld]=!0,Sv.forEach(function(h){h!=="selectionchange"&&(n2.has(h)||yf(h,!1,n),yf(h,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[ld]||(s[ld]=!0,yf("selectionchange",!1,s))}}function gx(n,s,h,v){switch(ex(s)){case 1:var b=gb;break;case 4:b=yb;break;default:b=Vm}h=b.bind(null,s,h,n),b=void 0,!Wf||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),v?b!==void 0?n.addEventListener(s,h,{capture:!0,passive:b}):n.addEventListener(s,h,!0):b!==void 0?n.addEventListener(s,h,{passive:b}):n.addEventListener(s,h,!1)}function vf(n,s,h,v,b){var I=v;if(!(s&1)&&!(s&2)&&v!==null)e:for(;;){if(v===null)return;var O=v.tag;if(O===3||O===4){var u=v.stateNode.containerInfo;if(u===b||u.nodeType===8&&u.parentNode===b)break;if(O===4)for(O=v.return;O!==null;){var H=O.tag;if((H===3||H===4)&&(H=O.stateNode.containerInfo,H===b||H.nodeType===8&&H.parentNode===b))return;O=O.return}for(;u!==null;){if(O=su(u),O===null)return;if(H=O.tag,H===5||H===6){v=I=O;continue e}u=u.parentNode}}v=v.return}Uv(function(){var q=I,ke=Om(h),_e=[];e:{var Ce=mx.get(n);if(Ce!==void 0){var Ue=$m,We=n;switch(n){case"keypress":if(wd(h)===0)break e;case"keydown":case"keyup":Ue=Lb;break;case"focusin":We="focus",Ue=df;break;case"focusout":We="blur",Ue=df;break;case"beforeblur":case"afterblur":Ue=df;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ue=fy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ue=wb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ue=Bb;break;case hx:case dx:case px:Ue=Sb;break;case fx:Ue=Fb;break;case"scroll":Ue=vb;break;case"wheel":Ue=Ub;break;case"copy":case"cut":case"paste":Ue=Pb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ue=_y}var Fe=(s&4)!==0,Bt=!Fe&&n==="scroll",pe=Fe?Ce!==null?Ce+"Capture":null:Ce;Fe=[];for(var ue=q,ye;ue!==null;){ye=ue;var Ne=ye.stateNode;if(ye.tag===5&&Ne!==null&&(ye=Ne,pe!==null&&(Ne=hh(ue,pe),Ne!=null&&Fe.push(yh(ue,Ne,ye)))),Bt)break;ue=ue.return}0<Fe.length&&(Ce=new Ue(Ce,We,null,h,ke),_e.push({event:Ce,listeners:Fe}))}}if(!(s&7)){e:{if(Ce=n==="mouseover"||n==="pointerover",Ue=n==="mouseout"||n==="pointerout",Ce&&h!==qf&&(We=h.relatedTarget||h.fromElement)&&(su(We)||We[Da]))break e;if((Ue||Ce)&&(Ce=ke.window===ke?ke:(Ce=ke.ownerDocument)?Ce.defaultView||Ce.parentWindow:window,Ue?(We=h.relatedTarget||h.toElement,Ue=q,We=We?su(We):null,We!==null&&(Bt=gu(We),We!==Bt||We.tag!==5&&We.tag!==6)&&(We=null)):(Ue=null,We=q),Ue!==We)){if(Fe=fy,Ne="onMouseLeave",pe="onMouseEnter",ue="mouse",(n==="pointerout"||n==="pointerover")&&(Fe=_y,Ne="onPointerLeave",pe="onPointerEnter",ue="pointer"),Bt=Ue==null?Ce:Gu(Ue),ye=We==null?Ce:Gu(We),Ce=new Fe(Ne,ue+"leave",Ue,h,ke),Ce.target=Bt,Ce.relatedTarget=ye,Ne=null,su(ke)===q&&(Fe=new Fe(pe,ue+"enter",We,h,ke),Fe.target=ye,Fe.relatedTarget=Bt,Ne=Fe),Bt=Ne,Ue&&We)t:{for(Fe=Ue,pe=We,ue=0,ye=Fe;ye;ye=Uu(ye))ue++;for(ye=0,Ne=pe;Ne;Ne=Uu(Ne))ye++;for(;0<ue-ye;)Fe=Uu(Fe),ue--;for(;0<ye-ue;)pe=Uu(pe),ye--;for(;ue--;){if(Fe===pe||pe!==null&&Fe===pe.alternate)break t;Fe=Uu(Fe),pe=Uu(pe)}Fe=null}else Fe=null;Ue!==null&&Cy(_e,Ce,Ue,Fe,!1),We!==null&&Bt!==null&&Cy(_e,Bt,We,Fe,!0)}}e:{if(Ce=q?Gu(q):window,Ue=Ce.nodeName&&Ce.nodeName.toLowerCase(),Ue==="select"||Ue==="input"&&Ce.type==="file")var tt=Wb;else if(vy(Ce))if(sx)tt=Yb;else{tt=Xb;var ht=Hb}else(Ue=Ce.nodeName)&&Ue.toLowerCase()==="input"&&(Ce.type==="checkbox"||Ce.type==="radio")&&(tt=Kb);if(tt&&(tt=tt(n,q))){ox(_e,tt,h,ke);break e}ht&&ht(n,Ce,q),n==="focusout"&&(ht=Ce._wrapperState)&&ht.controlled&&Ce.type==="number"&&Uf(Ce,"number",Ce.value)}switch(ht=q?Gu(q):window,n){case"focusin":(vy(ht)||ht.contentEditable==="true")&&(ju=ht,Jf=q,rh=null);break;case"focusout":rh=Jf=ju=null;break;case"mousedown":Qf=!0;break;case"contextmenu":case"mouseup":case"dragend":Qf=!1,Sy(_e,h,ke);break;case"selectionchange":if(e2)break;case"keydown":case"keyup":Sy(_e,h,ke)}var rt;if(qm)e:{switch(n){case"compositionstart":var dt="onCompositionStart";break e;case"compositionend":dt="onCompositionEnd";break e;case"compositionupdate":dt="onCompositionUpdate";break e}dt=void 0}else $u?nx(n,h)&&(dt="onCompositionEnd"):n==="keydown"&&h.keyCode===229&&(dt="onCompositionStart");dt&&(ix&&h.locale!=="ko"&&($u||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&$u&&(rt=tx()):(Pl=ke,Zm="value"in Pl?Pl.value:Pl.textContent,$u=!0)),ht=Bd(q,dt),0<ht.length&&(dt=new my(dt,n,null,h,ke),_e.push({event:dt,listeners:ht}),rt?dt.data=rt:(rt=rx(h),rt!==null&&(dt.data=rt)))),(rt=Zb?$b(n,h):jb(n,h))&&(q=Bd(q,"onBeforeInput"),0<q.length&&(ke=new my("onBeforeInput","beforeinput",null,h,ke),_e.push({event:ke,listeners:q}),ke.data=rt))}_x(_e,s)})}function yh(n,s,h){return{instance:n,listener:s,currentTarget:h}}function Bd(n,s){for(var h=s+"Capture",v=[];n!==null;){var b=n,I=b.stateNode;b.tag===5&&I!==null&&(b=I,I=hh(n,h),I!=null&&v.unshift(yh(n,I,b)),I=hh(n,s),I!=null&&v.push(yh(n,I,b))),n=n.return}return v}function Uu(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Cy(n,s,h,v,b){for(var I=s._reactName,O=[];h!==null&&h!==v;){var u=h,H=u.alternate,q=u.stateNode;if(H!==null&&H===v)break;u.tag===5&&q!==null&&(u=q,b?(H=hh(h,I),H!=null&&O.unshift(yh(h,H,u))):b||(H=hh(h,I),H!=null&&O.push(yh(h,H,u)))),h=h.return}O.length!==0&&n.push({event:s,listeners:O})}var r2=/\r\n?/g,o2=/\u0000|\uFFFD/g;function Iy(n){return(typeof n=="string"?n:""+n).replace(r2,`
`).replace(o2,"")}function ud(n,s,h){if(s=Iy(s),Iy(n)!==s&&h)throw Error($e(425))}function Od(){}var em=null,tm=null;function im(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var nm=typeof setTimeout=="function"?setTimeout:void 0,s2=typeof clearTimeout=="function"?clearTimeout:void 0,ky=typeof Promise=="function"?Promise:void 0,a2=typeof queueMicrotask=="function"?queueMicrotask:typeof ky<"u"?function(n){return ky.resolve(null).then(n).catch(l2)}:nm;function l2(n){setTimeout(function(){throw n})}function xf(n,s){var h=s,v=0;do{var b=h.nextSibling;if(n.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(v===0){n.removeChild(b),fh(s);return}v--}else h!=="$"&&h!=="$?"&&h!=="$!"||v++;h=b}while(h);fh(s)}function zl(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return n}function My(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var h=n.data;if(h==="$"||h==="$!"||h==="$?"){if(s===0)return n;s--}else h==="/$"&&s++}n=n.previousSibling}return null}var fc=Math.random().toString(36).slice(2),Qs="__reactFiber$"+fc,vh="__reactProps$"+fc,Da="__reactContainer$"+fc,rm="__reactEvents$"+fc,u2="__reactListeners$"+fc,c2="__reactHandles$"+fc;function su(n){var s=n[Qs];if(s)return s;for(var h=n.parentNode;h;){if(s=h[Da]||h[Qs]){if(h=s.alternate,s.child!==null||h!==null&&h.child!==null)for(n=My(n);n!==null;){if(h=n[Qs])return h;n=My(n)}return s}n=h,h=n.parentNode}return null}function kh(n){return n=n[Qs]||n[Da],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Gu(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error($e(33))}function rp(n){return n[vh]||null}var om=[],Wu=-1;function Nl(n){return{current:n}}function Ri(n){0>Wu||(n.current=om[Wu],om[Wu]=null,Wu--)}function Ii(n,s){Wu++,om[Wu]=n.current,n.current=s}var Ol={},_r=Nl(Ol),Kr=Nl(!1),hu=Ol;function sc(n,s){var h=n.type.contextTypes;if(!h)return Ol;var v=n.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===s)return v.__reactInternalMemoizedMaskedChildContext;var b={},I;for(I in h)b[I]=s[I];return v&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=b),b}function Yr(n){return n=n.childContextTypes,n!=null}function Fd(){Ri(Kr),Ri(_r)}function zy(n,s,h){if(_r.current!==Ol)throw Error($e(168));Ii(_r,s),Ii(Kr,h)}function yx(n,s,h){var v=n.stateNode;if(s=s.childContextTypes,typeof v.getChildContext!="function")return h;v=v.getChildContext();for(var b in v)if(!(b in s))throw Error($e(108,Hw(n)||"Unknown",b));return Qi({},h,v)}function Nd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ol,hu=_r.current,Ii(_r,n),Ii(Kr,Kr.current),!0}function Ay(n,s,h){var v=n.stateNode;if(!v)throw Error($e(169));h?(n=yx(n,s,hu),v.__reactInternalMemoizedMergedChildContext=n,Ri(Kr),Ri(_r),Ii(_r,n)):Ri(Kr),Ii(Kr,h)}var ka=null,op=!1,wf=!1;function vx(n){ka===null?ka=[n]:ka.push(n)}function h2(n){op=!0,vx(n)}function Ul(){if(!wf&&ka!==null){wf=!0;var n=0,s=_i;try{var h=ka;for(_i=1;n<h.length;n++){var v=h[n];do v=v(!0);while(v!==null)}ka=null,op=!1}catch(b){throw ka!==null&&(ka=ka.slice(n+1)),jv(Fm,Ul),b}finally{_i=s,wf=!1}}return null}var Hu=[],Xu=0,Ud=null,Vd=0,No=[],Uo=0,du=null,Ma=1,za="";function ru(n,s){Hu[Xu++]=Vd,Hu[Xu++]=Ud,Ud=n,Vd=s}function xx(n,s,h){No[Uo++]=Ma,No[Uo++]=za,No[Uo++]=du,du=n;var v=Ma;n=za;var b=32-ws(v)-1;v&=~(1<<b),h+=1;var I=32-ws(s)+b;if(30<I){var O=b-b%5;I=(v&(1<<O)-1).toString(32),v>>=O,b-=O,Ma=1<<32-ws(s)+b|h<<b|v,za=I+n}else Ma=1<<I|h<<b|v,za=n}function Wm(n){n.return!==null&&(ru(n,1),xx(n,1,0))}function Hm(n){for(;n===Ud;)Ud=Hu[--Xu],Hu[Xu]=null,Vd=Hu[--Xu],Hu[Xu]=null;for(;n===du;)du=No[--Uo],No[Uo]=null,za=No[--Uo],No[Uo]=null,Ma=No[--Uo],No[Uo]=null}var bo=null,wo=null,$i=!1,xs=null;function wx(n,s){var h=Vo(5,null,null,0);h.elementType="DELETED",h.stateNode=s,h.return=n,s=n.deletions,s===null?(n.deletions=[h],n.flags|=16):s.push(h)}function Ly(n,s){switch(n.tag){case 5:var h=n.type;return s=s.nodeType!==1||h.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(n.stateNode=s,bo=n,wo=zl(s.firstChild),!0):!1;case 6:return s=n.pendingProps===""||s.nodeType!==3?null:s,s!==null?(n.stateNode=s,bo=n,wo=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(h=du!==null?{id:Ma,overflow:za}:null,n.memoizedState={dehydrated:s,treeContext:h,retryLane:1073741824},h=Vo(18,null,null,0),h.stateNode=s,h.return=n,n.child=h,bo=n,wo=null,!0):!1;default:return!1}}function sm(n){return(n.mode&1)!==0&&(n.flags&128)===0}function am(n){if($i){var s=wo;if(s){var h=s;if(!Ly(n,s)){if(sm(n))throw Error($e(418));s=zl(h.nextSibling);var v=bo;s&&Ly(n,s)?wx(v,h):(n.flags=n.flags&-4097|2,$i=!1,bo=n)}}else{if(sm(n))throw Error($e(418));n.flags=n.flags&-4097|2,$i=!1,bo=n}}}function Dy(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;bo=n}function cd(n){if(n!==bo)return!1;if(!$i)return Dy(n),$i=!0,!1;var s;if((s=n.tag!==3)&&!(s=n.tag!==5)&&(s=n.type,s=s!=="head"&&s!=="body"&&!im(n.type,n.memoizedProps)),s&&(s=wo)){if(sm(n))throw bx(),Error($e(418));for(;s;)wx(n,s),s=zl(s.nextSibling)}if(Dy(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error($e(317));e:{for(n=n.nextSibling,s=0;n;){if(n.nodeType===8){var h=n.data;if(h==="/$"){if(s===0){wo=zl(n.nextSibling);break e}s--}else h!=="$"&&h!=="$!"&&h!=="$?"||s++}n=n.nextSibling}wo=null}}else wo=bo?zl(n.stateNode.nextSibling):null;return!0}function bx(){for(var n=wo;n;)n=zl(n.nextSibling)}function ac(){wo=bo=null,$i=!1}function Xm(n){xs===null?xs=[n]:xs.push(n)}var d2=Oa.ReactCurrentBatchConfig;function ys(n,s){if(n&&n.defaultProps){s=Qi({},s),n=n.defaultProps;for(var h in n)s[h]===void 0&&(s[h]=n[h]);return s}return s}var Zd=Nl(null),$d=null,Ku=null,Km=null;function Ym(){Km=Ku=$d=null}function Jm(n){var s=Zd.current;Ri(Zd),n._currentValue=s}function lm(n,s,h){for(;n!==null;){var v=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,v!==null&&(v.childLanes|=s)):v!==null&&(v.childLanes&s)!==s&&(v.childLanes|=s),n===h)break;n=n.return}}function nc(n,s){$d=n,Km=Ku=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&s&&(Xr=!0),n.firstContext=null)}function $o(n){var s=n._currentValue;if(Km!==n)if(n={context:n,memoizedValue:s,next:null},Ku===null){if($d===null)throw Error($e(308));Ku=n,$d.dependencies={lanes:0,firstContext:n}}else Ku=Ku.next=n;return s}var au=null;function Qm(n){au===null?au=[n]:au.push(n)}function Tx(n,s,h,v){var b=s.interleaved;return b===null?(h.next=h,Qm(s)):(h.next=b.next,b.next=h),s.interleaved=h,Ra(n,v)}function Ra(n,s){n.lanes|=s;var h=n.alternate;for(h!==null&&(h.lanes|=s),h=n,n=n.return;n!==null;)n.childLanes|=s,h=n.alternate,h!==null&&(h.childLanes|=s),h=n,n=n.return;return h.tag===3?h.stateNode:null}var Tl=!1;function e_(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sx(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Aa(n,s){return{eventTime:n,lane:s,tag:0,payload:null,callback:null,next:null}}function Al(n,s,h){var v=n.updateQueue;if(v===null)return null;if(v=v.shared,si&2){var b=v.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),v.pending=s,Ra(n,h)}return b=v.interleaved,b===null?(s.next=s,Qm(v)):(s.next=b.next,b.next=s),v.interleaved=s,Ra(n,h)}function bd(n,s,h){if(s=s.updateQueue,s!==null&&(s=s.shared,(h&4194240)!==0)){var v=s.lanes;v&=n.pendingLanes,h|=v,s.lanes=h,Nm(n,h)}}function Ry(n,s){var h=n.updateQueue,v=n.alternate;if(v!==null&&(v=v.updateQueue,h===v)){var b=null,I=null;if(h=h.firstBaseUpdate,h!==null){do{var O={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};I===null?b=I=O:I=I.next=O,h=h.next}while(h!==null);I===null?b=I=s:I=I.next=s}else b=I=s;h={baseState:v.baseState,firstBaseUpdate:b,lastBaseUpdate:I,shared:v.shared,effects:v.effects},n.updateQueue=h;return}n=h.lastBaseUpdate,n===null?h.firstBaseUpdate=s:n.next=s,h.lastBaseUpdate=s}function jd(n,s,h,v){var b=n.updateQueue;Tl=!1;var I=b.firstBaseUpdate,O=b.lastBaseUpdate,u=b.shared.pending;if(u!==null){b.shared.pending=null;var H=u,q=H.next;H.next=null,O===null?I=q:O.next=q,O=H;var ke=n.alternate;ke!==null&&(ke=ke.updateQueue,u=ke.lastBaseUpdate,u!==O&&(u===null?ke.firstBaseUpdate=q:u.next=q,ke.lastBaseUpdate=H))}if(I!==null){var _e=b.baseState;O=0,ke=q=H=null,u=I;do{var Ce=u.lane,Ue=u.eventTime;if((v&Ce)===Ce){ke!==null&&(ke=ke.next={eventTime:Ue,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var We=n,Fe=u;switch(Ce=s,Ue=h,Fe.tag){case 1:if(We=Fe.payload,typeof We=="function"){_e=We.call(Ue,_e,Ce);break e}_e=We;break e;case 3:We.flags=We.flags&-65537|128;case 0:if(We=Fe.payload,Ce=typeof We=="function"?We.call(Ue,_e,Ce):We,Ce==null)break e;_e=Qi({},_e,Ce);break e;case 2:Tl=!0}}u.callback!==null&&u.lane!==0&&(n.flags|=64,Ce=b.effects,Ce===null?b.effects=[u]:Ce.push(u))}else Ue={eventTime:Ue,lane:Ce,tag:u.tag,payload:u.payload,callback:u.callback,next:null},ke===null?(q=ke=Ue,H=_e):ke=ke.next=Ue,O|=Ce;if(u=u.next,u===null){if(u=b.shared.pending,u===null)break;Ce=u,u=Ce.next,Ce.next=null,b.lastBaseUpdate=Ce,b.shared.pending=null}}while(1);if(ke===null&&(H=_e),b.baseState=H,b.firstBaseUpdate=q,b.lastBaseUpdate=ke,s=b.shared.interleaved,s!==null){b=s;do O|=b.lane,b=b.next;while(b!==s)}else I===null&&(b.shared.lanes=0);fu|=O,n.lanes=O,n.memoizedState=_e}}function By(n,s,h){if(n=s.effects,s.effects=null,n!==null)for(s=0;s<n.length;s++){var v=n[s],b=v.callback;if(b!==null){if(v.callback=null,v=h,typeof b!="function")throw Error($e(191,b));b.call(v)}}}var Ex=new Tv.Component().refs;function um(n,s,h,v){s=n.memoizedState,h=h(v,s),h=h==null?s:Qi({},s,h),n.memoizedState=h,n.lanes===0&&(n.updateQueue.baseState=h)}var sp={isMounted:function(n){return(n=n._reactInternals)?gu(n)===n:!1},enqueueSetState:function(n,s,h){n=n._reactInternals;var v=Ar(),b=Dl(n),I=Aa(v,b);I.payload=s,h!=null&&(I.callback=h),s=Al(n,I,b),s!==null&&(bs(s,n,b,v),bd(s,n,b))},enqueueReplaceState:function(n,s,h){n=n._reactInternals;var v=Ar(),b=Dl(n),I=Aa(v,b);I.tag=1,I.payload=s,h!=null&&(I.callback=h),s=Al(n,I,b),s!==null&&(bs(s,n,b,v),bd(s,n,b))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var h=Ar(),v=Dl(n),b=Aa(h,v);b.tag=2,s!=null&&(b.callback=s),s=Al(n,b,v),s!==null&&(bs(s,n,v,h),bd(s,n,v))}};function Oy(n,s,h,v,b,I,O){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(v,I,O):s.prototype&&s.prototype.isPureReactComponent?!_h(h,v)||!_h(b,I):!0}function Px(n,s,h){var v=!1,b=Ol,I=s.contextType;return typeof I=="object"&&I!==null?I=$o(I):(b=Yr(s)?hu:_r.current,v=s.contextTypes,I=(v=v!=null)?sc(n,b):Ol),s=new s(h,I),n.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=sp,n.stateNode=s,s._reactInternals=n,v&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=b,n.__reactInternalMemoizedMaskedChildContext=I),s}function Fy(n,s,h,v){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(h,v),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(h,v),s.state!==n&&sp.enqueueReplaceState(s,s.state,null)}function cm(n,s,h,v){var b=n.stateNode;b.props=h,b.state=n.memoizedState,b.refs=Ex,e_(n);var I=s.contextType;typeof I=="object"&&I!==null?b.context=$o(I):(I=Yr(s)?hu:_r.current,b.context=sc(n,I)),b.state=n.memoizedState,I=s.getDerivedStateFromProps,typeof I=="function"&&(um(n,s,I,h),b.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(s=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),s!==b.state&&sp.enqueueReplaceState(b,b.state,null),jd(n,h,b,v),b.state=n.memoizedState),typeof b.componentDidMount=="function"&&(n.flags|=4194308)}function Wc(n,s,h){if(n=h.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error($e(309));var v=h.stateNode}if(!v)throw Error($e(147,n));var b=v,I=""+n;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===I?s.ref:(s=function(O){var u=b.refs;u===Ex&&(u=b.refs={}),O===null?delete u[I]:u[I]=O},s._stringRef=I,s)}if(typeof n!="string")throw Error($e(284));if(!h._owner)throw Error($e(290,n))}return n}function hd(n,s){throw n=Object.prototype.toString.call(s),Error($e(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n))}function Ny(n){var s=n._init;return s(n._payload)}function Cx(n){function s(pe,ue){if(n){var ye=pe.deletions;ye===null?(pe.deletions=[ue],pe.flags|=16):ye.push(ue)}}function h(pe,ue){if(!n)return null;for(;ue!==null;)s(pe,ue),ue=ue.sibling;return null}function v(pe,ue){for(pe=new Map;ue!==null;)ue.key!==null?pe.set(ue.key,ue):pe.set(ue.index,ue),ue=ue.sibling;return pe}function b(pe,ue){return pe=Rl(pe,ue),pe.index=0,pe.sibling=null,pe}function I(pe,ue,ye){return pe.index=ye,n?(ye=pe.alternate,ye!==null?(ye=ye.index,ye<ue?(pe.flags|=2,ue):ye):(pe.flags|=2,ue)):(pe.flags|=1048576,ue)}function O(pe){return n&&pe.alternate===null&&(pe.flags|=2),pe}function u(pe,ue,ye,Ne){return ue===null||ue.tag!==6?(ue=If(ye,pe.mode,Ne),ue.return=pe,ue):(ue=b(ue,ye),ue.return=pe,ue)}function H(pe,ue,ye,Ne){var tt=ye.type;return tt===Zu?ke(pe,ue,ye.props.children,Ne,ye.key):ue!==null&&(ue.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===bl&&Ny(tt)===ue.type)?(Ne=b(ue,ye.props),Ne.ref=Wc(pe,ue,ye),Ne.return=pe,Ne):(Ne=Id(ye.type,ye.key,ye.props,null,pe.mode,Ne),Ne.ref=Wc(pe,ue,ye),Ne.return=pe,Ne)}function q(pe,ue,ye,Ne){return ue===null||ue.tag!==4||ue.stateNode.containerInfo!==ye.containerInfo||ue.stateNode.implementation!==ye.implementation?(ue=kf(ye,pe.mode,Ne),ue.return=pe,ue):(ue=b(ue,ye.children||[]),ue.return=pe,ue)}function ke(pe,ue,ye,Ne,tt){return ue===null||ue.tag!==7?(ue=cu(ye,pe.mode,Ne,tt),ue.return=pe,ue):(ue=b(ue,ye),ue.return=pe,ue)}function _e(pe,ue,ye){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return ue=If(""+ue,pe.mode,ye),ue.return=pe,ue;if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case ed:return ye=Id(ue.type,ue.key,ue.props,null,pe.mode,ye),ye.ref=Wc(pe,null,ue),ye.return=pe,ye;case Vu:return ue=kf(ue,pe.mode,ye),ue.return=pe,ue;case bl:var Ne=ue._init;return _e(pe,Ne(ue._payload),ye)}if(Yc(ue)||Zc(ue))return ue=cu(ue,pe.mode,ye,null),ue.return=pe,ue;hd(pe,ue)}return null}function Ce(pe,ue,ye,Ne){var tt=ue!==null?ue.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number")return tt!==null?null:u(pe,ue,""+ye,Ne);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case ed:return ye.key===tt?H(pe,ue,ye,Ne):null;case Vu:return ye.key===tt?q(pe,ue,ye,Ne):null;case bl:return tt=ye._init,Ce(pe,ue,tt(ye._payload),Ne)}if(Yc(ye)||Zc(ye))return tt!==null?null:ke(pe,ue,ye,Ne,null);hd(pe,ye)}return null}function Ue(pe,ue,ye,Ne,tt){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return pe=pe.get(ye)||null,u(ue,pe,""+Ne,tt);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case ed:return pe=pe.get(Ne.key===null?ye:Ne.key)||null,H(ue,pe,Ne,tt);case Vu:return pe=pe.get(Ne.key===null?ye:Ne.key)||null,q(ue,pe,Ne,tt);case bl:var ht=Ne._init;return Ue(pe,ue,ye,ht(Ne._payload),tt)}if(Yc(Ne)||Zc(Ne))return pe=pe.get(ye)||null,ke(ue,pe,Ne,tt,null);hd(ue,Ne)}return null}function We(pe,ue,ye,Ne){for(var tt=null,ht=null,rt=ue,dt=ue=0,Ut=null;rt!==null&&dt<ye.length;dt++){rt.index>dt?(Ut=rt,rt=null):Ut=rt.sibling;var ct=Ce(pe,rt,ye[dt],Ne);if(ct===null){rt===null&&(rt=Ut);break}n&&rt&&ct.alternate===null&&s(pe,rt),ue=I(ct,ue,dt),ht===null?tt=ct:ht.sibling=ct,ht=ct,rt=Ut}if(dt===ye.length)return h(pe,rt),$i&&ru(pe,dt),tt;if(rt===null){for(;dt<ye.length;dt++)rt=_e(pe,ye[dt],Ne),rt!==null&&(ue=I(rt,ue,dt),ht===null?tt=rt:ht.sibling=rt,ht=rt);return $i&&ru(pe,dt),tt}for(rt=v(pe,rt);dt<ye.length;dt++)Ut=Ue(rt,pe,dt,ye[dt],Ne),Ut!==null&&(n&&Ut.alternate!==null&&rt.delete(Ut.key===null?dt:Ut.key),ue=I(Ut,ue,dt),ht===null?tt=Ut:ht.sibling=Ut,ht=Ut);return n&&rt.forEach(function(ei){return s(pe,ei)}),$i&&ru(pe,dt),tt}function Fe(pe,ue,ye,Ne){var tt=Zc(ye);if(typeof tt!="function")throw Error($e(150));if(ye=tt.call(ye),ye==null)throw Error($e(151));for(var ht=tt=null,rt=ue,dt=ue=0,Ut=null,ct=ye.next();rt!==null&&!ct.done;dt++,ct=ye.next()){rt.index>dt?(Ut=rt,rt=null):Ut=rt.sibling;var ei=Ce(pe,rt,ct.value,Ne);if(ei===null){rt===null&&(rt=Ut);break}n&&rt&&ei.alternate===null&&s(pe,rt),ue=I(ei,ue,dt),ht===null?tt=ei:ht.sibling=ei,ht=ei,rt=Ut}if(ct.done)return h(pe,rt),$i&&ru(pe,dt),tt;if(rt===null){for(;!ct.done;dt++,ct=ye.next())ct=_e(pe,ct.value,Ne),ct!==null&&(ue=I(ct,ue,dt),ht===null?tt=ct:ht.sibling=ct,ht=ct);return $i&&ru(pe,dt),tt}for(rt=v(pe,rt);!ct.done;dt++,ct=ye.next())ct=Ue(rt,pe,dt,ct.value,Ne),ct!==null&&(n&&ct.alternate!==null&&rt.delete(ct.key===null?dt:ct.key),ue=I(ct,ue,dt),ht===null?tt=ct:ht.sibling=ct,ht=ct);return n&&rt.forEach(function(ri){return s(pe,ri)}),$i&&ru(pe,dt),tt}function Bt(pe,ue,ye,Ne){if(typeof ye=="object"&&ye!==null&&ye.type===Zu&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case ed:e:{for(var tt=ye.key,ht=ue;ht!==null;){if(ht.key===tt){if(tt=ye.type,tt===Zu){if(ht.tag===7){h(pe,ht.sibling),ue=b(ht,ye.props.children),ue.return=pe,pe=ue;break e}}else if(ht.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===bl&&Ny(tt)===ht.type){h(pe,ht.sibling),ue=b(ht,ye.props),ue.ref=Wc(pe,ht,ye),ue.return=pe,pe=ue;break e}h(pe,ht);break}else s(pe,ht);ht=ht.sibling}ye.type===Zu?(ue=cu(ye.props.children,pe.mode,Ne,ye.key),ue.return=pe,pe=ue):(Ne=Id(ye.type,ye.key,ye.props,null,pe.mode,Ne),Ne.ref=Wc(pe,ue,ye),Ne.return=pe,pe=Ne)}return O(pe);case Vu:e:{for(ht=ye.key;ue!==null;){if(ue.key===ht)if(ue.tag===4&&ue.stateNode.containerInfo===ye.containerInfo&&ue.stateNode.implementation===ye.implementation){h(pe,ue.sibling),ue=b(ue,ye.children||[]),ue.return=pe,pe=ue;break e}else{h(pe,ue);break}else s(pe,ue);ue=ue.sibling}ue=kf(ye,pe.mode,Ne),ue.return=pe,pe=ue}return O(pe);case bl:return ht=ye._init,Bt(pe,ue,ht(ye._payload),Ne)}if(Yc(ye))return We(pe,ue,ye,Ne);if(Zc(ye))return Fe(pe,ue,ye,Ne);hd(pe,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"?(ye=""+ye,ue!==null&&ue.tag===6?(h(pe,ue.sibling),ue=b(ue,ye),ue.return=pe,pe=ue):(h(pe,ue),ue=If(ye,pe.mode,Ne),ue.return=pe,pe=ue),O(pe)):h(pe,ue)}return Bt}var lc=Cx(!0),Ix=Cx(!1),Mh={},ta=Nl(Mh),xh=Nl(Mh),wh=Nl(Mh);function lu(n){if(n===Mh)throw Error($e(174));return n}function t_(n,s){switch(Ii(wh,s),Ii(xh,n),Ii(ta,Mh),n=s.nodeType,n){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Zf(null,"");break;default:n=n===8?s.parentNode:s,s=n.namespaceURI||null,n=n.tagName,s=Zf(s,n)}Ri(ta),Ii(ta,s)}function uc(){Ri(ta),Ri(xh),Ri(wh)}function kx(n){lu(wh.current);var s=lu(ta.current),h=Zf(s,n.type);s!==h&&(Ii(xh,n),Ii(ta,h))}function i_(n){xh.current===n&&(Ri(ta),Ri(xh))}var Yi=Nl(0);function qd(n){for(var s=n;s!==null;){if(s.tag===13){var h=s.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var bf=[];function n_(){for(var n=0;n<bf.length;n++)bf[n]._workInProgressVersionPrimary=null;bf.length=0}var Td=Oa.ReactCurrentDispatcher,Tf=Oa.ReactCurrentBatchConfig,pu=0,Ji=null,Cn=null,Un=null,Gd=!1,oh=!1,bh=0,p2=0;function pr(){throw Error($e(321))}function r_(n,s){if(s===null)return!1;for(var h=0;h<s.length&&h<n.length;h++)if(!Ts(n[h],s[h]))return!1;return!0}function o_(n,s,h,v,b,I){if(pu=I,Ji=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Td.current=n===null||n.memoizedState===null?g2:y2,n=h(v,b),oh){I=0;do{if(oh=!1,bh=0,25<=I)throw Error($e(301));I+=1,Un=Cn=null,s.updateQueue=null,Td.current=v2,n=h(v,b)}while(oh)}if(Td.current=Wd,s=Cn!==null&&Cn.next!==null,pu=0,Un=Cn=Ji=null,Gd=!1,s)throw Error($e(300));return n}function s_(){var n=bh!==0;return bh=0,n}function Js(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?Ji.memoizedState=Un=n:Un=Un.next=n,Un}function jo(){if(Cn===null){var n=Ji.alternate;n=n!==null?n.memoizedState:null}else n=Cn.next;var s=Un===null?Ji.memoizedState:Un.next;if(s!==null)Un=s,Cn=n;else{if(n===null)throw Error($e(310));Cn=n,n={memoizedState:Cn.memoizedState,baseState:Cn.baseState,baseQueue:Cn.baseQueue,queue:Cn.queue,next:null},Un===null?Ji.memoizedState=Un=n:Un=Un.next=n}return Un}function Th(n,s){return typeof s=="function"?s(n):s}function Sf(n){var s=jo(),h=s.queue;if(h===null)throw Error($e(311));h.lastRenderedReducer=n;var v=Cn,b=v.baseQueue,I=h.pending;if(I!==null){if(b!==null){var O=b.next;b.next=I.next,I.next=O}v.baseQueue=b=I,h.pending=null}if(b!==null){I=b.next,v=v.baseState;var u=O=null,H=null,q=I;do{var ke=q.lane;if((pu&ke)===ke)H!==null&&(H=H.next={lane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),v=q.hasEagerState?q.eagerState:n(v,q.action);else{var _e={lane:ke,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null};H===null?(u=H=_e,O=v):H=H.next=_e,Ji.lanes|=ke,fu|=ke}q=q.next}while(q!==null&&q!==I);H===null?O=v:H.next=u,Ts(v,s.memoizedState)||(Xr=!0),s.memoizedState=v,s.baseState=O,s.baseQueue=H,h.lastRenderedState=v}if(n=h.interleaved,n!==null){b=n;do I=b.lane,Ji.lanes|=I,fu|=I,b=b.next;while(b!==n)}else b===null&&(h.lanes=0);return[s.memoizedState,h.dispatch]}function Ef(n){var s=jo(),h=s.queue;if(h===null)throw Error($e(311));h.lastRenderedReducer=n;var v=h.dispatch,b=h.pending,I=s.memoizedState;if(b!==null){h.pending=null;var O=b=b.next;do I=n(I,O.action),O=O.next;while(O!==b);Ts(I,s.memoizedState)||(Xr=!0),s.memoizedState=I,s.baseQueue===null&&(s.baseState=I),h.lastRenderedState=I}return[I,v]}function Mx(){}function zx(n,s){var h=Ji,v=jo(),b=s(),I=!Ts(v.memoizedState,b);if(I&&(v.memoizedState=b,Xr=!0),v=v.queue,a_(Dx.bind(null,h,v,n),[n]),v.getSnapshot!==s||I||Un!==null&&Un.memoizedState.tag&1){if(h.flags|=2048,Sh(9,Lx.bind(null,h,v,b,s),void 0,null),Vn===null)throw Error($e(349));pu&30||Ax(h,s,b)}return b}function Ax(n,s,h){n.flags|=16384,n={getSnapshot:s,value:h},s=Ji.updateQueue,s===null?(s={lastEffect:null,stores:null},Ji.updateQueue=s,s.stores=[n]):(h=s.stores,h===null?s.stores=[n]:h.push(n))}function Lx(n,s,h,v){s.value=h,s.getSnapshot=v,Rx(s)&&Bx(n)}function Dx(n,s,h){return h(function(){Rx(s)&&Bx(n)})}function Rx(n){var s=n.getSnapshot;n=n.value;try{var h=s();return!Ts(n,h)}catch{return!0}}function Bx(n){var s=Ra(n,1);s!==null&&bs(s,n,1,-1)}function Uy(n){var s=Js();return typeof n=="function"&&(n=n()),s.memoizedState=s.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Th,lastRenderedState:n},s.queue=n,n=n.dispatch=_2.bind(null,Ji,n),[s.memoizedState,n]}function Sh(n,s,h,v){return n={tag:n,create:s,destroy:h,deps:v,next:null},s=Ji.updateQueue,s===null?(s={lastEffect:null,stores:null},Ji.updateQueue=s,s.lastEffect=n.next=n):(h=s.lastEffect,h===null?s.lastEffect=n.next=n:(v=h.next,h.next=n,n.next=v,s.lastEffect=n)),n}function Ox(){return jo().memoizedState}function Sd(n,s,h,v){var b=Js();Ji.flags|=n,b.memoizedState=Sh(1|s,h,void 0,v===void 0?null:v)}function ap(n,s,h,v){var b=jo();v=v===void 0?null:v;var I=void 0;if(Cn!==null){var O=Cn.memoizedState;if(I=O.destroy,v!==null&&r_(v,O.deps)){b.memoizedState=Sh(s,h,I,v);return}}Ji.flags|=n,b.memoizedState=Sh(1|s,h,I,v)}function Vy(n,s){return Sd(8390656,8,n,s)}function a_(n,s){return ap(2048,8,n,s)}function Fx(n,s){return ap(4,2,n,s)}function Nx(n,s){return ap(4,4,n,s)}function Ux(n,s){if(typeof s=="function")return n=n(),s(n),function(){s(null)};if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Vx(n,s,h){return h=h!=null?h.concat([n]):null,ap(4,4,Ux.bind(null,s,n),h)}function l_(){}function Zx(n,s){var h=jo();s=s===void 0?null:s;var v=h.memoizedState;return v!==null&&s!==null&&r_(s,v[1])?v[0]:(h.memoizedState=[n,s],n)}function $x(n,s){var h=jo();s=s===void 0?null:s;var v=h.memoizedState;return v!==null&&s!==null&&r_(s,v[1])?v[0]:(n=n(),h.memoizedState=[n,s],n)}function jx(n,s,h){return pu&21?(Ts(h,s)||(h=Wv(),Ji.lanes|=h,fu|=h,n.baseState=!0),s):(n.baseState&&(n.baseState=!1,Xr=!0),n.memoizedState=h)}function f2(n,s){var h=_i;_i=h!==0&&4>h?h:4,n(!0);var v=Tf.transition;Tf.transition={};try{n(!1),s()}finally{_i=h,Tf.transition=v}}function qx(){return jo().memoizedState}function m2(n,s,h){var v=Dl(n);if(h={lane:v,action:h,hasEagerState:!1,eagerState:null,next:null},Gx(n))Wx(s,h);else if(h=Tx(n,s,h,v),h!==null){var b=Ar();bs(h,n,v,b),Hx(h,s,v)}}function _2(n,s,h){var v=Dl(n),b={lane:v,action:h,hasEagerState:!1,eagerState:null,next:null};if(Gx(n))Wx(s,b);else{var I=n.alternate;if(n.lanes===0&&(I===null||I.lanes===0)&&(I=s.lastRenderedReducer,I!==null))try{var O=s.lastRenderedState,u=I(O,h);if(b.hasEagerState=!0,b.eagerState=u,Ts(u,O)){var H=s.interleaved;H===null?(b.next=b,Qm(s)):(b.next=H.next,H.next=b),s.interleaved=b;return}}catch{}finally{}h=Tx(n,s,b,v),h!==null&&(b=Ar(),bs(h,n,v,b),Hx(h,s,v))}}function Gx(n){var s=n.alternate;return n===Ji||s!==null&&s===Ji}function Wx(n,s){oh=Gd=!0;var h=n.pending;h===null?s.next=s:(s.next=h.next,h.next=s),n.pending=s}function Hx(n,s,h){if(h&4194240){var v=s.lanes;v&=n.pendingLanes,h|=v,s.lanes=h,Nm(n,h)}}var Wd={readContext:$o,useCallback:pr,useContext:pr,useEffect:pr,useImperativeHandle:pr,useInsertionEffect:pr,useLayoutEffect:pr,useMemo:pr,useReducer:pr,useRef:pr,useState:pr,useDebugValue:pr,useDeferredValue:pr,useTransition:pr,useMutableSource:pr,useSyncExternalStore:pr,useId:pr,unstable_isNewReconciler:!1},g2={readContext:$o,useCallback:function(n,s){return Js().memoizedState=[n,s===void 0?null:s],n},useContext:$o,useEffect:Vy,useImperativeHandle:function(n,s,h){return h=h!=null?h.concat([n]):null,Sd(4194308,4,Ux.bind(null,s,n),h)},useLayoutEffect:function(n,s){return Sd(4194308,4,n,s)},useInsertionEffect:function(n,s){return Sd(4,2,n,s)},useMemo:function(n,s){var h=Js();return s=s===void 0?null:s,n=n(),h.memoizedState=[n,s],n},useReducer:function(n,s,h){var v=Js();return s=h!==void 0?h(s):s,v.memoizedState=v.baseState=s,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:s},v.queue=n,n=n.dispatch=m2.bind(null,Ji,n),[v.memoizedState,n]},useRef:function(n){var s=Js();return n={current:n},s.memoizedState=n},useState:Uy,useDebugValue:l_,useDeferredValue:function(n){return Js().memoizedState=n},useTransition:function(){var n=Uy(!1),s=n[0];return n=f2.bind(null,n[1]),Js().memoizedState=n,[s,n]},useMutableSource:function(){},useSyncExternalStore:function(n,s,h){var v=Ji,b=Js();if($i){if(h===void 0)throw Error($e(407));h=h()}else{if(h=s(),Vn===null)throw Error($e(349));pu&30||Ax(v,s,h)}b.memoizedState=h;var I={value:h,getSnapshot:s};return b.queue=I,Vy(Dx.bind(null,v,I,n),[n]),v.flags|=2048,Sh(9,Lx.bind(null,v,I,h,s),void 0,null),h},useId:function(){var n=Js(),s=Vn.identifierPrefix;if($i){var h=za,v=Ma;h=(v&~(1<<32-ws(v)-1)).toString(32)+h,s=":"+s+"R"+h,h=bh++,0<h&&(s+="H"+h.toString(32)),s+=":"}else h=p2++,s=":"+s+"r"+h.toString(32)+":";return n.memoizedState=s},unstable_isNewReconciler:!1},y2={readContext:$o,useCallback:Zx,useContext:$o,useEffect:a_,useImperativeHandle:Vx,useInsertionEffect:Fx,useLayoutEffect:Nx,useMemo:$x,useReducer:Sf,useRef:Ox,useState:function(){return Sf(Th)},useDebugValue:l_,useDeferredValue:function(n){var s=jo();return jx(s,Cn.memoizedState,n)},useTransition:function(){var n=Sf(Th)[0],s=jo().memoizedState;return[n,s]},useMutableSource:Mx,useSyncExternalStore:zx,useId:qx,unstable_isNewReconciler:!1},v2={readContext:$o,useCallback:Zx,useContext:$o,useEffect:a_,useImperativeHandle:Vx,useInsertionEffect:Fx,useLayoutEffect:Nx,useMemo:$x,useReducer:Ef,useRef:Ox,useState:function(){return Ef(Th)},useDebugValue:l_,useDeferredValue:function(n){var s=jo();return Cn===null?s.memoizedState=n:jx(s,Cn.memoizedState,n)},useTransition:function(){var n=Ef(Th)[0],s=jo().memoizedState;return[n,s]},useMutableSource:Mx,useSyncExternalStore:zx,useId:qx,unstable_isNewReconciler:!1};function cc(n,s){try{var h="",v=s;do h+=Ww(v),v=v.return;while(v);var b=h}catch(I){b=`
Error generating stack: `+I.message+`
`+I.stack}return{value:n,source:s,stack:b,digest:null}}function Pf(n,s,h){return{value:n,source:null,stack:h??null,digest:s??null}}function hm(n,s){try{console.error(s.value)}catch(h){setTimeout(function(){throw h})}}var x2=typeof WeakMap=="function"?WeakMap:Map;function Xx(n,s,h){h=Aa(-1,h),h.tag=3,h.payload={element:null};var v=s.value;return h.callback=function(){Xd||(Xd=!0,wm=v),hm(n,s)},h}function Kx(n,s,h){h=Aa(-1,h),h.tag=3;var v=n.type.getDerivedStateFromError;if(typeof v=="function"){var b=s.value;h.payload=function(){return v(b)},h.callback=function(){hm(n,s)}}var I=n.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(h.callback=function(){hm(n,s),typeof v!="function"&&(Ll===null?Ll=new Set([this]):Ll.add(this));var O=s.stack;this.componentDidCatch(s.value,{componentStack:O!==null?O:""})}),h}function Zy(n,s,h){var v=n.pingCache;if(v===null){v=n.pingCache=new x2;var b=new Set;v.set(s,b)}else b=v.get(s),b===void 0&&(b=new Set,v.set(s,b));b.has(h)||(b.add(h),n=D2.bind(null,n,s,h),s.then(n,n))}function $y(n){do{var s;if((s=n.tag===13)&&(s=n.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return n;n=n.return}while(n!==null);return null}function jy(n,s,h,v,b){return n.mode&1?(n.flags|=65536,n.lanes=b,n):(n===s?n.flags|=65536:(n.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(s=Aa(-1,1),s.tag=2,Al(h,s,1))),h.lanes|=1),n)}var w2=Oa.ReactCurrentOwner,Xr=!1;function zr(n,s,h,v){s.child=n===null?Ix(s,null,h,v):lc(s,n.child,h,v)}function qy(n,s,h,v,b){h=h.render;var I=s.ref;return nc(s,b),v=o_(n,s,h,v,I,b),h=s_(),n!==null&&!Xr?(s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~b,Ba(n,s,b)):($i&&h&&Wm(s),s.flags|=1,zr(n,s,v,b),s.child)}function Gy(n,s,h,v,b){if(n===null){var I=h.type;return typeof I=="function"&&!__(I)&&I.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(s.tag=15,s.type=I,Yx(n,s,I,v,b)):(n=Id(h.type,null,v,s,s.mode,b),n.ref=s.ref,n.return=s,s.child=n)}if(I=n.child,!(n.lanes&b)){var O=I.memoizedProps;if(h=h.compare,h=h!==null?h:_h,h(O,v)&&n.ref===s.ref)return Ba(n,s,b)}return s.flags|=1,n=Rl(I,v),n.ref=s.ref,n.return=s,s.child=n}function Yx(n,s,h,v,b){if(n!==null){var I=n.memoizedProps;if(_h(I,v)&&n.ref===s.ref)if(Xr=!1,s.pendingProps=v=I,(n.lanes&b)!==0)n.flags&131072&&(Xr=!0);else return s.lanes=n.lanes,Ba(n,s,b)}return dm(n,s,h,v,b)}function Jx(n,s,h){var v=s.pendingProps,b=v.children,I=n!==null?n.memoizedState:null;if(v.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ii(Ju,xo),xo|=h;else{if(!(h&1073741824))return n=I!==null?I.baseLanes|h:h,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:n,cachePool:null,transitions:null},s.updateQueue=null,Ii(Ju,xo),xo|=n,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},v=I!==null?I.baseLanes:h,Ii(Ju,xo),xo|=v}else I!==null?(v=I.baseLanes|h,s.memoizedState=null):v=h,Ii(Ju,xo),xo|=v;return zr(n,s,b,h),s.child}function Qx(n,s){var h=s.ref;(n===null&&h!==null||n!==null&&n.ref!==h)&&(s.flags|=512,s.flags|=2097152)}function dm(n,s,h,v,b){var I=Yr(h)?hu:_r.current;return I=sc(s,I),nc(s,b),h=o_(n,s,h,v,I,b),v=s_(),n!==null&&!Xr?(s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~b,Ba(n,s,b)):($i&&v&&Wm(s),s.flags|=1,zr(n,s,h,b),s.child)}function Wy(n,s,h,v,b){if(Yr(h)){var I=!0;Nd(s)}else I=!1;if(nc(s,b),s.stateNode===null)Ed(n,s),Px(s,h,v),cm(s,h,v,b),v=!0;else if(n===null){var O=s.stateNode,u=s.memoizedProps;O.props=u;var H=O.context,q=h.contextType;typeof q=="object"&&q!==null?q=$o(q):(q=Yr(h)?hu:_r.current,q=sc(s,q));var ke=h.getDerivedStateFromProps,_e=typeof ke=="function"||typeof O.getSnapshotBeforeUpdate=="function";_e||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(u!==v||H!==q)&&Fy(s,O,v,q),Tl=!1;var Ce=s.memoizedState;O.state=Ce,jd(s,v,O,b),H=s.memoizedState,u!==v||Ce!==H||Kr.current||Tl?(typeof ke=="function"&&(um(s,h,ke,v),H=s.memoizedState),(u=Tl||Oy(s,h,u,v,Ce,H,q))?(_e||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(s.flags|=4194308)):(typeof O.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=v,s.memoizedState=H),O.props=v,O.state=H,O.context=q,v=u):(typeof O.componentDidMount=="function"&&(s.flags|=4194308),v=!1)}else{O=s.stateNode,Sx(n,s),u=s.memoizedProps,q=s.type===s.elementType?u:ys(s.type,u),O.props=q,_e=s.pendingProps,Ce=O.context,H=h.contextType,typeof H=="object"&&H!==null?H=$o(H):(H=Yr(h)?hu:_r.current,H=sc(s,H));var Ue=h.getDerivedStateFromProps;(ke=typeof Ue=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(u!==_e||Ce!==H)&&Fy(s,O,v,H),Tl=!1,Ce=s.memoizedState,O.state=Ce,jd(s,v,O,b);var We=s.memoizedState;u!==_e||Ce!==We||Kr.current||Tl?(typeof Ue=="function"&&(um(s,h,Ue,v),We=s.memoizedState),(q=Tl||Oy(s,h,q,v,Ce,We,H)||!1)?(ke||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(v,We,H),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(v,We,H)),typeof O.componentDidUpdate=="function"&&(s.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof O.componentDidUpdate!="function"||u===n.memoizedProps&&Ce===n.memoizedState||(s.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&Ce===n.memoizedState||(s.flags|=1024),s.memoizedProps=v,s.memoizedState=We),O.props=v,O.state=We,O.context=H,v=q):(typeof O.componentDidUpdate!="function"||u===n.memoizedProps&&Ce===n.memoizedState||(s.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&Ce===n.memoizedState||(s.flags|=1024),v=!1)}return pm(n,s,h,v,I,b)}function pm(n,s,h,v,b,I){Qx(n,s);var O=(s.flags&128)!==0;if(!v&&!O)return b&&Ay(s,h,!1),Ba(n,s,I);v=s.stateNode,w2.current=s;var u=O&&typeof h.getDerivedStateFromError!="function"?null:v.render();return s.flags|=1,n!==null&&O?(s.child=lc(s,n.child,null,I),s.child=lc(s,null,u,I)):zr(n,s,u,I),s.memoizedState=v.state,b&&Ay(s,h,!0),s.child}function e0(n){var s=n.stateNode;s.pendingContext?zy(n,s.pendingContext,s.pendingContext!==s.context):s.context&&zy(n,s.context,!1),t_(n,s.containerInfo)}function Hy(n,s,h,v,b){return ac(),Xm(b),s.flags|=256,zr(n,s,h,v),s.child}var fm={dehydrated:null,treeContext:null,retryLane:0};function mm(n){return{baseLanes:n,cachePool:null,transitions:null}}function t0(n,s,h){var v=s.pendingProps,b=Yi.current,I=!1,O=(s.flags&128)!==0,u;if((u=O)||(u=n!==null&&n.memoizedState===null?!1:(b&2)!==0),u?(I=!0,s.flags&=-129):(n===null||n.memoizedState!==null)&&(b|=1),Ii(Yi,b&1),n===null)return am(s),n=s.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(s.mode&1?n.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(O=v.children,n=v.fallback,I?(v=s.mode,I=s.child,O={mode:"hidden",children:O},!(v&1)&&I!==null?(I.childLanes=0,I.pendingProps=O):I=cp(O,v,0,null),n=cu(n,v,h,null),I.return=s,n.return=s,I.sibling=n,s.child=I,s.child.memoizedState=mm(h),s.memoizedState=fm,n):u_(s,O));if(b=n.memoizedState,b!==null&&(u=b.dehydrated,u!==null))return b2(n,s,O,v,u,b,h);if(I){I=v.fallback,O=s.mode,b=n.child,u=b.sibling;var H={mode:"hidden",children:v.children};return!(O&1)&&s.child!==b?(v=s.child,v.childLanes=0,v.pendingProps=H,s.deletions=null):(v=Rl(b,H),v.subtreeFlags=b.subtreeFlags&14680064),u!==null?I=Rl(u,I):(I=cu(I,O,h,null),I.flags|=2),I.return=s,v.return=s,v.sibling=I,s.child=v,v=I,I=s.child,O=n.child.memoizedState,O=O===null?mm(h):{baseLanes:O.baseLanes|h,cachePool:null,transitions:O.transitions},I.memoizedState=O,I.childLanes=n.childLanes&~h,s.memoizedState=fm,v}return I=n.child,n=I.sibling,v=Rl(I,{mode:"visible",children:v.children}),!(s.mode&1)&&(v.lanes=h),v.return=s,v.sibling=null,n!==null&&(h=s.deletions,h===null?(s.deletions=[n],s.flags|=16):h.push(n)),s.child=v,s.memoizedState=null,v}function u_(n,s){return s=cp({mode:"visible",children:s},n.mode,0,null),s.return=n,n.child=s}function dd(n,s,h,v){return v!==null&&Xm(v),lc(s,n.child,null,h),n=u_(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function b2(n,s,h,v,b,I,O){if(h)return s.flags&256?(s.flags&=-257,v=Pf(Error($e(422))),dd(n,s,O,v)):s.memoizedState!==null?(s.child=n.child,s.flags|=128,null):(I=v.fallback,b=s.mode,v=cp({mode:"visible",children:v.children},b,0,null),I=cu(I,b,O,null),I.flags|=2,v.return=s,I.return=s,v.sibling=I,s.child=v,s.mode&1&&lc(s,n.child,null,O),s.child.memoizedState=mm(O),s.memoizedState=fm,I);if(!(s.mode&1))return dd(n,s,O,null);if(b.data==="$!"){if(v=b.nextSibling&&b.nextSibling.dataset,v)var u=v.dgst;return v=u,I=Error($e(419)),v=Pf(I,v,void 0),dd(n,s,O,v)}if(u=(O&n.childLanes)!==0,Xr||u){if(v=Vn,v!==null){switch(O&-O){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(v.suspendedLanes|O)?0:b,b!==0&&b!==I.retryLane&&(I.retryLane=b,Ra(n,b),bs(v,n,b,-1))}return m_(),v=Pf(Error($e(421))),dd(n,s,O,v)}return b.data==="$?"?(s.flags|=128,s.child=n.child,s=R2.bind(null,n),b._reactRetry=s,null):(n=I.treeContext,wo=zl(b.nextSibling),bo=s,$i=!0,xs=null,n!==null&&(No[Uo++]=Ma,No[Uo++]=za,No[Uo++]=du,Ma=n.id,za=n.overflow,du=s),s=u_(s,v.children),s.flags|=4096,s)}function Xy(n,s,h){n.lanes|=s;var v=n.alternate;v!==null&&(v.lanes|=s),lm(n.return,s,h)}function Cf(n,s,h,v,b){var I=n.memoizedState;I===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:v,tail:h,tailMode:b}:(I.isBackwards=s,I.rendering=null,I.renderingStartTime=0,I.last=v,I.tail=h,I.tailMode=b)}function i0(n,s,h){var v=s.pendingProps,b=v.revealOrder,I=v.tail;if(zr(n,s,v.children,h),v=Yi.current,v&2)v=v&1|2,s.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Xy(n,h,s);else if(n.tag===19)Xy(n,h,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}v&=1}if(Ii(Yi,v),!(s.mode&1))s.memoizedState=null;else switch(b){case"forwards":for(h=s.child,b=null;h!==null;)n=h.alternate,n!==null&&qd(n)===null&&(b=h),h=h.sibling;h=b,h===null?(b=s.child,s.child=null):(b=h.sibling,h.sibling=null),Cf(s,!1,b,h,I);break;case"backwards":for(h=null,b=s.child,s.child=null;b!==null;){if(n=b.alternate,n!==null&&qd(n)===null){s.child=b;break}n=b.sibling,b.sibling=h,h=b,b=n}Cf(s,!0,h,null,I);break;case"together":Cf(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Ed(n,s){!(s.mode&1)&&n!==null&&(n.alternate=null,s.alternate=null,s.flags|=2)}function Ba(n,s,h){if(n!==null&&(s.dependencies=n.dependencies),fu|=s.lanes,!(h&s.childLanes))return null;if(n!==null&&s.child!==n.child)throw Error($e(153));if(s.child!==null){for(n=s.child,h=Rl(n,n.pendingProps),s.child=h,h.return=s;n.sibling!==null;)n=n.sibling,h=h.sibling=Rl(n,n.pendingProps),h.return=s;h.sibling=null}return s.child}function T2(n,s,h){switch(s.tag){case 3:e0(s),ac();break;case 5:kx(s);break;case 1:Yr(s.type)&&Nd(s);break;case 4:t_(s,s.stateNode.containerInfo);break;case 10:var v=s.type._context,b=s.memoizedProps.value;Ii(Zd,v._currentValue),v._currentValue=b;break;case 13:if(v=s.memoizedState,v!==null)return v.dehydrated!==null?(Ii(Yi,Yi.current&1),s.flags|=128,null):h&s.child.childLanes?t0(n,s,h):(Ii(Yi,Yi.current&1),n=Ba(n,s,h),n!==null?n.sibling:null);Ii(Yi,Yi.current&1);break;case 19:if(v=(h&s.childLanes)!==0,n.flags&128){if(v)return i0(n,s,h);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Ii(Yi,Yi.current),v)break;return null;case 22:case 23:return s.lanes=0,Jx(n,s,h)}return Ba(n,s,h)}var n0,_m,r0,o0;n0=function(n,s){for(var h=s.child;h!==null;){if(h.tag===5||h.tag===6)n.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break;for(;h.sibling===null;){if(h.return===null||h.return===s)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};_m=function(){};r0=function(n,s,h,v){var b=n.memoizedProps;if(b!==v){n=s.stateNode,lu(ta.current);var I=null;switch(h){case"input":b=Ff(n,b),v=Ff(n,v),I=[];break;case"select":b=Qi({},b,{value:void 0}),v=Qi({},v,{value:void 0}),I=[];break;case"textarea":b=Vf(n,b),v=Vf(n,v),I=[];break;default:typeof b.onClick!="function"&&typeof v.onClick=="function"&&(n.onclick=Od)}$f(h,v);var O;h=null;for(q in b)if(!v.hasOwnProperty(q)&&b.hasOwnProperty(q)&&b[q]!=null)if(q==="style"){var u=b[q];for(O in u)u.hasOwnProperty(O)&&(h||(h={}),h[O]="")}else q!=="dangerouslySetInnerHTML"&&q!=="children"&&q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&q!=="autoFocus"&&(uh.hasOwnProperty(q)?I||(I=[]):(I=I||[]).push(q,null));for(q in v){var H=v[q];if(u=b!=null?b[q]:void 0,v.hasOwnProperty(q)&&H!==u&&(H!=null||u!=null))if(q==="style")if(u){for(O in u)!u.hasOwnProperty(O)||H&&H.hasOwnProperty(O)||(h||(h={}),h[O]="");for(O in H)H.hasOwnProperty(O)&&u[O]!==H[O]&&(h||(h={}),h[O]=H[O])}else h||(I||(I=[]),I.push(q,h)),h=H;else q==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,u=u?u.__html:void 0,H!=null&&u!==H&&(I=I||[]).push(q,H)):q==="children"?typeof H!="string"&&typeof H!="number"||(I=I||[]).push(q,""+H):q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&(uh.hasOwnProperty(q)?(H!=null&&q==="onScroll"&&Di("scroll",n),I||u===H||(I=[])):(I=I||[]).push(q,H))}h&&(I=I||[]).push("style",h);var q=I;(s.updateQueue=q)&&(s.flags|=4)}};o0=function(n,s,h,v){h!==v&&(s.flags|=4)};function Hc(n,s){if(!$i)switch(n.tailMode){case"hidden":s=n.tail;for(var h=null;s!==null;)s.alternate!==null&&(h=s),s=s.sibling;h===null?n.tail=null:h.sibling=null;break;case"collapsed":h=n.tail;for(var v=null;h!==null;)h.alternate!==null&&(v=h),h=h.sibling;v===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:v.sibling=null}}function fr(n){var s=n.alternate!==null&&n.alternate.child===n.child,h=0,v=0;if(s)for(var b=n.child;b!==null;)h|=b.lanes|b.childLanes,v|=b.subtreeFlags&14680064,v|=b.flags&14680064,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)h|=b.lanes|b.childLanes,v|=b.subtreeFlags,v|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=v,n.childLanes=h,s}function S2(n,s,h){var v=s.pendingProps;switch(Hm(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fr(s),null;case 1:return Yr(s.type)&&Fd(),fr(s),null;case 3:return v=s.stateNode,uc(),Ri(Kr),Ri(_r),n_(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(n===null||n.child===null)&&(cd(s)?s.flags|=4:n===null||n.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,xs!==null&&(Sm(xs),xs=null))),_m(n,s),fr(s),null;case 5:i_(s);var b=lu(wh.current);if(h=s.type,n!==null&&s.stateNode!=null)r0(n,s,h,v,b),n.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!v){if(s.stateNode===null)throw Error($e(166));return fr(s),null}if(n=lu(ta.current),cd(s)){v=s.stateNode,h=s.type;var I=s.memoizedProps;switch(v[Qs]=s,v[vh]=I,n=(s.mode&1)!==0,h){case"dialog":Di("cancel",v),Di("close",v);break;case"iframe":case"object":case"embed":Di("load",v);break;case"video":case"audio":for(b=0;b<Qc.length;b++)Di(Qc[b],v);break;case"source":Di("error",v);break;case"img":case"image":case"link":Di("error",v),Di("load",v);break;case"details":Di("toggle",v);break;case"input":ry(v,I),Di("invalid",v);break;case"select":v._wrapperState={wasMultiple:!!I.multiple},Di("invalid",v);break;case"textarea":sy(v,I),Di("invalid",v)}$f(h,I),b=null;for(var O in I)if(I.hasOwnProperty(O)){var u=I[O];O==="children"?typeof u=="string"?v.textContent!==u&&(I.suppressHydrationWarning!==!0&&ud(v.textContent,u,n),b=["children",u]):typeof u=="number"&&v.textContent!==""+u&&(I.suppressHydrationWarning!==!0&&ud(v.textContent,u,n),b=["children",""+u]):uh.hasOwnProperty(O)&&u!=null&&O==="onScroll"&&Di("scroll",v)}switch(h){case"input":td(v),oy(v,I,!0);break;case"textarea":td(v),ay(v);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(v.onclick=Od)}v=b,s.updateQueue=v,v!==null&&(s.flags|=4)}else{O=b.nodeType===9?b:b.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Av(h)),n==="http://www.w3.org/1999/xhtml"?h==="script"?(n=O.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof v.is=="string"?n=O.createElement(h,{is:v.is}):(n=O.createElement(h),h==="select"&&(O=n,v.multiple?O.multiple=!0:v.size&&(O.size=v.size))):n=O.createElementNS(n,h),n[Qs]=s,n[vh]=v,n0(n,s,!1,!1),s.stateNode=n;e:{switch(O=jf(h,v),h){case"dialog":Di("cancel",n),Di("close",n),b=v;break;case"iframe":case"object":case"embed":Di("load",n),b=v;break;case"video":case"audio":for(b=0;b<Qc.length;b++)Di(Qc[b],n);b=v;break;case"source":Di("error",n),b=v;break;case"img":case"image":case"link":Di("error",n),Di("load",n),b=v;break;case"details":Di("toggle",n),b=v;break;case"input":ry(n,v),b=Ff(n,v),Di("invalid",n);break;case"option":b=v;break;case"select":n._wrapperState={wasMultiple:!!v.multiple},b=Qi({},v,{value:void 0}),Di("invalid",n);break;case"textarea":sy(n,v),b=Vf(n,v),Di("invalid",n);break;default:b=v}$f(h,b),u=b;for(I in u)if(u.hasOwnProperty(I)){var H=u[I];I==="style"?Rv(n,H):I==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,H!=null&&Lv(n,H)):I==="children"?typeof H=="string"?(h!=="textarea"||H!=="")&&ch(n,H):typeof H=="number"&&ch(n,""+H):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(uh.hasOwnProperty(I)?H!=null&&I==="onScroll"&&Di("scroll",n):H!=null&&Lm(n,I,H,O))}switch(h){case"input":td(n),oy(n,v,!1);break;case"textarea":td(n),ay(n);break;case"option":v.value!=null&&n.setAttribute("value",""+Bl(v.value));break;case"select":n.multiple=!!v.multiple,I=v.value,I!=null?Qu(n,!!v.multiple,I,!1):v.defaultValue!=null&&Qu(n,!!v.multiple,v.defaultValue,!0);break;default:typeof b.onClick=="function"&&(n.onclick=Od)}switch(h){case"button":case"input":case"select":case"textarea":v=!!v.autoFocus;break e;case"img":v=!0;break e;default:v=!1}}v&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return fr(s),null;case 6:if(n&&s.stateNode!=null)o0(n,s,n.memoizedProps,v);else{if(typeof v!="string"&&s.stateNode===null)throw Error($e(166));if(h=lu(wh.current),lu(ta.current),cd(s)){if(v=s.stateNode,h=s.memoizedProps,v[Qs]=s,(I=v.nodeValue!==h)&&(n=bo,n!==null))switch(n.tag){case 3:ud(v.nodeValue,h,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ud(v.nodeValue,h,(n.mode&1)!==0)}I&&(s.flags|=4)}else v=(h.nodeType===9?h:h.ownerDocument).createTextNode(v),v[Qs]=s,s.stateNode=v}return fr(s),null;case 13:if(Ri(Yi),v=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if($i&&wo!==null&&s.mode&1&&!(s.flags&128))bx(),ac(),s.flags|=98560,I=!1;else if(I=cd(s),v!==null&&v.dehydrated!==null){if(n===null){if(!I)throw Error($e(318));if(I=s.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error($e(317));I[Qs]=s}else ac(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;fr(s),I=!1}else xs!==null&&(Sm(xs),xs=null),I=!0;if(!I)return s.flags&65536?s:null}return s.flags&128?(s.lanes=h,s):(v=v!==null,v!==(n!==null&&n.memoizedState!==null)&&v&&(s.child.flags|=8192,s.mode&1&&(n===null||Yi.current&1?In===0&&(In=3):m_())),s.updateQueue!==null&&(s.flags|=4),fr(s),null);case 4:return uc(),_m(n,s),n===null&&gh(s.stateNode.containerInfo),fr(s),null;case 10:return Jm(s.type._context),fr(s),null;case 17:return Yr(s.type)&&Fd(),fr(s),null;case 19:if(Ri(Yi),I=s.memoizedState,I===null)return fr(s),null;if(v=(s.flags&128)!==0,O=I.rendering,O===null)if(v)Hc(I,!1);else{if(In!==0||n!==null&&n.flags&128)for(n=s.child;n!==null;){if(O=qd(n),O!==null){for(s.flags|=128,Hc(I,!1),v=O.updateQueue,v!==null&&(s.updateQueue=v,s.flags|=4),s.subtreeFlags=0,v=h,h=s.child;h!==null;)I=h,n=v,I.flags&=14680066,O=I.alternate,O===null?(I.childLanes=0,I.lanes=n,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=O.childLanes,I.lanes=O.lanes,I.child=O.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=O.memoizedProps,I.memoizedState=O.memoizedState,I.updateQueue=O.updateQueue,I.type=O.type,n=O.dependencies,I.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),h=h.sibling;return Ii(Yi,Yi.current&1|2),s.child}n=n.sibling}I.tail!==null&&dn()>hc&&(s.flags|=128,v=!0,Hc(I,!1),s.lanes=4194304)}else{if(!v)if(n=qd(O),n!==null){if(s.flags|=128,v=!0,h=n.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),Hc(I,!0),I.tail===null&&I.tailMode==="hidden"&&!O.alternate&&!$i)return fr(s),null}else 2*dn()-I.renderingStartTime>hc&&h!==1073741824&&(s.flags|=128,v=!0,Hc(I,!1),s.lanes=4194304);I.isBackwards?(O.sibling=s.child,s.child=O):(h=I.last,h!==null?h.sibling=O:s.child=O,I.last=O)}return I.tail!==null?(s=I.tail,I.rendering=s,I.tail=s.sibling,I.renderingStartTime=dn(),s.sibling=null,h=Yi.current,Ii(Yi,v?h&1|2:h&1),s):(fr(s),null);case 22:case 23:return f_(),v=s.memoizedState!==null,n!==null&&n.memoizedState!==null!==v&&(s.flags|=8192),v&&s.mode&1?xo&1073741824&&(fr(s),s.subtreeFlags&6&&(s.flags|=8192)):fr(s),null;case 24:return null;case 25:return null}throw Error($e(156,s.tag))}function E2(n,s){switch(Hm(s),s.tag){case 1:return Yr(s.type)&&Fd(),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return uc(),Ri(Kr),Ri(_r),n_(),n=s.flags,n&65536&&!(n&128)?(s.flags=n&-65537|128,s):null;case 5:return i_(s),null;case 13:if(Ri(Yi),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error($e(340));ac()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return Ri(Yi),null;case 4:return uc(),null;case 10:return Jm(s.type._context),null;case 22:case 23:return f_(),null;case 24:return null;default:return null}}var pd=!1,mr=!1,P2=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Yu(n,s){var h=n.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(v){on(n,s,v)}else h.current=null}function gm(n,s,h){try{h()}catch(v){on(n,s,v)}}var Ky=!1;function C2(n,s){if(em=Dd,n=ux(),Gm(n)){if("selectionStart"in n)var h={start:n.selectionStart,end:n.selectionEnd};else e:{h=(h=n.ownerDocument)&&h.defaultView||window;var v=h.getSelection&&h.getSelection();if(v&&v.rangeCount!==0){h=v.anchorNode;var b=v.anchorOffset,I=v.focusNode;v=v.focusOffset;try{h.nodeType,I.nodeType}catch{h=null;break e}var O=0,u=-1,H=-1,q=0,ke=0,_e=n,Ce=null;t:for(;;){for(var Ue;_e!==h||b!==0&&_e.nodeType!==3||(u=O+b),_e!==I||v!==0&&_e.nodeType!==3||(H=O+v),_e.nodeType===3&&(O+=_e.nodeValue.length),(Ue=_e.firstChild)!==null;)Ce=_e,_e=Ue;for(;;){if(_e===n)break t;if(Ce===h&&++q===b&&(u=O),Ce===I&&++ke===v&&(H=O),(Ue=_e.nextSibling)!==null)break;_e=Ce,Ce=_e.parentNode}_e=Ue}h=u===-1||H===-1?null:{start:u,end:H}}else h=null}h=h||{start:0,end:0}}else h=null;for(tm={focusedElem:n,selectionRange:h},Dd=!1,mt=s;mt!==null;)if(s=mt,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,mt=n;else for(;mt!==null;){s=mt;try{var We=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(We!==null){var Fe=We.memoizedProps,Bt=We.memoizedState,pe=s.stateNode,ue=pe.getSnapshotBeforeUpdate(s.elementType===s.type?Fe:ys(s.type,Fe),Bt);pe.__reactInternalSnapshotBeforeUpdate=ue}break;case 3:var ye=s.stateNode.containerInfo;ye.nodeType===1?ye.textContent="":ye.nodeType===9&&ye.documentElement&&ye.removeChild(ye.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($e(163))}}catch(Ne){on(s,s.return,Ne)}if(n=s.sibling,n!==null){n.return=s.return,mt=n;break}mt=s.return}return We=Ky,Ky=!1,We}function sh(n,s,h){var v=s.updateQueue;if(v=v!==null?v.lastEffect:null,v!==null){var b=v=v.next;do{if((b.tag&n)===n){var I=b.destroy;b.destroy=void 0,I!==void 0&&gm(s,h,I)}b=b.next}while(b!==v)}}function lp(n,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var h=s=s.next;do{if((h.tag&n)===n){var v=h.create;h.destroy=v()}h=h.next}while(h!==s)}}function ym(n){var s=n.ref;if(s!==null){var h=n.stateNode;switch(n.tag){case 5:n=h;break;default:n=h}typeof s=="function"?s(n):s.current=n}}function s0(n){var s=n.alternate;s!==null&&(n.alternate=null,s0(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&(delete s[Qs],delete s[vh],delete s[rm],delete s[u2],delete s[c2])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function a0(n){return n.tag===5||n.tag===3||n.tag===4}function Yy(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||a0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function vm(n,s,h){var v=n.tag;if(v===5||v===6)n=n.stateNode,s?h.nodeType===8?h.parentNode.insertBefore(n,s):h.insertBefore(n,s):(h.nodeType===8?(s=h.parentNode,s.insertBefore(n,h)):(s=h,s.appendChild(n)),h=h._reactRootContainer,h!=null||s.onclick!==null||(s.onclick=Od));else if(v!==4&&(n=n.child,n!==null))for(vm(n,s,h),n=n.sibling;n!==null;)vm(n,s,h),n=n.sibling}function xm(n,s,h){var v=n.tag;if(v===5||v===6)n=n.stateNode,s?h.insertBefore(n,s):h.appendChild(n);else if(v!==4&&(n=n.child,n!==null))for(xm(n,s,h),n=n.sibling;n!==null;)xm(n,s,h),n=n.sibling}var Yn=null,vs=!1;function wl(n,s,h){for(h=h.child;h!==null;)l0(n,s,h),h=h.sibling}function l0(n,s,h){if(ea&&typeof ea.onCommitFiberUnmount=="function")try{ea.onCommitFiberUnmount(ep,h)}catch{}switch(h.tag){case 5:mr||Yu(h,s);case 6:var v=Yn,b=vs;Yn=null,wl(n,s,h),Yn=v,vs=b,Yn!==null&&(vs?(n=Yn,h=h.stateNode,n.nodeType===8?n.parentNode.removeChild(h):n.removeChild(h)):Yn.removeChild(h.stateNode));break;case 18:Yn!==null&&(vs?(n=Yn,h=h.stateNode,n.nodeType===8?xf(n.parentNode,h):n.nodeType===1&&xf(n,h),fh(n)):xf(Yn,h.stateNode));break;case 4:v=Yn,b=vs,Yn=h.stateNode.containerInfo,vs=!0,wl(n,s,h),Yn=v,vs=b;break;case 0:case 11:case 14:case 15:if(!mr&&(v=h.updateQueue,v!==null&&(v=v.lastEffect,v!==null))){b=v=v.next;do{var I=b,O=I.destroy;I=I.tag,O!==void 0&&(I&2||I&4)&&gm(h,s,O),b=b.next}while(b!==v)}wl(n,s,h);break;case 1:if(!mr&&(Yu(h,s),v=h.stateNode,typeof v.componentWillUnmount=="function"))try{v.props=h.memoizedProps,v.state=h.memoizedState,v.componentWillUnmount()}catch(u){on(h,s,u)}wl(n,s,h);break;case 21:wl(n,s,h);break;case 22:h.mode&1?(mr=(v=mr)||h.memoizedState!==null,wl(n,s,h),mr=v):wl(n,s,h);break;default:wl(n,s,h)}}function Jy(n){var s=n.updateQueue;if(s!==null){n.updateQueue=null;var h=n.stateNode;h===null&&(h=n.stateNode=new P2),s.forEach(function(v){var b=B2.bind(null,n,v);h.has(v)||(h.add(v),v.then(b,b))})}}function gs(n,s){var h=s.deletions;if(h!==null)for(var v=0;v<h.length;v++){var b=h[v];try{var I=n,O=s,u=O;e:for(;u!==null;){switch(u.tag){case 5:Yn=u.stateNode,vs=!1;break e;case 3:Yn=u.stateNode.containerInfo,vs=!0;break e;case 4:Yn=u.stateNode.containerInfo,vs=!0;break e}u=u.return}if(Yn===null)throw Error($e(160));l0(I,O,b),Yn=null,vs=!1;var H=b.alternate;H!==null&&(H.return=null),b.return=null}catch(q){on(b,s,q)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)u0(s,n),s=s.sibling}function u0(n,s){var h=n.alternate,v=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(gs(s,n),Ks(n),v&4){try{sh(3,n,n.return),lp(3,n)}catch(Fe){on(n,n.return,Fe)}try{sh(5,n,n.return)}catch(Fe){on(n,n.return,Fe)}}break;case 1:gs(s,n),Ks(n),v&512&&h!==null&&Yu(h,h.return);break;case 5:if(gs(s,n),Ks(n),v&512&&h!==null&&Yu(h,h.return),n.flags&32){var b=n.stateNode;try{ch(b,"")}catch(Fe){on(n,n.return,Fe)}}if(v&4&&(b=n.stateNode,b!=null)){var I=n.memoizedProps,O=h!==null?h.memoizedProps:I,u=n.type,H=n.updateQueue;if(n.updateQueue=null,H!==null)try{u==="input"&&I.type==="radio"&&I.name!=null&&Mv(b,I),jf(u,O);var q=jf(u,I);for(O=0;O<H.length;O+=2){var ke=H[O],_e=H[O+1];ke==="style"?Rv(b,_e):ke==="dangerouslySetInnerHTML"?Lv(b,_e):ke==="children"?ch(b,_e):Lm(b,ke,_e,q)}switch(u){case"input":Nf(b,I);break;case"textarea":zv(b,I);break;case"select":var Ce=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!I.multiple;var Ue=I.value;Ue!=null?Qu(b,!!I.multiple,Ue,!1):Ce!==!!I.multiple&&(I.defaultValue!=null?Qu(b,!!I.multiple,I.defaultValue,!0):Qu(b,!!I.multiple,I.multiple?[]:"",!1))}b[vh]=I}catch(Fe){on(n,n.return,Fe)}}break;case 6:if(gs(s,n),Ks(n),v&4){if(n.stateNode===null)throw Error($e(162));b=n.stateNode,I=n.memoizedProps;try{b.nodeValue=I}catch(Fe){on(n,n.return,Fe)}}break;case 3:if(gs(s,n),Ks(n),v&4&&h!==null&&h.memoizedState.isDehydrated)try{fh(s.containerInfo)}catch(Fe){on(n,n.return,Fe)}break;case 4:gs(s,n),Ks(n);break;case 13:gs(s,n),Ks(n),b=n.child,b.flags&8192&&(I=b.memoizedState!==null,b.stateNode.isHidden=I,!I||b.alternate!==null&&b.alternate.memoizedState!==null||(d_=dn())),v&4&&Jy(n);break;case 22:if(ke=h!==null&&h.memoizedState!==null,n.mode&1?(mr=(q=mr)||ke,gs(s,n),mr=q):gs(s,n),Ks(n),v&8192){if(q=n.memoizedState!==null,(n.stateNode.isHidden=q)&&!ke&&n.mode&1)for(mt=n,ke=n.child;ke!==null;){for(_e=mt=ke;mt!==null;){switch(Ce=mt,Ue=Ce.child,Ce.tag){case 0:case 11:case 14:case 15:sh(4,Ce,Ce.return);break;case 1:Yu(Ce,Ce.return);var We=Ce.stateNode;if(typeof We.componentWillUnmount=="function"){v=Ce,h=Ce.return;try{s=v,We.props=s.memoizedProps,We.state=s.memoizedState,We.componentWillUnmount()}catch(Fe){on(v,h,Fe)}}break;case 5:Yu(Ce,Ce.return);break;case 22:if(Ce.memoizedState!==null){ev(_e);continue}}Ue!==null?(Ue.return=Ce,mt=Ue):ev(_e)}ke=ke.sibling}e:for(ke=null,_e=n;;){if(_e.tag===5){if(ke===null){ke=_e;try{b=_e.stateNode,q?(I=b.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(u=_e.stateNode,H=_e.memoizedProps.style,O=H!=null&&H.hasOwnProperty("display")?H.display:null,u.style.display=Dv("display",O))}catch(Fe){on(n,n.return,Fe)}}}else if(_e.tag===6){if(ke===null)try{_e.stateNode.nodeValue=q?"":_e.memoizedProps}catch(Fe){on(n,n.return,Fe)}}else if((_e.tag!==22&&_e.tag!==23||_e.memoizedState===null||_e===n)&&_e.child!==null){_e.child.return=_e,_e=_e.child;continue}if(_e===n)break e;for(;_e.sibling===null;){if(_e.return===null||_e.return===n)break e;ke===_e&&(ke=null),_e=_e.return}ke===_e&&(ke=null),_e.sibling.return=_e.return,_e=_e.sibling}}break;case 19:gs(s,n),Ks(n),v&4&&Jy(n);break;case 21:break;default:gs(s,n),Ks(n)}}function Ks(n){var s=n.flags;if(s&2){try{e:{for(var h=n.return;h!==null;){if(a0(h)){var v=h;break e}h=h.return}throw Error($e(160))}switch(v.tag){case 5:var b=v.stateNode;v.flags&32&&(ch(b,""),v.flags&=-33);var I=Yy(n);xm(n,I,b);break;case 3:case 4:var O=v.stateNode.containerInfo,u=Yy(n);vm(n,u,O);break;default:throw Error($e(161))}}catch(H){on(n,n.return,H)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function I2(n,s,h){mt=n,c0(n)}function c0(n,s,h){for(var v=(n.mode&1)!==0;mt!==null;){var b=mt,I=b.child;if(b.tag===22&&v){var O=b.memoizedState!==null||pd;if(!O){var u=b.alternate,H=u!==null&&u.memoizedState!==null||mr;u=pd;var q=mr;if(pd=O,(mr=H)&&!q)for(mt=b;mt!==null;)O=mt,H=O.child,O.tag===22&&O.memoizedState!==null?tv(b):H!==null?(H.return=O,mt=H):tv(b);for(;I!==null;)mt=I,c0(I),I=I.sibling;mt=b,pd=u,mr=q}Qy(n)}else b.subtreeFlags&8772&&I!==null?(I.return=b,mt=I):Qy(n)}}function Qy(n){for(;mt!==null;){var s=mt;if(s.flags&8772){var h=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:mr||lp(5,s);break;case 1:var v=s.stateNode;if(s.flags&4&&!mr)if(h===null)v.componentDidMount();else{var b=s.elementType===s.type?h.memoizedProps:ys(s.type,h.memoizedProps);v.componentDidUpdate(b,h.memoizedState,v.__reactInternalSnapshotBeforeUpdate)}var I=s.updateQueue;I!==null&&By(s,I,v);break;case 3:var O=s.updateQueue;if(O!==null){if(h=null,s.child!==null)switch(s.child.tag){case 5:h=s.child.stateNode;break;case 1:h=s.child.stateNode}By(s,O,h)}break;case 5:var u=s.stateNode;if(h===null&&s.flags&4){h=u;var H=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":H.autoFocus&&h.focus();break;case"img":H.src&&(h.src=H.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var q=s.alternate;if(q!==null){var ke=q.memoizedState;if(ke!==null){var _e=ke.dehydrated;_e!==null&&fh(_e)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($e(163))}mr||s.flags&512&&ym(s)}catch(Ce){on(s,s.return,Ce)}}if(s===n){mt=null;break}if(h=s.sibling,h!==null){h.return=s.return,mt=h;break}mt=s.return}}function ev(n){for(;mt!==null;){var s=mt;if(s===n){mt=null;break}var h=s.sibling;if(h!==null){h.return=s.return,mt=h;break}mt=s.return}}function tv(n){for(;mt!==null;){var s=mt;try{switch(s.tag){case 0:case 11:case 15:var h=s.return;try{lp(4,s)}catch(H){on(s,h,H)}break;case 1:var v=s.stateNode;if(typeof v.componentDidMount=="function"){var b=s.return;try{v.componentDidMount()}catch(H){on(s,b,H)}}var I=s.return;try{ym(s)}catch(H){on(s,I,H)}break;case 5:var O=s.return;try{ym(s)}catch(H){on(s,O,H)}}}catch(H){on(s,s.return,H)}if(s===n){mt=null;break}var u=s.sibling;if(u!==null){u.return=s.return,mt=u;break}mt=s.return}}var k2=Math.ceil,Hd=Oa.ReactCurrentDispatcher,c_=Oa.ReactCurrentOwner,Zo=Oa.ReactCurrentBatchConfig,si=0,Vn=null,vn=null,Jn=0,xo=0,Ju=Nl(0),In=0,Eh=null,fu=0,up=0,h_=0,ah=null,Hr=null,d_=0,hc=1/0,Ia=null,Xd=!1,wm=null,Ll=null,fd=!1,Cl=null,Kd=0,lh=0,bm=null,Pd=-1,Cd=0;function Ar(){return si&6?dn():Pd!==-1?Pd:Pd=dn()}function Dl(n){return n.mode&1?si&2&&Jn!==0?Jn&-Jn:d2.transition!==null?(Cd===0&&(Cd=Wv()),Cd):(n=_i,n!==0||(n=window.event,n=n===void 0?16:ex(n.type)),n):1}function bs(n,s,h,v){if(50<lh)throw lh=0,bm=null,Error($e(185));Ch(n,h,v),(!(si&2)||n!==Vn)&&(n===Vn&&(!(si&2)&&(up|=h),In===4&&El(n,Jn)),Jr(n,v),h===1&&si===0&&!(s.mode&1)&&(hc=dn()+500,op&&Ul()))}function Jr(n,s){var h=n.callbackNode;db(n,s);var v=Ld(n,n===Vn?Jn:0);if(v===0)h!==null&&cy(h),n.callbackNode=null,n.callbackPriority=0;else if(s=v&-v,n.callbackPriority!==s){if(h!=null&&cy(h),s===1)n.tag===0?h2(iv.bind(null,n)):vx(iv.bind(null,n)),a2(function(){!(si&6)&&Ul()}),h=null;else{switch(Hv(v)){case 1:h=Fm;break;case 4:h=qv;break;case 16:h=Ad;break;case 536870912:h=Gv;break;default:h=Ad}h=y0(h,h0.bind(null,n))}n.callbackPriority=s,n.callbackNode=h}}function h0(n,s){if(Pd=-1,Cd=0,si&6)throw Error($e(327));var h=n.callbackNode;if(rc()&&n.callbackNode!==h)return null;var v=Ld(n,n===Vn?Jn:0);if(v===0)return null;if(v&30||v&n.expiredLanes||s)s=Yd(n,v);else{s=v;var b=si;si|=2;var I=p0();(Vn!==n||Jn!==s)&&(Ia=null,hc=dn()+500,uu(n,s));do try{A2();break}catch(u){d0(n,u)}while(1);Ym(),Hd.current=I,si=b,vn!==null?s=0:(Vn=null,Jn=0,s=In)}if(s!==0){if(s===2&&(b=Xf(n),b!==0&&(v=b,s=Tm(n,b))),s===1)throw h=Eh,uu(n,0),El(n,v),Jr(n,dn()),h;if(s===6)El(n,v);else{if(b=n.current.alternate,!(v&30)&&!M2(b)&&(s=Yd(n,v),s===2&&(I=Xf(n),I!==0&&(v=I,s=Tm(n,I))),s===1))throw h=Eh,uu(n,0),El(n,v),Jr(n,dn()),h;switch(n.finishedWork=b,n.finishedLanes=v,s){case 0:case 1:throw Error($e(345));case 2:ou(n,Hr,Ia);break;case 3:if(El(n,v),(v&130023424)===v&&(s=d_+500-dn(),10<s)){if(Ld(n,0)!==0)break;if(b=n.suspendedLanes,(b&v)!==v){Ar(),n.pingedLanes|=n.suspendedLanes&b;break}n.timeoutHandle=nm(ou.bind(null,n,Hr,Ia),s);break}ou(n,Hr,Ia);break;case 4:if(El(n,v),(v&4194240)===v)break;for(s=n.eventTimes,b=-1;0<v;){var O=31-ws(v);I=1<<O,O=s[O],O>b&&(b=O),v&=~I}if(v=b,v=dn()-v,v=(120>v?120:480>v?480:1080>v?1080:1920>v?1920:3e3>v?3e3:4320>v?4320:1960*k2(v/1960))-v,10<v){n.timeoutHandle=nm(ou.bind(null,n,Hr,Ia),v);break}ou(n,Hr,Ia);break;case 5:ou(n,Hr,Ia);break;default:throw Error($e(329))}}}return Jr(n,dn()),n.callbackNode===h?h0.bind(null,n):null}function Tm(n,s){var h=ah;return n.current.memoizedState.isDehydrated&&(uu(n,s).flags|=256),n=Yd(n,s),n!==2&&(s=Hr,Hr=h,s!==null&&Sm(s)),n}function Sm(n){Hr===null?Hr=n:Hr.push.apply(Hr,n)}function M2(n){for(var s=n;;){if(s.flags&16384){var h=s.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var v=0;v<h.length;v++){var b=h[v],I=b.getSnapshot;b=b.value;try{if(!Ts(I(),b))return!1}catch{return!1}}}if(h=s.child,s.subtreeFlags&16384&&h!==null)h.return=s,s=h;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function El(n,s){for(s&=~h_,s&=~up,n.suspendedLanes|=s,n.pingedLanes&=~s,n=n.expirationTimes;0<s;){var h=31-ws(s),v=1<<h;n[h]=-1,s&=~v}}function iv(n){if(si&6)throw Error($e(327));rc();var s=Ld(n,0);if(!(s&1))return Jr(n,dn()),null;var h=Yd(n,s);if(n.tag!==0&&h===2){var v=Xf(n);v!==0&&(s=v,h=Tm(n,v))}if(h===1)throw h=Eh,uu(n,0),El(n,s),Jr(n,dn()),h;if(h===6)throw Error($e(345));return n.finishedWork=n.current.alternate,n.finishedLanes=s,ou(n,Hr,Ia),Jr(n,dn()),null}function p_(n,s){var h=si;si|=1;try{return n(s)}finally{si=h,si===0&&(hc=dn()+500,op&&Ul())}}function mu(n){Cl!==null&&Cl.tag===0&&!(si&6)&&rc();var s=si;si|=1;var h=Zo.transition,v=_i;try{if(Zo.transition=null,_i=1,n)return n()}finally{_i=v,Zo.transition=h,si=s,!(si&6)&&Ul()}}function f_(){xo=Ju.current,Ri(Ju)}function uu(n,s){n.finishedWork=null,n.finishedLanes=0;var h=n.timeoutHandle;if(h!==-1&&(n.timeoutHandle=-1,s2(h)),vn!==null)for(h=vn.return;h!==null;){var v=h;switch(Hm(v),v.tag){case 1:v=v.type.childContextTypes,v!=null&&Fd();break;case 3:uc(),Ri(Kr),Ri(_r),n_();break;case 5:i_(v);break;case 4:uc();break;case 13:Ri(Yi);break;case 19:Ri(Yi);break;case 10:Jm(v.type._context);break;case 22:case 23:f_()}h=h.return}if(Vn=n,vn=n=Rl(n.current,null),Jn=xo=s,In=0,Eh=null,h_=up=fu=0,Hr=ah=null,au!==null){for(s=0;s<au.length;s++)if(h=au[s],v=h.interleaved,v!==null){h.interleaved=null;var b=v.next,I=h.pending;if(I!==null){var O=I.next;I.next=b,v.next=O}h.pending=v}au=null}return n}function d0(n,s){do{var h=vn;try{if(Ym(),Td.current=Wd,Gd){for(var v=Ji.memoizedState;v!==null;){var b=v.queue;b!==null&&(b.pending=null),v=v.next}Gd=!1}if(pu=0,Un=Cn=Ji=null,oh=!1,bh=0,c_.current=null,h===null||h.return===null){In=1,Eh=s,vn=null;break}e:{var I=n,O=h.return,u=h,H=s;if(s=Jn,u.flags|=32768,H!==null&&typeof H=="object"&&typeof H.then=="function"){var q=H,ke=u,_e=ke.tag;if(!(ke.mode&1)&&(_e===0||_e===11||_e===15)){var Ce=ke.alternate;Ce?(ke.updateQueue=Ce.updateQueue,ke.memoizedState=Ce.memoizedState,ke.lanes=Ce.lanes):(ke.updateQueue=null,ke.memoizedState=null)}var Ue=$y(O);if(Ue!==null){Ue.flags&=-257,jy(Ue,O,u,I,s),Ue.mode&1&&Zy(I,q,s),s=Ue,H=q;var We=s.updateQueue;if(We===null){var Fe=new Set;Fe.add(H),s.updateQueue=Fe}else We.add(H);break e}else{if(!(s&1)){Zy(I,q,s),m_();break e}H=Error($e(426))}}else if($i&&u.mode&1){var Bt=$y(O);if(Bt!==null){!(Bt.flags&65536)&&(Bt.flags|=256),jy(Bt,O,u,I,s),Xm(cc(H,u));break e}}I=H=cc(H,u),In!==4&&(In=2),ah===null?ah=[I]:ah.push(I),I=O;do{switch(I.tag){case 3:I.flags|=65536,s&=-s,I.lanes|=s;var pe=Xx(I,H,s);Ry(I,pe);break e;case 1:u=H;var ue=I.type,ye=I.stateNode;if(!(I.flags&128)&&(typeof ue.getDerivedStateFromError=="function"||ye!==null&&typeof ye.componentDidCatch=="function"&&(Ll===null||!Ll.has(ye)))){I.flags|=65536,s&=-s,I.lanes|=s;var Ne=Kx(I,u,s);Ry(I,Ne);break e}}I=I.return}while(I!==null)}m0(h)}catch(tt){s=tt,vn===h&&h!==null&&(vn=h=h.return);continue}break}while(1)}function p0(){var n=Hd.current;return Hd.current=Wd,n===null?Wd:n}function m_(){(In===0||In===3||In===2)&&(In=4),Vn===null||!(fu&268435455)&&!(up&268435455)||El(Vn,Jn)}function Yd(n,s){var h=si;si|=2;var v=p0();(Vn!==n||Jn!==s)&&(Ia=null,uu(n,s));do try{z2();break}catch(b){d0(n,b)}while(1);if(Ym(),si=h,Hd.current=v,vn!==null)throw Error($e(261));return Vn=null,Jn=0,In}function z2(){for(;vn!==null;)f0(vn)}function A2(){for(;vn!==null&&!nb();)f0(vn)}function f0(n){var s=g0(n.alternate,n,xo);n.memoizedProps=n.pendingProps,s===null?m0(n):vn=s,c_.current=null}function m0(n){var s=n;do{var h=s.alternate;if(n=s.return,s.flags&32768){if(h=E2(h,s),h!==null){h.flags&=32767,vn=h;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{In=6,vn=null;return}}else if(h=S2(h,s,xo),h!==null){vn=h;return}if(s=s.sibling,s!==null){vn=s;return}vn=s=n}while(s!==null);In===0&&(In=5)}function ou(n,s,h){var v=_i,b=Zo.transition;try{Zo.transition=null,_i=1,L2(n,s,h,v)}finally{Zo.transition=b,_i=v}return null}function L2(n,s,h,v){do rc();while(Cl!==null);if(si&6)throw Error($e(327));h=n.finishedWork;var b=n.finishedLanes;if(h===null)return null;if(n.finishedWork=null,n.finishedLanes=0,h===n.current)throw Error($e(177));n.callbackNode=null,n.callbackPriority=0;var I=h.lanes|h.childLanes;if(pb(n,I),n===Vn&&(vn=Vn=null,Jn=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||fd||(fd=!0,y0(Ad,function(){return rc(),null})),I=(h.flags&15990)!==0,h.subtreeFlags&15990||I){I=Zo.transition,Zo.transition=null;var O=_i;_i=1;var u=si;si|=4,c_.current=null,C2(n,h),u0(h,n),Qb(tm),Dd=!!em,tm=em=null,n.current=h,I2(h),rb(),si=u,_i=O,Zo.transition=I}else n.current=h;if(fd&&(fd=!1,Cl=n,Kd=b),I=n.pendingLanes,I===0&&(Ll=null),ab(h.stateNode),Jr(n,dn()),s!==null)for(v=n.onRecoverableError,h=0;h<s.length;h++)b=s[h],v(b.value,{componentStack:b.stack,digest:b.digest});if(Xd)throw Xd=!1,n=wm,wm=null,n;return Kd&1&&n.tag!==0&&rc(),I=n.pendingLanes,I&1?n===bm?lh++:(lh=0,bm=n):lh=0,Ul(),null}function rc(){if(Cl!==null){var n=Hv(Kd),s=Zo.transition,h=_i;try{if(Zo.transition=null,_i=16>n?16:n,Cl===null)var v=!1;else{if(n=Cl,Cl=null,Kd=0,si&6)throw Error($e(331));var b=si;for(si|=4,mt=n.current;mt!==null;){var I=mt,O=I.child;if(mt.flags&16){var u=I.deletions;if(u!==null){for(var H=0;H<u.length;H++){var q=u[H];for(mt=q;mt!==null;){var ke=mt;switch(ke.tag){case 0:case 11:case 15:sh(8,ke,I)}var _e=ke.child;if(_e!==null)_e.return=ke,mt=_e;else for(;mt!==null;){ke=mt;var Ce=ke.sibling,Ue=ke.return;if(s0(ke),ke===q){mt=null;break}if(Ce!==null){Ce.return=Ue,mt=Ce;break}mt=Ue}}}var We=I.alternate;if(We!==null){var Fe=We.child;if(Fe!==null){We.child=null;do{var Bt=Fe.sibling;Fe.sibling=null,Fe=Bt}while(Fe!==null)}}mt=I}}if(I.subtreeFlags&2064&&O!==null)O.return=I,mt=O;else e:for(;mt!==null;){if(I=mt,I.flags&2048)switch(I.tag){case 0:case 11:case 15:sh(9,I,I.return)}var pe=I.sibling;if(pe!==null){pe.return=I.return,mt=pe;break e}mt=I.return}}var ue=n.current;for(mt=ue;mt!==null;){O=mt;var ye=O.child;if(O.subtreeFlags&2064&&ye!==null)ye.return=O,mt=ye;else e:for(O=ue;mt!==null;){if(u=mt,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:lp(9,u)}}catch(tt){on(u,u.return,tt)}if(u===O){mt=null;break e}var Ne=u.sibling;if(Ne!==null){Ne.return=u.return,mt=Ne;break e}mt=u.return}}if(si=b,Ul(),ea&&typeof ea.onPostCommitFiberRoot=="function")try{ea.onPostCommitFiberRoot(ep,n)}catch{}v=!0}return v}finally{_i=h,Zo.transition=s}}return!1}function nv(n,s,h){s=cc(h,s),s=Xx(n,s,1),n=Al(n,s,1),s=Ar(),n!==null&&(Ch(n,1,s),Jr(n,s))}function on(n,s,h){if(n.tag===3)nv(n,n,h);else for(;s!==null;){if(s.tag===3){nv(s,n,h);break}else if(s.tag===1){var v=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(Ll===null||!Ll.has(v))){n=cc(h,n),n=Kx(s,n,1),s=Al(s,n,1),n=Ar(),s!==null&&(Ch(s,1,n),Jr(s,n));break}}s=s.return}}function D2(n,s,h){var v=n.pingCache;v!==null&&v.delete(s),s=Ar(),n.pingedLanes|=n.suspendedLanes&h,Vn===n&&(Jn&h)===h&&(In===4||In===3&&(Jn&130023424)===Jn&&500>dn()-d_?uu(n,0):h_|=h),Jr(n,s)}function _0(n,s){s===0&&(n.mode&1?(s=rd,rd<<=1,!(rd&130023424)&&(rd=4194304)):s=1);var h=Ar();n=Ra(n,s),n!==null&&(Ch(n,s,h),Jr(n,h))}function R2(n){var s=n.memoizedState,h=0;s!==null&&(h=s.retryLane),_0(n,h)}function B2(n,s){var h=0;switch(n.tag){case 13:var v=n.stateNode,b=n.memoizedState;b!==null&&(h=b.retryLane);break;case 19:v=n.stateNode;break;default:throw Error($e(314))}v!==null&&v.delete(s),_0(n,h)}var g0;g0=function(n,s,h){if(n!==null)if(n.memoizedProps!==s.pendingProps||Kr.current)Xr=!0;else{if(!(n.lanes&h)&&!(s.flags&128))return Xr=!1,T2(n,s,h);Xr=!!(n.flags&131072)}else Xr=!1,$i&&s.flags&1048576&&xx(s,Vd,s.index);switch(s.lanes=0,s.tag){case 2:var v=s.type;Ed(n,s),n=s.pendingProps;var b=sc(s,_r.current);nc(s,h),b=o_(null,s,v,n,b,h);var I=s_();return s.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Yr(v)?(I=!0,Nd(s)):I=!1,s.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,e_(s),b.updater=sp,s.stateNode=b,b._reactInternals=s,cm(s,v,n,h),s=pm(null,s,v,!0,I,h)):(s.tag=0,$i&&I&&Wm(s),zr(null,s,b,h),s=s.child),s;case 16:v=s.elementType;e:{switch(Ed(n,s),n=s.pendingProps,b=v._init,v=b(v._payload),s.type=v,b=s.tag=F2(v),n=ys(v,n),b){case 0:s=dm(null,s,v,n,h);break e;case 1:s=Wy(null,s,v,n,h);break e;case 11:s=qy(null,s,v,n,h);break e;case 14:s=Gy(null,s,v,ys(v.type,n),h);break e}throw Error($e(306,v,""))}return s;case 0:return v=s.type,b=s.pendingProps,b=s.elementType===v?b:ys(v,b),dm(n,s,v,b,h);case 1:return v=s.type,b=s.pendingProps,b=s.elementType===v?b:ys(v,b),Wy(n,s,v,b,h);case 3:e:{if(e0(s),n===null)throw Error($e(387));v=s.pendingProps,I=s.memoizedState,b=I.element,Sx(n,s),jd(s,v,null,h);var O=s.memoizedState;if(v=O.element,I.isDehydrated)if(I={element:v,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},s.updateQueue.baseState=I,s.memoizedState=I,s.flags&256){b=cc(Error($e(423)),s),s=Hy(n,s,v,h,b);break e}else if(v!==b){b=cc(Error($e(424)),s),s=Hy(n,s,v,h,b);break e}else for(wo=zl(s.stateNode.containerInfo.firstChild),bo=s,$i=!0,xs=null,h=Ix(s,null,v,h),s.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(ac(),v===b){s=Ba(n,s,h);break e}zr(n,s,v,h)}s=s.child}return s;case 5:return kx(s),n===null&&am(s),v=s.type,b=s.pendingProps,I=n!==null?n.memoizedProps:null,O=b.children,im(v,b)?O=null:I!==null&&im(v,I)&&(s.flags|=32),Qx(n,s),zr(n,s,O,h),s.child;case 6:return n===null&&am(s),null;case 13:return t0(n,s,h);case 4:return t_(s,s.stateNode.containerInfo),v=s.pendingProps,n===null?s.child=lc(s,null,v,h):zr(n,s,v,h),s.child;case 11:return v=s.type,b=s.pendingProps,b=s.elementType===v?b:ys(v,b),qy(n,s,v,b,h);case 7:return zr(n,s,s.pendingProps,h),s.child;case 8:return zr(n,s,s.pendingProps.children,h),s.child;case 12:return zr(n,s,s.pendingProps.children,h),s.child;case 10:e:{if(v=s.type._context,b=s.pendingProps,I=s.memoizedProps,O=b.value,Ii(Zd,v._currentValue),v._currentValue=O,I!==null)if(Ts(I.value,O)){if(I.children===b.children&&!Kr.current){s=Ba(n,s,h);break e}}else for(I=s.child,I!==null&&(I.return=s);I!==null;){var u=I.dependencies;if(u!==null){O=I.child;for(var H=u.firstContext;H!==null;){if(H.context===v){if(I.tag===1){H=Aa(-1,h&-h),H.tag=2;var q=I.updateQueue;if(q!==null){q=q.shared;var ke=q.pending;ke===null?H.next=H:(H.next=ke.next,ke.next=H),q.pending=H}}I.lanes|=h,H=I.alternate,H!==null&&(H.lanes|=h),lm(I.return,h,s),u.lanes|=h;break}H=H.next}}else if(I.tag===10)O=I.type===s.type?null:I.child;else if(I.tag===18){if(O=I.return,O===null)throw Error($e(341));O.lanes|=h,u=O.alternate,u!==null&&(u.lanes|=h),lm(O,h,s),O=I.sibling}else O=I.child;if(O!==null)O.return=I;else for(O=I;O!==null;){if(O===s){O=null;break}if(I=O.sibling,I!==null){I.return=O.return,O=I;break}O=O.return}I=O}zr(n,s,b.children,h),s=s.child}return s;case 9:return b=s.type,v=s.pendingProps.children,nc(s,h),b=$o(b),v=v(b),s.flags|=1,zr(n,s,v,h),s.child;case 14:return v=s.type,b=ys(v,s.pendingProps),b=ys(v.type,b),Gy(n,s,v,b,h);case 15:return Yx(n,s,s.type,s.pendingProps,h);case 17:return v=s.type,b=s.pendingProps,b=s.elementType===v?b:ys(v,b),Ed(n,s),s.tag=1,Yr(v)?(n=!0,Nd(s)):n=!1,nc(s,h),Px(s,v,b),cm(s,v,b,h),pm(null,s,v,!0,n,h);case 19:return i0(n,s,h);case 22:return Jx(n,s,h)}throw Error($e(156,s.tag))};function y0(n,s){return jv(n,s)}function O2(n,s,h,v){this.tag=n,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vo(n,s,h,v){return new O2(n,s,h,v)}function __(n){return n=n.prototype,!(!n||!n.isReactComponent)}function F2(n){if(typeof n=="function")return __(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Rm)return 11;if(n===Bm)return 14}return 2}function Rl(n,s){var h=n.alternate;return h===null?(h=Vo(n.tag,s,n.key,n.mode),h.elementType=n.elementType,h.type=n.type,h.stateNode=n.stateNode,h.alternate=n,n.alternate=h):(h.pendingProps=s,h.type=n.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=n.flags&14680064,h.childLanes=n.childLanes,h.lanes=n.lanes,h.child=n.child,h.memoizedProps=n.memoizedProps,h.memoizedState=n.memoizedState,h.updateQueue=n.updateQueue,s=n.dependencies,h.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},h.sibling=n.sibling,h.index=n.index,h.ref=n.ref,h}function Id(n,s,h,v,b,I){var O=2;if(v=n,typeof n=="function")__(n)&&(O=1);else if(typeof n=="string")O=5;else e:switch(n){case Zu:return cu(h.children,b,I,s);case Dm:O=8,b|=8;break;case Df:return n=Vo(12,h,s,b|2),n.elementType=Df,n.lanes=I,n;case Rf:return n=Vo(13,h,s,b),n.elementType=Rf,n.lanes=I,n;case Bf:return n=Vo(19,h,s,b),n.elementType=Bf,n.lanes=I,n;case Cv:return cp(h,b,I,s);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Ev:O=10;break e;case Pv:O=9;break e;case Rm:O=11;break e;case Bm:O=14;break e;case bl:O=16,v=null;break e}throw Error($e(130,n==null?n:typeof n,""))}return s=Vo(O,h,s,b),s.elementType=n,s.type=v,s.lanes=I,s}function cu(n,s,h,v){return n=Vo(7,n,v,s),n.lanes=h,n}function cp(n,s,h,v){return n=Vo(22,n,v,s),n.elementType=Cv,n.lanes=h,n.stateNode={isHidden:!1},n}function If(n,s,h){return n=Vo(6,n,null,s),n.lanes=h,n}function kf(n,s,h){return s=Vo(4,n.children!==null?n.children:[],n.key,s),s.lanes=h,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}function N2(n,s,h,v,b){this.tag=s,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uf(0),this.expirationTimes=uf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uf(0),this.identifierPrefix=v,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function g_(n,s,h,v,b,I,O,u,H){return n=new N2(n,s,h,u,H),s===1?(s=1,I===!0&&(s|=8)):s=0,I=Vo(3,null,null,s),n.current=I,I.stateNode=n,I.memoizedState={element:v,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},e_(I),n}function U2(n,s,h){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Vu,key:v==null?null:""+v,children:n,containerInfo:s,implementation:h}}function v0(n){if(!n)return Ol;n=n._reactInternals;e:{if(gu(n)!==n||n.tag!==1)throw Error($e(170));var s=n;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Yr(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error($e(171))}if(n.tag===1){var h=n.type;if(Yr(h))return yx(n,h,s)}return s}function x0(n,s,h,v,b,I,O,u,H){return n=g_(h,v,!0,n,b,I,O,u,H),n.context=v0(null),h=n.current,v=Ar(),b=Dl(h),I=Aa(v,b),I.callback=s??null,Al(h,I,b),n.current.lanes=b,Ch(n,b,v),Jr(n,v),n}function hp(n,s,h,v){var b=s.current,I=Ar(),O=Dl(b);return h=v0(h),s.context===null?s.context=h:s.pendingContext=h,s=Aa(I,O),s.payload={element:n},v=v===void 0?null:v,v!==null&&(s.callback=v),n=Al(b,s,O),n!==null&&(bs(n,b,O,I),bd(n,b,O)),O}function Jd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function rv(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var h=n.retryLane;n.retryLane=h!==0&&h<s?h:s}}function y_(n,s){rv(n,s),(n=n.alternate)&&rv(n,s)}function V2(){return null}var w0=typeof reportError=="function"?reportError:function(n){console.error(n)};function v_(n){this._internalRoot=n}dp.prototype.render=v_.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error($e(409));hp(n,s,null,null)};dp.prototype.unmount=v_.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;mu(function(){hp(null,n,null,null)}),s[Da]=null}};function dp(n){this._internalRoot=n}dp.prototype.unstable_scheduleHydration=function(n){if(n){var s=Yv();n={blockedOn:null,target:n,priority:s};for(var h=0;h<Sl.length&&s!==0&&s<Sl[h].priority;h++);Sl.splice(h,0,n),h===0&&Qv(n)}};function x_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function pp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function ov(){}function Z2(n,s,h,v,b){if(b){if(typeof v=="function"){var I=v;v=function(){var q=Jd(O);I.call(q)}}var O=x0(s,v,n,0,null,!1,!1,"",ov);return n._reactRootContainer=O,n[Da]=O.current,gh(n.nodeType===8?n.parentNode:n),mu(),O}for(;b=n.lastChild;)n.removeChild(b);if(typeof v=="function"){var u=v;v=function(){var q=Jd(H);u.call(q)}}var H=g_(n,0,!1,null,null,!1,!1,"",ov);return n._reactRootContainer=H,n[Da]=H.current,gh(n.nodeType===8?n.parentNode:n),mu(function(){hp(s,H,h,v)}),H}function fp(n,s,h,v,b){var I=h._reactRootContainer;if(I){var O=I;if(typeof b=="function"){var u=b;b=function(){var H=Jd(O);u.call(H)}}hp(s,O,n,b)}else O=Z2(h,s,n,b,v);return Jd(O)}Xv=function(n){switch(n.tag){case 3:var s=n.stateNode;if(s.current.memoizedState.isDehydrated){var h=Jc(s.pendingLanes);h!==0&&(Nm(s,h|1),Jr(s,dn()),!(si&6)&&(hc=dn()+500,Ul()))}break;case 13:mu(function(){var v=Ra(n,1);if(v!==null){var b=Ar();bs(v,n,1,b)}}),y_(n,1)}};Um=function(n){if(n.tag===13){var s=Ra(n,134217728);if(s!==null){var h=Ar();bs(s,n,134217728,h)}y_(n,134217728)}};Kv=function(n){if(n.tag===13){var s=Dl(n),h=Ra(n,s);if(h!==null){var v=Ar();bs(h,n,s,v)}y_(n,s)}};Yv=function(){return _i};Jv=function(n,s){var h=_i;try{return _i=n,s()}finally{_i=h}};Gf=function(n,s,h){switch(s){case"input":if(Nf(n,h),s=h.name,h.type==="radio"&&s!=null){for(h=n;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<h.length;s++){var v=h[s];if(v!==n&&v.form===n.form){var b=rp(v);if(!b)throw Error($e(90));kv(v),Nf(v,b)}}}break;case"textarea":zv(n,h);break;case"select":s=h.value,s!=null&&Qu(n,!!h.multiple,s,!1)}};Fv=p_;Nv=mu;var $2={usingClientEntryPoint:!1,Events:[kh,Gu,rp,Bv,Ov,p_]},Xc={findFiberByHostInstance:su,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},j2={bundleType:Xc.bundleType,version:Xc.version,rendererPackageName:Xc.rendererPackageName,rendererConfig:Xc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Oa.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Zv(n),n===null?null:n.stateNode},findFiberByHostInstance:Xc.findFiberByHostInstance||V2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var md=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!md.isDisabled&&md.supportsFiber)try{ep=md.inject(j2),ea=md}catch{}}So.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$2;So.createPortal=function(n,s){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!x_(s))throw Error($e(200));return U2(n,s,null,h)};So.createRoot=function(n,s){if(!x_(n))throw Error($e(299));var h=!1,v="",b=w0;return s!=null&&(s.unstable_strictMode===!0&&(h=!0),s.identifierPrefix!==void 0&&(v=s.identifierPrefix),s.onRecoverableError!==void 0&&(b=s.onRecoverableError)),s=g_(n,1,!1,null,null,h,!1,v,b),n[Da]=s.current,gh(n.nodeType===8?n.parentNode:n),new v_(s)};So.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error($e(188)):(n=Object.keys(n).join(","),Error($e(268,n)));return n=Zv(s),n=n===null?null:n.stateNode,n};So.flushSync=function(n){return mu(n)};So.hydrate=function(n,s,h){if(!pp(s))throw Error($e(200));return fp(null,n,s,!0,h)};So.hydrateRoot=function(n,s,h){if(!x_(n))throw Error($e(405));var v=h!=null&&h.hydratedSources||null,b=!1,I="",O=w0;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(I=h.identifierPrefix),h.onRecoverableError!==void 0&&(O=h.onRecoverableError)),s=x0(s,null,n,1,h??null,b,!1,I,O),n[Da]=s.current,gh(n),v)for(n=0;n<v.length;n++)h=v[n],b=h._getVersion,b=b(h._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[h,b]:s.mutableSourceEagerHydrationData.push(h,b);return new dp(s)};So.render=function(n,s,h){if(!pp(s))throw Error($e(200));return fp(null,n,s,!1,h)};So.unmountComponentAtNode=function(n){if(!pp(n))throw Error($e(40));return n._reactRootContainer?(mu(function(){fp(null,null,n,!1,function(){n._reactRootContainer=null,n[Da]=null})}),!0):!1};So.unstable_batchedUpdates=p_;So.unstable_renderSubtreeIntoContainer=function(n,s,h,v){if(!pp(h))throw Error($e(200));if(n==null||n._reactInternals===void 0)throw Error($e(38));return fp(n,s,h,!1,v)};So.version="18.2.0-next-9e3b772b8-20220608";function b0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b0)}catch(n){console.error(n)}}b0(),xv.exports=So;var q2=xv.exports,sv=q2;Af.createRoot=sv.createRoot,Af.hydrateRoot=sv.hydrateRoot;function G2(n,s){const h=ji.useRef(s);ji.useEffect(function(){s!==h.current&&n.attributionControl!=null&&(h.current!=null&&n.attributionControl.removeAttribution(h.current),s!=null&&n.attributionControl.addAttribution(s)),h.current=s},[n,s])}const W2=1;function H2(n){return Object.freeze({__version:W2,map:n})}const T0=ji.createContext(null),X2=T0.Provider;function K2(){const n=ji.useContext(T0);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function Y2(n){function s(h,v){const{instance:b}=n(h).current;return ji.useImperativeHandle(v,()=>b),null}return ji.forwardRef(s)}function J2(n,s){const h=ji.useRef();ji.useEffect(function(){return s!=null&&n.instance.on(s),h.current=s,function(){h.current!=null&&n.instance.off(h.current),h.current=null}},[n,s])}function S0(n,s){const h=n.pane??s.pane;return h?{...n,pane:h}:n}var _d={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var av;function E0(){return av||(av=1,function(n,s){(function(h,v){v(s)})(Pm,function(h){var v="1.9.4";function b(o){var d,x,P,z;for(x=1,P=arguments.length;x<P;x++){z=arguments[x];for(d in z)o[d]=z[d]}return o}var I=Object.create||function(){function o(){}return function(d){return o.prototype=d,new o}}();function O(o,d){var x=Array.prototype.slice;if(o.bind)return o.bind.apply(o,x.call(arguments,1));var P=x.call(arguments,2);return function(){return o.apply(d,P.length?P.concat(x.call(arguments)):arguments)}}var u=0;function H(o){return"_leaflet_id"in o||(o._leaflet_id=++u),o._leaflet_id}function q(o,d,x){var P,z,$,oe;return oe=function(){P=!1,z&&($.apply(x,z),z=!1)},$=function(){P?z=arguments:(o.apply(x,arguments),setTimeout(oe,d),P=!0)},$}function ke(o,d,x){var P=d[1],z=d[0],$=P-z;return o===P&&x?o:((o-z)%$+$)%$+z}function _e(){return!1}function Ce(o,d){if(d===!1)return o;var x=Math.pow(10,d===void 0?6:d);return Math.round(o*x)/x}function Ue(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}function We(o){return Ue(o).split(/\s+/)}function Fe(o,d){Object.prototype.hasOwnProperty.call(o,"options")||(o.options=o.options?I(o.options):{});for(var x in d)o.options[x]=d[x];return o.options}function Bt(o,d,x){var P=[];for(var z in o)P.push(encodeURIComponent(x?z.toUpperCase():z)+"="+encodeURIComponent(o[z]));return(!d||d.indexOf("?")===-1?"?":"&")+P.join("&")}var pe=/\{ *([\w_ -]+) *\}/g;function ue(o,d){return o.replace(pe,function(x,P){var z=d[P];if(z===void 0)throw new Error("No value provided for variable "+x);return typeof z=="function"&&(z=z(d)),z})}var ye=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"};function Ne(o,d){for(var x=0;x<o.length;x++)if(o[x]===d)return x;return-1}var tt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function ht(o){return window["webkit"+o]||window["moz"+o]||window["ms"+o]}var rt=0;function dt(o){var d=+new Date,x=Math.max(0,16-(d-rt));return rt=d+x,window.setTimeout(o,x)}var Ut=window.requestAnimationFrame||ht("RequestAnimationFrame")||dt,ct=window.cancelAnimationFrame||ht("CancelAnimationFrame")||ht("CancelRequestAnimationFrame")||function(o){window.clearTimeout(o)};function ei(o,d,x){if(x&&Ut===dt)o.call(d);else return Ut.call(window,O(o,d))}function ri(o){o&&ct.call(window,o)}var xn={__proto__:null,extend:b,create:I,bind:O,get lastId(){return u},stamp:H,throttle:q,wrapNum:ke,falseFn:_e,formatNum:Ce,trim:Ue,splitWords:We,setOptions:Fe,getParamString:Bt,template:ue,isArray:ye,indexOf:Ne,emptyImageUrl:tt,requestFn:Ut,cancelFn:ct,requestAnimFrame:ei,cancelAnimFrame:ri};function sn(){}sn.extend=function(o){var d=function(){Fe(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},x=d.__super__=this.prototype,P=I(x);P.constructor=d,d.prototype=P;for(var z in this)Object.prototype.hasOwnProperty.call(this,z)&&z!=="prototype"&&z!=="__super__"&&(d[z]=this[z]);return o.statics&&b(d,o.statics),o.includes&&(Rr(o.includes),b.apply(null,[P].concat(o.includes))),b(P,o),delete P.statics,delete P.includes,P.options&&(P.options=x.options?I(x.options):{},b(P.options,o.options)),P._initHooks=[],P.callInitHooks=function(){if(!this._initHooksCalled){x.callInitHooks&&x.callInitHooks.call(this),this._initHooksCalled=!0;for(var $=0,oe=P._initHooks.length;$<oe;$++)P._initHooks[$].call(this)}},d},sn.include=function(o){var d=this.prototype.options;return b(this.prototype,o),o.options&&(this.prototype.options=d,this.mergeOptions(o.options)),this},sn.mergeOptions=function(o){return b(this.prototype.options,o),this},sn.addInitHook=function(o){var d=Array.prototype.slice.call(arguments,1),x=typeof o=="function"?o:function(){this[o].apply(this,d)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(x),this};function Rr(o){if(!(typeof L>"u"||!L||!L.Mixin)){o=ye(o)?o:[o];for(var d=0;d<o.length;d++)o[d]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var hi={on:function(o,d,x){if(typeof o=="object")for(var P in o)this._on(P,o[P],d);else{o=We(o);for(var z=0,$=o.length;z<$;z++)this._on(o[z],d,x)}return this},off:function(o,d,x){if(!arguments.length)delete this._events;else if(typeof o=="object")for(var P in o)this._off(P,o[P],d);else{o=We(o);for(var z=arguments.length===1,$=0,oe=o.length;$<oe;$++)z?this._off(o[$]):this._off(o[$],d,x)}return this},_on:function(o,d,x,P){if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}if(this._listens(o,d,x)===!1){x===this&&(x=void 0);var z={fn:d,ctx:x};P&&(z.once=!0),this._events=this._events||{},this._events[o]=this._events[o]||[],this._events[o].push(z)}},_off:function(o,d,x){var P,z,$;if(this._events&&(P=this._events[o],!!P)){if(arguments.length===1){if(this._firingCount)for(z=0,$=P.length;z<$;z++)P[z].fn=_e;delete this._events[o];return}if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}var oe=this._listens(o,d,x);if(oe!==!1){var we=P[oe];this._firingCount&&(we.fn=_e,this._events[o]=P=P.slice()),P.splice(oe,1)}}},fire:function(o,d,x){if(!this.listens(o,x))return this;var P=b({},d,{type:o,target:this,sourceTarget:d&&d.sourceTarget||this});if(this._events){var z=this._events[o];if(z){this._firingCount=this._firingCount+1||1;for(var $=0,oe=z.length;$<oe;$++){var we=z[$],ce=we.fn;we.once&&this.off(o,ce,we.ctx),ce.call(we.ctx||this,P)}this._firingCount--}}return x&&this._propagateEvent(P),this},listens:function(o,d,x,P){typeof o!="string"&&console.warn('"string" type argument expected');var z=d;typeof d!="function"&&(P=!!d,z=void 0,x=void 0);var $=this._events&&this._events[o];if($&&$.length&&this._listens(o,z,x)!==!1)return!0;if(P){for(var oe in this._eventParents)if(this._eventParents[oe].listens(o,d,x,P))return!0}return!1},_listens:function(o,d,x){if(!this._events)return!1;var P=this._events[o]||[];if(!d)return!!P.length;x===this&&(x=void 0);for(var z=0,$=P.length;z<$;z++)if(P[z].fn===d&&P[z].ctx===x)return z;return!1},once:function(o,d,x){if(typeof o=="object")for(var P in o)this._on(P,o[P],d,!0);else{o=We(o);for(var z=0,$=o.length;z<$;z++)this._on(o[z],d,x,!0)}return this},addEventParent:function(o){return this._eventParents=this._eventParents||{},this._eventParents[H(o)]=o,this},removeEventParent:function(o){return this._eventParents&&delete this._eventParents[H(o)],this},_propagateEvent:function(o){for(var d in this._eventParents)this._eventParents[d].fire(o.type,b({layer:o.target,propagatedFrom:o.target},o),!0)}};hi.addEventListener=hi.on,hi.removeEventListener=hi.clearAllEventListeners=hi.off,hi.addOneTimeEventListener=hi.once,hi.fireEvent=hi.fire,hi.hasEventListeners=hi.listens;var kn=sn.extend(hi);function Re(o,d,x){this.x=x?Math.round(o):o,this.y=x?Math.round(d):d}var kt=Math.trunc||function(o){return o>0?Math.floor(o):Math.ceil(o)};Re.prototype={clone:function(){return new Re(this.x,this.y)},add:function(o){return this.clone()._add(He(o))},_add:function(o){return this.x+=o.x,this.y+=o.y,this},subtract:function(o){return this.clone()._subtract(He(o))},_subtract:function(o){return this.x-=o.x,this.y-=o.y,this},divideBy:function(o){return this.clone()._divideBy(o)},_divideBy:function(o){return this.x/=o,this.y/=o,this},multiplyBy:function(o){return this.clone()._multiplyBy(o)},_multiplyBy:function(o){return this.x*=o,this.y*=o,this},scaleBy:function(o){return new Re(this.x*o.x,this.y*o.y)},unscaleBy:function(o){return new Re(this.x/o.x,this.y/o.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=kt(this.x),this.y=kt(this.y),this},distanceTo:function(o){o=He(o);var d=o.x-this.x,x=o.y-this.y;return Math.sqrt(d*d+x*x)},equals:function(o){return o=He(o),o.x===this.x&&o.y===this.y},contains:function(o){return o=He(o),Math.abs(o.x)<=Math.abs(this.x)&&Math.abs(o.y)<=Math.abs(this.y)},toString:function(){return"Point("+Ce(this.x)+", "+Ce(this.y)+")"}};function He(o,d,x){return o instanceof Re?o:ye(o)?new Re(o[0],o[1]):o==null?o:typeof o=="object"&&"x"in o&&"y"in o?new Re(o.x,o.y):new Re(o,d,x)}function St(o,d){if(o)for(var x=d?[o,d]:o,P=0,z=x.length;P<z;P++)this.extend(x[P])}St.prototype={extend:function(o){var d,x;if(!o)return this;if(o instanceof Re||typeof o[0]=="number"||"x"in o)d=x=He(o);else if(o=Rt(o),d=o.min,x=o.max,!d||!x)return this;return!this.min&&!this.max?(this.min=d.clone(),this.max=x.clone()):(this.min.x=Math.min(d.x,this.min.x),this.max.x=Math.max(x.x,this.max.x),this.min.y=Math.min(d.y,this.min.y),this.max.y=Math.max(x.y,this.max.y)),this},getCenter:function(o){return He((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,o)},getBottomLeft:function(){return He(this.min.x,this.max.y)},getTopRight:function(){return He(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(o){var d,x;return typeof o[0]=="number"||o instanceof Re?o=He(o):o=Rt(o),o instanceof St?(d=o.min,x=o.max):d=x=o,d.x>=this.min.x&&x.x<=this.max.x&&d.y>=this.min.y&&x.y<=this.max.y},intersects:function(o){o=Rt(o);var d=this.min,x=this.max,P=o.min,z=o.max,$=z.x>=d.x&&P.x<=x.x,oe=z.y>=d.y&&P.y<=x.y;return $&&oe},overlaps:function(o){o=Rt(o);var d=this.min,x=this.max,P=o.min,z=o.max,$=z.x>d.x&&P.x<x.x,oe=z.y>d.y&&P.y<x.y;return $&&oe},isValid:function(){return!!(this.min&&this.max)},pad:function(o){var d=this.min,x=this.max,P=Math.abs(d.x-x.x)*o,z=Math.abs(d.y-x.y)*o;return Rt(He(d.x-P,d.y-z),He(x.x+P,x.y+z))},equals:function(o){return o?(o=Rt(o),this.min.equals(o.getTopLeft())&&this.max.equals(o.getBottomRight())):!1}};function Rt(o,d){return!o||o instanceof St?o:new St(o,d)}function ti(o,d){if(o)for(var x=d?[o,d]:o,P=0,z=x.length;P<z;P++)this.extend(x[P])}ti.prototype={extend:function(o){var d=this._southWest,x=this._northEast,P,z;if(o instanceof Zt)P=o,z=o;else if(o instanceof ti){if(P=o._southWest,z=o._northEast,!P||!z)return this}else return o?this.extend(zt(o)||Ct(o)):this;return!d&&!x?(this._southWest=new Zt(P.lat,P.lng),this._northEast=new Zt(z.lat,z.lng)):(d.lat=Math.min(P.lat,d.lat),d.lng=Math.min(P.lng,d.lng),x.lat=Math.max(z.lat,x.lat),x.lng=Math.max(z.lng,x.lng)),this},pad:function(o){var d=this._southWest,x=this._northEast,P=Math.abs(d.lat-x.lat)*o,z=Math.abs(d.lng-x.lng)*o;return new ti(new Zt(d.lat-P,d.lng-z),new Zt(x.lat+P,x.lng+z))},getCenter:function(){return new Zt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Zt(this.getNorth(),this.getWest())},getSouthEast:function(){return new Zt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(o){typeof o[0]=="number"||o instanceof Zt||"lat"in o?o=zt(o):o=Ct(o);var d=this._southWest,x=this._northEast,P,z;return o instanceof ti?(P=o.getSouthWest(),z=o.getNorthEast()):P=z=o,P.lat>=d.lat&&z.lat<=x.lat&&P.lng>=d.lng&&z.lng<=x.lng},intersects:function(o){o=Ct(o);var d=this._southWest,x=this._northEast,P=o.getSouthWest(),z=o.getNorthEast(),$=z.lat>=d.lat&&P.lat<=x.lat,oe=z.lng>=d.lng&&P.lng<=x.lng;return $&&oe},overlaps:function(o){o=Ct(o);var d=this._southWest,x=this._northEast,P=o.getSouthWest(),z=o.getNorthEast(),$=z.lat>d.lat&&P.lat<x.lat,oe=z.lng>d.lng&&P.lng<x.lng;return $&&oe},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(o,d){return o?(o=Ct(o),this._southWest.equals(o.getSouthWest(),d)&&this._northEast.equals(o.getNorthEast(),d)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Ct(o,d){return o instanceof ti?o:new ti(o,d)}function Zt(o,d,x){if(isNaN(o)||isNaN(d))throw new Error("Invalid LatLng object: ("+o+", "+d+")");this.lat=+o,this.lng=+d,x!==void 0&&(this.alt=+x)}Zt.prototype={equals:function(o,d){if(!o)return!1;o=zt(o);var x=Math.max(Math.abs(this.lat-o.lat),Math.abs(this.lng-o.lng));return x<=(d===void 0?1e-9:d)},toString:function(o){return"LatLng("+Ce(this.lat,o)+", "+Ce(this.lng,o)+")"},distanceTo:function(o){return Zn.distance(this,zt(o))},wrap:function(){return Zn.wrapLatLng(this)},toBounds:function(o){var d=180*o/40075017,x=d/Math.cos(Math.PI/180*this.lat);return Ct([this.lat-d,this.lng-x],[this.lat+d,this.lng+x])},clone:function(){return new Zt(this.lat,this.lng,this.alt)}};function zt(o,d,x){return o instanceof Zt?o:ye(o)&&typeof o[0]!="object"?o.length===3?new Zt(o[0],o[1],o[2]):o.length===2?new Zt(o[0],o[1]):null:o==null?o:typeof o=="object"&&"lat"in o?new Zt(o.lat,"lng"in o?o.lng:o.lon,o.alt):d===void 0?null:new Zt(o,d,x)}var Bi={latLngToPoint:function(o,d){var x=this.projection.project(o),P=this.scale(d);return this.transformation._transform(x,P)},pointToLatLng:function(o,d){var x=this.scale(d),P=this.transformation.untransform(o,x);return this.projection.unproject(P)},project:function(o){return this.projection.project(o)},unproject:function(o){return this.projection.unproject(o)},scale:function(o){return 256*Math.pow(2,o)},zoom:function(o){return Math.log(o/256)/Math.LN2},getProjectedBounds:function(o){if(this.infinite)return null;var d=this.projection.bounds,x=this.scale(o),P=this.transformation.transform(d.min,x),z=this.transformation.transform(d.max,x);return new St(P,z)},infinite:!1,wrapLatLng:function(o){var d=this.wrapLng?ke(o.lng,this.wrapLng,!0):o.lng,x=this.wrapLat?ke(o.lat,this.wrapLat,!0):o.lat,P=o.alt;return new Zt(x,d,P)},wrapLatLngBounds:function(o){var d=o.getCenter(),x=this.wrapLatLng(d),P=d.lat-x.lat,z=d.lng-x.lng;if(P===0&&z===0)return o;var $=o.getSouthWest(),oe=o.getNorthEast(),we=new Zt($.lat-P,$.lng-z),ce=new Zt(oe.lat-P,oe.lng-z);return new ti(we,ce)}},Zn=b({},Bi,{wrapLng:[-180,180],R:6371e3,distance:function(o,d){var x=Math.PI/180,P=o.lat*x,z=d.lat*x,$=Math.sin((d.lat-o.lat)*x/2),oe=Math.sin((d.lng-o.lng)*x/2),we=$*$+Math.cos(P)*Math.cos(z)*oe*oe,ce=2*Math.atan2(Math.sqrt(we),Math.sqrt(1-we));return this.R*ce}}),Br=6378137,Mn={R:Br,MAX_LATITUDE:85.0511287798,project:function(o){var d=Math.PI/180,x=this.MAX_LATITUDE,P=Math.max(Math.min(x,o.lat),-x),z=Math.sin(P*d);return new Re(this.R*o.lng*d,this.R*Math.log((1+z)/(1-z))/2)},unproject:function(o){var d=180/Math.PI;return new Zt((2*Math.atan(Math.exp(o.y/this.R))-Math.PI/2)*d,o.x*d/this.R)},bounds:function(){var o=Br*Math.PI;return new St([-o,-o],[o,o])}()};function er(o,d,x,P){if(ye(o)){this._a=o[0],this._b=o[1],this._c=o[2],this._d=o[3];return}this._a=o,this._b=d,this._c=x,this._d=P}er.prototype={transform:function(o,d){return this._transform(o.clone(),d)},_transform:function(o,d){return d=d||1,o.x=d*(this._a*o.x+this._b),o.y=d*(this._c*o.y+this._d),o},untransform:function(o,d){return d=d||1,new Re((o.x/d-this._b)/this._a,(o.y/d-this._d)/this._c)}};function tr(o,d,x,P){return new er(o,d,x,P)}var Ie=b({},Zn,{code:"EPSG:3857",projection:Mn,transformation:function(){var o=.5/(Math.PI*Mn.R);return tr(o,.5,-o,.5)}()}),Qr=b({},Ie,{code:"EPSG:900913"});function qo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ii(o,d){var x="",P,z,$,oe,we,ce;for(P=0,$=o.length;P<$;P++){for(we=o[P],z=0,oe=we.length;z<oe;z++)ce=we[z],x+=(z?"L":"M")+ce.x+" "+ce.y;x+=d?ve.svg?"z":"x":""}return x||"M0 0"}var Xt=document.documentElement.style,Or="ActiveXObject"in window,Go=Or&&!document.addEventListener,ia="msLaunchUri"in navigator&&!("documentMode"in document),Ss=de("webkit"),gi=de("android"),Es=de("android 2")||de("android 3"),Ps=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),qe=gi&&de("Google")&&Ps<537&&!("AudioNode"in window),an=!!window.opera,wn=!ia&&de("chrome"),Fr=de("gecko")&&!Ss&&!an&&!Or,Po=!wn&&de("safari"),je=de("phantom"),Mt="OTransition"in Xt,At=navigator.platform.indexOf("Win")===0,ln=Or&&"transition"in Xt,gr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Es,yt="MozPerspective"in Xt,Nr=!window.L_DISABLE_3D&&(ln||gr||yt)&&!Mt&&!je,zn=typeof orientation<"u"||de("mobile"),Co=zn&&Ss,ir=zn&&gr,eo=!window.PointerEvent&&window.MSPointerEvent,en=!!(window.PointerEvent||eo),ai="ontouchstart"in window||!!window.TouchEvent,na=!window.L_NO_TOUCH&&(ai||en),Ur=zn&&an,J=zn&&Fr,F=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,U=function(){var o=!1;try{var d=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("testPassiveEventSupport",_e,d),window.removeEventListener("testPassiveEventSupport",_e,d)}catch{}return o}(),G=function(){return!!document.createElement("canvas").getContext}(),ee=!!(document.createElementNS&&qo("svg").createSVGRect),re=!!ee&&function(){var o=document.createElement("div");return o.innerHTML="<svg/>",(o.firstChild&&o.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),me=!ee&&function(){try{var o=document.createElement("div");o.innerHTML='<v:shape adj="1"/>';var d=o.firstChild;return d.style.behavior="url(#default#VML)",d&&typeof d.adj=="object"}catch{return!1}}(),ae=navigator.platform.indexOf("Mac")===0,se=navigator.platform.indexOf("Linux")===0;function de(o){return navigator.userAgent.toLowerCase().indexOf(o)>=0}var ve={ie:Or,ielt9:Go,edge:ia,webkit:Ss,android:gi,android23:Es,androidStock:qe,opera:an,chrome:wn,gecko:Fr,safari:Po,phantom:je,opera12:Mt,win:At,ie3d:ln,webkit3d:gr,gecko3d:yt,any3d:Nr,mobile:zn,mobileWebkit:Co,mobileWebkit3d:ir,msPointer:eo,pointer:en,touch:na,touchNative:ai,mobileOpera:Ur,mobileGecko:J,retina:F,passiveEvents:U,canvas:G,svg:ee,vml:me,inlineSvg:re,mac:ae,linux:se},Ae=ve.msPointer?"MSPointerDown":"pointerdown",Le=ve.msPointer?"MSPointerMove":"pointermove",_t=ve.msPointer?"MSPointerUp":"pointerup",It=ve.msPointer?"MSPointerCancel":"pointercancel",ot={touchstart:Ae,touchmove:Le,touchend:_t,touchcancel:It},ft={touchstart:ki,touchmove:Fi,touchend:Fi,touchcancel:Fi},vt={},qt=!1;function oi(o,d,x){return d==="touchstart"&&Oi(),ft[d]?(x=ft[d].bind(this,x),o.addEventListener(ot[d],x,!1),x):(console.warn("wrong event specified:",d),_e)}function Ot(o,d,x){if(!ot[d]){console.warn("wrong event specified:",d);return}o.removeEventListener(ot[d],x,!1)}function Gt(o){vt[o.pointerId]=o}function An(o){vt[o.pointerId]&&(vt[o.pointerId]=o)}function xt(o){delete vt[o.pointerId]}function Oi(){qt||(document.addEventListener(Ae,Gt,!0),document.addEventListener(Le,An,!0),document.addEventListener(_t,xt,!0),document.addEventListener(It,xt,!0),qt=!0)}function Fi(o,d){if(d.pointerType!==(d.MSPOINTER_TYPE_MOUSE||"mouse")){d.touches=[];for(var x in vt)d.touches.push(vt[x]);d.changedTouches=[d],o(d)}}function ki(o,d){d.MSPOINTER_TYPE_TOUCH&&d.pointerType===d.MSPOINTER_TYPE_TOUCH&&Ni(d),Fi(o,d)}function $n(o){var d={},x,P;for(P in o)x=o[P],d[P]=x&&x.bind?x.bind(o):x;return o=d,d.type="dblclick",d.detail=2,d.isTrusted=!1,d._simulated=!0,d}var mc=200;function pn(o,d){o.addEventListener("dblclick",d);var x=0,P;function z($){if($.detail!==1){P=$.detail;return}if(!($.pointerType==="mouse"||$.sourceCapabilities&&!$.sourceCapabilities.firesTouchEvents)){var oe=Yo($);if(!(oe.some(function(ce){return ce instanceof HTMLLabelElement&&ce.attributes.for})&&!oe.some(function(ce){return ce instanceof HTMLInputElement||ce instanceof HTMLSelectElement}))){var we=Date.now();we-x<=mc?(P++,P===2&&d($n($))):P=1,x=we}}}return o.addEventListener("click",z),{dblclick:d,simDblclick:z}}function nr(o,d){o.removeEventListener("dblclick",d.dblclick),o.removeEventListener("click",d.simDblclick)}var Fa=Na(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Io=Na(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ci=Io==="webkitTransition"||Io==="OTransition"?Io+"End":"transitionend";function to(o){return typeof o=="string"?document.getElementById(o):o}function yr(o,d){var x=o.style[d]||o.currentStyle&&o.currentStyle[d];if((!x||x==="auto")&&document.defaultView){var P=document.defaultView.getComputedStyle(o,null);x=P?P[d]:null}return x==="auto"?null:x}function Tt(o,d,x){var P=document.createElement(o);return P.className=d||"",x&&x.appendChild(P),P}function di(o){var d=o.parentNode;d&&d.removeChild(o)}function qi(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function io(o){var d=o.parentNode;d&&d.lastChild!==o&&d.appendChild(o)}function bn(o){var d=o.parentNode;d&&d.firstChild!==o&&d.insertBefore(o,d.firstChild)}function Wo(o,d){if(o.classList!==void 0)return o.classList.contains(d);var x=vr(o);return x.length>0&&new RegExp("(^|\\s)"+d+"(\\s|$)").test(x)}function at(o,d){if(o.classList!==void 0)for(var x=We(d),P=0,z=x.length;P<z;P++)o.classList.add(x[P]);else if(!Wo(o,d)){var $=vr(o);ko(o,($?$+" ":"")+d)}}function yi(o,d){o.classList!==void 0?o.classList.remove(d):ko(o,Ue((" "+vr(o)+" ").replace(" "+d+" "," ")))}function ko(o,d){o.className.baseVal===void 0?o.className=d:o.className.baseVal=d}function vr(o){return o.correspondingElement&&(o=o.correspondingElement),o.className.baseVal===void 0?o.className:o.className.baseVal}function Tn(o,d){"opacity"in o.style?o.style.opacity=d:"filter"in o.style&&ra(o,d)}function ra(o,d){var x=!1,P="DXImageTransform.Microsoft.Alpha";try{x=o.filters.item(P)}catch{if(d===1)return}d=Math.round(d*100),x?(x.Enabled=d!==100,x.Opacity=d):o.style.filter+=" progid:"+P+"(opacity="+d+")"}function Na(o){for(var d=document.documentElement.style,x=0;x<o.length;x++)if(o[x]in d)return o[x];return!1}function Mo(o,d,x){var P=d||new Re(0,0);o.style[Fa]=(ve.ie3d?"translate("+P.x+"px,"+P.y+"px)":"translate3d("+P.x+"px,"+P.y+"px,0)")+(x?" scale("+x+")":"")}function Ti(o,d){o._leaflet_pos=d,ve.any3d?Mo(o,d):(o.style.left=d.x+"px",o.style.top=d.y+"px")}function Ho(o){return o._leaflet_pos||new Re(0,0)}var Cs,oa,Ua;if("onselectstart"in document)Cs=function(){Lt(window,"selectstart",Ni)},oa=function(){ni(window,"selectstart",Ni)};else{var Is=Na(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Cs=function(){if(Is){var o=document.documentElement.style;Ua=o[Is],o[Is]="none"}},oa=function(){Is&&(document.documentElement.style[Is]=Ua,Ua=void 0)}}function ks(){Lt(window,"dragstart",Ni)}function Va(){ni(window,"dragstart",Ni)}var sa,Ms;function Za(o){for(;o.tabIndex===-1;)o=o.parentNode;o.style&&(Vr(),sa=o,Ms=o.style.outlineStyle,o.style.outlineStyle="none",Lt(window,"keydown",Vr))}function Vr(){sa&&(sa.style.outlineStyle=Ms,sa=void 0,Ms=void 0,ni(window,"keydown",Vr))}function aa(o){do o=o.parentNode;while((!o.offsetWidth||!o.offsetHeight)&&o!==document.body);return o}function Sn(o){var d=o.getBoundingClientRect();return{x:d.width/o.offsetWidth||1,y:d.height/o.offsetHeight||1,boundingClientRect:d}}var la={__proto__:null,TRANSFORM:Fa,TRANSITION:Io,TRANSITION_END:Ci,get:to,getStyle:yr,create:Tt,remove:di,empty:qi,toFront:io,toBack:bn,hasClass:Wo,addClass:at,removeClass:yi,setClass:ko,getClass:vr,setOpacity:Tn,testProp:Na,setTransform:Mo,setPosition:Ti,getPosition:Ho,get disableTextSelection(){return Cs},get enableTextSelection(){return oa},disableImageDrag:ks,enableImageDrag:Va,preventOutline:Za,restoreOutline:Vr,getSizedParentNode:aa,getScale:Sn};function Lt(o,d,x,P){if(d&&typeof d=="object")for(var z in d)no(o,z,d[z],x);else{d=We(d);for(var $=0,oe=d.length;$<oe;$++)no(o,d[$],x,P)}return this}var Ln="_leaflet_events";function ni(o,d,x,P){if(arguments.length===1)zs(o),delete o[Ln];else if(d&&typeof d=="object")for(var z in d)As(o,z,d[z],x);else if(d=We(d),arguments.length===2)zs(o,function(we){return Ne(d,we)!==-1});else for(var $=0,oe=d.length;$<oe;$++)As(o,d[$],x,P);return this}function zs(o,d){for(var x in o[Ln]){var P=x.split(/\d/)[0];(!d||d(P))&&As(o,P,null,null,x)}}var Xo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function no(o,d,x,P){var z=d+H(x)+(P?"_"+H(P):"");if(o[Ln]&&o[Ln][z])return this;var $=function(we){return x.call(P||o,we||window.event)},oe=$;!ve.touchNative&&ve.pointer&&d.indexOf("touch")===0?$=oi(o,d,$):ve.touch&&d==="dblclick"?$=pn(o,$):"addEventListener"in o?d==="touchstart"||d==="touchmove"||d==="wheel"||d==="mousewheel"?o.addEventListener(Xo[d]||d,$,ve.passiveEvents?{passive:!1}:!1):d==="mouseenter"||d==="mouseleave"?($=function(we){we=we||window.event,ua(o,we)&&oe(we)},o.addEventListener(Xo[d],$,!1)):o.addEventListener(d,oe,!1):o.attachEvent("on"+d,$),o[Ln]=o[Ln]||{},o[Ln][z]=$}function As(o,d,x,P,z){z=z||d+H(x)+(P?"_"+H(P):"");var $=o[Ln]&&o[Ln][z];if(!$)return this;!ve.touchNative&&ve.pointer&&d.indexOf("touch")===0?Ot(o,d,$):ve.touch&&d==="dblclick"?nr(o,$):"removeEventListener"in o?o.removeEventListener(Xo[d]||d,$,!1):o.detachEvent("on"+d,$),o[Ln][z]=null}function Gi(o){return o.stopPropagation?o.stopPropagation():o.originalEvent?o.originalEvent._stopped=!0:o.cancelBubble=!0,this}function En(o){return no(o,"wheel",Gi),this}function Ko(o){return Lt(o,"mousedown touchstart dblclick contextmenu",Gi),o._leaflet_disable_click=!0,this}function Ni(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function rr(o){return Ni(o),Gi(o),this}function Yo(o){if(o.composedPath)return o.composedPath();for(var d=[],x=o.target;x;)d.push(x),x=x.parentNode;return d}function Wt(o,d){if(!d)return new Re(o.clientX,o.clientY);var x=Sn(d),P=x.boundingClientRect;return new Re((o.clientX-P.left)/x.x-d.clientLeft,(o.clientY-P.top)/x.y-d.clientTop)}var $a=ve.linux&&ve.chrome?window.devicePixelRatio:ve.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ja(o){return ve.edge?o.wheelDeltaY/2:o.deltaY&&o.deltaMode===0?-o.deltaY/$a:o.deltaY&&o.deltaMode===1?-o.deltaY*20:o.deltaY&&o.deltaMode===2?-o.deltaY*60:o.deltaX||o.deltaZ?0:o.wheelDelta?(o.wheelDeltaY||o.wheelDelta)/2:o.detail&&Math.abs(o.detail)<32765?-o.detail*20:o.detail?o.detail/-32765*60:0}function ua(o,d){var x=d.relatedTarget;if(!x)return!0;try{for(;x&&x!==o;)x=x.parentNode}catch{return!1}return x!==o}var qa={__proto__:null,on:Lt,off:ni,stopPropagation:Gi,disableScrollPropagation:En,disableClickPropagation:Ko,preventDefault:Ni,stop:rr,getPropagationPath:Yo,getMousePosition:Wt,getWheelDelta:ja,isExternalTarget:ua,addListener:Lt,removeListener:ni},Vl=kn.extend({run:function(o,d,x,P){this.stop(),this._el=o,this._inProgress=!0,this._duration=x||.25,this._easeOutPower=1/Math.max(P||.5,.2),this._startPos=Ho(o),this._offset=d.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ei(this._animate,this),this._step()},_step:function(o){var d=+new Date-this._startTime,x=this._duration*1e3;d<x?this._runFrame(this._easeOut(d/x),o):(this._runFrame(1),this._complete())},_runFrame:function(o,d){var x=this._startPos.add(this._offset.multiplyBy(o));d&&x._round(),Ti(this._el,x),this.fire("step")},_complete:function(){ri(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(o){return 1-Math.pow(1-o,this._easeOutPower)}}),Ht=kn.extend({options:{crs:Ie,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(o,d){d=Fe(this,d),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(o),this._initLayout(),this._onResize=O(this._onResize,this),this._initEvents(),d.maxBounds&&this.setMaxBounds(d.maxBounds),d.zoom!==void 0&&(this._zoom=this._limitZoom(d.zoom)),d.center&&d.zoom!==void 0&&this.setView(zt(d.center),d.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Io&&ve.any3d&&!ve.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Lt(this._proxy,Ci,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(o,d,x){if(d=d===void 0?this._zoom:this._limitZoom(d),o=this._limitCenter(zt(o),d,this.options.maxBounds),x=x||{},this._stop(),this._loaded&&!x.reset&&x!==!0){x.animate!==void 0&&(x.zoom=b({animate:x.animate},x.zoom),x.pan=b({animate:x.animate,duration:x.duration},x.pan));var P=this._zoom!==d?this._tryAnimatedZoom&&this._tryAnimatedZoom(o,d,x.zoom):this._tryAnimatedPan(o,x.pan);if(P)return clearTimeout(this._sizeTimer),this}return this._resetView(o,d,x.pan&&x.pan.noMoveStart),this},setZoom:function(o,d){return this._loaded?this.setView(this.getCenter(),o,{zoom:d}):(this._zoom=o,this)},zoomIn:function(o,d){return o=o||(ve.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+o,d)},zoomOut:function(o,d){return o=o||(ve.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-o,d)},setZoomAround:function(o,d,x){var P=this.getZoomScale(d),z=this.getSize().divideBy(2),$=o instanceof Re?o:this.latLngToContainerPoint(o),oe=$.subtract(z).multiplyBy(1-1/P),we=this.containerPointToLatLng(z.add(oe));return this.setView(we,d,{zoom:x})},_getBoundsCenterZoom:function(o,d){d=d||{},o=o.getBounds?o.getBounds():Ct(o);var x=He(d.paddingTopLeft||d.padding||[0,0]),P=He(d.paddingBottomRight||d.padding||[0,0]),z=this.getBoundsZoom(o,!1,x.add(P));if(z=typeof d.maxZoom=="number"?Math.min(d.maxZoom,z):z,z===1/0)return{center:o.getCenter(),zoom:z};var $=P.subtract(x).divideBy(2),oe=this.project(o.getSouthWest(),z),we=this.project(o.getNorthEast(),z),ce=this.unproject(oe.add(we).divideBy(2).add($),z);return{center:ce,zoom:z}},fitBounds:function(o,d){if(o=Ct(o),!o.isValid())throw new Error("Bounds are not valid.");var x=this._getBoundsCenterZoom(o,d);return this.setView(x.center,x.zoom,d)},fitWorld:function(o){return this.fitBounds([[-90,-180],[90,180]],o)},panTo:function(o,d){return this.setView(o,this._zoom,{pan:d})},panBy:function(o,d){if(o=He(o).round(),d=d||{},!o.x&&!o.y)return this.fire("moveend");if(d.animate!==!0&&!this.getSize().contains(o))return this._resetView(this.unproject(this.project(this.getCenter()).add(o)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Vl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),d.noMoveStart||this.fire("movestart"),d.animate!==!1){at(this._mapPane,"leaflet-pan-anim");var x=this._getMapPanePos().subtract(o).round();this._panAnim.run(this._mapPane,x,d.duration||.25,d.easeLinearity)}else this._rawPanBy(o),this.fire("move").fire("moveend");return this},flyTo:function(o,d,x){if(x=x||{},x.animate===!1||!ve.any3d)return this.setView(o,d,x);this._stop();var P=this.project(this.getCenter()),z=this.project(o),$=this.getSize(),oe=this._zoom;o=zt(o),d=d===void 0?oe:d;var we=Math.max($.x,$.y),ce=we*this.getZoomScale(oe,d),Te=z.distanceTo(P)||1,it=1.42,Pt=it*it;function Ft(wi){var Zs=wi?-1:1,Ro=wi?ce:we,ls=ce*ce-we*we+Zs*Pt*Pt*Te*Te,Ql=2*Ro*Pt*Te,$s=ls/Ql,Bo=Math.sqrt($s*$s+1)-$s,eu=Bo<1e-9?-18:Math.log(Bo);return eu}function Yt(wi){return(Math.exp(wi)-Math.exp(-wi))/2}function Hi(wi){return(Math.exp(wi)+Math.exp(-wi))/2}function Mi(wi){return Yt(wi)/Hi(wi)}var Rn=Ft(0);function Er(wi){return we*(Hi(Rn)/Hi(Rn+it*wi))}function Ei(wi){return we*(Hi(Rn)*Mi(Rn+it*wi)-Yt(Rn))/Pt}function zi(wi){return 1-Math.pow(1-wi,1.5)}var po=Date.now(),as=(Ft(1)-Rn)/it,Vs=x.duration?1e3*x.duration:1e3*as*.8;function wa(){var wi=(Date.now()-po)/Vs,Zs=zi(wi)*as;wi<=1?(this._flyToFrame=ei(wa,this),this._move(this.unproject(P.add(z.subtract(P).multiplyBy(Ei(Zs)/Te)),oe),this.getScaleZoom(we/Er(Zs),oe),{flyTo:!0})):this._move(o,d)._moveEnd(!0)}return this._moveStart(!0,x.noMoveStart),wa.call(this),this},flyToBounds:function(o,d){var x=this._getBoundsCenterZoom(o,d);return this.flyTo(x.center,x.zoom,d)},setMaxBounds:function(o){return o=Ct(o),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),o.isValid()?(this.options.maxBounds=o,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(o){var d=this.options.minZoom;return this.options.minZoom=o,this._loaded&&d!==o&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(o):this},setMaxZoom:function(o){var d=this.options.maxZoom;return this.options.maxZoom=o,this._loaded&&d!==o&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(o):this},panInsideBounds:function(o,d){this._enforcingBounds=!0;var x=this.getCenter(),P=this._limitCenter(x,this._zoom,Ct(o));return x.equals(P)||this.panTo(P,d),this._enforcingBounds=!1,this},panInside:function(o,d){d=d||{};var x=He(d.paddingTopLeft||d.padding||[0,0]),P=He(d.paddingBottomRight||d.padding||[0,0]),z=this.project(this.getCenter()),$=this.project(o),oe=this.getPixelBounds(),we=Rt([oe.min.add(x),oe.max.subtract(P)]),ce=we.getSize();if(!we.contains($)){this._enforcingBounds=!0;var Te=$.subtract(we.getCenter()),it=we.extend($).getSize().subtract(ce);z.x+=Te.x<0?-it.x:it.x,z.y+=Te.y<0?-it.y:it.y,this.panTo(this.unproject(z),d),this._enforcingBounds=!1}return this},invalidateSize:function(o){if(!this._loaded)return this;o=b({animate:!1,pan:!0},o===!0?{animate:!0}:o);var d=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var x=this.getSize(),P=d.divideBy(2).round(),z=x.divideBy(2).round(),$=P.subtract(z);return!$.x&&!$.y?this:(o.animate&&o.pan?this.panBy($):(o.pan&&this._rawPanBy($),this.fire("move"),o.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(O(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:d,newSize:x}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(o){if(o=this._locateOptions=b({timeout:1e4,watch:!1},o),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var d=O(this._handleGeolocationResponse,this),x=O(this._handleGeolocationError,this);return o.watch?this._locationWatchId=navigator.geolocation.watchPosition(d,x,o):navigator.geolocation.getCurrentPosition(d,x,o),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(o){if(this._container._leaflet_id){var d=o.code,x=o.message||(d===1?"permission denied":d===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:d,message:"Geolocation error: "+x+"."})}},_handleGeolocationResponse:function(o){if(this._container._leaflet_id){var d=o.coords.latitude,x=o.coords.longitude,P=new Zt(d,x),z=P.toBounds(o.coords.accuracy*2),$=this._locateOptions;if($.setView){var oe=this.getBoundsZoom(z);this.setView(P,$.maxZoom?Math.min(oe,$.maxZoom):oe)}var we={latlng:P,bounds:z,timestamp:o.timestamp};for(var ce in o.coords)typeof o.coords[ce]=="number"&&(we[ce]=o.coords[ce]);this.fire("locationfound",we)}},addHandler:function(o,d){if(!d)return this;var x=this[o]=new d(this);return this._handlers.push(x),this.options[o]&&x.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),di(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ri(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var o;for(o in this._layers)this._layers[o].remove();for(o in this._panes)di(this._panes[o]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(o,d){var x="leaflet-pane"+(o?" leaflet-"+o.replace("Pane","")+"-pane":""),P=Tt("div",x,d||this._mapPane);return o&&(this._panes[o]=P),P},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var o=this.getPixelBounds(),d=this.unproject(o.getBottomLeft()),x=this.unproject(o.getTopRight());return new ti(d,x)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(o,d,x){o=Ct(o),x=He(x||[0,0]);var P=this.getZoom()||0,z=this.getMinZoom(),$=this.getMaxZoom(),oe=o.getNorthWest(),we=o.getSouthEast(),ce=this.getSize().subtract(x),Te=Rt(this.project(we,P),this.project(oe,P)).getSize(),it=ve.any3d?this.options.zoomSnap:1,Pt=ce.x/Te.x,Ft=ce.y/Te.y,Yt=d?Math.max(Pt,Ft):Math.min(Pt,Ft);return P=this.getScaleZoom(Yt,P),it&&(P=Math.round(P/(it/100))*(it/100),P=d?Math.ceil(P/it)*it:Math.floor(P/it)*it),Math.max(z,Math.min($,P))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Re(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(o,d){var x=this._getTopLeftPoint(o,d);return new St(x,x.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(o){return this.options.crs.getProjectedBounds(o===void 0?this.getZoom():o)},getPane:function(o){return typeof o=="string"?this._panes[o]:o},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(o,d){var x=this.options.crs;return d=d===void 0?this._zoom:d,x.scale(o)/x.scale(d)},getScaleZoom:function(o,d){var x=this.options.crs;d=d===void 0?this._zoom:d;var P=x.zoom(o*x.scale(d));return isNaN(P)?1/0:P},project:function(o,d){return d=d===void 0?this._zoom:d,this.options.crs.latLngToPoint(zt(o),d)},unproject:function(o,d){return d=d===void 0?this._zoom:d,this.options.crs.pointToLatLng(He(o),d)},layerPointToLatLng:function(o){var d=He(o).add(this.getPixelOrigin());return this.unproject(d)},latLngToLayerPoint:function(o){var d=this.project(zt(o))._round();return d._subtract(this.getPixelOrigin())},wrapLatLng:function(o){return this.options.crs.wrapLatLng(zt(o))},wrapLatLngBounds:function(o){return this.options.crs.wrapLatLngBounds(Ct(o))},distance:function(o,d){return this.options.crs.distance(zt(o),zt(d))},containerPointToLayerPoint:function(o){return He(o).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(o){return He(o).add(this._getMapPanePos())},containerPointToLatLng:function(o){var d=this.containerPointToLayerPoint(He(o));return this.layerPointToLatLng(d)},latLngToContainerPoint:function(o){return this.layerPointToContainerPoint(this.latLngToLayerPoint(zt(o)))},mouseEventToContainerPoint:function(o){return Wt(o,this._container)},mouseEventToLayerPoint:function(o){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(o))},mouseEventToLatLng:function(o){return this.layerPointToLatLng(this.mouseEventToLayerPoint(o))},_initContainer:function(o){var d=this._container=to(o);if(d){if(d._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Lt(d,"scroll",this._onScroll,this),this._containerId=H(d)},_initLayout:function(){var o=this._container;this._fadeAnimated=this.options.fadeAnimation&&ve.any3d,at(o,"leaflet-container"+(ve.touch?" leaflet-touch":"")+(ve.retina?" leaflet-retina":"")+(ve.ielt9?" leaflet-oldie":"")+(ve.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var d=yr(o,"position");d!=="absolute"&&d!=="relative"&&d!=="fixed"&&d!=="sticky"&&(o.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var o=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ti(this._mapPane,new Re(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(at(o.markerPane,"leaflet-zoom-hide"),at(o.shadowPane,"leaflet-zoom-hide"))},_resetView:function(o,d,x){Ti(this._mapPane,new Re(0,0));var P=!this._loaded;this._loaded=!0,d=this._limitZoom(d),this.fire("viewprereset");var z=this._zoom!==d;this._moveStart(z,x)._move(o,d)._moveEnd(z),this.fire("viewreset"),P&&this.fire("load")},_moveStart:function(o,d){return o&&this.fire("zoomstart"),d||this.fire("movestart"),this},_move:function(o,d,x,P){d===void 0&&(d=this._zoom);var z=this._zoom!==d;return this._zoom=d,this._lastCenter=o,this._pixelOrigin=this._getNewPixelOrigin(o),P?x&&x.pinch&&this.fire("zoom",x):((z||x&&x.pinch)&&this.fire("zoom",x),this.fire("move",x)),this},_moveEnd:function(o){return o&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ri(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(o){Ti(this._mapPane,this._getMapPanePos().subtract(o))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(o){this._targets={},this._targets[H(this._container)]=this;var d=o?ni:Lt;d(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&d(window,"resize",this._onResize,this),ve.any3d&&this.options.transform3DLimit&&(o?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ri(this._resizeRequest),this._resizeRequest=ei(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var o=this._getMapPanePos();Math.max(Math.abs(o.x),Math.abs(o.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(o,d){for(var x=[],P,z=d==="mouseout"||d==="mouseover",$=o.target||o.srcElement,oe=!1;$;){if(P=this._targets[H($)],P&&(d==="click"||d==="preclick")&&this._draggableMoved(P)){oe=!0;break}if(P&&P.listens(d,!0)&&(z&&!ua($,o)||(x.push(P),z))||$===this._container)break;$=$.parentNode}return!x.length&&!oe&&!z&&this.listens(d,!0)&&(x=[this]),x},_isClickDisabled:function(o){for(;o&&o!==this._container;){if(o._leaflet_disable_click)return!0;o=o.parentNode}},_handleDOMEvent:function(o){var d=o.target||o.srcElement;if(!(!this._loaded||d._leaflet_disable_events||o.type==="click"&&this._isClickDisabled(d))){var x=o.type;x==="mousedown"&&Za(d),this._fireDOMEvent(o,x)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(o,d,x){if(o.type==="click"){var P=b({},o);P.type="preclick",this._fireDOMEvent(P,P.type,x)}var z=this._findEventTargets(o,d);if(x){for(var $=[],oe=0;oe<x.length;oe++)x[oe].listens(d,!0)&&$.push(x[oe]);z=$.concat(z)}if(z.length){d==="contextmenu"&&Ni(o);var we=z[0],ce={originalEvent:o};if(o.type!=="keypress"&&o.type!=="keydown"&&o.type!=="keyup"){var Te=we.getLatLng&&(!we._radius||we._radius<=10);ce.containerPoint=Te?this.latLngToContainerPoint(we.getLatLng()):this.mouseEventToContainerPoint(o),ce.layerPoint=this.containerPointToLayerPoint(ce.containerPoint),ce.latlng=Te?we.getLatLng():this.layerPointToLatLng(ce.layerPoint)}for(oe=0;oe<z.length;oe++)if(z[oe].fire(d,ce,!0),ce.originalEvent._stopped||z[oe].options.bubblingMouseEvents===!1&&Ne(this._mouseEvents,d)!==-1)return}},_draggableMoved:function(o){return o=o.dragging&&o.dragging.enabled()?o:this,o.dragging&&o.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var o=0,d=this._handlers.length;o<d;o++)this._handlers[o].disable()},whenReady:function(o,d){return this._loaded?o.call(d||this,{target:this}):this.on("load",o,d),this},_getMapPanePos:function(){return Ho(this._mapPane)||new Re(0,0)},_moved:function(){var o=this._getMapPanePos();return o&&!o.equals([0,0])},_getTopLeftPoint:function(o,d){var x=o&&d!==void 0?this._getNewPixelOrigin(o,d):this.getPixelOrigin();return x.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(o,d){var x=this.getSize()._divideBy(2);return this.project(o,d)._subtract(x)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(o,d,x){var P=this._getNewPixelOrigin(x,d);return this.project(o,d)._subtract(P)},_latLngBoundsToNewLayerBounds:function(o,d,x){var P=this._getNewPixelOrigin(x,d);return Rt([this.project(o.getSouthWest(),d)._subtract(P),this.project(o.getNorthWest(),d)._subtract(P),this.project(o.getSouthEast(),d)._subtract(P),this.project(o.getNorthEast(),d)._subtract(P)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(o){return this.latLngToLayerPoint(o).subtract(this._getCenterLayerPoint())},_limitCenter:function(o,d,x){if(!x)return o;var P=this.project(o,d),z=this.getSize().divideBy(2),$=new St(P.subtract(z),P.add(z)),oe=this._getBoundsOffset($,x,d);return Math.abs(oe.x)<=1&&Math.abs(oe.y)<=1?o:this.unproject(P.add(oe),d)},_limitOffset:function(o,d){if(!d)return o;var x=this.getPixelBounds(),P=new St(x.min.add(o),x.max.add(o));return o.add(this._getBoundsOffset(P,d))},_getBoundsOffset:function(o,d,x){var P=Rt(this.project(d.getNorthEast(),x),this.project(d.getSouthWest(),x)),z=P.min.subtract(o.min),$=P.max.subtract(o.max),oe=this._rebound(z.x,-$.x),we=this._rebound(z.y,-$.y);return new Re(oe,we)},_rebound:function(o,d){return o+d>0?Math.round(o-d)/2:Math.max(0,Math.ceil(o))-Math.max(0,Math.floor(d))},_limitZoom:function(o){var d=this.getMinZoom(),x=this.getMaxZoom(),P=ve.any3d?this.options.zoomSnap:1;return P&&(o=Math.round(o/P)*P),Math.max(d,Math.min(x,o))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){yi(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(o,d){var x=this._getCenterOffset(o)._trunc();return(d&&d.animate)!==!0&&!this.getSize().contains(x)?!1:(this.panBy(x,d),!0)},_createAnimProxy:function(){var o=this._proxy=Tt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(o),this.on("zoomanim",function(d){var x=Fa,P=this._proxy.style[x];Mo(this._proxy,this.project(d.center,d.zoom),this.getZoomScale(d.zoom,1)),P===this._proxy.style[x]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){di(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var o=this.getCenter(),d=this.getZoom();Mo(this._proxy,this.project(o,d),this.getZoomScale(d,1))},_catchTransitionEnd:function(o){this._animatingZoom&&o.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(o,d,x){if(this._animatingZoom)return!0;if(x=x||{},!this._zoomAnimated||x.animate===!1||this._nothingToAnimate()||Math.abs(d-this._zoom)>this.options.zoomAnimationThreshold)return!1;var P=this.getZoomScale(d),z=this._getCenterOffset(o)._divideBy(1-1/P);return x.animate!==!0&&!this.getSize().contains(z)?!1:(ei(function(){this._moveStart(!0,x.noMoveStart||!1)._animateZoom(o,d,!0)},this),!0)},_animateZoom:function(o,d,x,P){this._mapPane&&(x&&(this._animatingZoom=!0,this._animateToCenter=o,this._animateToZoom=d,at(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:o,zoom:d,noUpdate:P}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(O(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&yi(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ls(o,d){return new Ht(o,d)}var xr=sn.extend({options:{position:"topright"},initialize:function(o){Fe(this,o)},getPosition:function(){return this.options.position},setPosition:function(o){var d=this._map;return d&&d.removeControl(this),this.options.position=o,d&&d.addControl(this),this},getContainer:function(){return this._container},addTo:function(o){this.remove(),this._map=o;var d=this._container=this.onAdd(o),x=this.getPosition(),P=o._controlCorners[x];return at(d,"leaflet-control"),x.indexOf("bottom")!==-1?P.insertBefore(d,P.firstChild):P.appendChild(d),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(di(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(o){this._map&&o&&o.screenX>0&&o.screenY>0&&this._map.getContainer().focus()}}),ca=function(o){return new xr(o)};Ht.include({addControl:function(o){return o.addTo(this),this},removeControl:function(o){return o.remove(),this},_initControlPos:function(){var o=this._controlCorners={},d="leaflet-",x=this._controlContainer=Tt("div",d+"control-container",this._container);function P(z,$){var oe=d+z+" "+d+$;o[z+$]=Tt("div",oe,x)}P("top","left"),P("top","right"),P("bottom","left"),P("bottom","right")},_clearControlPos:function(){for(var o in this._controlCorners)di(this._controlCorners[o]);di(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var yu=xr.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(o,d,x,P){return x<P?-1:P<x?1:0}},initialize:function(o,d,x){Fe(this,x),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var P in o)this._addLayer(o[P],P);for(P in d)this._addLayer(d[P],P,!0)},onAdd:function(o){this._initLayout(),this._update(),this._map=o,o.on("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(o){return xr.prototype.addTo.call(this,o),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(o,d){return this._addLayer(o,d),this._map?this._update():this},addOverlay:function(o,d){return this._addLayer(o,d,!0),this._map?this._update():this},removeLayer:function(o){o.off("add remove",this._onLayerChange,this);var d=this._getLayer(H(o));return d&&this._layers.splice(this._layers.indexOf(d),1),this._map?this._update():this},expand:function(){at(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var o=this._map.getSize().y-(this._container.offsetTop+50);return o<this._section.clientHeight?(at(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=o+"px"):yi(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return yi(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var o="leaflet-control-layers",d=this._container=Tt("div",o),x=this.options.collapsed;d.setAttribute("aria-haspopup",!0),Ko(d),En(d);var P=this._section=Tt("section",o+"-list");x&&(this._map.on("click",this.collapse,this),Lt(d,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var z=this._layersLink=Tt("a",o+"-toggle",d);z.href="#",z.title="Layers",z.setAttribute("role","button"),Lt(z,{keydown:function($){$.keyCode===13&&this._expandSafely()},click:function($){Ni($),this._expandSafely()}},this),x||this.expand(),this._baseLayersList=Tt("div",o+"-base",P),this._separator=Tt("div",o+"-separator",P),this._overlaysList=Tt("div",o+"-overlays",P),d.appendChild(P)},_getLayer:function(o){for(var d=0;d<this._layers.length;d++)if(this._layers[d]&&H(this._layers[d].layer)===o)return this._layers[d]},_addLayer:function(o,d,x){this._map&&o.on("add remove",this._onLayerChange,this),this._layers.push({layer:o,name:d,overlay:x}),this.options.sortLayers&&this._layers.sort(O(function(P,z){return this.options.sortFunction(P.layer,z.layer,P.name,z.name)},this)),this.options.autoZIndex&&o.setZIndex&&(this._lastZIndex++,o.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;qi(this._baseLayersList),qi(this._overlaysList),this._layerControlInputs=[];var o,d,x,P,z=0;for(x=0;x<this._layers.length;x++)P=this._layers[x],this._addItem(P),d=d||P.overlay,o=o||!P.overlay,z+=P.overlay?0:1;return this.options.hideSingleBase&&(o=o&&z>1,this._baseLayersList.style.display=o?"":"none"),this._separator.style.display=d&&o?"":"none",this},_onLayerChange:function(o){this._handlingClick||this._update();var d=this._getLayer(H(o.target)),x=d.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;x&&this._map.fire(x,d)},_createRadioElement:function(o,d){var x='<input type="radio" class="leaflet-control-layers-selector" name="'+o+'"'+(d?' checked="checked"':"")+"/>",P=document.createElement("div");return P.innerHTML=x,P.firstChild},_addItem:function(o){var d=document.createElement("label"),x=this._map.hasLayer(o.layer),P;o.overlay?(P=document.createElement("input"),P.type="checkbox",P.className="leaflet-control-layers-selector",P.defaultChecked=x):P=this._createRadioElement("leaflet-base-layers_"+H(this),x),this._layerControlInputs.push(P),P.layerId=H(o.layer),Lt(P,"click",this._onInputClick,this);var z=document.createElement("span");z.innerHTML=" "+o.name;var $=document.createElement("span");d.appendChild($),$.appendChild(P),$.appendChild(z);var oe=o.overlay?this._overlaysList:this._baseLayersList;return oe.appendChild(d),this._checkDisabledLayers(),d},_onInputClick:function(){if(!this._preventClick){var o=this._layerControlInputs,d,x,P=[],z=[];this._handlingClick=!0;for(var $=o.length-1;$>=0;$--)d=o[$],x=this._getLayer(d.layerId).layer,d.checked?P.push(x):d.checked||z.push(x);for($=0;$<z.length;$++)this._map.hasLayer(z[$])&&this._map.removeLayer(z[$]);for($=0;$<P.length;$++)this._map.hasLayer(P[$])||this._map.addLayer(P[$]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var o=this._layerControlInputs,d,x,P=this._map.getZoom(),z=o.length-1;z>=0;z--)d=o[z],x=this._getLayer(d.layerId).layer,d.disabled=x.options.minZoom!==void 0&&P<x.options.minZoom||x.options.maxZoom!==void 0&&P>x.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var o=this._section;this._preventClick=!0,Lt(o,"click",Ni),this.expand();var d=this;setTimeout(function(){ni(o,"click",Ni),d._preventClick=!1})}}),_c=function(o,d,x){return new yu(o,d,x)},Zl=xr.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(o){var d="leaflet-control-zoom",x=Tt("div",d+" leaflet-bar"),P=this.options;return this._zoomInButton=this._createButton(P.zoomInText,P.zoomInTitle,d+"-in",x,this._zoomIn),this._zoomOutButton=this._createButton(P.zoomOutText,P.zoomOutTitle,d+"-out",x,this._zoomOut),this._updateDisabled(),o.on("zoomend zoomlevelschange",this._updateDisabled,this),x},onRemove:function(o){o.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(o){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(o.shiftKey?3:1))},_zoomOut:function(o){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(o.shiftKey?3:1))},_createButton:function(o,d,x,P,z){var $=Tt("a",x,P);return $.innerHTML=o,$.href="#",$.title=d,$.setAttribute("role","button"),$.setAttribute("aria-label",d),Ko($),Lt($,"click",rr),Lt($,"click",z,this),Lt($,"click",this._refocusOnMap,this),$},_updateDisabled:function(){var o=this._map,d="leaflet-disabled";yi(this._zoomInButton,d),yi(this._zoomOutButton,d),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||o._zoom===o.getMinZoom())&&(at(this._zoomOutButton,d),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||o._zoom===o.getMaxZoom())&&(at(this._zoomInButton,d),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ht.mergeOptions({zoomControl:!0}),Ht.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Zl,this.addControl(this.zoomControl))});var gc=function(o){return new Zl(o)},Ga=xr.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(o){var d="leaflet-control-scale",x=Tt("div",d),P=this.options;return this._addScales(P,d+"-line",x),o.on(P.updateWhenIdle?"moveend":"move",this._update,this),o.whenReady(this._update,this),x},onRemove:function(o){o.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(o,d,x){o.metric&&(this._mScale=Tt("div",d,x)),o.imperial&&(this._iScale=Tt("div",d,x))},_update:function(){var o=this._map,d=o.getSize().y/2,x=o.distance(o.containerPointToLatLng([0,d]),o.containerPointToLatLng([this.options.maxWidth,d]));this._updateScales(x)},_updateScales:function(o){this.options.metric&&o&&this._updateMetric(o),this.options.imperial&&o&&this._updateImperial(o)},_updateMetric:function(o){var d=this._getRoundNum(o),x=d<1e3?d+" m":d/1e3+" km";this._updateScale(this._mScale,x,d/o)},_updateImperial:function(o){var d=o*3.2808399,x,P,z;d>5280?(x=d/5280,P=this._getRoundNum(x),this._updateScale(this._iScale,P+" mi",P/x)):(z=this._getRoundNum(d),this._updateScale(this._iScale,z+" ft",z/d))},_updateScale:function(o,d,x){o.style.width=Math.round(this.options.maxWidth*x)+"px",o.innerHTML=d},_getRoundNum:function(o){var d=Math.pow(10,(Math.floor(o)+"").length-1),x=o/d;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:1,d*x}}),Wa=function(o){return new Ga(o)},$l='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ha=xr.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ve.inlineSvg?$l+" ":"")+"Leaflet</a>"},initialize:function(o){Fe(this,o),this._attributions={}},onAdd:function(o){o.attributionControl=this,this._container=Tt("div","leaflet-control-attribution"),Ko(this._container);for(var d in o._layers)o._layers[d].getAttribution&&this.addAttribution(o._layers[d].getAttribution());return this._update(),o.on("layeradd",this._addAttribution,this),this._container},onRemove:function(o){o.off("layeradd",this._addAttribution,this)},_addAttribution:function(o){o.layer.getAttribution&&(this.addAttribution(o.layer.getAttribution()),o.layer.once("remove",function(){this.removeAttribution(o.layer.getAttribution())},this))},setPrefix:function(o){return this.options.prefix=o,this._update(),this},addAttribution:function(o){return o?(this._attributions[o]||(this._attributions[o]=0),this._attributions[o]++,this._update(),this):this},removeAttribution:function(o){return o?(this._attributions[o]&&(this._attributions[o]--,this._update()),this):this},_update:function(){if(this._map){var o=[];for(var d in this._attributions)this._attributions[d]&&o.push(d);var x=[];this.options.prefix&&x.push(this.options.prefix),o.length&&x.push(o.join(", ")),this._container.innerHTML=x.join(' <span aria-hidden="true">|</span> ')}}});Ht.mergeOptions({attributionControl:!0}),Ht.addInitHook(function(){this.options.attributionControl&&new ha().addTo(this)});var Ds=function(o){return new ha(o)};xr.Layers=yu,xr.Zoom=Zl,xr.Scale=Ga,xr.Attribution=ha,ca.layers=_c,ca.zoom=gc,ca.scale=Wa,ca.attribution=Ds;var wr=sn.extend({initialize:function(o){this._map=o},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});wr.addTo=function(o,d){return o.addHandler(d,this),this};var vu={Events:hi},Ha=ve.touch?"touchstart mousedown":"mousedown",Dn=kn.extend({options:{clickTolerance:3},initialize:function(o,d,x,P){Fe(this,P),this._element=o,this._dragStartTarget=d||o,this._preventOutline=x},enable:function(){this._enabled||(Lt(this._dragStartTarget,Ha,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Dn._dragging===this&&this.finishDrag(!0),ni(this._dragStartTarget,Ha,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(o){if(this._enabled&&(this._moved=!1,!Wo(this._element,"leaflet-zoom-anim"))){if(o.touches&&o.touches.length!==1){Dn._dragging===this&&this.finishDrag();return}if(!(Dn._dragging||o.shiftKey||o.which!==1&&o.button!==1&&!o.touches)&&(Dn._dragging=this,this._preventOutline&&Za(this._element),ks(),Cs(),!this._moving)){this.fire("down");var d=o.touches?o.touches[0]:o,x=aa(this._element);this._startPoint=new Re(d.clientX,d.clientY),this._startPos=Ho(this._element),this._parentScale=Sn(x);var P=o.type==="mousedown";Lt(document,P?"mousemove":"touchmove",this._onMove,this),Lt(document,P?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(o){if(this._enabled){if(o.touches&&o.touches.length>1){this._moved=!0;return}var d=o.touches&&o.touches.length===1?o.touches[0]:o,x=new Re(d.clientX,d.clientY)._subtract(this._startPoint);!x.x&&!x.y||Math.abs(x.x)+Math.abs(x.y)<this.options.clickTolerance||(x.x/=this._parentScale.x,x.y/=this._parentScale.y,Ni(o),this._moved||(this.fire("dragstart"),this._moved=!0,at(document.body,"leaflet-dragging"),this._lastTarget=o.target||o.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),at(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(x),this._moving=!0,this._lastEvent=o,this._updatePosition())}},_updatePosition:function(){var o={originalEvent:this._lastEvent};this.fire("predrag",o),Ti(this._element,this._newPos),this.fire("drag",o)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(o){yi(document.body,"leaflet-dragging"),this._lastTarget&&(yi(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ni(document,"mousemove touchmove",this._onMove,this),ni(document,"mouseup touchend touchcancel",this._onUp,this),Va(),oa();var d=this._moved&&this._moving;this._moving=!1,Dn._dragging=!1,d&&this.fire("dragend",{noInertia:o,distance:this._newPos.distanceTo(this._startPos)})}});function jl(o,d,x){var P,z=[1,4,2,8],$,oe,we,ce,Te,it,Pt,Ft;for($=0,it=o.length;$<it;$++)o[$]._code=es(o[$],d);for(we=0;we<4;we++){for(Pt=z[we],P=[],$=0,it=o.length,oe=it-1;$<it;oe=$++)ce=o[$],Te=o[oe],ce._code&Pt?Te._code&Pt||(Ft=da(Te,ce,Pt,d,x),Ft._code=es(Ft,d),P.push(Ft)):(Te._code&Pt&&(Ft=da(Te,ce,Pt,d,x),Ft._code=es(Ft,d),P.push(Ft)),P.push(ce));o=P}return o}function Jo(o,d){var x,P,z,$,oe,we,ce,Te,it;if(!o||o.length===0)throw new Error("latlngs not passed");Et(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var Pt=zt([0,0]),Ft=Ct(o),Yt=Ft.getNorthWest().distanceTo(Ft.getSouthWest())*Ft.getNorthEast().distanceTo(Ft.getNorthWest());Yt<1700&&(Pt=zo(o));var Hi=o.length,Mi=[];for(x=0;x<Hi;x++){var Rn=zt(o[x]);Mi.push(d.project(zt([Rn.lat-Pt.lat,Rn.lng-Pt.lng])))}for(we=ce=Te=0,x=0,P=Hi-1;x<Hi;P=x++)z=Mi[x],$=Mi[P],oe=z.y*$.x-$.y*z.x,ce+=(z.x+$.x)*oe,Te+=(z.y+$.y)*oe,we+=oe*3;we===0?it=Mi[0]:it=[ce/we,Te/we];var Er=d.unproject(He(it));return zt([Er.lat+Pt.lat,Er.lng+Pt.lng])}function zo(o){for(var d=0,x=0,P=0,z=0;z<o.length;z++){var $=zt(o[z]);d+=$.lat,x+=$.lng,P++}return zt([d/P,x/P])}var xu={__proto__:null,clipPolygon:jl,polygonCenter:Jo,centroid:zo};function Xa(o,d){if(!d||!o.length)return o.slice();var x=d*d;return o=Qo(o,x),o=yc(o,x),o}function Kt(o,d,x){return Math.sqrt(Ao(o,d,x,!0))}function Ka(o,d,x){return Ao(o,d,x)}function yc(o,d){var x=o.length,P=typeof Uint8Array!=void 0+""?Uint8Array:Array,z=new P(x);z[0]=z[x-1]=1,Ya(o,z,d,0,x-1);var $,oe=[];for($=0;$<x;$++)z[$]&&oe.push(o[$]);return oe}function Ya(o,d,x,P,z){var $=0,oe,we,ce;for(we=P+1;we<=z-1;we++)ce=Ao(o[we],o[P],o[z],!0),ce>$&&(oe=we,$=ce);$>x&&(d[oe]=1,Ya(o,d,x,P,oe),Ya(o,d,x,oe,z))}function Qo(o,d){for(var x=[o[0]],P=1,z=0,$=o.length;P<$;P++)Si(o[P],o[z])>d&&(x.push(o[P]),z=P);return z<$-1&&x.push(o[$-1]),x}var wu;function bu(o,d,x,P,z){var $=P?wu:es(o,x),oe=es(d,x),we,ce,Te;for(wu=oe;;){if(!($|oe))return[o,d];if($&oe)return!1;we=$||oe,ce=da(o,d,we,x,z),Te=es(ce,x),we===$?(o=ce,$=Te):(d=ce,oe=Te)}}function da(o,d,x,P,z){var $=d.x-o.x,oe=d.y-o.y,we=P.min,ce=P.max,Te,it;return x&8?(Te=o.x+$*(ce.y-o.y)/oe,it=ce.y):x&4?(Te=o.x+$*(we.y-o.y)/oe,it=we.y):x&2?(Te=ce.x,it=o.y+oe*(ce.x-o.x)/$):x&1&&(Te=we.x,it=o.y+oe*(we.x-o.x)/$),new Re(Te,it,z)}function es(o,d){var x=0;return o.x<d.min.x?x|=1:o.x>d.max.x&&(x|=2),o.y<d.min.y?x|=4:o.y>d.max.y&&(x|=8),x}function Si(o,d){var x=d.x-o.x,P=d.y-o.y;return x*x+P*P}function Ao(o,d,x,P){var z=d.x,$=d.y,oe=x.x-z,we=x.y-$,ce=oe*oe+we*we,Te;return ce>0&&(Te=((o.x-z)*oe+(o.y-$)*we)/ce,Te>1?(z=x.x,$=x.y):Te>0&&(z+=oe*Te,$+=we*Te)),oe=o.x-z,we=o.y-$,P?oe*oe+we*we:new Re(z,$)}function Et(o){return!ye(o[0])||typeof o[0][0]!="object"&&typeof o[0][0]<"u"}function Rs(o){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Et(o)}function ui(o,d){var x,P,z,$,oe,we,ce,Te;if(!o||o.length===0)throw new Error("latlngs not passed");Et(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var it=zt([0,0]),Pt=Ct(o),Ft=Pt.getNorthWest().distanceTo(Pt.getSouthWest())*Pt.getNorthEast().distanceTo(Pt.getNorthWest());Ft<1700&&(it=zo(o));var Yt=o.length,Hi=[];for(x=0;x<Yt;x++){var Mi=zt(o[x]);Hi.push(d.project(zt([Mi.lat-it.lat,Mi.lng-it.lng])))}for(x=0,P=0;x<Yt-1;x++)P+=Hi[x].distanceTo(Hi[x+1])/2;if(P===0)Te=Hi[0];else for(x=0,$=0;x<Yt-1;x++)if(oe=Hi[x],we=Hi[x+1],z=oe.distanceTo(we),$+=z,$>P){ce=($-P)/z,Te=[we.x-ce*(we.x-oe.x),we.y-ce*(we.y-oe.y)];break}var Rn=d.unproject(He(Te));return zt([Rn.lat+it.lat,Rn.lng+it.lng])}var pi={__proto__:null,simplify:Xa,pointToSegmentDistance:Kt,closestPointOnSegment:Ka,clipSegment:bu,_getEdgeIntersection:da,_getBitCode:es,_sqClosestPointOnSegment:Ao,isFlat:Et,_flat:Rs,polylineCenter:ui},ro={project:function(o){return new Re(o.lng,o.lat)},unproject:function(o){return new Zt(o.y,o.x)},bounds:new St([-180,-90],[180,90])},ts={R:6378137,R_MINOR:6356752314245179e-9,bounds:new St([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(o){var d=Math.PI/180,x=this.R,P=o.lat*d,z=this.R_MINOR/x,$=Math.sqrt(1-z*z),oe=$*Math.sin(P),we=Math.tan(Math.PI/4-P/2)/Math.pow((1-oe)/(1+oe),$/2);return P=-x*Math.log(Math.max(we,1e-10)),new Re(o.lng*d*x,P)},unproject:function(o){for(var d=180/Math.PI,x=this.R,P=this.R_MINOR/x,z=Math.sqrt(1-P*P),$=Math.exp(-o.y/x),oe=Math.PI/2-2*Math.atan($),we=0,ce=.1,Te;we<15&&Math.abs(ce)>1e-7;we++)Te=z*Math.sin(oe),Te=Math.pow((1-Te)/(1+Te),z/2),ce=Math.PI/2-2*Math.atan($*Te)-oe,oe+=ce;return new Zt(oe*d,o.x*d/x)}},ql={__proto__:null,LonLat:ro,Mercator:ts,SphericalMercator:Mn},vc=b({},Zn,{code:"EPSG:3395",projection:ts,transformation:function(){var o=.5/(Math.PI*ts.R);return tr(o,.5,-o,.5)}()}),Ja=b({},Zn,{code:"EPSG:4326",projection:ro,transformation:tr(1/180,1,-1/180,.5)}),xc=b({},Bi,{projection:ro,transformation:tr(1,0,-1,0),scale:function(o){return Math.pow(2,o)},zoom:function(o){return Math.log(o)/Math.LN2},distance:function(o,d){var x=d.lng-o.lng,P=d.lat-o.lat;return Math.sqrt(x*x+P*P)},infinite:!0});Bi.Earth=Zn,Bi.EPSG3395=vc,Bi.EPSG3857=Ie,Bi.EPSG900913=Qr,Bi.EPSG4326=Ja,Bi.Simple=xc;var jn=kn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(o){return o.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(o){return o&&o.removeLayer(this),this},getPane:function(o){return this._map.getPane(o?this.options[o]||o:this.options.pane)},addInteractiveTarget:function(o){return this._map._targets[H(o)]=this,this},removeInteractiveTarget:function(o){return delete this._map._targets[H(o)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(o){var d=o.target;if(d.hasLayer(this)){if(this._map=d,this._zoomAnimated=d._zoomAnimated,this.getEvents){var x=this.getEvents();d.on(x,this),this.once("remove",function(){d.off(x,this)},this)}this.onAdd(d),this.fire("add"),d.fire("layeradd",{layer:this})}}});Ht.include({addLayer:function(o){if(!o._layerAdd)throw new Error("The provided object is not a Layer.");var d=H(o);return this._layers[d]?this:(this._layers[d]=o,o._mapToAdd=this,o.beforeAdd&&o.beforeAdd(this),this.whenReady(o._layerAdd,o),this)},removeLayer:function(o){var d=H(o);return this._layers[d]?(this._loaded&&o.onRemove(this),delete this._layers[d],this._loaded&&(this.fire("layerremove",{layer:o}),o.fire("remove")),o._map=o._mapToAdd=null,this):this},hasLayer:function(o){return H(o)in this._layers},eachLayer:function(o,d){for(var x in this._layers)o.call(d,this._layers[x]);return this},_addLayers:function(o){o=o?ye(o)?o:[o]:[];for(var d=0,x=o.length;d<x;d++)this.addLayer(o[d])},_addZoomLimit:function(o){(!isNaN(o.options.maxZoom)||!isNaN(o.options.minZoom))&&(this._zoomBoundLayers[H(o)]=o,this._updateZoomLevels())},_removeZoomLimit:function(o){var d=H(o);this._zoomBoundLayers[d]&&(delete this._zoomBoundLayers[d],this._updateZoomLevels())},_updateZoomLevels:function(){var o=1/0,d=-1/0,x=this._getZoomSpan();for(var P in this._zoomBoundLayers){var z=this._zoomBoundLayers[P].options;o=z.minZoom===void 0?o:Math.min(o,z.minZoom),d=z.maxZoom===void 0?d:Math.max(d,z.maxZoom)}this._layersMaxZoom=d===-1/0?void 0:d,this._layersMinZoom=o===1/0?void 0:o,x!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Zr=jn.extend({initialize:function(o,d){Fe(this,d),this._layers={};var x,P;if(o)for(x=0,P=o.length;x<P;x++)this.addLayer(o[x])},addLayer:function(o){var d=this.getLayerId(o);return this._layers[d]=o,this._map&&this._map.addLayer(o),this},removeLayer:function(o){var d=o in this._layers?o:this.getLayerId(o);return this._map&&this._layers[d]&&this._map.removeLayer(this._layers[d]),delete this._layers[d],this},hasLayer:function(o){var d=typeof o=="number"?o:this.getLayerId(o);return d in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(o){var d=Array.prototype.slice.call(arguments,1),x,P;for(x in this._layers)P=this._layers[x],P[o]&&P[o].apply(P,d);return this},onAdd:function(o){this.eachLayer(o.addLayer,o)},onRemove:function(o){this.eachLayer(o.removeLayer,o)},eachLayer:function(o,d){for(var x in this._layers)o.call(d,this._layers[x]);return this},getLayer:function(o){return this._layers[o]},getLayers:function(){var o=[];return this.eachLayer(o.push,o),o},setZIndex:function(o){return this.invoke("setZIndex",o)},getLayerId:function(o){return H(o)}}),Qa=function(o,d){return new Zr(o,d)},br=Zr.extend({addLayer:function(o){return this.hasLayer(o)?this:(o.addEventParent(this),Zr.prototype.addLayer.call(this,o),this.fire("layeradd",{layer:o}))},removeLayer:function(o){return this.hasLayer(o)?(o in this._layers&&(o=this._layers[o]),o.removeEventParent(this),Zr.prototype.removeLayer.call(this,o),this.fire("layerremove",{layer:o})):this},setStyle:function(o){return this.invoke("setStyle",o)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var o=new ti;for(var d in this._layers){var x=this._layers[d];o.extend(x.getBounds?x.getBounds():x.getLatLng())}return o}}),el=function(o,d){return new br(o,d)},oo=sn.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(o){Fe(this,o)},createIcon:function(o){return this._createIcon("icon",o)},createShadow:function(o){return this._createIcon("shadow",o)},_createIcon:function(o,d){var x=this._getIconUrl(o);if(!x){if(o==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var P=this._createImg(x,d&&d.tagName==="IMG"?d:null);return this._setIconStyles(P,o),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),P},_setIconStyles:function(o,d){var x=this.options,P=x[d+"Size"];typeof P=="number"&&(P=[P,P]);var z=He(P),$=He(d==="shadow"&&x.shadowAnchor||x.iconAnchor||z&&z.divideBy(2,!0));o.className="leaflet-marker-"+d+" "+(x.className||""),$&&(o.style.marginLeft=-$.x+"px",o.style.marginTop=-$.y+"px"),z&&(o.style.width=z.x+"px",o.style.height=z.y+"px")},_createImg:function(o,d){return d=d||document.createElement("img"),d.src=o,d},_getIconUrl:function(o){return ve.retina&&this.options[o+"RetinaUrl"]||this.options[o+"Url"]}});function Gl(o){return new oo(o)}var pa=oo.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(o){return typeof pa.imagePath!="string"&&(pa.imagePath=this._detectIconPath()),(this.options.imagePath||pa.imagePath)+oo.prototype._getIconUrl.call(this,o)},_stripUrl:function(o){var d=function(x,P,z){var $=P.exec(x);return $&&$[z]};return o=d(o,/^url\((['"])?(.+)\1\)$/,2),o&&d(o,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var o=Tt("div","leaflet-default-icon-path",document.body),d=yr(o,"background-image")||yr(o,"backgroundImage");if(document.body.removeChild(o),d=this._stripUrl(d),d)return d;var x=document.querySelector('link[href$="leaflet.css"]');return x?x.href.substring(0,x.href.length-11-1):""}}),Wl=wr.extend({initialize:function(o){this._marker=o},addHooks:function(){var o=this._marker._icon;this._draggable||(this._draggable=new Dn(o,o,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),at(o,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&yi(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(o){var d=this._marker,x=d._map,P=this._marker.options.autoPanSpeed,z=this._marker.options.autoPanPadding,$=Ho(d._icon),oe=x.getPixelBounds(),we=x.getPixelOrigin(),ce=Rt(oe.min._subtract(we).add(z),oe.max._subtract(we).subtract(z));if(!ce.contains($)){var Te=He((Math.max(ce.max.x,$.x)-ce.max.x)/(oe.max.x-ce.max.x)-(Math.min(ce.min.x,$.x)-ce.min.x)/(oe.min.x-ce.min.x),(Math.max(ce.max.y,$.y)-ce.max.y)/(oe.max.y-ce.max.y)-(Math.min(ce.min.y,$.y)-ce.min.y)/(oe.min.y-ce.min.y)).multiplyBy(P);x.panBy(Te,{animate:!1}),this._draggable._newPos._add(Te),this._draggable._startPos._add(Te),Ti(d._icon,this._draggable._newPos),this._onDrag(o),this._panRequest=ei(this._adjustPan.bind(this,o))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(o){this._marker.options.autoPan&&(ri(this._panRequest),this._panRequest=ei(this._adjustPan.bind(this,o)))},_onDrag:function(o){var d=this._marker,x=d._shadow,P=Ho(d._icon),z=d._map.layerPointToLatLng(P);x&&Ti(x,P),d._latlng=z,o.latlng=z,o.oldLatLng=this._oldLatLng,d.fire("move",o).fire("drag",o)},_onDragEnd:function(o){ri(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",o)}}),vi=jn.extend({options:{icon:new pa,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(o,d){Fe(this,d),this._latlng=zt(o)},onAdd:function(o){this._zoomAnimated=this._zoomAnimated&&o.options.markerZoomAnimation,this._zoomAnimated&&o.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(o){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&o.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(o){var d=this._latlng;return this._latlng=zt(o),this.update(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},setZIndexOffset:function(o){return this.options.zIndexOffset=o,this.update()},getIcon:function(){return this.options.icon},setIcon:function(o){return this.options.icon=o,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var o=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(o)}return this},_initIcon:function(){var o=this.options,d="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),x=o.icon.createIcon(this._icon),P=!1;x!==this._icon&&(this._icon&&this._removeIcon(),P=!0,o.title&&(x.title=o.title),x.tagName==="IMG"&&(x.alt=o.alt||"")),at(x,d),o.keyboard&&(x.tabIndex="0",x.setAttribute("role","button")),this._icon=x,o.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Lt(x,"focus",this._panOnFocus,this);var z=o.icon.createShadow(this._shadow),$=!1;z!==this._shadow&&(this._removeShadow(),$=!0),z&&(at(z,d),z.alt=""),this._shadow=z,o.opacity<1&&this._updateOpacity(),P&&this.getPane().appendChild(this._icon),this._initInteraction(),z&&$&&this.getPane(o.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ni(this._icon,"focus",this._panOnFocus,this),di(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&di(this._shadow),this._shadow=null},_setPos:function(o){this._icon&&Ti(this._icon,o),this._shadow&&Ti(this._shadow,o),this._zIndex=o.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(o){this._icon&&(this._icon.style.zIndex=this._zIndex+o)},_animateZoom:function(o){var d=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center).round();this._setPos(d)},_initInteraction:function(){if(this.options.interactive&&(at(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Wl)){var o=this.options.draggable;this.dragging&&(o=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Wl(this),o&&this.dragging.enable()}},setOpacity:function(o){return this.options.opacity=o,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var o=this.options.opacity;this._icon&&Tn(this._icon,o),this._shadow&&Tn(this._shadow,o)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var o=this._map;if(o){var d=this.options.icon.options,x=d.iconSize?He(d.iconSize):He(0,0),P=d.iconAnchor?He(d.iconAnchor):He(0,0);o.panInside(this._latlng,{paddingTopLeft:P,paddingBottomRight:x.subtract(P)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function is(o,d){return new vi(o,d)}var Wi=jn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(o){this._renderer=o.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(o){return Fe(this,o),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&o&&Object.prototype.hasOwnProperty.call(o,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Bs=Wi.extend({options:{fill:!0,radius:10},initialize:function(o,d){Fe(this,d),this._latlng=zt(o),this._radius=this.options.radius},setLatLng:function(o){var d=this._latlng;return this._latlng=zt(o),this.redraw(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(o){return this.options.radius=this._radius=o,this.redraw()},getRadius:function(){return this._radius},setStyle:function(o){var d=o&&o.radius||this._radius;return Wi.prototype.setStyle.call(this,o),this.setRadius(d),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var o=this._radius,d=this._radiusY||o,x=this._clickTolerance(),P=[o+x,d+x];this._pxBounds=new St(this._point.subtract(P),this._point.add(P))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(o){return o.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function tl(o,d){return new Bs(o,d)}var fa=Bs.extend({initialize:function(o,d,x){if(typeof d=="number"&&(d=b({},x,{radius:d})),Fe(this,d),this._latlng=zt(o),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(o){return this._mRadius=o,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var o=[this._radius,this._radiusY||this._radius];return new ti(this._map.layerPointToLatLng(this._point.subtract(o)),this._map.layerPointToLatLng(this._point.add(o)))},setStyle:Wi.prototype.setStyle,_project:function(){var o=this._latlng.lng,d=this._latlng.lat,x=this._map,P=x.options.crs;if(P.distance===Zn.distance){var z=Math.PI/180,$=this._mRadius/Zn.R/z,oe=x.project([d+$,o]),we=x.project([d-$,o]),ce=oe.add(we).divideBy(2),Te=x.unproject(ce).lat,it=Math.acos((Math.cos($*z)-Math.sin(d*z)*Math.sin(Te*z))/(Math.cos(d*z)*Math.cos(Te*z)))/z;(isNaN(it)||it===0)&&(it=$/Math.cos(Math.PI/180*d)),this._point=ce.subtract(x.getPixelOrigin()),this._radius=isNaN(it)?0:ce.x-x.project([Te,o-it]).x,this._radiusY=ce.y-oe.y}else{var Pt=P.unproject(P.project(this._latlng).subtract([this._mRadius,0]));this._point=x.latLngToLayerPoint(this._latlng),this._radius=this._point.x-x.latLngToLayerPoint(Pt).x}this._updateBounds()}});function so(o,d,x){return new fa(o,d,x)}var qn=Wi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(o,d){Fe(this,d),this._setLatLngs(o)},getLatLngs:function(){return this._latlngs},setLatLngs:function(o){return this._setLatLngs(o),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(o){for(var d=1/0,x=null,P=Ao,z,$,oe=0,we=this._parts.length;oe<we;oe++)for(var ce=this._parts[oe],Te=1,it=ce.length;Te<it;Te++){z=ce[Te-1],$=ce[Te];var Pt=P(o,z,$,!0);Pt<d&&(d=Pt,x=P(o,z,$))}return x&&(x.distance=Math.sqrt(d)),x},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ui(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(o,d){return d=d||this._defaultShape(),o=zt(o),d.push(o),this._bounds.extend(o),this.redraw()},_setLatLngs:function(o){this._bounds=new ti,this._latlngs=this._convertLatLngs(o)},_defaultShape:function(){return Et(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(o){for(var d=[],x=Et(o),P=0,z=o.length;P<z;P++)x?(d[P]=zt(o[P]),this._bounds.extend(d[P])):d[P]=this._convertLatLngs(o[P]);return d},_project:function(){var o=new St;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,o),this._bounds.isValid()&&o.isValid()&&(this._rawPxBounds=o,this._updateBounds())},_updateBounds:function(){var o=this._clickTolerance(),d=new Re(o,o);this._rawPxBounds&&(this._pxBounds=new St([this._rawPxBounds.min.subtract(d),this._rawPxBounds.max.add(d)]))},_projectLatlngs:function(o,d,x){var P=o[0]instanceof Zt,z=o.length,$,oe;if(P){for(oe=[],$=0;$<z;$++)oe[$]=this._map.latLngToLayerPoint(o[$]),x.extend(oe[$]);d.push(oe)}else for($=0;$<z;$++)this._projectLatlngs(o[$],d,x)},_clipPoints:function(){var o=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}var d=this._parts,x,P,z,$,oe,we,ce;for(x=0,z=0,$=this._rings.length;x<$;x++)for(ce=this._rings[x],P=0,oe=ce.length;P<oe-1;P++)we=bu(ce[P],ce[P+1],o,P,!0),we&&(d[z]=d[z]||[],d[z].push(we[0]),(we[1]!==ce[P+1]||P===oe-2)&&(d[z].push(we[1]),z++))}},_simplifyPoints:function(){for(var o=this._parts,d=this.options.smoothFactor,x=0,P=o.length;x<P;x++)o[x]=Xa(o[x],d)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(o,d){var x,P,z,$,oe,we,ce=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(x=0,$=this._parts.length;x<$;x++)for(we=this._parts[x],P=0,oe=we.length,z=oe-1;P<oe;z=P++)if(!(!d&&P===0)&&Kt(o,we[z],we[P])<=ce)return!0;return!1}});function il(o,d){return new qn(o,d)}qn._flat=Rs;var ns=qn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Jo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(o){var d=qn.prototype._convertLatLngs.call(this,o),x=d.length;return x>=2&&d[0]instanceof Zt&&d[0].equals(d[x-1])&&d.pop(),d},_setLatLngs:function(o){qn.prototype._setLatLngs.call(this,o),Et(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Et(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var o=this._renderer._bounds,d=this.options.weight,x=new Re(d,d);if(o=new St(o.min.subtract(x),o.max.add(x)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}for(var P=0,z=this._rings.length,$;P<z;P++)$=jl(this._rings[P],o,!0),$.length&&this._parts.push($)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(o){var d=!1,x,P,z,$,oe,we,ce,Te;if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for($=0,ce=this._parts.length;$<ce;$++)for(x=this._parts[$],oe=0,Te=x.length,we=Te-1;oe<Te;we=oe++)P=x[oe],z=x[we],P.y>o.y!=z.y>o.y&&o.x<(z.x-P.x)*(o.y-P.y)/(z.y-P.y)+P.x&&(d=!d);return d||qn.prototype._containsPoint.call(this,o,!0)}});function nl(o,d){return new ns(o,d)}var Gn=br.extend({initialize:function(o,d){Fe(this,d),this._layers={},o&&this.addData(o)},addData:function(o){var d=ye(o)?o:o.features,x,P,z;if(d){for(x=0,P=d.length;x<P;x++)z=d[x],(z.geometries||z.geometry||z.features||z.coordinates)&&this.addData(z);return this}var $=this.options;if($.filter&&!$.filter(o))return this;var oe=rs(o,$);return oe?(oe.feature=ga(o),oe.defaultOptions=oe.options,this.resetStyle(oe),$.onEachFeature&&$.onEachFeature(o,oe),this.addLayer(oe)):this},resetStyle:function(o){return o===void 0?this.eachLayer(this.resetStyle,this):(o.options=b({},o.defaultOptions),this._setLayerStyle(o,this.options.style),this)},setStyle:function(o){return this.eachLayer(function(d){this._setLayerStyle(d,o)},this)},_setLayerStyle:function(o,d){o.setStyle&&(typeof d=="function"&&(d=d(o.feature)),o.setStyle(d))}});function rs(o,d){var x=o.type==="Feature"?o.geometry:o,P=x?x.coordinates:null,z=[],$=d&&d.pointToLayer,oe=d&&d.coordsToLatLng||ao,we,ce,Te,it;if(!P&&!x)return null;switch(x.type){case"Point":return we=oe(P),ma($,o,we,d);case"MultiPoint":for(Te=0,it=P.length;Te<it;Te++)we=oe(P[Te]),z.push(ma($,o,we,d));return new br(z);case"LineString":case"MultiLineString":return ce=Lo(P,x.type==="LineString"?0:1,oe),new qn(ce,d);case"Polygon":case"MultiPolygon":return ce=Lo(P,x.type==="Polygon"?1:2,oe),new ns(ce,d);case"GeometryCollection":for(Te=0,it=x.geometries.length;Te<it;Te++){var Pt=rs({geometry:x.geometries[Te],type:"Feature",properties:o.properties},d);Pt&&z.push(Pt)}return new br(z);case"FeatureCollection":for(Te=0,it=x.features.length;Te<it;Te++){var Ft=rs(x.features[Te],d);Ft&&z.push(Ft)}return new br(z);default:throw new Error("Invalid GeoJSON object.")}}function ma(o,d,x,P){return o?o(d,x):new vi(x,P&&P.markersInheritOptions&&P)}function ao(o){return new Zt(o[1],o[0],o[2])}function Lo(o,d,x){for(var P=[],z=0,$=o.length,oe;z<$;z++)oe=d?Lo(o[z],d-1,x):(x||ao)(o[z]),P.push(oe);return P}function rl(o,d){return o=zt(o),o.alt!==void 0?[Ce(o.lng,d),Ce(o.lat,d),Ce(o.alt,d)]:[Ce(o.lng,d),Ce(o.lat,d)]}function _a(o,d,x,P){for(var z=[],$=0,oe=o.length;$<oe;$++)z.push(d?_a(o[$],Et(o[$])?0:d-1,x,P):rl(o[$],P));return!d&&x&&z.length>0&&z.push(z[0].slice()),z}function os(o,d){return o.feature?b({},o.feature,{geometry:d}):ga(d)}function ga(o){return o.type==="Feature"||o.type==="FeatureCollection"?o:{type:"Feature",properties:{},geometry:o}}var ol={toGeoJSON:function(o){return os(this,{type:"Point",coordinates:rl(this.getLatLng(),o)})}};vi.include(ol),fa.include(ol),Bs.include(ol),qn.include({toGeoJSON:function(o){var d=!Et(this._latlngs),x=_a(this._latlngs,d?1:0,!1,o);return os(this,{type:(d?"Multi":"")+"LineString",coordinates:x})}}),ns.include({toGeoJSON:function(o){var d=!Et(this._latlngs),x=d&&!Et(this._latlngs[0]),P=_a(this._latlngs,x?2:d?1:0,!0,o);return d||(P=[P]),os(this,{type:(x?"Multi":"")+"Polygon",coordinates:P})}}),Zr.include({toMultiPoint:function(o){var d=[];return this.eachLayer(function(x){d.push(x.toGeoJSON(o).geometry.coordinates)}),os(this,{type:"MultiPoint",coordinates:d})},toGeoJSON:function(o){var d=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(d==="MultiPoint")return this.toMultiPoint(o);var x=d==="GeometryCollection",P=[];return this.eachLayer(function(z){if(z.toGeoJSON){var $=z.toGeoJSON(o);if(x)P.push($.geometry);else{var oe=ga($);oe.type==="FeatureCollection"?P.push.apply(P,oe.features):P.push(oe)}}}),x?os(this,{geometries:P,type:"GeometryCollection"}):{type:"FeatureCollection",features:P}}});function lo(o,d){return new Gn(o,d)}var ya=lo,xi=jn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(o,d,x){this._url=o,this._bounds=Ct(d),Fe(this,x)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(at(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){di(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(o){return this.options.opacity=o,this._image&&this._updateOpacity(),this},setStyle:function(o){return o.opacity&&this.setOpacity(o.opacity),this},bringToFront:function(){return this._map&&io(this._image),this},bringToBack:function(){return this._map&&bn(this._image),this},setUrl:function(o){return this._url=o,this._image&&(this._image.src=o),this},setBounds:function(o){return this._bounds=Ct(o),this._map&&this._reset(),this},getEvents:function(){var o={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var o=this._url.tagName==="IMG",d=this._image=o?this._url:Tt("img");if(at(d,"leaflet-image-layer"),this._zoomAnimated&&at(d,"leaflet-zoom-animated"),this.options.className&&at(d,this.options.className),d.onselectstart=_e,d.onmousemove=_e,d.onload=O(this.fire,this,"load"),d.onerror=O(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(d.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),o){this._url=d.src;return}d.src=this._url,d.alt=this.options.alt},_animateZoom:function(o){var d=this._map.getZoomScale(o.zoom),x=this._map._latLngBoundsToNewLayerBounds(this._bounds,o.zoom,o.center).min;Mo(this._image,x,d)},_reset:function(){var o=this._image,d=new St(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),x=d.getSize();Ti(o,d.min),o.style.width=x.x+"px",o.style.height=x.y+"px"},_updateOpacity:function(){Tn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var o=this.options.errorOverlayUrl;o&&this._url!==o&&(this._url=o,this._image.src=o)},getCenter:function(){return this._bounds.getCenter()}}),or=function(o,d,x){return new xi(o,d,x)},Hl=xi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var o=this._url.tagName==="VIDEO",d=this._image=o?this._url:Tt("video");if(at(d,"leaflet-image-layer"),this._zoomAnimated&&at(d,"leaflet-zoom-animated"),this.options.className&&at(d,this.options.className),d.onselectstart=_e,d.onmousemove=_e,d.onloadeddata=O(this.fire,this,"load"),o){for(var x=d.getElementsByTagName("source"),P=[],z=0;z<x.length;z++)P.push(x[z].src);this._url=x.length>0?P:[d.src];return}ye(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(d.style,"objectFit")&&(d.style.objectFit="fill"),d.autoplay=!!this.options.autoplay,d.loop=!!this.options.loop,d.muted=!!this.options.muted,d.playsInline=!!this.options.playsInline;for(var $=0;$<this._url.length;$++){var oe=Tt("source");oe.src=this._url[$],d.appendChild(oe)}}});function uo(o,d,x){return new Hl(o,d,x)}var Os=xi.extend({_initImage:function(){var o=this._image=this._url;at(o,"leaflet-image-layer"),this._zoomAnimated&&at(o,"leaflet-zoom-animated"),this.options.className&&at(o,this.options.className),o.onselectstart=_e,o.onmousemove=_e}});function va(o,d,x){return new Os(o,d,x)}var $r=jn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(o,d){o&&(o instanceof Zt||ye(o))?(this._latlng=zt(o),Fe(this,d)):(Fe(this,o),this._source=d),this.options.content&&(this._content=this.options.content)},openOn:function(o){return o=arguments.length?o:this._source._map,o.hasLayer(this)||o.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(o){return this._map?this.close():(arguments.length?this._source=o:o=this._source,this._prepareOpen(),this.openOn(o._map)),this},onAdd:function(o){this._zoomAnimated=o._zoomAnimated,this._container||this._initLayout(),o._fadeAnimated&&Tn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),o._fadeAnimated&&Tn(this._container,1),this.bringToFront(),this.options.interactive&&(at(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(o){o._fadeAnimated?(Tn(this._container,0),this._removeTimeout=setTimeout(O(di,void 0,this._container),200)):di(this._container),this.options.interactive&&(yi(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(o){return this._latlng=zt(o),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(o){return this._content=o,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var o={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&io(this._container),this},bringToBack:function(){return this._map&&bn(this._container),this},_prepareOpen:function(o){var d=this._source;if(!d._map)return!1;if(d instanceof br){d=null;var x=this._source._layers;for(var P in x)if(x[P]._map){d=x[P];break}if(!d)return!1;this._source=d}if(!o)if(d.getCenter)o=d.getCenter();else if(d.getLatLng)o=d.getLatLng();else if(d.getBounds)o=d.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(o),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var o=this._contentNode,d=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof d=="string")o.innerHTML=d;else{for(;o.hasChildNodes();)o.removeChild(o.firstChild);o.appendChild(d)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var o=this._map.latLngToLayerPoint(this._latlng),d=He(this.options.offset),x=this._getAnchor();this._zoomAnimated?Ti(this._container,o.add(x)):d=d.add(o).add(x);var P=this._containerBottom=-d.y,z=this._containerLeft=-Math.round(this._containerWidth/2)+d.x;this._container.style.bottom=P+"px",this._container.style.left=z+"px"}},_getAnchor:function(){return[0,0]}});Ht.include({_initOverlay:function(o,d,x,P){var z=d;return z instanceof o||(z=new o(P).setContent(d)),x&&z.setLatLng(x),z}}),jn.include({_initOverlay:function(o,d,x,P){var z=x;return z instanceof o?(Fe(z,P),z._source=this):(z=d&&!P?d:new o(P,this),z.setContent(x)),z}});var Fs=$r.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(o){return o=arguments.length?o:this._source._map,!o.hasLayer(this)&&o._popup&&o._popup.options.autoClose&&o.removeLayer(o._popup),o._popup=this,$r.prototype.openOn.call(this,o)},onAdd:function(o){$r.prototype.onAdd.call(this,o),o.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Wi||this._source.on("preclick",Gi))},onRemove:function(o){$r.prototype.onRemove.call(this,o),o.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Wi||this._source.off("preclick",Gi))},getEvents:function(){var o=$r.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(o.preclick=this.close),this.options.keepInView&&(o.moveend=this._adjustPan),o},_initLayout:function(){var o="leaflet-popup",d=this._container=Tt("div",o+" "+(this.options.className||"")+" leaflet-zoom-animated"),x=this._wrapper=Tt("div",o+"-content-wrapper",d);if(this._contentNode=Tt("div",o+"-content",x),Ko(d),En(this._contentNode),Lt(d,"contextmenu",Gi),this._tipContainer=Tt("div",o+"-tip-container",d),this._tip=Tt("div",o+"-tip",this._tipContainer),this.options.closeButton){var P=this._closeButton=Tt("a",o+"-close-button",d);P.setAttribute("role","button"),P.setAttribute("aria-label","Close popup"),P.href="#close",P.innerHTML='<span aria-hidden="true">&#215;</span>',Lt(P,"click",function(z){Ni(z),this.close()},this)}},_updateLayout:function(){var o=this._contentNode,d=o.style;d.width="",d.whiteSpace="nowrap";var x=o.offsetWidth;x=Math.min(x,this.options.maxWidth),x=Math.max(x,this.options.minWidth),d.width=x+1+"px",d.whiteSpace="",d.height="";var P=o.offsetHeight,z=this.options.maxHeight,$="leaflet-popup-scrolled";z&&P>z?(d.height=z+"px",at(o,$)):yi(o,$),this._containerWidth=this._container.offsetWidth},_animateZoom:function(o){var d=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center),x=this._getAnchor();Ti(this._container,d.add(x))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var o=this._map,d=parseInt(yr(this._container,"marginBottom"),10)||0,x=this._container.offsetHeight+d,P=this._containerWidth,z=new Re(this._containerLeft,-x-this._containerBottom);z._add(Ho(this._container));var $=o.layerPointToContainerPoint(z),oe=He(this.options.autoPanPadding),we=He(this.options.autoPanPaddingTopLeft||oe),ce=He(this.options.autoPanPaddingBottomRight||oe),Te=o.getSize(),it=0,Pt=0;$.x+P+ce.x>Te.x&&(it=$.x+P-Te.x+ce.x),$.x-it-we.x<0&&(it=$.x-we.x),$.y+x+ce.y>Te.y&&(Pt=$.y+x-Te.y+ce.y),$.y-Pt-we.y<0&&(Pt=$.y-we.y),(it||Pt)&&(this.options.keepInView&&(this._autopanning=!0),o.fire("autopanstart").panBy([it,Pt]))}},_getAnchor:function(){return He(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Tu=function(o,d){return new Fs(o,d)};Ht.mergeOptions({closePopupOnClick:!0}),Ht.include({openPopup:function(o,d,x){return this._initOverlay(Fs,o,d,x).openOn(this),this},closePopup:function(o){return o=arguments.length?o:this._popup,o&&o.close(),this}}),jn.include({bindPopup:function(o,d){return this._popup=this._initOverlay(Fs,this._popup,o,d),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(o){return this._popup&&(this instanceof br||(this._popup._source=this),this._popup._prepareOpen(o||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(o){return this._popup&&this._popup.setContent(o),this},getPopup:function(){return this._popup},_openPopup:function(o){if(!(!this._popup||!this._map)){rr(o);var d=o.layer||o.target;if(this._popup._source===d&&!(d instanceof Wi)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(o.latlng);return}this._popup._source=d,this.openPopup(o.latlng)}},_movePopup:function(o){this._popup.setLatLng(o.latlng)},_onKeyPress:function(o){o.originalEvent.keyCode===13&&this._openPopup(o)}});var jr=$r.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(o){$r.prototype.onAdd.call(this,o),this.setOpacity(this.options.opacity),o.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(o){$r.prototype.onRemove.call(this,o),o.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var o=$r.prototype.getEvents.call(this);return this.options.permanent||(o.preclick=this.close),o},_initLayout:function(){var o="leaflet-tooltip",d=o+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Tt("div",d),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+H(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(o){var d,x,P=this._map,z=this._container,$=P.latLngToContainerPoint(P.getCenter()),oe=P.layerPointToContainerPoint(o),we=this.options.direction,ce=z.offsetWidth,Te=z.offsetHeight,it=He(this.options.offset),Pt=this._getAnchor();we==="top"?(d=ce/2,x=Te):we==="bottom"?(d=ce/2,x=0):we==="center"?(d=ce/2,x=Te/2):we==="right"?(d=0,x=Te/2):we==="left"?(d=ce,x=Te/2):oe.x<$.x?(we="right",d=0,x=Te/2):(we="left",d=ce+(it.x+Pt.x)*2,x=Te/2),o=o.subtract(He(d,x,!0)).add(it).add(Pt),yi(z,"leaflet-tooltip-right"),yi(z,"leaflet-tooltip-left"),yi(z,"leaflet-tooltip-top"),yi(z,"leaflet-tooltip-bottom"),at(z,"leaflet-tooltip-"+we),Ti(z,o)},_updatePosition:function(){var o=this._map.latLngToLayerPoint(this._latlng);this._setPosition(o)},setOpacity:function(o){this.options.opacity=o,this._container&&Tn(this._container,o)},_animateZoom:function(o){var d=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center);this._setPosition(d)},_getAnchor:function(){return He(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Do=function(o,d){return new jr(o,d)};Ht.include({openTooltip:function(o,d,x){return this._initOverlay(jr,o,d,x).openOn(this),this},closeTooltip:function(o){return o.close(),this}}),jn.include({bindTooltip:function(o,d){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(jr,this._tooltip,o,d),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(o){if(!(!o&&this._tooltipHandlersAdded)){var d=o?"off":"on",x={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?x.add=this._openTooltip:(x.mouseover=this._openTooltip,x.mouseout=this.closeTooltip,x.click=this._openTooltip,this._map?this._addFocusListeners():x.add=this._addFocusListeners),this._tooltip.options.sticky&&(x.mousemove=this._moveTooltip),this[d](x),this._tooltipHandlersAdded=!o}},openTooltip:function(o){return this._tooltip&&(this instanceof br||(this._tooltip._source=this),this._tooltip._prepareOpen(o)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(o){return this._tooltip&&this._tooltip.setContent(o),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(o){var d=typeof o.getElement=="function"&&o.getElement();d&&(Lt(d,"focus",function(){this._tooltip._source=o,this.openTooltip()},this),Lt(d,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(o){var d=typeof o.getElement=="function"&&o.getElement();d&&d.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(o){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var d=this;this._map.once("moveend",function(){d._openOnceFlag=!1,d._openTooltip(o)});return}this._tooltip._source=o.layer||o.target,this.openTooltip(this._tooltip.options.sticky?o.latlng:void 0)}},_moveTooltip:function(o){var d=o.latlng,x,P;this._tooltip.options.sticky&&o.originalEvent&&(x=this._map.mouseEventToContainerPoint(o.originalEvent),P=this._map.containerPointToLayerPoint(x),d=this._map.layerPointToLatLng(P)),this._tooltip.setLatLng(d)}});var Qe=oo.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(o){var d=o&&o.tagName==="DIV"?o:document.createElement("div"),x=this.options;if(x.html instanceof Element?(qi(d),d.appendChild(x.html)):d.innerHTML=x.html!==!1?x.html:"",x.bgPos){var P=He(x.bgPos);d.style.backgroundPosition=-P.x+"px "+-P.y+"px"}return this._setIconStyles(d,"icon"),d},createShadow:function(){return null}});function Su(o){return new Qe(o)}oo.Default=pa;var Tr=jn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ve.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(o){Fe(this,o)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(o){o._addZoomLimit(this)},onRemove:function(o){this._removeAllTiles(),di(this._container),o._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(io(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(bn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(o){return this.options.opacity=o,this._updateOpacity(),this},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var o=this._clampZoom(this._map.getZoom());o!==this._tileZoom&&(this._tileZoom=o,this._updateLevels()),this._update()}return this},getEvents:function(){var o={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=q(this._onMoveEnd,this.options.updateInterval,this)),o.move=this._onMove),this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},createTile:function(){return document.createElement("div")},getTileSize:function(){var o=this.options.tileSize;return o instanceof Re?o:new Re(o,o)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(o){for(var d=this.getPane().children,x=-o(-1/0,1/0),P=0,z=d.length,$;P<z;P++)$=d[P].style.zIndex,d[P]!==this._container&&$&&(x=o(x,+$));isFinite(x)&&(this.options.zIndex=x+o(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ve.ielt9){Tn(this._container,this.options.opacity);var o=+new Date,d=!1,x=!1;for(var P in this._tiles){var z=this._tiles[P];if(!(!z.current||!z.loaded)){var $=Math.min(1,(o-z.loaded)/200);Tn(z.el,$),$<1?d=!0:(z.active?x=!0:this._onOpaqueTile(z),z.active=!0)}}x&&!this._noPrune&&this._pruneTiles(),d&&(ri(this._fadeFrame),this._fadeFrame=ei(this._updateOpacity,this))}},_onOpaqueTile:_e,_initContainer:function(){this._container||(this._container=Tt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var o=this._tileZoom,d=this.options.maxZoom;if(o!==void 0){for(var x in this._levels)x=Number(x),this._levels[x].el.children.length||x===o?(this._levels[x].el.style.zIndex=d-Math.abs(o-x),this._onUpdateLevel(x)):(di(this._levels[x].el),this._removeTilesAtZoom(x),this._onRemoveLevel(x),delete this._levels[x]);var P=this._levels[o],z=this._map;return P||(P=this._levels[o]={},P.el=Tt("div","leaflet-tile-container leaflet-zoom-animated",this._container),P.el.style.zIndex=d,P.origin=z.project(z.unproject(z.getPixelOrigin()),o).round(),P.zoom=o,this._setZoomTransform(P,z.getCenter(),z.getZoom()),_e(P.el.offsetWidth),this._onCreateLevel(P)),this._level=P,P}},_onUpdateLevel:_e,_onRemoveLevel:_e,_onCreateLevel:_e,_pruneTiles:function(){if(this._map){var o,d,x=this._map.getZoom();if(x>this.options.maxZoom||x<this.options.minZoom){this._removeAllTiles();return}for(o in this._tiles)d=this._tiles[o],d.retain=d.current;for(o in this._tiles)if(d=this._tiles[o],d.current&&!d.active){var P=d.coords;this._retainParent(P.x,P.y,P.z,P.z-5)||this._retainChildren(P.x,P.y,P.z,P.z+2)}for(o in this._tiles)this._tiles[o].retain||this._removeTile(o)}},_removeTilesAtZoom:function(o){for(var d in this._tiles)this._tiles[d].coords.z===o&&this._removeTile(d)},_removeAllTiles:function(){for(var o in this._tiles)this._removeTile(o)},_invalidateAll:function(){for(var o in this._levels)di(this._levels[o].el),this._onRemoveLevel(Number(o)),delete this._levels[o];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(o,d,x,P){var z=Math.floor(o/2),$=Math.floor(d/2),oe=x-1,we=new Re(+z,+$);we.z=+oe;var ce=this._tileCoordsToKey(we),Te=this._tiles[ce];return Te&&Te.active?(Te.retain=!0,!0):(Te&&Te.loaded&&(Te.retain=!0),oe>P?this._retainParent(z,$,oe,P):!1)},_retainChildren:function(o,d,x,P){for(var z=2*o;z<2*o+2;z++)for(var $=2*d;$<2*d+2;$++){var oe=new Re(z,$);oe.z=x+1;var we=this._tileCoordsToKey(oe),ce=this._tiles[we];if(ce&&ce.active){ce.retain=!0;continue}else ce&&ce.loaded&&(ce.retain=!0);x+1<P&&this._retainChildren(z,$,x+1,P)}},_resetView:function(o){var d=o&&(o.pinch||o.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),d,d)},_animateZoom:function(o){this._setView(o.center,o.zoom,!0,o.noUpdate)},_clampZoom:function(o){var d=this.options;return d.minNativeZoom!==void 0&&o<d.minNativeZoom?d.minNativeZoom:d.maxNativeZoom!==void 0&&d.maxNativeZoom<o?d.maxNativeZoom:o},_setView:function(o,d,x,P){var z=Math.round(d);this.options.maxZoom!==void 0&&z>this.options.maxZoom||this.options.minZoom!==void 0&&z<this.options.minZoom?z=void 0:z=this._clampZoom(z);var $=this.options.updateWhenZooming&&z!==this._tileZoom;(!P||$)&&(this._tileZoom=z,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),z!==void 0&&this._update(o),x||this._pruneTiles(),this._noPrune=!!x),this._setZoomTransforms(o,d)},_setZoomTransforms:function(o,d){for(var x in this._levels)this._setZoomTransform(this._levels[x],o,d)},_setZoomTransform:function(o,d,x){var P=this._map.getZoomScale(x,o.zoom),z=o.origin.multiplyBy(P).subtract(this._map._getNewPixelOrigin(d,x)).round();ve.any3d?Mo(o.el,z,P):Ti(o.el,z)},_resetGrid:function(){var o=this._map,d=o.options.crs,x=this._tileSize=this.getTileSize(),P=this._tileZoom,z=this._map.getPixelWorldBounds(this._tileZoom);z&&(this._globalTileRange=this._pxBoundsToTileRange(z)),this._wrapX=d.wrapLng&&!this.options.noWrap&&[Math.floor(o.project([0,d.wrapLng[0]],P).x/x.x),Math.ceil(o.project([0,d.wrapLng[1]],P).x/x.y)],this._wrapY=d.wrapLat&&!this.options.noWrap&&[Math.floor(o.project([d.wrapLat[0],0],P).y/x.x),Math.ceil(o.project([d.wrapLat[1],0],P).y/x.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(o){var d=this._map,x=d._animatingZoom?Math.max(d._animateToZoom,d.getZoom()):d.getZoom(),P=d.getZoomScale(x,this._tileZoom),z=d.project(o,this._tileZoom).floor(),$=d.getSize().divideBy(P*2);return new St(z.subtract($),z.add($))},_update:function(o){var d=this._map;if(d){var x=this._clampZoom(d.getZoom());if(o===void 0&&(o=d.getCenter()),this._tileZoom!==void 0){var P=this._getTiledPixelBounds(o),z=this._pxBoundsToTileRange(P),$=z.getCenter(),oe=[],we=this.options.keepBuffer,ce=new St(z.getBottomLeft().subtract([we,-we]),z.getTopRight().add([we,-we]));if(!(isFinite(z.min.x)&&isFinite(z.min.y)&&isFinite(z.max.x)&&isFinite(z.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Te in this._tiles){var it=this._tiles[Te].coords;(it.z!==this._tileZoom||!ce.contains(new Re(it.x,it.y)))&&(this._tiles[Te].current=!1)}if(Math.abs(x-this._tileZoom)>1){this._setView(o,x);return}for(var Pt=z.min.y;Pt<=z.max.y;Pt++)for(var Ft=z.min.x;Ft<=z.max.x;Ft++){var Yt=new Re(Ft,Pt);if(Yt.z=this._tileZoom,!!this._isValidTile(Yt)){var Hi=this._tiles[this._tileCoordsToKey(Yt)];Hi?Hi.current=!0:oe.push(Yt)}}if(oe.sort(function(Rn,Er){return Rn.distanceTo($)-Er.distanceTo($)}),oe.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Mi=document.createDocumentFragment();for(Ft=0;Ft<oe.length;Ft++)this._addTile(oe[Ft],Mi);this._level.el.appendChild(Mi)}}}},_isValidTile:function(o){var d=this._map.options.crs;if(!d.infinite){var x=this._globalTileRange;if(!d.wrapLng&&(o.x<x.min.x||o.x>x.max.x)||!d.wrapLat&&(o.y<x.min.y||o.y>x.max.y))return!1}if(!this.options.bounds)return!0;var P=this._tileCoordsToBounds(o);return Ct(this.options.bounds).overlaps(P)},_keyToBounds:function(o){return this._tileCoordsToBounds(this._keyToTileCoords(o))},_tileCoordsToNwSe:function(o){var d=this._map,x=this.getTileSize(),P=o.scaleBy(x),z=P.add(x),$=d.unproject(P,o.z),oe=d.unproject(z,o.z);return[$,oe]},_tileCoordsToBounds:function(o){var d=this._tileCoordsToNwSe(o),x=new ti(d[0],d[1]);return this.options.noWrap||(x=this._map.wrapLatLngBounds(x)),x},_tileCoordsToKey:function(o){return o.x+":"+o.y+":"+o.z},_keyToTileCoords:function(o){var d=o.split(":"),x=new Re(+d[0],+d[1]);return x.z=+d[2],x},_removeTile:function(o){var d=this._tiles[o];d&&(di(d.el),delete this._tiles[o],this.fire("tileunload",{tile:d.el,coords:this._keyToTileCoords(o)}))},_initTile:function(o){at(o,"leaflet-tile");var d=this.getTileSize();o.style.width=d.x+"px",o.style.height=d.y+"px",o.onselectstart=_e,o.onmousemove=_e,ve.ielt9&&this.options.opacity<1&&Tn(o,this.options.opacity)},_addTile:function(o,d){var x=this._getTilePos(o),P=this._tileCoordsToKey(o),z=this.createTile(this._wrapCoords(o),O(this._tileReady,this,o));this._initTile(z),this.createTile.length<2&&ei(O(this._tileReady,this,o,null,z)),Ti(z,x),this._tiles[P]={el:z,coords:o,current:!0},d.appendChild(z),this.fire("tileloadstart",{tile:z,coords:o})},_tileReady:function(o,d,x){d&&this.fire("tileerror",{error:d,tile:x,coords:o});var P=this._tileCoordsToKey(o);x=this._tiles[P],x&&(x.loaded=+new Date,this._map._fadeAnimated?(Tn(x.el,0),ri(this._fadeFrame),this._fadeFrame=ei(this._updateOpacity,this)):(x.active=!0,this._pruneTiles()),d||(at(x.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:x.el,coords:o})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ve.ielt9||!this._map._fadeAnimated?ei(this._pruneTiles,this):setTimeout(O(this._pruneTiles,this),250)))},_getTilePos:function(o){return o.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(o){var d=new Re(this._wrapX?ke(o.x,this._wrapX):o.x,this._wrapY?ke(o.y,this._wrapY):o.y);return d.z=o.z,d},_pxBoundsToTileRange:function(o){var d=this.getTileSize();return new St(o.min.unscaleBy(d).floor(),o.max.unscaleBy(d).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var o in this._tiles)if(!this._tiles[o].loaded)return!1;return!0}});function Ns(o){return new Tr(o)}var co=Tr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(o,d){this._url=o,d=Fe(this,d),d.detectRetina&&ve.retina&&d.maxZoom>0?(d.tileSize=Math.floor(d.tileSize/2),d.zoomReverse?(d.zoomOffset--,d.minZoom=Math.min(d.maxZoom,d.minZoom+1)):(d.zoomOffset++,d.maxZoom=Math.max(d.minZoom,d.maxZoom-1)),d.minZoom=Math.max(0,d.minZoom)):d.zoomReverse?d.minZoom=Math.min(d.maxZoom,d.minZoom):d.maxZoom=Math.max(d.minZoom,d.maxZoom),typeof d.subdomains=="string"&&(d.subdomains=d.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(o,d){return this._url===o&&d===void 0&&(d=!0),this._url=o,d||this.redraw(),this},createTile:function(o,d){var x=document.createElement("img");return Lt(x,"load",O(this._tileOnLoad,this,d,x)),Lt(x,"error",O(this._tileOnError,this,d,x)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(x.referrerPolicy=this.options.referrerPolicy),x.alt="",x.src=this.getTileUrl(o),x},getTileUrl:function(o){var d={r:ve.retina?"@2x":"",s:this._getSubdomain(o),x:o.x,y:o.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var x=this._globalTileRange.max.y-o.y;this.options.tms&&(d.y=x),d["-y"]=x}return ue(this._url,b(d,this.options))},_tileOnLoad:function(o,d){ve.ielt9?setTimeout(O(o,this,null,d),0):o(null,d)},_tileOnError:function(o,d,x){var P=this.options.errorTileUrl;P&&d.getAttribute("src")!==P&&(d.src=P),o(x,d)},_onTileRemove:function(o){o.tile.onload=null},_getZoomForUrl:function(){var o=this._tileZoom,d=this.options.maxZoom,x=this.options.zoomReverse,P=this.options.zoomOffset;return x&&(o=d-o),o+P},_getSubdomain:function(o){var d=Math.abs(o.x+o.y)%this.options.subdomains.length;return this.options.subdomains[d]},_abortLoading:function(){var o,d;for(o in this._tiles)if(this._tiles[o].coords.z!==this._tileZoom&&(d=this._tiles[o].el,d.onload=_e,d.onerror=_e,!d.complete)){d.src=tt;var x=this._tiles[o].coords;di(d),delete this._tiles[o],this.fire("tileabort",{tile:d,coords:x})}},_removeTile:function(o){var d=this._tiles[o];if(d)return d.el.setAttribute("src",tt),Tr.prototype._removeTile.call(this,o)},_tileReady:function(o,d,x){if(!(!this._map||x&&x.getAttribute("src")===tt))return Tr.prototype._tileReady.call(this,o,d,x)}});function Ye(o,d){return new co(o,d)}var xa=co.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(o,d){this._url=o;var x=b({},this.defaultWmsParams);for(var P in d)P in this.options||(x[P]=d[P]);d=Fe(this,d);var z=d.detectRetina&&ve.retina?2:1,$=this.getTileSize();x.width=$.x*z,x.height=$.y*z,this.wmsParams=x},onAdd:function(o){this._crs=this.options.crs||o.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var d=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[d]=this._crs.code,co.prototype.onAdd.call(this,o)},getTileUrl:function(o){var d=this._tileCoordsToNwSe(o),x=this._crs,P=Rt(x.project(d[0]),x.project(d[1])),z=P.min,$=P.max,oe=(this._wmsVersion>=1.3&&this._crs===Ja?[z.y,z.x,$.y,$.x]:[z.x,z.y,$.x,$.y]).join(","),we=co.prototype.getTileUrl.call(this,o);return we+Bt(this.wmsParams,we,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+oe},setParams:function(o,d){return b(this.wmsParams,o),d||this.redraw(),this}});function wc(o,d){return new xa(o,d)}co.WMS=xa,Ye.wms=wc;var Sr=jn.extend({options:{padding:.1},initialize:function(o){Fe(this,o),H(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),at(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var o={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(o.zoomanim=this._onAnimZoom),o},_onAnimZoom:function(o){this._updateTransform(o.center,o.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(o,d){var x=this._map.getZoomScale(d,this._zoom),P=this._map.getSize().multiplyBy(.5+this.options.padding),z=this._map.project(this._center,d),$=P.multiplyBy(-x).add(z).subtract(this._map._getNewPixelOrigin(o,d));ve.any3d?Mo(this._container,$,x):Ti(this._container,$)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var o in this._layers)this._layers[o]._reset()},_onZoomEnd:function(){for(var o in this._layers)this._layers[o]._project()},_updatePaths:function(){for(var o in this._layers)this._layers[o]._update()},_update:function(){var o=this.options.padding,d=this._map.getSize(),x=this._map.containerPointToLayerPoint(d.multiplyBy(-o)).round();this._bounds=new St(x,x.add(d.multiplyBy(1+o*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ss=Sr.extend({options:{tolerance:0},getEvents:function(){var o=Sr.prototype.getEvents.call(this);return o.viewprereset=this._onViewPreReset,o},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Sr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var o=this._container=document.createElement("canvas");Lt(o,"mousemove",this._onMouseMove,this),Lt(o,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Lt(o,"mouseout",this._handleMouseOut,this),o._leaflet_disable_events=!0,this._ctx=o.getContext("2d")},_destroyContainer:function(){ri(this._redrawRequest),delete this._ctx,di(this._container),ni(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var o;this._redrawBounds=null;for(var d in this._layers)o=this._layers[d],o._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Sr.prototype._update.call(this);var o=this._bounds,d=this._container,x=o.getSize(),P=ve.retina?2:1;Ti(d,o.min),d.width=P*x.x,d.height=P*x.y,d.style.width=x.x+"px",d.style.height=x.y+"px",ve.retina&&this._ctx.scale(2,2),this._ctx.translate(-o.min.x,-o.min.y),this.fire("update")}},_reset:function(){Sr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(o){this._updateDashArray(o),this._layers[H(o)]=o;var d=o._order={layer:o,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=d),this._drawLast=d,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(o){this._requestRedraw(o)},_removePath:function(o){var d=o._order,x=d.next,P=d.prev;x?x.prev=P:this._drawLast=P,P?P.next=x:this._drawFirst=x,delete o._order,delete this._layers[H(o)],this._requestRedraw(o)},_updatePath:function(o){this._extendRedrawBounds(o),o._project(),o._update(),this._requestRedraw(o)},_updateStyle:function(o){this._updateDashArray(o),this._requestRedraw(o)},_updateDashArray:function(o){if(typeof o.options.dashArray=="string"){var d=o.options.dashArray.split(/[, ]+/),x=[],P,z;for(z=0;z<d.length;z++){if(P=Number(d[z]),isNaN(P))return;x.push(P)}o.options._dashArray=x}else o.options._dashArray=o.options.dashArray},_requestRedraw:function(o){this._map&&(this._extendRedrawBounds(o),this._redrawRequest=this._redrawRequest||ei(this._redraw,this))},_extendRedrawBounds:function(o){if(o._pxBounds){var d=(o.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new St,this._redrawBounds.extend(o._pxBounds.min.subtract([d,d])),this._redrawBounds.extend(o._pxBounds.max.add([d,d]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var o=this._redrawBounds;if(o){var d=o.getSize();this._ctx.clearRect(o.min.x,o.min.y,d.x,d.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var o,d=this._redrawBounds;if(this._ctx.save(),d){var x=d.getSize();this._ctx.beginPath(),this._ctx.rect(d.min.x,d.min.y,x.x,x.y),this._ctx.clip()}this._drawing=!0;for(var P=this._drawFirst;P;P=P.next)o=P.layer,(!d||o._pxBounds&&o._pxBounds.intersects(d))&&o._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(o,d){if(this._drawing){var x,P,z,$,oe=o._parts,we=oe.length,ce=this._ctx;if(we){for(ce.beginPath(),x=0;x<we;x++){for(P=0,z=oe[x].length;P<z;P++)$=oe[x][P],ce[P?"lineTo":"moveTo"]($.x,$.y);d&&ce.closePath()}this._fillStroke(ce,o)}}},_updateCircle:function(o){if(!(!this._drawing||o._empty())){var d=o._point,x=this._ctx,P=Math.max(Math.round(o._radius),1),z=(Math.max(Math.round(o._radiusY),1)||P)/P;z!==1&&(x.save(),x.scale(1,z)),x.beginPath(),x.arc(d.x,d.y/z,P,0,Math.PI*2,!1),z!==1&&x.restore(),this._fillStroke(x,o)}},_fillStroke:function(o,d){var x=d.options;x.fill&&(o.globalAlpha=x.fillOpacity,o.fillStyle=x.fillColor||x.color,o.fill(x.fillRule||"evenodd")),x.stroke&&x.weight!==0&&(o.setLineDash&&o.setLineDash(d.options&&d.options._dashArray||[]),o.globalAlpha=x.opacity,o.lineWidth=x.weight,o.strokeStyle=x.color,o.lineCap=x.lineCap,o.lineJoin=x.lineJoin,o.stroke())},_onClick:function(o){for(var d=this._map.mouseEventToLayerPoint(o),x,P,z=this._drawFirst;z;z=z.next)x=z.layer,x.options.interactive&&x._containsPoint(d)&&(!(o.type==="click"||o.type==="preclick")||!this._map._draggableMoved(x))&&(P=x);this._fireEvent(P?[P]:!1,o)},_onMouseMove:function(o){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var d=this._map.mouseEventToLayerPoint(o);this._handleMouseHover(o,d)}},_handleMouseOut:function(o){var d=this._hoveredLayer;d&&(yi(this._container,"leaflet-interactive"),this._fireEvent([d],o,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(o,d){if(!this._mouseHoverThrottled){for(var x,P,z=this._drawFirst;z;z=z.next)x=z.layer,x.options.interactive&&x._containsPoint(d)&&(P=x);P!==this._hoveredLayer&&(this._handleMouseOut(o),P&&(at(this._container,"leaflet-interactive"),this._fireEvent([P],o,"mouseover"),this._hoveredLayer=P)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,o),this._mouseHoverThrottled=!0,setTimeout(O(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(o,d,x){this._map._fireDOMEvent(d,x||d.type,o)},_bringToFront:function(o){var d=o._order;if(d){var x=d.next,P=d.prev;if(x)x.prev=P;else return;P?P.next=x:x&&(this._drawFirst=x),d.prev=this._drawLast,this._drawLast.next=d,d.next=null,this._drawLast=d,this._requestRedraw(o)}},_bringToBack:function(o){var d=o._order;if(d){var x=d.next,P=d.prev;if(P)P.next=x;else return;x?x.prev=P:P&&(this._drawLast=P),d.prev=null,d.next=this._drawFirst,this._drawFirst.prev=d,this._drawFirst=d,this._requestRedraw(o)}}});function sl(o){return ve.canvas?new ss(o):null}var Us=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(o){return document.createElement("<lvml:"+o+' class="lvml">')}}catch{}return function(o){return document.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Eu={_initContainer:function(){this._container=Tt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Sr.prototype._update.call(this),this.fire("update"))},_initPath:function(o){var d=o._container=Us("shape");at(d,"leaflet-vml-shape "+(this.options.className||"")),d.coordsize="1 1",o._path=Us("path"),d.appendChild(o._path),this._updateStyle(o),this._layers[H(o)]=o},_addPath:function(o){var d=o._container;this._container.appendChild(d),o.options.interactive&&o.addInteractiveTarget(d)},_removePath:function(o){var d=o._container;di(d),o.removeInteractiveTarget(d),delete this._layers[H(o)]},_updateStyle:function(o){var d=o._stroke,x=o._fill,P=o.options,z=o._container;z.stroked=!!P.stroke,z.filled=!!P.fill,P.stroke?(d||(d=o._stroke=Us("stroke")),z.appendChild(d),d.weight=P.weight+"px",d.color=P.color,d.opacity=P.opacity,P.dashArray?d.dashStyle=ye(P.dashArray)?P.dashArray.join(" "):P.dashArray.replace(/( *, *)/g," "):d.dashStyle="",d.endcap=P.lineCap.replace("butt","flat"),d.joinstyle=P.lineJoin):d&&(z.removeChild(d),o._stroke=null),P.fill?(x||(x=o._fill=Us("fill")),z.appendChild(x),x.color=P.fillColor||P.color,x.opacity=P.fillOpacity):x&&(z.removeChild(x),o._fill=null)},_updateCircle:function(o){var d=o._point.round(),x=Math.round(o._radius),P=Math.round(o._radiusY||x);this._setPath(o,o._empty()?"M0 0":"AL "+d.x+","+d.y+" "+x+","+P+" 0,"+65535*360)},_setPath:function(o,d){o._path.v=d},_bringToFront:function(o){io(o._container)},_bringToBack:function(o){bn(o._container)}},al=ve.vml?Us:qo,ho=Sr.extend({_initContainer:function(){this._container=al("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=al("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){di(this._container),ni(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Sr.prototype._update.call(this);var o=this._bounds,d=o.getSize(),x=this._container;(!this._svgSize||!this._svgSize.equals(d))&&(this._svgSize=d,x.setAttribute("width",d.x),x.setAttribute("height",d.y)),Ti(x,o.min),x.setAttribute("viewBox",[o.min.x,o.min.y,d.x,d.y].join(" ")),this.fire("update")}},_initPath:function(o){var d=o._path=al("path");o.options.className&&at(d,o.options.className),o.options.interactive&&at(d,"leaflet-interactive"),this._updateStyle(o),this._layers[H(o)]=o},_addPath:function(o){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(o._path),o.addInteractiveTarget(o._path)},_removePath:function(o){di(o._path),o.removeInteractiveTarget(o._path),delete this._layers[H(o)]},_updatePath:function(o){o._project(),o._update()},_updateStyle:function(o){var d=o._path,x=o.options;d&&(x.stroke?(d.setAttribute("stroke",x.color),d.setAttribute("stroke-opacity",x.opacity),d.setAttribute("stroke-width",x.weight),d.setAttribute("stroke-linecap",x.lineCap),d.setAttribute("stroke-linejoin",x.lineJoin),x.dashArray?d.setAttribute("stroke-dasharray",x.dashArray):d.removeAttribute("stroke-dasharray"),x.dashOffset?d.setAttribute("stroke-dashoffset",x.dashOffset):d.removeAttribute("stroke-dashoffset")):d.setAttribute("stroke","none"),x.fill?(d.setAttribute("fill",x.fillColor||x.color),d.setAttribute("fill-opacity",x.fillOpacity),d.setAttribute("fill-rule",x.fillRule||"evenodd")):d.setAttribute("fill","none"))},_updatePoly:function(o,d){this._setPath(o,ii(o._parts,d))},_updateCircle:function(o){var d=o._point,x=Math.max(Math.round(o._radius),1),P=Math.max(Math.round(o._radiusY),1)||x,z="a"+x+","+P+" 0 1,0 ",$=o._empty()?"M0 0":"M"+(d.x-x)+","+d.y+z+x*2+",0 "+z+-x*2+",0 ";this._setPath(o,$)},_setPath:function(o,d){o._path.setAttribute("d",d)},_bringToFront:function(o){io(o._path)},_bringToBack:function(o){bn(o._path)}});ve.vml&&ho.include(Eu);function ll(o){return ve.svg||ve.vml?new ho(o):null}Ht.include({getRenderer:function(o){var d=o.options.renderer||this._getPaneRenderer(o.options.pane)||this.options.renderer||this._renderer;return d||(d=this._renderer=this._createRenderer()),this.hasLayer(d)||this.addLayer(d),d},_getPaneRenderer:function(o){if(o==="overlayPane"||o===void 0)return!1;var d=this._paneRenderers[o];return d===void 0&&(d=this._createRenderer({pane:o}),this._paneRenderers[o]=d),d},_createRenderer:function(o){return this.options.preferCanvas&&sl(o)||ll(o)}});var ul=ns.extend({initialize:function(o,d){ns.prototype.initialize.call(this,this._boundsToLatLngs(o),d)},setBounds:function(o){return this.setLatLngs(this._boundsToLatLngs(o))},_boundsToLatLngs:function(o){return o=Ct(o),[o.getSouthWest(),o.getNorthWest(),o.getNorthEast(),o.getSouthEast()]}});function Xl(o,d){return new ul(o,d)}ho.create=al,ho.pointsToPath=ii,Gn.geometryToLayer=rs,Gn.coordsToLatLng=ao,Gn.coordsToLatLngs=Lo,Gn.latLngToCoords=rl,Gn.latLngsToCoords=_a,Gn.getFeature=os,Gn.asFeature=ga,Ht.mergeOptions({boxZoom:!0});var Pn=wr.extend({initialize:function(o){this._map=o,this._container=o._container,this._pane=o._panes.overlayPane,this._resetStateTimeout=0,o.on("unload",this._destroy,this)},addHooks:function(){Lt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ni(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){di(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(o){if(!o.shiftKey||o.which!==1&&o.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Cs(),ks(),this._startPoint=this._map.mouseEventToContainerPoint(o),Lt(document,{contextmenu:rr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(o){this._moved||(this._moved=!0,this._box=Tt("div","leaflet-zoom-box",this._container),at(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(o);var d=new St(this._point,this._startPoint),x=d.getSize();Ti(this._box,d.min),this._box.style.width=x.x+"px",this._box.style.height=x.y+"px"},_finish:function(){this._moved&&(di(this._box),yi(this._container,"leaflet-crosshair")),oa(),Va(),ni(document,{contextmenu:rr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(o){if(!(o.which!==1&&o.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(O(this._resetState,this),0);var d=new ti(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(d).fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(o){o.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ht.addInitHook("addHandler","boxZoom",Pn),Ht.mergeOptions({doubleClickZoom:!0});var qr=wr.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(o){var d=this._map,x=d.getZoom(),P=d.options.zoomDelta,z=o.originalEvent.shiftKey?x-P:x+P;d.options.doubleClickZoom==="center"?d.setZoom(z):d.setZoomAround(o.containerPoint,z)}});Ht.addInitHook("addHandler","doubleClickZoom",qr),Ht.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Kl=wr.extend({addHooks:function(){if(!this._draggable){var o=this._map;this._draggable=new Dn(o._mapPane,o._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),o.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),o.on("zoomend",this._onZoomEnd,this),o.whenReady(this._onZoomEnd,this))}at(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){yi(this._map._container,"leaflet-grab"),yi(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var o=this._map;if(o._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var d=Ct(this._map.options.maxBounds);this._offsetLimit=Rt(this._map.latLngToContainerPoint(d.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(d.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;o.fire("movestart").fire("dragstart"),o.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(o){if(this._map.options.inertia){var d=this._lastTime=+new Date,x=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(x),this._times.push(d),this._prunePositions(d)}this._map.fire("move",o).fire("drag",o)},_prunePositions:function(o){for(;this._positions.length>1&&o-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var o=this._map.getSize().divideBy(2),d=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=d.subtract(o).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(o,d){return o-(o-d)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var o=this._draggable._newPos.subtract(this._draggable._startPos),d=this._offsetLimit;o.x<d.min.x&&(o.x=this._viscousLimit(o.x,d.min.x)),o.y<d.min.y&&(o.y=this._viscousLimit(o.y,d.min.y)),o.x>d.max.x&&(o.x=this._viscousLimit(o.x,d.max.x)),o.y>d.max.y&&(o.y=this._viscousLimit(o.y,d.max.y)),this._draggable._newPos=this._draggable._startPos.add(o)}},_onPreDragWrap:function(){var o=this._worldWidth,d=Math.round(o/2),x=this._initialWorldOffset,P=this._draggable._newPos.x,z=(P-d+x)%o+d-x,$=(P+d+x)%o-d-x,oe=Math.abs(z+x)<Math.abs($+x)?z:$;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=oe},_onDragEnd:function(o){var d=this._map,x=d.options,P=!x.inertia||o.noInertia||this._times.length<2;if(d.fire("dragend",o),P)d.fire("moveend");else{this._prunePositions(+new Date);var z=this._lastPos.subtract(this._positions[0]),$=(this._lastTime-this._times[0])/1e3,oe=x.easeLinearity,we=z.multiplyBy(oe/$),ce=we.distanceTo([0,0]),Te=Math.min(x.inertiaMaxSpeed,ce),it=we.multiplyBy(Te/ce),Pt=Te/(x.inertiaDeceleration*oe),Ft=it.multiplyBy(-Pt/2).round();!Ft.x&&!Ft.y?d.fire("moveend"):(Ft=d._limitOffset(Ft,d.options.maxBounds),ei(function(){d.panBy(Ft,{duration:Pt,easeLinearity:oe,noMoveStart:!0,animate:!0})}))}}});Ht.addInitHook("addHandler","dragging",Kl),Ht.mergeOptions({keyboard:!0,keyboardPanDelta:80});var cl=wr.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(o){this._map=o,this._setPanDelta(o.options.keyboardPanDelta),this._setZoomDelta(o.options.zoomDelta)},addHooks:function(){var o=this._map._container;o.tabIndex<=0&&(o.tabIndex="0"),Lt(o,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ni(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var o=document.body,d=document.documentElement,x=o.scrollTop||d.scrollTop,P=o.scrollLeft||d.scrollLeft;this._map._container.focus(),window.scrollTo(P,x)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(o){var d=this._panKeys={},x=this.keyCodes,P,z;for(P=0,z=x.left.length;P<z;P++)d[x.left[P]]=[-1*o,0];for(P=0,z=x.right.length;P<z;P++)d[x.right[P]]=[o,0];for(P=0,z=x.down.length;P<z;P++)d[x.down[P]]=[0,o];for(P=0,z=x.up.length;P<z;P++)d[x.up[P]]=[0,-1*o]},_setZoomDelta:function(o){var d=this._zoomKeys={},x=this.keyCodes,P,z;for(P=0,z=x.zoomIn.length;P<z;P++)d[x.zoomIn[P]]=o;for(P=0,z=x.zoomOut.length;P<z;P++)d[x.zoomOut[P]]=-o},_addHooks:function(){Lt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ni(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(o){if(!(o.altKey||o.ctrlKey||o.metaKey)){var d=o.keyCode,x=this._map,P;if(d in this._panKeys){if(!x._panAnim||!x._panAnim._inProgress)if(P=this._panKeys[d],o.shiftKey&&(P=He(P).multiplyBy(3)),x.options.maxBounds&&(P=x._limitOffset(He(P),x.options.maxBounds)),x.options.worldCopyJump){var z=x.wrapLatLng(x.unproject(x.project(x.getCenter()).add(P)));x.panTo(z)}else x.panBy(P)}else if(d in this._zoomKeys)x.setZoom(x.getZoom()+(o.shiftKey?3:1)*this._zoomKeys[d]);else if(d===27&&x._popup&&x._popup.options.closeOnEscapeKey)x.closePopup();else return;rr(o)}}});Ht.addInitHook("addHandler","keyboard",cl),Ht.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var hl=wr.extend({addHooks:function(){Lt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ni(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(o){var d=ja(o),x=this._map.options.wheelDebounceTime;this._delta+=d,this._lastMousePos=this._map.mouseEventToContainerPoint(o),this._startTime||(this._startTime=+new Date);var P=Math.max(x-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(O(this._performZoom,this),P),rr(o)},_performZoom:function(){var o=this._map,d=o.getZoom(),x=this._map.options.zoomSnap||0;o._stop();var P=this._delta/(this._map.options.wheelPxPerZoomLevel*4),z=4*Math.log(2/(1+Math.exp(-Math.abs(P))))/Math.LN2,$=x?Math.ceil(z/x)*x:z,oe=o._limitZoom(d+(this._delta>0?$:-$))-d;this._delta=0,this._startTime=null,oe&&(o.options.scrollWheelZoom==="center"?o.setZoom(d+oe):o.setZoomAround(this._lastMousePos,d+oe))}});Ht.addInitHook("addHandler","scrollWheelZoom",hl);var Yl=600;Ht.mergeOptions({tapHold:ve.touchNative&&ve.safari&&ve.mobile,tapTolerance:15});var Jl=wr.extend({addHooks:function(){Lt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ni(this._map._container,"touchstart",this._onDown,this)},_onDown:function(o){if(clearTimeout(this._holdTimeout),o.touches.length===1){var d=o.touches[0];this._startPos=this._newPos=new Re(d.clientX,d.clientY),this._holdTimeout=setTimeout(O(function(){this._cancel(),this._isTapValid()&&(Lt(document,"touchend",Ni),Lt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",d))},this),Yl),Lt(document,"touchend touchcancel contextmenu",this._cancel,this),Lt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function o(){ni(document,"touchend",Ni),ni(document,"touchend touchcancel",o)},_cancel:function(){clearTimeout(this._holdTimeout),ni(document,"touchend touchcancel contextmenu",this._cancel,this),ni(document,"touchmove",this._onMove,this)},_onMove:function(o){var d=o.touches[0];this._newPos=new Re(d.clientX,d.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(o,d){var x=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,screenX:d.screenX,screenY:d.screenY,clientX:d.clientX,clientY:d.clientY});x._simulated=!0,d.target.dispatchEvent(x)}});Ht.addInitHook("addHandler","tapHold",Jl),Ht.mergeOptions({touchZoom:ve.touch,bounceAtZoomLimits:!0});var Wn=wr.extend({addHooks:function(){at(this._map._container,"leaflet-touch-zoom"),Lt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){yi(this._map._container,"leaflet-touch-zoom"),ni(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(o){var d=this._map;if(!(!o.touches||o.touches.length!==2||d._animatingZoom||this._zooming)){var x=d.mouseEventToContainerPoint(o.touches[0]),P=d.mouseEventToContainerPoint(o.touches[1]);this._centerPoint=d.getSize()._divideBy(2),this._startLatLng=d.containerPointToLatLng(this._centerPoint),d.options.touchZoom!=="center"&&(this._pinchStartLatLng=d.containerPointToLatLng(x.add(P)._divideBy(2))),this._startDist=x.distanceTo(P),this._startZoom=d.getZoom(),this._moved=!1,this._zooming=!0,d._stop(),Lt(document,"touchmove",this._onTouchMove,this),Lt(document,"touchend touchcancel",this._onTouchEnd,this),Ni(o)}},_onTouchMove:function(o){if(!(!o.touches||o.touches.length!==2||!this._zooming)){var d=this._map,x=d.mouseEventToContainerPoint(o.touches[0]),P=d.mouseEventToContainerPoint(o.touches[1]),z=x.distanceTo(P)/this._startDist;if(this._zoom=d.getScaleZoom(z,this._startZoom),!d.options.bounceAtZoomLimits&&(this._zoom<d.getMinZoom()&&z<1||this._zoom>d.getMaxZoom()&&z>1)&&(this._zoom=d._limitZoom(this._zoom)),d.options.touchZoom==="center"){if(this._center=this._startLatLng,z===1)return}else{var $=x._add(P)._divideBy(2)._subtract(this._centerPoint);if(z===1&&$.x===0&&$.y===0)return;this._center=d.unproject(d.project(this._pinchStartLatLng,this._zoom).subtract($),this._zoom)}this._moved||(d._moveStart(!0,!1),this._moved=!0),ri(this._animRequest);var oe=O(d._move,d,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ei(oe,this,!0),Ni(o)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ri(this._animRequest),ni(document,"touchmove",this._onTouchMove,this),ni(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ht.addInitHook("addHandler","touchZoom",Wn),Ht.BoxZoom=Pn,Ht.DoubleClickZoom=qr,Ht.Drag=Kl,Ht.Keyboard=cl,Ht.ScrollWheelZoom=hl,Ht.TapHold=Jl,Ht.TouchZoom=Wn,h.Bounds=St,h.Browser=ve,h.CRS=Bi,h.Canvas=ss,h.Circle=fa,h.CircleMarker=Bs,h.Class=sn,h.Control=xr,h.DivIcon=Qe,h.DivOverlay=$r,h.DomEvent=qa,h.DomUtil=la,h.Draggable=Dn,h.Evented=kn,h.FeatureGroup=br,h.GeoJSON=Gn,h.GridLayer=Tr,h.Handler=wr,h.Icon=oo,h.ImageOverlay=xi,h.LatLng=Zt,h.LatLngBounds=ti,h.Layer=jn,h.LayerGroup=Zr,h.LineUtil=pi,h.Map=Ht,h.Marker=vi,h.Mixin=vu,h.Path=Wi,h.Point=Re,h.PolyUtil=xu,h.Polygon=ns,h.Polyline=qn,h.Popup=Fs,h.PosAnimation=Vl,h.Projection=ql,h.Rectangle=ul,h.Renderer=Sr,h.SVG=ho,h.SVGOverlay=Os,h.TileLayer=co,h.Tooltip=jr,h.Transformation=er,h.Util=xn,h.VideoOverlay=Hl,h.bind=O,h.bounds=Rt,h.canvas=sl,h.circle=so,h.circleMarker=tl,h.control=ca,h.divIcon=Su,h.extend=b,h.featureGroup=el,h.geoJSON=lo,h.geoJson=ya,h.gridLayer=Ns,h.icon=Gl,h.imageOverlay=or,h.latLng=zt,h.latLngBounds=Ct,h.layerGroup=Qa,h.map=Ls,h.marker=is,h.point=He,h.polygon=nl,h.polyline=il,h.popup=Tu,h.rectangle=Xl,h.setOptions=Fe,h.stamp=H,h.svg=ll,h.svgOverlay=va,h.tileLayer=Ye,h.tooltip=Do,h.transformation=tr,h.version=v,h.videoOverlay=uo;var fi=window.L;h.noConflict=function(){return window.L=fi,this},window.L=h})}(_d,_d.exports)),_d.exports}var P0=E0();const Q2=uv(P0);function eT(n,s,h){return Object.freeze({instance:n,context:s,container:h})}function tT(n,s){return s==null?function(v,b){const I=ji.useRef();return I.current||(I.current=n(v,b)),I}:function(v,b){const I=ji.useRef();I.current||(I.current=n(v,b));const O=ji.useRef(v),{instance:u}=I.current;return ji.useEffect(function(){O.current!==v&&(s(u,v,O.current),O.current=v)},[u,v,b]),I}}function iT(n,s){ji.useEffect(function(){return(s.layerContainer??s.map).addLayer(n.instance),function(){var I;(I=s.layerContainer)==null||I.removeLayer(n.instance),s.map.removeLayer(n.instance)}},[s,n])}function nT(n){return function(h){const v=K2(),b=n(S0(h,v),v);return G2(v.map,h.attribution),J2(b.current,h.eventHandlers),iT(b.current,v),b}}function rT(n,s){const h=tT(n,s),v=nT(h);return Y2(v)}function oT(n,s,h){const{opacity:v,zIndex:b}=s;v!=null&&v!==h.opacity&&n.setOpacity(v),b!=null&&b!==h.zIndex&&n.setZIndex(b)}function Em(){return Em=Object.assign||function(n){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var v in h)Object.prototype.hasOwnProperty.call(h,v)&&(n[v]=h[v])}return n},Em.apply(this,arguments)}function sT({bounds:n,boundsOptions:s,center:h,children:v,className:b,id:I,placeholder:O,style:u,whenReady:H,zoom:q,...ke},_e){const[Ce]=ji.useState({className:b,id:I,style:u}),[Ue,We]=ji.useState(null);ji.useImperativeHandle(_e,()=>(Ue==null?void 0:Ue.map)??null,[Ue]);const Fe=ji.useCallback(pe=>{if(pe!==null&&Ue===null){const ue=new P0.Map(pe,ke);h!=null&&q!=null?ue.setView(h,q):n!=null&&ue.fitBounds(n,s),H!=null&&ue.whenReady(H),We(H2(ue))}},[]);ji.useEffect(()=>()=>{Ue==null||Ue.map.remove()},[Ue]);const Bt=Ue?zf.createElement(X2,{value:Ue},v):O??null;return zf.createElement("div",Em({},Ce,{ref:Fe}),Bt)}const aT=ji.forwardRef(sT);var lT={exports:{}},Mf={exports:{}},lv;function uT(){return lv||(lv=1,function(n,s){(function(h,v){n.exports=v()})(Pm,function(){var h,v,b;function I(u,H){if(!h)h=H;else if(!v)v=H;else{var q="var sharedChunk = {}; ("+h+")(sharedChunk); ("+v+")(sharedChunk);",ke={};h(ke),b=H(ke),typeof window<"u"&&(b.workerUrl=window.URL.createObjectURL(new Blob([q],{type:"text/javascript"})))}}I(["exports"],function(u){function H(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var q=ke;function ke(i,e){this.x=i,this.y=e}ke.prototype={clone:function(){return new ke(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),l=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=l,this},_rotateAround:function(i,e){var r=Math.cos(i),l=Math.sin(i),p=e.y+l*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-l*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ke.convert=function(i){return i instanceof ke?i:Array.isArray(i)?new ke(i[0],i[1]):i};var _e=H(q),Ce=Ue;function Ue(i,e,r,l){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=l}Ue.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,l=0;l<8;l++){var p=this.sampleCurveX(r)-i;if(Math.abs(p)<e)return r;var _=this.sampleCurveDerivativeX(r);if(Math.abs(_)<1e-6)break;r-=p/_}var y=0,w=1;for(r=i,l=0;l<20&&(p=this.sampleCurveX(r),!(Math.abs(p-i)<e));l++)i>p?y=r:w=r,r=.5*(w-y)+y;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var We=H(Ce);function Fe(i,e,r,l){const p=new We(i,e,r,l);return function(_){return p.solve(_)}}const Bt=Fe(.25,.1,.25,1);function pe(i,e,r){return Math.min(r,Math.max(e,i))}function ue(i,e,r){const l=r-e,p=((i-e)%l+l)%l+e;return p===e?r:p}function ye(i,...e){for(const r of e)for(const l in r)i[l]=r[l];return i}let Ne=1;function tt(i,e,r){const l={};for(const p in i)l[p]=e.call(r||this,i[p],p,i);return l}function ht(i,e,r){const l={};for(const p in i)e.call(r||this,i[p],p,i)&&(l[p]=i[p]);return l}function rt(i){return Array.isArray(i)?i.map(rt):typeof i=="object"&&i?tt(i,rt):i}const dt={};function Ut(i){dt[i]||(typeof console<"u"&&console.warn(i),dt[i]=!0)}function ct(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function ei(i){let e=0;for(let r,l,p=0,_=i.length,y=_-1;p<_;y=p++)r=i[p],l=i[y],e+=(l.x-r.x)*(r.y+l.y);return e}function ri(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let xn=null;function sn(i){if(xn==null){const e=i.navigator?i.navigator.userAgent:null;xn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return xn}function Rr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const hi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let kn,Re;const kt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(kn||(kn=document.createElement("a")),kn.href=i,kn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Re==null&&(Re=matchMedia("(prefers-reduced-motion: reduce)")),Re.matches)}},He={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class St extends Error{constructor(e,r,l,p){super(`AJAXError: ${r} (${e}): ${l}`),this.status=e,this.statusText=r,this.url=l,this.body=p}}const Rt=ri()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ti=i=>He.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function Ct(i,e){const r=new AbortController,l=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Rt(),signal:r.signal});let p=!1,_=!1;return i.type==="json"&&l.headers.set("Accept","application/json"),_||fetch(l).then(y=>y.ok?(w=>{(i.type==="arrayBuffer"||i.type==="image"?w.arrayBuffer():i.type==="json"?w.json():w.text()).then(E=>{_||(p=!0,e(null,E,w.headers.get("Cache-Control"),w.headers.get("Expires")))}).catch(E=>{_||e(new Error(E.message))})})(y):y.blob().then(w=>e(new St(y.status,y.statusText,i.url,w)))).catch(y=>{y.code!==20&&e(new Error(y.message))}),{cancel:()=>{_=!0,p||r.abort()}}}const Zt=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ri()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!ri())return(ti(i.url)||Ct)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Rt())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Ct(i,e);if(ri()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(l,p){const _=new XMLHttpRequest;_.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(_.responseType="arraybuffer");for(const y in l.headers)_.setRequestHeader(y,l.headers[y]);return l.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=l.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let y=_.response;if(l.type==="json")try{y=JSON.parse(_.response)}catch(w){return p(w)}p(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const y=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});p(new St(_.status,_.statusText,l.url,y))}},_.send(l.body),{cancel:()=>_.abort()}}(i,e)},zt=function(i,e){return Zt(ye(i,{type:"arrayBuffer"}),e)};function Bi(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Zn(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Br(i,e,r){if(r&&r[i]){const l=r[i].indexOf(e);l!==-1&&r[i].splice(l,1)}}class Mn{constructor(e,r={}){ye(this,r),this.type=e}}class er extends Mn{constructor(e,r={}){super("error",ye({error:e},r))}}class tr{on(e,r){return this._listeners=this._listeners||{},Zn(e,r,this._listeners),this}off(e,r){return Br(e,r,this._listeners),Br(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Zn(e,r,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,r){typeof e=="string"&&(e=new Mn(e,r||{}));const l=e.type;if(this.listens(l)){e.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of p)w.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of _)Br(l,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(ye(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof er&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Qr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qo(i,e){const r={};for(const l in i)l!=="ref"&&(r[l]=i[l]);return Qr.forEach(l=>{l in e&&(r[l]=e[l])}),r}function ii(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!ii(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!ii(i[r],e[r]))return!1;return!0}return i===e}const Xt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Or(i,e,r){r.push({command:Xt.addSource,args:[i,e[i]]})}function Go(i,e,r){e.push({command:Xt.removeSource,args:[i]}),r[i]=!0}function ia(i,e,r,l){Go(i,r,l),Or(i,e,r)}function Ss(i,e,r){let l;for(l in i[r])if(Object.prototype.hasOwnProperty.call(i[r],l)&&l!=="data"&&!ii(i[r][l],e[r][l]))return!1;for(l in e[r])if(Object.prototype.hasOwnProperty.call(e[r],l)&&l!=="data"&&!ii(i[r][l],e[r][l]))return!1;return!0}function gi(i,e,r,l,p,_){let y;for(y in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,y)&&(ii(i[y],e[y])||r.push({command:_,args:[l,y,e[y],p]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(ii(i[y],e[y])||r.push({command:_,args:[l,y,e[y],p]}))}function Es(i){return i.id}function Ps(i,e){return i[e.id]=e,i}class qe{constructor(e,r,l,p){this.message=(e?`${e}: `:"")+l,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function an(i,...e){for(const r of e)for(const l in r)i[l]=r[l];return i}class wn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Fr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,p]of r)this.bindings[l]=p}concat(e){return new Fr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Po={kind:"null"},je={kind:"number"},Mt={kind:"string"},At={kind:"boolean"},ln={kind:"color"},gr={kind:"object"},yt={kind:"value"},Nr={kind:"collator"},zn={kind:"formatted"},Co={kind:"padding"},ir={kind:"resolvedImage"},eo={kind:"variableAnchorOffsetCollection"};function en(i,e){return{kind:"array",itemType:i,N:e}}function ai(i){if(i.kind==="array"){const e=ai(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const na=[Po,je,Mt,At,ln,zn,gr,en(yt),Co,ir,eo];function Ur(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ur(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of na)if(!Ur(r,e))return null}}return`Expected ${ai(i)} but found ${ai(e)} instead.`}function J(i,e){return e.some(r=>r.kind===i.kind)}function F(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function U(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const G=.96422,ee=.82521,re=4/29,me=6/29,ae=3*me*me,se=me*me*me,de=Math.PI/180,ve=180/Math.PI;function Ae(i){return(i%=360)<0&&(i+=360),i}function Le([i,e,r,l]){let p,_;const y=It((.2225045*(i=_t(i))+.7168786*(e=_t(e))+.0606169*(r=_t(r)))/1);i===e&&e===r?p=_=y:(p=It((.4360747*i+.3850649*e+.1430804*r)/G),_=It((.0139322*i+.0971045*e+.7141733*r)/ee));const w=116*y-16;return[w<0?0:w,500*(p-y),200*(y-_),l]}function _t(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function It(i){return i>se?Math.pow(i,1/3):i/ae+re}function ot([i,e,r,l]){let p=(i+16)/116,_=isNaN(e)?p:p+e/500,y=isNaN(r)?p:p-r/200;return p=1*vt(p),_=G*vt(_),y=ee*vt(y),[ft(3.1338561*_-1.6168667*p-.4906146*y),ft(-.9787684*_+1.9161415*p+.033454*y),ft(.0719453*_-.2289914*p+1.4052427*y),l]}function ft(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function vt(i){return i>me?i*i*i:ae*(i-re)}function qt(i){return parseInt(i.padEnd(2,i),16)/255}function oi(i,e){return Ot(e?i/100:i,0,1)}function Ot(i,e,r){return Math.min(Math.max(e,i),r)}function Gt(i){return!i.some(Number.isNaN)}const An={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class xt{constructor(e,r,l,p=1,_=!0){this.r=e,this.g=r,this.b=l,this.a=p,_||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[e,r,l,p]))}static parse(e){if(e instanceof xt)return e;if(typeof e!="string")return;const r=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=An[l];if(p){const[y,w,E]=p;return[y/255,w/255,E/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const y=l.length<6?1:2;let w=1;return[qt(l.slice(w,w+=y)),qt(l.slice(w,w+=y)),qt(l.slice(w,w+=y)),qt(l.slice(w,w+y)||"ff")]}if(l.startsWith("rgb")){const y=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[w,E,k,D,B,N,Z,j,Y,te,ne,ge]=y,le=[D||" ",Z||" ",te].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const xe=[k,N,Y].join(""),Se=xe==="%%%"?100:xe===""?255:0;if(Se){const ze=[Ot(+E/Se,0,1),Ot(+B/Se,0,1),Ot(+j/Se,0,1),ne?oi(+ne,ge):1];if(Gt(ze))return ze}}return}}const _=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[y,w,E,k,D,B,N,Z,j]=_,Y=[E||" ",D||" ",N].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const te=[+w,Ot(+k,0,100),Ot(+B,0,100),Z?oi(+Z,j):1];if(Gt(te))return function([ne,ge,le,xe]){function Se(ze){const et=(ze+ne/30)%12,ut=ge*Math.min(le,1-le);return le-ut*Math.max(-1,Math.min(et-3,9-et,1))}return ne=Ae(ne),ge/=100,le/=100,[Se(0),Se(8),Se(4),xe]}(te)}}}(e);return r?new xt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:l,a:p}=this,_=p||1/0;return this.overwriteGetter("rgb",[e/_,r/_,l/_,p])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,l,p,_]=Le(e),y=Math.sqrt(l*l+p*p);return[Math.round(1e4*y)?Ae(Math.atan2(p,l)*ve):NaN,y,r,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Le(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,l,p]=this.rgb;return`rgba(${[e,r,l].map(_=>Math.round(255*_)).join(",")},${p})`}}xt.black=new xt(0,0,0,1),xt.white=new xt(1,1,1,1),xt.transparent=new xt(0,0,0,0),xt.red=new xt(1,0,0,1);class Oi{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fi{constructor(e,r,l,p,_){this.text=e,this.image=r,this.scale=l,this.fontStack=p,this.textColor=_}}class ki{constructor(e){this.sections=e}static fromString(e){return new ki([new Fi(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ki?e:ki.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class $n{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof $n)return e;if(typeof e=="number")return new $n([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new $n(e)}}toString(){return JSON.stringify(this.values)}}const mc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class pn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof pn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const l=e[r],p=e[r+1];if(typeof l!="string"||!mc.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new pn(e)}}toString(){return JSON.stringify(this.values)}}class nr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new nr({name:e,available:!1}):null}}function Fa(i,e,r,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,r,l]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Io(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof xt||i instanceof Oi||i instanceof ki||i instanceof $n||i instanceof pn||i instanceof nr)return!0;if(Array.isArray(i)){for(const e of i)if(!Io(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Io(i[e]))return!1;return!0}return!1}function Ci(i){if(i===null)return Po;if(typeof i=="string")return Mt;if(typeof i=="boolean")return At;if(typeof i=="number")return je;if(i instanceof xt)return ln;if(i instanceof Oi)return Nr;if(i instanceof ki)return zn;if(i instanceof $n)return Co;if(i instanceof pn)return eo;if(i instanceof nr)return ir;if(Array.isArray(i)){const e=i.length;let r;for(const l of i){const p=Ci(l);if(r){if(r===p)continue;r=yt;break}r=p}return en(r||yt,e)}return gr}function to(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof xt||i instanceof ki||i instanceof $n||i instanceof pn||i instanceof nr?i.toString():JSON.stringify(i)}class yr{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Io(e[1]))return r.error("invalid value");const l=e[1];let p=Ci(l);const _=r.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new yr(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Tt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const di={string:Mt,number:je,boolean:At,object:gr};class qi{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,p=1;const _=e[0];if(_==="array"){let w,E;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in di)||k==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);w=di[k],p++}else w=yt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=e[2],p++}l=en(w,E)}else{if(!di[_])throw new Error(`Types doesn't contain name = ${_}`);l=di[_]}const y=[];for(;p<e.length;p++){const w=r.parse(e[p],p,yt);if(!w)return null;y.push(w)}return new qi(l,y)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!Ur(this.type,Ci(l)))return l;if(r===this.args.length-1)throw new Tt(`Expected value to be of type ${ai(this.type)}, but found ${ai(Ci(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const io={"to-boolean":At,"to-color":ln,"to-number":je,"to-string":Mt};class bn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0];if(!io[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");const p=io[l],_=[];for(let y=1;y<e.length;y++){const w=r.parse(e[y],y,yt);if(!w)return null;_.push(w)}return new bn(p,_)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,l;for(const p of this.args){if(r=p.evaluate(e),l=null,r instanceof xt)return r;if(typeof r=="string"){const _=e.parseColor(r);if(_)return _}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Fa(r[0],r[1],r[2],r[3]),!l))return new xt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Tt(l||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const l of this.args){r=l.evaluate(e);const p=$n.parse(r);if(p)return p}throw new Tt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const l of this.args){r=l.evaluate(e);const p=pn.parse(r);if(p)return p}throw new Tt(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new Tt(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return ki.fromString(to(this.args[0].evaluate(e)));case"resolvedImage":return nr.fromString(to(this.args[0].evaluate(e)));default:return to(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Wo=["Unknown","Point","LineString","Polygon"];class at{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=xt.parse(e)),r}}class yi{constructor(e,r,l=[],p,_=new Fr,y=[]){this.registry=e,this.path=l,this.key=l.map(w=>`[${w}]`).join(""),this.scope=_,this.errors=y,this.expectedType=p,this._isConstant=r}parse(e,r,l,p,_={}){return r?this.concat(r,l,p)._parse(e,_):this._parse(e,_)}_parse(e,r){function l(p,_,y){return y==="assert"?new qi(_,[p]):y==="coerce"?new bn(_,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let y=_.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,E=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string")if(w.kind!=="padding"||E.kind!=="value"&&E.kind!=="number"&&E.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||E.kind!=="value"&&E.kind!=="array"){if(this.checkSubtype(w,E))return null}else y=l(y,w,r.typeAnnotation||"coerce");else y=l(y,w,r.typeAnnotation||"coerce");else y=l(y,w,r.typeAnnotation||"coerce");else y=l(y,w,r.typeAnnotation||"assert")}if(!(y instanceof yr)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const w=new at;try{y=new yr(y.type,y.evaluate(w))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l){const p=typeof e=="number"?this.path.concat(e):this.path,_=l?this.scope.concat(l):this.scope;return new yi(this.registry,this._isConstant,p,r||null,_,this.errors)}error(e,...r){const l=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new wn(l,e))}checkSubtype(e,r){const l=Ur(e,r);return l&&this.error(l),l}}class ko{constructor(e,r,l){this.type=Nr,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const p=r.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,At);if(!p)return null;const _=r.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,At);if(!_)return null;let y=null;return l.locale&&(y=r.parse(l.locale,1,Mt),!y)?null:new ko(p,_,y)}evaluate(e){return new Oi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const vr=8192;function Tn(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ra(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Na(i,e){const r=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*vr),Math.round(l*p*vr)]}function Mo(i,e,r){const l=i[0]-e[0],p=i[1]-e[1],_=i[0]-r[0],y=i[1]-r[1];return l*y-_*p==0&&l*_<=0&&p*y<=0}function Ti(i,e){let r=!1;for(let y=0,w=e.length;y<w;y++){const E=e[y];for(let k=0,D=E.length;k<D-1;k++){if(Mo(i,E[k],E[k+1]))return!1;(p=E[k])[1]>(l=i)[1]!=(_=E[k+1])[1]>l[1]&&l[0]<(_[0]-p[0])*(l[1]-p[1])/(_[1]-p[1])+p[0]&&(r=!r)}}var l,p,_;return r}function Ho(i,e){for(let r=0;r<e.length;r++)if(Ti(i,e[r]))return!0;return!1}function Cs(i,e,r,l){const p=l[0]-r[0],_=l[1]-r[1],y=(i[0]-r[0])*_-p*(i[1]-r[1]),w=(e[0]-r[0])*_-p*(e[1]-r[1]);return y>0&&w<0||y<0&&w>0}function oa(i,e,r){for(const k of r)for(let D=0;D<k.length-1;++D)if((w=[(y=k[D+1])[0]-(_=k[D])[0],y[1]-_[1]])[0]*(E=[(p=e)[0]-(l=i)[0],p[1]-l[1]])[1]-w[1]*E[0]!=0&&Cs(l,p,_,y)&&Cs(_,y,l,p))return!0;var l,p,_,y,w,E;return!1}function Ua(i,e){for(let r=0;r<i.length;++r)if(!Ti(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(oa(i[r],i[r+1],e))return!1;return!0}function Is(i,e){for(let r=0;r<e.length;r++)if(Ua(i,e[r]))return!0;return!1}function ks(i,e,r){const l=[];for(let p=0;p<i.length;p++){const _=[];for(let y=0;y<i[p].length;y++){const w=Na(i[p][y],r);Tn(e,w),_.push(w)}l.push(_)}return l}function Va(i,e,r){const l=[];for(let p=0;p<i.length;p++){const _=ks(i[p],e,r);l.push(_)}return l}function sa(i,e,r,l){if(i[0]<r[0]||i[0]>r[2]){const p=.5*l;let _=i[0]-r[0]>p?-l:r[0]-i[0]>p?l:0;_===0&&(_=i[0]-r[2]>p?-l:r[2]-i[0]>p?l:0),i[0]+=_}Tn(e,i)}function Ms(i,e,r,l){const p=Math.pow(2,l.z)*vr,_=[l.x*vr,l.y*vr],y=[];for(const w of i)for(const E of w){const k=[E.x+_[0],E.y+_[1]];sa(k,e,r,p),y.push(k)}return y}function Za(i,e,r,l){const p=Math.pow(2,l.z)*vr,_=[l.x*vr,l.y*vr],y=[];for(const E of i){const k=[];for(const D of E){const B=[D.x+_[0],D.y+_[1]];Tn(e,B),k.push(B)}y.push(k)}if(e[2]-e[0]<=p/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of y)for(const k of E)sa(k,e,r,p)}var w;return y}class Vr{constructor(e,r){this.type=At,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Io(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let p=0;p<l.features.length;++p){const _=l.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Vr(l,l.features[p].geometry)}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Vr(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Vr(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(l.type==="Polygon"){const w=ks(l.coordinates,_,y),E=Ms(r.geometry(),p,_,y);if(!ra(p,_))return!1;for(const k of E)if(!Ti(k,w))return!1}if(l.type==="MultiPolygon"){const w=Va(l.coordinates,_,y),E=Ms(r.geometry(),p,_,y);if(!ra(p,_))return!1;for(const k of E)if(!Ho(k,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(l.type==="Polygon"){const w=ks(l.coordinates,_,y),E=Za(r.geometry(),p,_,y);if(!ra(p,_))return!1;for(const k of E)if(!Ua(k,w))return!1}if(l.type==="MultiPolygon"){const w=Va(l.coordinates,_,y),E=Za(r.geometry(),p,_,y);if(!ra(p,_))return!1;for(const k of E)if(!Is(k,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class aa{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new aa(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Sn{constructor(e,r,l,p){this.name=e,this.type=r,this._evaluate=l,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const l=e[0],p=Sn.definitions[l];if(!p)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=y.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let E=null;for(const[k,D]of w){E=new yi(r.registry,la,r.path,null,r.scope);const B=[];let N=!1;for(let Z=1;Z<e.length;Z++){const j=e[Z],Y=Array.isArray(k)?k[Z-1]:k.type,te=E.parse(j,1+B.length,Y);if(!te){N=!0;break}B.push(te)}if(!N)if(Array.isArray(k)&&k.length!==B.length)E.error(`Expected ${k.length} arguments, but found ${B.length} instead.`);else{for(let Z=0;Z<B.length;Z++){const j=Array.isArray(k)?k[Z]:k.type,Y=B[Z];E.concat(Z+1).checkSubtype(j,Y.type)}if(E.errors.length===0)return new Sn(l,_,D,B)}}if(w.length===1)r.errors.push(...E.errors);else{const k=(w.length?w:y).map(([B])=>{return N=B,Array.isArray(N)?`(${N.map(ai).join(", ")})`:`(${ai(N.type)}...)`;var N}).join(" | "),D=[];for(let B=1;B<e.length;B++){const N=r.parse(e[B],1+D.length);if(!N)return null;D.push(ai(N.type))}r.error(`Expected arguments of type ${k}, but found (${D.join(", ")}) instead.`)}return null}static register(e,r){Sn.definitions=r;for(const l in r)e[l]=Sn}}function la(i){if(i instanceof aa)return la(i.boundExpression);if(i instanceof Sn&&i.name==="error"||i instanceof ko||i instanceof Vr)return!1;const e=i instanceof bn||i instanceof qi;let r=!0;return i.eachChild(l=>{r=e?r&&la(l):r&&l instanceof yr}),!!r&&Lt(i)&&ni(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Lt(i){if(i instanceof Sn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Vr)return!1;let e=!0;return i.eachChild(r=>{e&&!Lt(r)&&(e=!1)}),e}function Ln(i){if(i instanceof Sn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Ln(r)&&(e=!1)}),e}function ni(i,e){if(i instanceof Sn&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(l=>{r&&!ni(l,e)&&(r=!1)}),r}function zs(i,e){const r=i.length-1;let l,p,_=0,y=r,w=0;for(;_<=y;)if(w=Math.floor((_+y)/2),l=i[w],p=i[w+1],l<=e){if(w===r||e<p)return w;_=w+1}else{if(!(l>e))throw new Tt("Input is not a number.");y=w-1}return 0}class Xo{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[p,_]of l)this.labels.push(p),this.outputs.push(_)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,je);if(!l)return null;const p=[];let _=null;r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let y=1;y<e.length;y+=2){const w=y===1?-1/0:e[y],E=e[y+1],k=y,D=y+1;if(typeof w!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(p.length&&p[p.length-1][0]>=w)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const B=r.parse(E,D,_);if(!B)return null;_=_||B.type,p.push([w,B])}return new Xo(_,l,p)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return l[0].evaluate(e);const _=r.length;return p>=r[_-1]?l[_-1].evaluate(e):l[zs(r,p)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function no(i,e,r){return i+r*(e-i)}function As(i,e,r){return i.map((l,p)=>no(l,e[p],r))}const Gi={number:no,color:function(i,e,r,l="rgb"){switch(l){case"rgb":{const[p,_,y,w]=As(i.rgb,e.rgb,r);return new xt(p,_,y,w,!1)}case"hcl":{const[p,_,y,w]=i.hcl,[E,k,D,B]=e.hcl;let N,Z;if(isNaN(p)||isNaN(E))isNaN(p)?isNaN(E)?N=NaN:(N=E,y!==1&&y!==0||(Z=k)):(N=p,D!==1&&D!==0||(Z=_));else{let ge=E-p;E>p&&ge>180?ge-=360:E<p&&p-E>180&&(ge+=360),N=p+r*ge}const[j,Y,te,ne]=function([ge,le,xe,Se]){return ge=isNaN(ge)?0:ge*de,ot([xe,Math.cos(ge)*le,Math.sin(ge)*le,Se])}([N,Z??no(_,k,r),no(y,D,r),no(w,B,r)]);return new xt(j,Y,te,ne,!1)}case"lab":{const[p,_,y,w]=ot(As(i.lab,e.lab,r));return new xt(p,_,y,w,!1)}}},array:As,padding:function(i,e,r){return new $n(As(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const l=i.values,p=e.values;if(l.length!==p.length)throw new Tt(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const _=[];for(let y=0;y<l.length;y+=2){if(l[y]!==p[y])throw new Tt(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${l[y]}, to[${y}]: ${p[y]}`);_.push(l[y]);const[w,E]=l[y+1],[k,D]=p[y+1];_.push([no(w,k,r),no(E,D,r)])}return new pn(_)}};class En{constructor(e,r,l,p,_){this.type=e,this.operator=r,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[y,w]of _)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,r,l,p){let _=0;if(e.name==="exponential")_=Ko(r,e.base,l,p);else if(e.name==="linear")_=Ko(r,1,l,p);else if(e.name==="cubic-bezier"){const y=e.controlPoints;_=new We(y[0],y[1],y[2],y[3]).solve(Ko(r,1,l,p))}return _}static parse(e,r){let[l,p,_,...y]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const k=p[1];if(typeof k!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:k}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const k=p.slice(1);if(k.length!==4||k.some(D=>typeof D!="number"||D<0||D>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(_=r.parse(_,2,je),!_)return null;const w=[];let E=null;l==="interpolate-hcl"||l==="interpolate-lab"?E=ln:r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType);for(let k=0;k<y.length;k+=2){const D=y[k],B=y[k+1],N=k+3,Z=k+4;if(typeof D!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(w.length&&w[w.length-1][0]>=D)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const j=r.parse(B,Z,E);if(!j)return null;E=E||j.type,w.push([D,j])}return U(E,je)||U(E,ln)||U(E,Co)||U(E,eo)||U(E,en(je))?new En(E,l,p,_,w):r.error(`Type ${ai(E)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return l[0].evaluate(e);const _=r.length;if(p>=r[_-1])return l[_-1].evaluate(e);const y=zs(r,p),w=En.interpolationFactor(this.interpolation,p,r[y],r[y+1]),E=l[y].evaluate(e),k=l[y+1].evaluate(e);switch(this.operator){case"interpolate":return Gi[this.type.kind](E,k,w);case"interpolate-hcl":return Gi.color(E,k,w,"hcl");case"interpolate-lab":return Gi.color(E,k,w,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ko(i,e,r,l){const p=l-r,_=i-r;return p===0?0:e===1?_/p:(Math.pow(e,_)-1)/(Math.pow(e,p)-1)}class Ni{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null;const p=r.expectedType;p&&p.kind!=="value"&&(l=p);const _=[];for(const w of e.slice(1)){const E=r.parse(w,1+_.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,_.push(E)}if(!l)throw new Error("No output type");const y=p&&_.some(w=>Ur(p,w.type));return new Ni(y?yt:l,_)}evaluate(e){let r,l=null,p=0;for(const _ of this.args)if(p++,l=_.evaluate(e),l&&l instanceof nr&&!l.available&&(r||(r=l.name),l=null,p===this.args.length&&(l=r)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class rr{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let _=1;_<e.length-1;_+=2){const y=e[_];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=r.parse(e[_+1],_+1);if(!w)return null;l.push([y,w])}const p=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return p?new rr(l,p):null}outputDefined(){return this.result.outputDefined()}}class Yo{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,je),p=r.parse(e[2],2,en(r.expectedType||yt));return l&&p?new Yo(p.type.itemType,l,p):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Tt(`Array index out of bounds: ${r} < 0.`);if(r>=l.length)throw new Tt(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r!==Math.floor(r))throw new Tt(`Array index must be an integer, but found ${r} instead.`);return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Wt{constructor(e,r){this.type=At,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,yt),p=r.parse(e[2],2,yt);return l&&p?J(l.type,[At,Mt,je,Po,yt])?new Wt(l,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ai(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!F(r,["boolean","string","number","null"]))throw new Tt(`Expected first argument to be of type boolean, string, number or null, but found ${ai(Ci(r))} instead.`);if(!F(l,["string","array"]))throw new Tt(`Expected second argument to be of type array or string, but found ${ai(Ci(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class $a{constructor(e,r,l){this.type=je,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,yt),p=r.parse(e[2],2,yt);if(!l||!p)return null;if(!J(l.type,[At,Mt,je,Po,yt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ai(l.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,je);return _?new $a(l,p,_):null}return new $a(l,p)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!F(r,["boolean","string","number","null"]))throw new Tt(`Expected first argument to be of type boolean, string, number or null, but found ${ai(Ci(r))} instead.`);if(!F(l,["string","array"]))throw new Tt(`Expected second argument to be of type array or string, but found ${ai(Ci(l))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return l.indexOf(r,p)}return l.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ja{constructor(e,r,l,p,_,y){this.inputType=e,this.type=r,this.input=l,this.cases=p,this.outputs=_,this.otherwise=y}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const _={},y=[];for(let k=2;k<e.length-1;k+=2){let D=e[k];const B=e[k+1];Array.isArray(D)||(D=[D]);const N=r.concat(k);if(D.length===0)return N.error("Expected at least one branch label.");for(const j of D){if(typeof j!="number"&&typeof j!="string")return N.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return N.error("Numeric branch labels must be integer values.");if(l){if(N.checkSubtype(l,Ci(j)))return null}else l=Ci(j);if(_[String(j)]!==void 0)return N.error("Branch labels must be unique.");_[String(j)]=y.length}const Z=r.parse(B,k,p);if(!Z)return null;p=p||Z.type,y.push(Z)}const w=r.parse(e[1],1,yt);if(!w)return null;const E=r.parse(e[e.length-1],e.length-1,p);return E?w.type.kind!=="value"&&r.concat(1).checkSubtype(l,w.type)?null:new ja(l,p,w,_,y,E):null}evaluate(e){const r=this.input.evaluate(e);return(Ci(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class ua{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const p=[];for(let y=1;y<e.length-1;y+=2){const w=r.parse(e[y],y,At);if(!w)return null;const E=r.parse(e[y+1],y+1,l);if(!E)return null;p.push([w,E]),l=l||E.type}const _=r.parse(e[e.length-1],e.length-1,l);if(!_)return null;if(!l)throw new Error("Can't infer output type");return new ua(l,p,_)}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class qa{constructor(e,r,l,p){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,yt),p=r.parse(e[2],2,je);if(!l||!p)return null;if(!J(l.type,[en(yt),Mt,yt]))return r.error(`Expected first argument to be of type array or string, but found ${ai(l.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,je);return _?new qa(l.type,l,p,_):null}return new qa(l.type,l,p)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!F(r,["string","array"]))throw new Tt(`Expected first argument to be of type array or string, but found ${ai(Ci(r))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return r.slice(l,p)}return r.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Vl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ht(i,e,r,l){return l.compare(e,r)===0}function Ls(i,e,r){const l=i!=="=="&&i!=="!=";return class C0{constructor(_,y,w){this.type=At,this.lhs=_,this.rhs=y,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");const w=_[0];let E=y.parse(_[1],1,yt);if(!E)return null;if(!Vl(w,E.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${ai(E.type)}'.`);let k=y.parse(_[2],2,yt);if(!k)return null;if(!Vl(w,k.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${ai(k.type)}'.`);if(E.type.kind!==k.type.kind&&E.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${ai(E.type)}' and '${ai(k.type)}'.`);l&&(E.type.kind==="value"&&k.type.kind!=="value"?E=new qi(k.type,[E]):E.type.kind!=="value"&&k.type.kind==="value"&&(k=new qi(E.type,[k])));let D=null;if(_.length===4){if(E.type.kind!=="string"&&k.type.kind!=="string"&&E.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(D=y.parse(_[3],3,Nr),!D)return null}return new C0(E,k,D)}evaluate(_){const y=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(l&&this.hasUntypedArgument){const E=Ci(y),k=Ci(w);if(E.kind!==k.kind||E.kind!=="string"&&E.kind!=="number")throw new Tt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${k.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=Ci(y),k=Ci(w);if(E.kind!=="string"||k.kind!=="string")return e(_,y,w)}return this.collator?r(_,y,w,this.collator.evaluate(_)):e(_,y,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const xr=Ls("==",function(i,e,r){return e===r},Ht),ca=Ls("!=",function(i,e,r){return e!==r},function(i,e,r,l){return!Ht(0,e,r,l)}),yu=Ls("<",function(i,e,r){return e<r},function(i,e,r,l){return l.compare(e,r)<0}),_c=Ls(">",function(i,e,r){return e>r},function(i,e,r,l){return l.compare(e,r)>0}),Zl=Ls("<=",function(i,e,r){return e<=r},function(i,e,r,l){return l.compare(e,r)<=0}),gc=Ls(">=",function(i,e,r){return e>=r},function(i,e,r,l){return l.compare(e,r)>=0});class Ga{constructor(e,r,l,p,_){this.type=Mt,this.number=e,this.locale=r,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,je);if(!l)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=r.parse(p.locale,1,Mt),!_))return null;let y=null;if(p.currency&&(y=r.parse(p.currency,1,Mt),!y))return null;let w=null;if(p["min-fraction-digits"]&&(w=r.parse(p["min-fraction-digits"],1,je),!w))return null;let E=null;return p["max-fraction-digits"]&&(E=r.parse(p["max-fraction-digits"],1,je),!E)?null:new Ga(l,_,y,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Wa{constructor(e){this.type=zn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const p=[];let _=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let E=null;if(w["font-scale"]&&(E=r.parse(w["font-scale"],1,je),!E))return null;let k=null;if(w["text-font"]&&(k=r.parse(w["text-font"],1,en(Mt)),!k))return null;let D=null;if(w["text-color"]&&(D=r.parse(w["text-color"],1,ln),!D))return null;const B=p[p.length-1];B.scale=E,B.font=k,B.textColor=D}else{const E=r.parse(e[y],1,yt);if(!E)return null;const k=E.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new Wa(p)}evaluate(e){return new ki(this.sections.map(r=>{const l=r.content.evaluate(e);return Ci(l)===ir?new Fi("",l,null,null,null):new Fi(to(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class $l{constructor(e){this.type=ir,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const l=r.parse(e[1],1,Mt);return l?new $l(l):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),l=nr.fromString(r);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(r)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class ha{constructor(e){this.type=je,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ai(l.type)} instead.`):new ha(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Tt(`Expected value to be of type string or array, but found ${ai(Ci(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ds={"==":xr,"!=":ca,">":_c,"<":yu,">=":gc,"<=":Zl,array:qi,at:Yo,boolean:qi,case:ua,coalesce:Ni,collator:ko,format:Wa,image:$l,in:Wt,"index-of":$a,interpolate:En,"interpolate-hcl":En,"interpolate-lab":En,length:ha,let:rr,literal:yr,match:ja,number:qi,"number-format":Ga,object:qi,slice:qa,step:Xo,string:qi,"to-boolean":bn,"to-color":bn,"to-number":bn,"to-string":bn,var:aa,within:Vr};function wr(i,[e,r,l,p]){e=e.evaluate(i),r=r.evaluate(i),l=l.evaluate(i);const _=p?p.evaluate(i):1,y=Fa(e,r,l,_);if(y)throw new Tt(y);return new xt(e/255,r/255,l/255,_,!1)}function vu(i,e){return i in e}function Ha(i,e){const r=e[i];return r===void 0?null:r}function Dn(i){return{type:i}}function jl(i){return{result:"success",value:i}}function Jo(i){return{result:"error",value:i}}function zo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function xu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Xa(i){return!!i.expression&&i.expression.interpolated}function Kt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ka(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function yc(i){return i}function Ya(i,e){const r=e.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",p=l||!(l||i.property!==void 0),_=i.type||(Xa(e)?"exponential":"interval");if(r||e.type==="padding"){const D=r?xt.parse:$n.parse;(i=an({},i)).stops&&(i.stops=i.stops.map(B=>[B[0],D(B[1])])),i.default=D(i.default?i.default:e.default)}if(i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;let w,E,k;if(_==="exponential")w=da;else if(_==="interval")w=bu;else if(_==="categorical"){w=wu,E=Object.create(null);for(const D of i.stops)E[D[0]]=D[1];k=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);w=es}if(l){const D={},B=[];for(let j=0;j<i.stops.length;j++){const Y=i.stops[j],te=Y[0].zoom;D[te]===void 0&&(D[te]={zoom:te,type:i.type,property:i.property,default:i.default,stops:[]},B.push(te)),D[te].stops.push([Y[0].value,Y[1]])}const N=[];for(const j of B)N.push([D[j].zoom,Ya(D[j],e)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:En.interpolationFactor.bind(void 0,Z),zoomStops:N.map(j=>j[0]),evaluate:({zoom:j},Y)=>da({stops:N,base:i.base},e,j).evaluate(j,Y)}}if(p){const D=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:En.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(B=>B[0]),evaluate:({zoom:B})=>w(i,e,B,E,k)}}return{kind:"source",evaluate(D,B){const N=B&&B.properties?B.properties[i.property]:void 0;return N===void 0?Qo(i.default,e.default):w(i,e,N,E,k)}}}function Qo(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function wu(i,e,r,l,p){return Qo(typeof r===p?l[r]:void 0,i.default,e.default)}function bu(i,e,r){if(Kt(r)!=="number")return Qo(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const p=zs(i.stops.map(_=>_[0]),r);return i.stops[p][1]}function da(i,e,r){const l=i.base!==void 0?i.base:1;if(Kt(r)!=="number")return Qo(i.default,e.default);const p=i.stops.length;if(p===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[p-1][0])return i.stops[p-1][1];const _=zs(i.stops.map(D=>D[0]),r),y=function(D,B,N,Z){const j=Z-N,Y=D-N;return j===0?0:B===1?Y/j:(Math.pow(B,Y)-1)/(Math.pow(B,j)-1)}(r,l,i.stops[_][0],i.stops[_+1][0]),w=i.stops[_][1],E=i.stops[_+1][1],k=Gi[e.type]||yc;return typeof w.evaluate=="function"?{evaluate(...D){const B=w.evaluate.apply(void 0,D),N=E.evaluate.apply(void 0,D);if(B!==void 0&&N!==void 0)return k(B,N,y,i.colorSpace)}}:k(w,E,y,i.colorSpace)}function es(i,e,r){switch(e.type){case"color":r=xt.parse(r);break;case"formatted":r=ki.fromString(r.toString());break;case"resolvedImage":r=nr.fromString(r.toString());break;case"padding":r=$n.parse(r);break;default:Kt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Qo(r,i.default,e.default)}Sn.register(Ds,{error:[{kind:"error"},[Mt],(i,[e])=>{throw new Tt(e.evaluate(i))}],typeof:[Mt,[yt],(i,[e])=>ai(Ci(e.evaluate(i)))],"to-rgba":[en(je,4),[ln],(i,[e])=>{const[r,l,p,_]=e.evaluate(i).rgb;return[255*r,255*l,255*p,_]}],rgb:[ln,[je,je,je],wr],rgba:[ln,[je,je,je,je],wr],has:{type:At,overloads:[[[Mt],(i,[e])=>vu(e.evaluate(i),i.properties())],[[Mt,gr],(i,[e,r])=>vu(e.evaluate(i),r.evaluate(i))]]},get:{type:yt,overloads:[[[Mt],(i,[e])=>Ha(e.evaluate(i),i.properties())],[[Mt,gr],(i,[e,r])=>Ha(e.evaluate(i),r.evaluate(i))]]},"feature-state":[yt,[Mt],(i,[e])=>Ha(e.evaluate(i),i.featureState||{})],properties:[gr,[],i=>i.properties()],"geometry-type":[Mt,[],i=>i.geometryType()],id:[yt,[],i=>i.id()],zoom:[je,[],i=>i.globals.zoom],"heatmap-density":[je,[],i=>i.globals.heatmapDensity||0],"line-progress":[je,[],i=>i.globals.lineProgress||0],accumulated:[yt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[je,Dn(je),(i,e)=>{let r=0;for(const l of e)r+=l.evaluate(i);return r}],"*":[je,Dn(je),(i,e)=>{let r=1;for(const l of e)r*=l.evaluate(i);return r}],"-":{type:je,overloads:[[[je,je],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[je],(i,[e])=>-e.evaluate(i)]]},"/":[je,[je,je],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[je,[je,je],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[je,[je],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[je,[je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[je,[je],(i,[e])=>Math.log(e.evaluate(i))],log2:[je,[je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[je,[je],(i,[e])=>Math.sin(e.evaluate(i))],cos:[je,[je],(i,[e])=>Math.cos(e.evaluate(i))],tan:[je,[je],(i,[e])=>Math.tan(e.evaluate(i))],asin:[je,[je],(i,[e])=>Math.asin(e.evaluate(i))],acos:[je,[je],(i,[e])=>Math.acos(e.evaluate(i))],atan:[je,[je],(i,[e])=>Math.atan(e.evaluate(i))],min:[je,Dn(je),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[je,Dn(je),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[je,[je],(i,[e])=>Math.abs(e.evaluate(i))],round:[je,[je],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[je,[je],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[je,[je],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[At,[Mt,yt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[At,[yt],(i,[e])=>i.id()===e.value],"filter-type-==":[At,[Mt],(i,[e])=>i.geometryType()===e.value],"filter-<":[At,[Mt,yt],(i,[e,r])=>{const l=i.properties()[e.value],p=r.value;return typeof l==typeof p&&l<p}],"filter-id-<":[At,[yt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[At,[Mt,yt],(i,[e,r])=>{const l=i.properties()[e.value],p=r.value;return typeof l==typeof p&&l>p}],"filter-id->":[At,[yt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[At,[Mt,yt],(i,[e,r])=>{const l=i.properties()[e.value],p=r.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[At,[yt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[At,[Mt,yt],(i,[e,r])=>{const l=i.properties()[e.value],p=r.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[At,[yt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[At,[yt],(i,[e])=>e.value in i.properties()],"filter-has-id":[At,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[At,[en(Mt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[At,[en(yt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[At,[Mt,en(yt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[At,[Mt,en(yt)],(i,[e,r])=>function(l,p,_,y){for(;_<=y;){const w=_+y>>1;if(p[w]===l)return!0;p[w]>l?y=w-1:_=w+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:At,overloads:[[[At,At],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Dn(At),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:At,overloads:[[[At,At],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Dn(At),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[At,[At],(i,[e])=>!e.evaluate(i)],"is-supported-script":[At,[Mt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Mt,[Mt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Mt,[Mt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Mt,Dn(yt),(i,e)=>e.map(r=>to(r.evaluate(i))).join("")],"resolved-locale":[Mt,[Nr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Si{constructor(e,r){var l;this.expression=e,this._warningHistory={},this._evaluator=new at,this._defaultValue=r?(l=r).type==="color"&&Ka(l.default)?new xt(0,0,0,0):l.type==="color"?xt.parse(l.default)||null:l.type==="padding"?$n.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?pn.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,l,p,_,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,p,_,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Tt(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Ao(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ds}function Et(i,e){const r=new yi(Ds,la,[],e?function(p){const _={color:ln,string:Mt,number:je,enum:Mt,boolean:At,formatted:zn,padding:Co,resolvedImage:ir,variableAnchorOffsetCollection:eo};return p.type==="array"?en(_[p.value]||yt,p.length):_[p.type]}(e):void 0),l=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?jl(new Si(l,e)):Jo(r.errors)}class Rs{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Ln(r.expression)}evaluateWithoutErrorHandling(e,r,l,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,p,_,y)}evaluate(e,r,l,p,_,y){return this._styleExpression.evaluate(e,r,l,p,_,y)}}class ui{constructor(e,r,l,p){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ln(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,l,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,p,_,y)}evaluate(e,r,l,p,_,y){return this._styleExpression.evaluate(e,r,l,p,_,y)}interpolationFactor(e,r,l){return this.interpolationType?En.interpolationFactor(this.interpolationType,e,r,l):0}}function pi(i,e){const r=Et(i,e);if(r.result==="error")return r;const l=r.value.expression,p=Lt(l);if(!p&&!zo(e))return Jo([new wn("","data expressions not supported")]);const _=ni(l,["zoom"]);if(!_&&!xu(e))return Jo([new wn("","zoom expressions not supported")]);const y=ts(l);return y||_?y instanceof wn?Jo([y]):y instanceof En&&!Xa(e)?Jo([new wn("",'"interpolate" expressions cannot be used with this property')]):jl(y?new ui(p?"camera":"composite",r.value,y.labels,y instanceof En?y.interpolation:void 0):new Rs(p?"constant":"source",r.value)):Jo([new wn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ro{constructor(e,r){this._parameters=e,this._specification=r,an(this,Ya(this._parameters,this._specification))}static deserialize(e){return new ro(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ts(i){let e=null;if(i instanceof rr)e=ts(i.result);else if(i instanceof Ni){for(const r of i.args)if(e=ts(r),e)break}else(i instanceof Xo||i instanceof En)&&i.input instanceof Sn&&i.input.name==="zoom"&&(e=i);return e instanceof wn||i.eachChild(r=>{const l=ts(r);l instanceof wn?e=l:!e&&l?e=new wn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new wn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ql(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ql(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const vc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ja(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ql(i)||(i=Zr(i));const e=Et(i,vc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,l,p)=>e.value.evaluate(r,l,{},p),needGeometry:jn(i)}}function xc(i,e){return i<e?-1:i>e?1:0}function jn(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(jn(i[e]))return!0;return!1}function Zr(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Qa(i[1],i[2],"=="):e==="!="?oo(Qa(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Qa(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Zr))):e==="all"?["all"].concat(i.slice(1).map(Zr)):e==="none"?["all"].concat(i.slice(1).map(Zr).map(oo)):e==="in"?br(i[1],i.slice(2)):e==="!in"?oo(br(i[1],i.slice(2))):e==="has"?el(i[1]):e==="!has"?oo(el(i[1])):e!=="within"||i;var r}function Qa(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function br(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(xc)]]:["filter-in-small",i,["literal",e]]}}function el(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function oo(i){return["!",i]}function Gl(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let p="[";for(const _ of i)p+=`${Gl(_)},`;return`${p}]`}const r=Object.keys(i).sort();let l="{";for(let p=0;p<r.length;p++)l+=`${JSON.stringify(r[p])}:${Gl(i[r[p]])},`;return`${l}}`}function pa(i){let e="";for(const r of Qr)e+=`/${Gl(i[r])}`;return e}function Wl(i){const e=i.value;return e?[new qe(i.key,e,"constants have been deprecated as of v8")]:[]}function vi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function is(i){if(Array.isArray(i))return i.map(is);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=is(i[r]);return e}return vi(i)}function Wi(i){const e=i.key,r=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},_=i.style,y=i.styleSpec,w=i.validateSpec;let E=[];const k=Kt(r);if(k!=="object")return[new qe(e,r,`object expected, ${k} found`)];for(const D in r){const B=D.split(".")[0],N=l[B]||l["*"];let Z;if(p[B])Z=p[B];else if(l[B])Z=w;else if(p["*"])Z=p["*"];else{if(!l["*"]){E.push(new qe(e,r[D],`unknown property "${D}"`));continue}Z=w}E=E.concat(Z({key:(e&&`${e}.`)+D,value:r[D],valueSpec:N,style:_,styleSpec:y,object:r,objectKey:D,validateSpec:w},r))}for(const D in l)p[D]||l[D].required&&l[D].default===void 0&&r[D]===void 0&&E.push(new qe(e,r,`missing required property "${D}"`));return E}function Bs(i){const e=i.value,r=i.valueSpec,l=i.style,p=i.styleSpec,_=i.key,y=i.arrayElementValidator||i.validateSpec;if(Kt(e)!=="array")return[new qe(_,e,`array expected, ${Kt(e)} found`)];if(r.length&&e.length!==r.length)return[new qe(_,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new qe(_,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let w={type:r.value,values:r.values};p.$version<7&&(w.function=r.function),Kt(r.value)==="object"&&(w=r.value);let E=[];for(let k=0;k<e.length;k++)E=E.concat(y({array:e,arrayIndex:k,value:e[k],valueSpec:w,validateSpec:i.validateSpec,style:l,styleSpec:p,key:`${_}[${k}]`}));return E}function tl(i){const e=i.key,r=i.value,l=i.valueSpec;let p=Kt(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new qe(e,r,`number expected, ${p} found`)]:"minimum"in l&&r<l.minimum?[new qe(e,r,`${r} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&r>l.maximum?[new qe(e,r,`${r} is greater than the maximum value ${l.maximum}`)]:[]}function fa(i){const e=i.valueSpec,r=vi(i.value.type);let l,p,_,y={};const w=r!=="categorical"&&i.value.property===void 0,E=!w,k=Kt(i.value.stops)==="array"&&Kt(i.value.stops[0])==="array"&&Kt(i.value.stops[0][0])==="object",D=Wi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(r==="identity")return[new qe(Z.key,Z.value,'identity function may not have a "stops" property')];let j=[];const Y=Z.value;return j=j.concat(Bs({key:Z.key,value:Y,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:B})),Kt(Y)==="array"&&Y.length===0&&j.push(new qe(Z.key,Y,"array must have at least one stop")),j},default:function(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:e,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}});return r==="identity"&&w&&D.push(new qe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||D.push(new qe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Xa(i.valueSpec)&&D.push(new qe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!zo(i.valueSpec)?D.push(new qe(i.key,i.value,"property functions not supported")):w&&!xu(i.valueSpec)&&D.push(new qe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!k||i.value.property!==void 0||D.push(new qe(i.key,i.value,'"property" property is required')),D;function B(Z){let j=[];const Y=Z.value,te=Z.key;if(Kt(Y)!=="array")return[new qe(te,Y,`array expected, ${Kt(Y)} found`)];if(Y.length!==2)return[new qe(te,Y,`array length 2 expected, length ${Y.length} found`)];if(k){if(Kt(Y[0])!=="object")return[new qe(te,Y,`object expected, ${Kt(Y[0])} found`)];if(Y[0].zoom===void 0)return[new qe(te,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new qe(te,Y,"object stop key must have value")];if(_&&_>vi(Y[0].zoom))return[new qe(te,Y[0].zoom,"stop zoom values must appear in ascending order")];vi(Y[0].zoom)!==_&&(_=vi(Y[0].zoom),p=void 0,y={}),j=j.concat(Wi({key:`${te}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:tl,value:N}}))}else j=j.concat(N({key:`${te}[0]`,value:Y[0],valueSpec:{},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},Y));return Ao(is(Y[1]))?j.concat([new qe(`${te}[1]`,Y[1],"expressions are not allowed in function stops.")]):j.concat(Z.validateSpec({key:`${te}[1]`,value:Y[1],valueSpec:e,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function N(Z,j){const Y=Kt(Z.value),te=vi(Z.value),ne=Z.value!==null?Z.value:j;if(l){if(Y!==l)return[new qe(Z.key,ne,`${Y} stop domain type must match previous stop domain type ${l}`)]}else l=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new qe(Z.key,ne,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&r!=="categorical"){let ge=`number expected, ${Y} found`;return zo(e)&&r===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(Z.key,ne,ge)]}return r!=="categorical"||Y!=="number"||isFinite(te)&&Math.floor(te)===te?r!=="categorical"&&Y==="number"&&p!==void 0&&te<p?[new qe(Z.key,ne,"stop domain values must appear in ascending order")]:(p=te,r==="categorical"&&te in y?[new qe(Z.key,ne,"stop domain values must be unique")]:(y[te]=!0,[])):[new qe(Z.key,ne,`integer expected, found ${te}`)]}}function so(i){const e=(i.expressionContext==="property"?pi:Et)(is(i.value),i.valueSpec);if(e.result==="error")return e.value.map(l=>new qe(`${i.key}${l.key}`,i.value,l.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new qe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ln(r))return[new qe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ln(r))return[new qe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ni(r,["zoom","feature-state"]))return[new qe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Lt(r))return[new qe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qn(i){const e=i.key,r=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(vi(r))===-1&&p.push(new qe(e,r,`expected one of [${l.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(l.values).indexOf(vi(r))===-1&&p.push(new qe(e,r,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function il(i){return ql(is(i.value))?so(an({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ns(i)}function ns(i){const e=i.value,r=i.key;if(Kt(e)!=="array")return[new qe(r,e,`array expected, ${Kt(e)} found`)];const l=i.styleSpec;let p,_=[];if(e.length<1)return[new qe(r,e,"filter array must have at least 1 element")];switch(_=_.concat(qn({key:`${r}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),vi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&vi(e[1])==="$type"&&_.push(new qe(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new qe(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Kt(e[1]),p!=="string"&&_.push(new qe(`${r}[1]`,e[1],`string expected, ${p} found`)));for(let y=2;y<e.length;y++)p=Kt(e[y]),vi(e[1])==="$type"?_=_.concat(qn({key:`${r}[${y}]`,value:e[y],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new qe(`${r}[${y}]`,e[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)_=_.concat(ns({key:`${r}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Kt(e[1]),e.length!==2?_.push(new qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new qe(`${r}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=Kt(e[1]),e.length!==2?_.push(new qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="object"&&_.push(new qe(`${r}[1]`,e[1],`object expected, ${p} found`))}return _}function nl(i,e){const r=i.key,l=i.validateSpec,p=i.style,_=i.styleSpec,y=i.value,w=i.objectKey,E=_[`${e}_${i.layerType}`];if(!E)return[];const k=w.match(/^(.*)-transition$/);if(e==="paint"&&k&&E[k[1]]&&E[k[1]].transition)return l({key:r,value:y,valueSpec:_.transition,style:p,styleSpec:_});const D=i.valueSpec||E[w];if(!D)return[new qe(r,y,`unknown property "${w}"`)];let B;if(Kt(y)==="string"&&zo(D)&&!D.tokens&&(B=/^{([^}]+)}$/.exec(y)))return[new qe(r,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const N=[];return i.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&N.push(new qe(r,y,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Ka(is(y))&&vi(y.type)==="identity"&&N.push(new qe(r,y,'"text-font" does not support identity functions'))),N.concat(l({key:i.key,value:y,valueSpec:D,style:p,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:w}))}function Gn(i){return nl(i,"paint")}function rs(i){return nl(i,"layout")}function ma(i){let e=[];const r=i.value,l=i.key,p=i.style,_=i.styleSpec;r.type||r.ref||e.push(new qe(l,r,'either "type" or "ref" is required'));let y=vi(r.type);const w=vi(r.ref);if(r.id){const E=vi(r.id);for(let k=0;k<i.arrayIndex;k++){const D=p.layers[k];vi(D.id)===E&&e.push(new qe(l,r.id,`duplicate layer id "${r.id}", previously used at line ${D.id.__line__}`))}}if("ref"in r){let E;["type","source","source-layer","filter","layout"].forEach(k=>{k in r&&e.push(new qe(l,r[k],`"${k}" is prohibited for ref layers`))}),p.layers.forEach(k=>{vi(k.id)===w&&(E=k)}),E?E.ref?e.push(new qe(l,r.ref,"ref cannot reference another ref layer")):y=vi(E.type):e.push(new qe(l,r.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(r.source){const E=p.sources&&p.sources[r.source],k=E&&vi(E.type);E?k==="vector"&&y==="raster"?e.push(new qe(l,r.source,`layer "${r.id}" requires a raster source`)):k==="raster"&&y!=="raster"?e.push(new qe(l,r.source,`layer "${r.id}" requires a vector source`)):k!=="vector"||r["source-layer"]?k==="raster-dem"&&y!=="hillshade"?e.push(new qe(l,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||k==="geojson"&&E.lineMetrics||e.push(new qe(l,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new qe(l,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new qe(l,r.source,`source "${r.source}" not found`))}else e.push(new qe(l,r,'missing required property "source"'));return e=e.concat(Wi({key:l,value:r,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:r.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:il,layout:E=>Wi({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":k=>rs(an({layerType:y},k))}}),paint:E=>Wi({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":k=>Gn(an({layerType:y},k))}})}})),e}function ao(i){const e=i.value,r=i.key,l=Kt(e);return l!=="string"?[new qe(r,e,`string expected, ${l} found`)]:[]}const Lo={promoteId:function({key:i,value:e}){if(Kt(e)==="string")return ao({key:i,value:e});{const r=[];for(const l in e)r.push(...ao({key:`${i}.${l}`,value:e[l]}));return r}}};function rl(i){const e=i.value,r=i.key,l=i.styleSpec,p=i.style,_=i.validateSpec;if(!e.type)return[new qe(r,e,'"type" is required')];const y=vi(e.type);let w;switch(y){case"vector":case"raster":case"raster-dem":return w=Wi({key:r,value:e,valueSpec:l[`source_${y.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Lo,validateSpec:_}),w;case"geojson":if(w=Wi({key:r,value:e,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:_,objectElementValidators:Lo}),e.cluster)for(const E in e.clusterProperties){const[k,D]=e.clusterProperties[E],B=typeof k=="string"?[k,["accumulated"],["get",E]]:k;w.push(...so({key:`${r}.${E}.map`,value:D,validateSpec:_,expressionContext:"cluster-map"})),w.push(...so({key:`${r}.${E}.reduce`,value:B,validateSpec:_,expressionContext:"cluster-reduce"}))}return w;case"video":return Wi({key:r,value:e,valueSpec:l.source_video,style:p,validateSpec:_,styleSpec:l});case"image":return Wi({key:r,value:e,valueSpec:l.source_image,style:p,validateSpec:_,styleSpec:l});case"canvas":return[new qe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qn({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,validateSpec:_,styleSpec:l})}}function _a(i){const e=i.value,r=i.styleSpec,l=r.light,p=i.style;let _=[];const y=Kt(e);if(e===void 0)return _;if(y!=="object")return _=_.concat([new qe("light",e,`object expected, ${y} found`)]),_;for(const w in e){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&l[E[1]]&&l[E[1]].transition?i.validateSpec({key:w,value:e[w],valueSpec:r.transition,validateSpec:i.validateSpec,style:p,styleSpec:r}):l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:i.validateSpec,style:p,styleSpec:r}):[new qe(w,e[w],`unknown property "${w}"`)])}return _}function os(i){const e=i.value,r=i.styleSpec,l=r.terrain,p=i.style;let _=[];const y=Kt(e);if(e===void 0)return _;if(y!=="object")return _=_.concat([new qe("terrain",e,`object expected, ${y} found`)]),_;for(const w in e)_=_.concat(l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:i.validateSpec,style:p,styleSpec:r}):[new qe(w,e[w],`unknown property "${w}"`)]);return _}function ga(i){let e=[];const r=i.value,l=i.key;if(Array.isArray(r)){const p=[],_=[];for(const y in r)r[y].id&&p.includes(r[y].id)&&e.push(new qe(l,r,`all the sprites' ids must be unique, but ${r[y].id} is duplicated`)),p.push(r[y].id),r[y].url&&_.includes(r[y].url)&&e.push(new qe(l,r,`all the sprites' URLs must be unique, but ${r[y].url} is duplicated`)),_.push(r[y].url),e=e.concat(Wi({key:`${l}[${y}]`,value:r[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return ao({key:l,value:r})}const ol={"*":()=>[],array:Bs,boolean:function(i){const e=i.value,r=i.key,l=Kt(e);return l!=="boolean"?[new qe(r,e,`boolean expected, ${l} found`)]:[]},number:tl,color:function(i){const e=i.key,r=i.value,l=Kt(r);return l!=="string"?[new qe(e,r,`color expected, ${l} found`)]:xt.parse(String(r))?[]:[new qe(e,r,`color expected, "${r}" found`)]},constants:Wl,enum:qn,filter:il,function:fa,layer:ma,object:Wi,source:rl,light:_a,terrain:os,string:ao,formatted:function(i){return ao(i).length===0?[]:so(i)},resolvedImage:function(i){return ao(i).length===0?[]:so(i)},padding:function(i){const e=i.key,r=i.value;if(Kt(r)==="array"){if(r.length<1||r.length>4)return[new qe(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const l={type:"number"};let p=[];for(let _=0;_<r.length;_++)p=p.concat(i.validateSpec({key:`${e}[${_}]`,value:r[_],validateSpec:i.validateSpec,valueSpec:l}));return p}return tl({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,l=Kt(r),p=i.styleSpec;if(l!=="array"||r.length<1||r.length%2!=0)return[new qe(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let y=0;y<r.length;y+=2)_=_.concat(qn({key:`${e}[${y}]`,value:r[y],valueSpec:p.layout_symbol["text-anchor"]})),_=_.concat(Bs({key:`${e}[${y+1}]`,value:r[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:p}));return _},sprite:ga};function lo(i){const e=i.value,r=i.valueSpec,l=i.styleSpec;return i.validateSpec=lo,r.expression&&Ka(vi(e))?fa(i):r.expression&&Ao(is(e))?so(i):r.type&&ol[r.type]?ol[r.type](i):Wi(an({},i,{valueSpec:r.type?l[r.type]:r}))}function ya(i){const e=i.value,r=i.key,l=ao(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new qe(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new qe(r,e,'"glyphs" url must include a "{range}" token'))),l}function xi(i,e=Ie){let r=[];return r=r.concat(lo({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:lo,objectElementValidators:{glyphs:ya,"*":()=>[]}})),i.constants&&(r=r.concat(Wl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:lo}))),Hl(r)}function or(i){return function(e){return i({...e,validateSpec:lo})}}function Hl(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function uo(i){return function(...e){return Hl(i.apply(this,e))}}xi.source=uo(or(rl)),xi.sprite=uo(or(ga)),xi.glyphs=uo(or(ya)),xi.light=uo(or(_a)),xi.terrain=uo(or(os)),xi.layer=uo(or(ma)),xi.filter=uo(or(il)),xi.paintProperty=uo(or(Gn)),xi.layoutProperty=uo(or(rs));const Os=xi,va=Os.light,$r=Os.paintProperty,Fs=Os.layoutProperty;function Tu(i,e){let r=!1;if(e&&e.length)for(const l of e)i.fire(new er(new Error(l.message))),r=!0;return r}class jr{constructor(e,r,l){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(r=y[1])+2*(l=y[2]);for(let E=0;E<this.d*this.d;E++){const k=y[3+E],D=y[3+E+1];p.push(k===D?null:y.subarray(k,D))}const w=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=r+2*l;for(let y=0;y<this.d*this.d;y++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=l,this.scale=r/e,this.uid=0;const _=l/r*e;this.min=-_,this.max=e+_}insert(e,r,l,p,_){this._forEachCell(r,l,p,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,l,p,_,y){this.cells[_].push(y)}query(e,r,l,p,_){const y=this.min,w=this.max;if(e<=y&&r<=y&&w<=l&&w<=p&&!_)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(e,r,l,p,this._queryCell,E,{},_),E}}_queryCell(e,r,l,p,_,y,w,E){const k=this.cells[_];if(k!==null){const D=this.keys,B=this.bboxes;for(let N=0;N<k.length;N++){const Z=k[N];if(w[Z]===void 0){const j=4*Z;(E?E(B[j+0],B[j+1],B[j+2],B[j+3]):e<=B[j+2]&&r<=B[j+3]&&l>=B[j+0]&&p>=B[j+1])?(w[Z]=!0,y.push(D[Z])):w[Z]=!1}}}}_forEachCell(e,r,l,p,_,y,w,E){const k=this._convertToCellCoord(e),D=this._convertToCellCoord(r),B=this._convertToCellCoord(l),N=this._convertToCellCoord(p);for(let Z=k;Z<=B;Z++)for(let j=D;j<=N;j++){const Y=this.d*j+Z;if((!E||E(this._convertFromCellCoord(Z),this._convertFromCellCoord(j),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(j+1)))&&_.call(this,e,r,l,p,Y,y,w,E))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let l=0;for(let y=0;y<this.cells.length;y++)l+=this.cells[y].length;const p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let _=r;for(let y=0;y<e.length;y++){const w=e[y];p[3+y]=_,p.set(w,_),_+=w.length}return p[3+e.length]=_,p.set(this.keys,_),_+=this.keys.length,p[3+e.length+1]=_,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer}static serialize(e,r){const l=e.toArrayBuffer();return r&&r.push(l),{buffer:l}}static deserialize(e){return new jr(e.buffer)}}const Do={};function Qe(i,e,r={}){if(Do[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Do[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Qe("Object",Object),Qe("TransferableGridIndex",jr),Qe("Color",xt),Qe("Error",Error),Qe("AJAXError",St),Qe("ResolvedImage",nr),Qe("StylePropertyFunction",ro),Qe("StyleExpression",Si,{omit:["_evaluator"]}),Qe("ZoomDependentExpression",ui),Qe("ZoomConstantExpression",Rs),Qe("CompoundExpression",Sn,{omit:["_evaluate"]});for(const i in Ds)Ds[i]._classRegistryKey||Qe(`Expression_${i}`,Ds[i]);function Su(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Tr(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Su(i)||Rr(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const l of i)r.push(Tr(l,e));return r}if(typeof i=="object"){const r=i.constructor,l=r._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");if(!Do[l])throw new Error(`${l} is not registered.`);const p=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||Do[l].omit.indexOf(_)>=0)continue;const y=i[_];p[_]=Do[l].shallow.indexOf(_)>=0?y:Tr(y,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(p.$name=l),p}throw new Error("can't serialize object of type "+typeof i)}function Ns(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Su(i)||Rr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Ns);if(typeof i=="object"){const e=i.$name||"Object";if(!Do[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Do[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const l=Object.create(r.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const _=i[p];l[p]=Do[e].shallow.indexOf(p)>=0?_:Ns(_)}return l}throw new Error("can't deserialize object of type "+typeof i)}class co{constructor(){this.first=!0}update(e,r){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}const Ye={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function xa(i){for(const e of i)if(ss(e.charCodeAt(0)))return!0;return!1}function wc(i){for(const e of i)if(!Sr(e.charCodeAt(0)))return!1;return!0}function Sr(i){return!(Ye.Arabic(i)||Ye["Arabic Supplement"](i)||Ye["Arabic Extended-A"](i)||Ye["Arabic Presentation Forms-A"](i)||Ye["Arabic Presentation Forms-B"](i))}function ss(i){return!(i!==746&&i!==747&&(i<4352||!(Ye["Bopomofo Extended"](i)||Ye.Bopomofo(i)||Ye["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ye["CJK Compatibility Ideographs"](i)||Ye["CJK Compatibility"](i)||Ye["CJK Radicals Supplement"](i)||Ye["CJK Strokes"](i)||!(!Ye["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ye["CJK Unified Ideographs Extension A"](i)||Ye["CJK Unified Ideographs"](i)||Ye["Enclosed CJK Letters and Months"](i)||Ye["Hangul Compatibility Jamo"](i)||Ye["Hangul Jamo Extended-A"](i)||Ye["Hangul Jamo Extended-B"](i)||Ye["Hangul Jamo"](i)||Ye["Hangul Syllables"](i)||Ye.Hiragana(i)||Ye["Ideographic Description Characters"](i)||Ye.Kanbun(i)||Ye["Kangxi Radicals"](i)||Ye["Katakana Phonetic Extensions"](i)||Ye.Katakana(i)&&i!==12540||!(!Ye["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ye["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ye["Unified Canadian Aboriginal Syllabics"](i)||Ye["Unified Canadian Aboriginal Syllabics Extended"](i)||Ye["Vertical Forms"](i)||Ye["Yijing Hexagram Symbols"](i)||Ye["Yi Syllables"](i)||Ye["Yi Radicals"](i))))}function sl(i){return!(ss(i)||function(e){return!!(Ye["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ye["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ye["Letterlike Symbols"](e)||Ye["Number Forms"](e)||Ye["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ye["Control Pictures"](e)&&e!==9251||Ye["Optical Character Recognition"](e)||Ye["Enclosed Alphanumerics"](e)||Ye["Geometric Shapes"](e)||Ye["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ye["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ye["CJK Symbols and Punctuation"](e)||Ye.Katakana(e)||Ye["Private Use Area"](e)||Ye["CJK Compatibility Forms"](e)||Ye["Small Form Variants"](e)||Ye["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Us(i){return i>=1424&&i<=2303||Ye["Arabic Presentation Forms-A"](i)||Ye["Arabic Presentation Forms-B"](i)}function Eu(i,e){return!(!e&&Us(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ye.Khmer(i))}function al(i){for(const e of i)if(Us(e.charCodeAt(0)))return!0;return!1}const ho="deferred",ll="loading",ul="loaded";let Xl=null,Pn="unavailable",qr=null;const Kl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Pn="error"),Xl&&Xl(i)};function cl(){hl.fire(new Mn("pluginStateChange",{pluginStatus:Pn,pluginURL:qr}))}const hl=new tr,Yl=function(){return Pn},Jl=function(){if(Pn!==ho||!qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pn=ll,cl(),qr&&zt({url:qr},i=>{i?Kl(i):(Pn=ul,cl())})},Wn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pn===ul||Wn.applyArabicShaping!=null,isLoading:()=>Pn===ll,setState(i){if(!ri())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Pn=i.pluginStatus,qr=i.pluginURL},isParsed(){if(!ri())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Wn.applyArabicShaping!=null&&Wn.processBidirectionalText!=null&&Wn.processStyledBidirectionalText!=null},getPluginURL(){if(!ri())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return qr}};class fi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new co,this.transition={})}isSupportedScript(e){return function(r,l){for(const p of r)if(!Eu(p.charCodeAt(0),l))return!1;return!0}(e,Wn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*r}}}class o{constructor(e,r){this.property=e,this.value=r,this.expression=function(l,p){if(Ka(l))return new ro(l,p);if(Ao(l)){const _=pi(l,p);if(_.result==="error")throw new Error(_.value.map(y=>`${y.key}: ${y.message}`).join(", "));return _.value}{let _=l;return p.type==="color"&&typeof l=="string"?_=xt.parse(l):p.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(_=pn.parse(l)):_=$n.parse(l),{kind:"constant",evaluate:()=>_}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l){return this.property.possiblyEvaluate(this,e,r,l)}}class d{constructor(e){this.property=e,this.value=new o(e,void 0)}transitioned(e,r){return new P(this.property,this.value,r,ye({},e.transition,this.transition),e.now)}untransitioned(){return new P(this.property,this.value,null,{},0)}}class x{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return rt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new d(this._values[e].property)),this._values[e].value=new o(this._values[e].property,r===null?void 0:rt(r))}getTransition(e){return rt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new d(this._values[e].property)),this._values[e].transition=rt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){const l=new z(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(e,r._values[p]);return l}untransitioned(){const e=new z(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class P{constructor(e,r,l,p,_){this.property=e,this.value=r,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const p=e.now||0,_=this.value.possiblyEvaluate(e,r,l),y=this.prior;if(y){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return y.possiblyEvaluate(e,r,l);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,r,l),_,function(E){if(E<=0)return 0;if(E>=1)return 1;const k=E*E,D=k*E;return 4*(E<.5?D:3*(E-k)+D-.75)}(w))}}return _}}class z{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const p=new we(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,r,l);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ${constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return rt(this._values[e].value)}setValue(e,r){this._values[e]=new o(this._values[e].property,r===null?void 0:rt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l){const p=new we(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,r,l);return p}}class oe{constructor(e,r,l){this.property=e,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,p){return this.property.evaluate(this.value,this.parameters,e,r,l,p)}}class we{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ce{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,l){const p=Gi[this.specification.type];return p?p(e,r,l):e}}class Te{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,p){return new oe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},l,p)}:e.expression,r)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new oe(this,{kind:"constant",value:void 0},e.parameters);const p=Gi[this.specification.type];if(p){const _=p(e.value.value,r.value.value,l);return new oe(this,{kind:"constant",value:_},e.parameters)}return e}evaluate(e,r,l,p,_,y){return e.kind==="constant"?e.value:e.evaluate(r,l,p,_,y)}}class it extends Te{possiblyEvaluate(e,r,l,p){if(e.value===void 0)return new oe(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const _=e.expression.evaluate(r,null,{},l,p),y=e.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,w=this._calculate(y,y,y,r);return new oe(this,{kind:"constant",value:w},r)}if(e.expression.kind==="camera"){const _=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new oe(this,{kind:"constant",value:_},r)}return new oe(this,e.expression,r)}evaluate(e,r,l,p,_,y){if(e.kind==="source"){const w=e.evaluate(r,l,p,_,y);return this._calculate(w,w,w,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},l,p),e.evaluate({zoom:Math.floor(r.zoom)},l,p),e.evaluate({zoom:Math.floor(r.zoom)+1},l,p),r):e.value}_calculate(e,r,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Pt{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const _=e.expression.evaluate(r,null,{},l,p);return this._calculate(_,_,_,r)}return this._calculate(e.expression.evaluate(new fi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new fi(Math.floor(r.zoom),r)),e.expression.evaluate(new fi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Ft{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,p){return!!e.expression.evaluate(r,null,{},l,p)}interpolate(){return!1}}class Yt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const l=e[r];l.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new o(l,void 0),_=this.defaultTransitionablePropertyValues[r]=new d(l);this.defaultTransitioningPropertyValues[r]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}Qe("DataDrivenProperty",Te),Qe("DataConstantProperty",ce),Qe("CrossFadedDataDrivenProperty",it),Qe("CrossFadedProperty",Pt),Qe("ColorRampProperty",Ft);const Hi="-transition";class Mi extends tr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new $(r.layout)),r.paint)){this._transitionablePaint=new x(r.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new we(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,l={}){r!=null&&this._validate(Fs,`layers.${this.id}.layout.${e}`,e,r,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Hi)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,l={}){if(r!=null&&this._validate($r,`layers.${this.id}.paint.${e}`,e,r,l))return!1;if(e.endsWith(Hi))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const p=this._transitionablePaint._values[e],_=p.property.specification["property-type"]==="cross-faded-data-driven",y=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(e,w,E)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ht(e,(r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length))}_validate(e,r,l,p,_={}){return(!_||_.validate!==!1)&&Tu(this,e.call(Os,{key:r,layerType:this.type,objectKey:l,value:p,styleSpec:Ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof oe&&zo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Rn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Er{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ei{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function zi(i,e=1){let r=0,l=0;return{members:i.map(p=>{const _=Rn[p.type].BYTES_PER_ELEMENT,y=r=po(r,Math.max(e,_)),w=p.components||1;return l=Math.max(l,_),r+=_*w,{name:p.name,type:p.type,components:w,offset:y}}),size:po(r,Math.max(l,e)),alignment:e}}function po(i,e){return Math.ceil(i/e)*e}class as extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const p=2*e;return this.int16[p+0]=r,this.int16[p+1]=l,e}}as.prototype.bytesPerElement=4,Qe("StructArrayLayout2i4",as);class Vs extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l)}emplace(e,r,l,p){const _=3*e;return this.int16[_+0]=r,this.int16[_+1]=l,this.int16[_+2]=p,e}}Vs.prototype.bytesPerElement=6,Qe("StructArrayLayout3i6",Vs);class wa extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,p)}emplace(e,r,l,p,_){const y=4*e;return this.int16[y+0]=r,this.int16[y+1]=l,this.int16[y+2]=p,this.int16[y+3]=_,e}}wa.prototype.bytesPerElement=8,Qe("StructArrayLayout4i8",wa);class wi extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,l,p,_,y)}emplace(e,r,l,p,_,y,w){const E=6*e;return this.int16[E+0]=r,this.int16[E+1]=l,this.int16[E+2]=p,this.int16[E+3]=_,this.int16[E+4]=y,this.int16[E+5]=w,e}}wi.prototype.bytesPerElement=12,Qe("StructArrayLayout2i4i12",wi);class Zs extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,l,p,_,y)}emplace(e,r,l,p,_,y,w){const E=4*e,k=8*e;return this.int16[E+0]=r,this.int16[E+1]=l,this.uint8[k+4]=p,this.uint8[k+5]=_,this.uint8[k+6]=y,this.uint8[k+7]=w,e}}Zs.prototype.bytesPerElement=8,Qe("StructArrayLayout2i4ub8",Zs);class Ro extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const p=2*e;return this.float32[p+0]=r,this.float32[p+1]=l,e}}Ro.prototype.bytesPerElement=8,Qe("StructArrayLayout2f8",Ro);class ls extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y,w,E,k,D){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,l,p,_,y,w,E,k,D)}emplace(e,r,l,p,_,y,w,E,k,D,B){const N=10*e;return this.uint16[N+0]=r,this.uint16[N+1]=l,this.uint16[N+2]=p,this.uint16[N+3]=_,this.uint16[N+4]=y,this.uint16[N+5]=w,this.uint16[N+6]=E,this.uint16[N+7]=k,this.uint16[N+8]=D,this.uint16[N+9]=B,e}}ls.prototype.bytesPerElement=20,Qe("StructArrayLayout10ui20",ls);class Ql extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y,w,E,k,D,B,N){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,r,l,p,_,y,w,E,k,D,B,N)}emplace(e,r,l,p,_,y,w,E,k,D,B,N,Z){const j=12*e;return this.int16[j+0]=r,this.int16[j+1]=l,this.int16[j+2]=p,this.int16[j+3]=_,this.uint16[j+4]=y,this.uint16[j+5]=w,this.uint16[j+6]=E,this.uint16[j+7]=k,this.int16[j+8]=D,this.int16[j+9]=B,this.int16[j+10]=N,this.int16[j+11]=Z,e}}Ql.prototype.bytesPerElement=24,Qe("StructArrayLayout4i4ui4i24",Ql);class $s extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l)}emplace(e,r,l,p){const _=3*e;return this.float32[_+0]=r,this.float32[_+1]=l,this.float32[_+2]=p,e}}$s.prototype.bytesPerElement=12,Qe("StructArrayLayout3f12",$s);class Bo extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Bo.prototype.bytesPerElement=4,Qe("StructArrayLayout1ul4",Bo);class eu extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y,w,E,k){const D=this.length;return this.resize(D+1),this.emplace(D,e,r,l,p,_,y,w,E,k)}emplace(e,r,l,p,_,y,w,E,k,D){const B=10*e,N=5*e;return this.int16[B+0]=r,this.int16[B+1]=l,this.int16[B+2]=p,this.int16[B+3]=_,this.int16[B+4]=y,this.int16[B+5]=w,this.uint32[N+3]=E,this.uint16[B+8]=k,this.uint16[B+9]=D,e}}eu.prototype.bytesPerElement=20,Qe("StructArrayLayout6i1ul2ui20",eu);class bc extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,l,p,_,y)}emplace(e,r,l,p,_,y,w){const E=6*e;return this.int16[E+0]=r,this.int16[E+1]=l,this.int16[E+2]=p,this.int16[E+3]=_,this.int16[E+4]=y,this.int16[E+5]=w,e}}bc.prototype.bytesPerElement=12,Qe("StructArrayLayout2i2i2i12",bc);class Pu extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,l,p,_)}emplace(e,r,l,p,_,y){const w=4*e,E=8*e;return this.float32[w+0]=r,this.float32[w+1]=l,this.float32[w+2]=p,this.int16[E+6]=_,this.int16[E+7]=y,e}}Pu.prototype.bytesPerElement=16,Qe("StructArrayLayout2f1f2i16",Pu);class Tc extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,p)}emplace(e,r,l,p,_){const y=12*e,w=3*e;return this.uint8[y+0]=r,this.uint8[y+1]=l,this.float32[w+1]=p,this.float32[w+2]=_,e}}Tc.prototype.bytesPerElement=12,Qe("StructArrayLayout2ub2f12",Tc);class Cu extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l)}emplace(e,r,l,p){const _=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=l,this.uint16[_+2]=p,e}}Cu.prototype.bytesPerElement=6,Qe("StructArrayLayout3ui6",Cu);class Qt extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y,w,E,k,D,B,N,Z,j,Y,te,ne){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,r,l,p,_,y,w,E,k,D,B,N,Z,j,Y,te,ne)}emplace(e,r,l,p,_,y,w,E,k,D,B,N,Z,j,Y,te,ne,ge){const le=24*e,xe=12*e,Se=48*e;return this.int16[le+0]=r,this.int16[le+1]=l,this.uint16[le+2]=p,this.uint16[le+3]=_,this.uint32[xe+2]=y,this.uint32[xe+3]=w,this.uint32[xe+4]=E,this.uint16[le+10]=k,this.uint16[le+11]=D,this.uint16[le+12]=B,this.float32[xe+7]=N,this.float32[xe+8]=Z,this.uint8[Se+36]=j,this.uint8[Se+37]=Y,this.uint8[Se+38]=te,this.uint32[xe+10]=ne,this.int16[le+22]=ge,e}}Qt.prototype.bytesPerElement=48,Qe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qt);class m extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,p,_,y,w,E,k,D,B,N,Z,j,Y,te,ne,ge,le,xe,Se,ze,et,ut,Je,Ke,Ze,nt){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,r,l,p,_,y,w,E,k,D,B,N,Z,j,Y,te,ne,ge,le,xe,Se,ze,et,ut,Je,Ke,Ze,nt)}emplace(e,r,l,p,_,y,w,E,k,D,B,N,Z,j,Y,te,ne,ge,le,xe,Se,ze,et,ut,Je,Ke,Ze,nt,Ge){const Oe=32*e,gt=16*e;return this.int16[Oe+0]=r,this.int16[Oe+1]=l,this.int16[Oe+2]=p,this.int16[Oe+3]=_,this.int16[Oe+4]=y,this.int16[Oe+5]=w,this.int16[Oe+6]=E,this.int16[Oe+7]=k,this.uint16[Oe+8]=D,this.uint16[Oe+9]=B,this.uint16[Oe+10]=N,this.uint16[Oe+11]=Z,this.uint16[Oe+12]=j,this.uint16[Oe+13]=Y,this.uint16[Oe+14]=te,this.uint16[Oe+15]=ne,this.uint16[Oe+16]=ge,this.uint16[Oe+17]=le,this.uint16[Oe+18]=xe,this.uint16[Oe+19]=Se,this.uint16[Oe+20]=ze,this.uint16[Oe+21]=et,this.uint16[Oe+22]=ut,this.uint32[gt+12]=Je,this.float32[gt+13]=Ke,this.float32[gt+14]=Ze,this.uint16[Oe+30]=nt,this.uint16[Oe+31]=Ge,e}}m.prototype.bytesPerElement=64,Qe("StructArrayLayout8i15ui1ul2f2ui64",m);class t extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}t.prototype.bytesPerElement=4,Qe("StructArrayLayout1f4",t);class a extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l)}emplace(e,r,l,p){const _=3*e;return this.uint16[6*e+0]=r,this.float32[_+1]=l,this.float32[_+2]=p,e}}a.prototype.bytesPerElement=12,Qe("StructArrayLayout1ui2f12",a);class c extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l)}emplace(e,r,l,p){const _=4*e;return this.uint32[2*e+0]=r,this.uint16[_+2]=l,this.uint16[_+3]=p,e}}c.prototype.bytesPerElement=8,Qe("StructArrayLayout1ul2ui8",c);class f extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=l,e}}f.prototype.bytesPerElement=4,Qe("StructArrayLayout2ui4",f);class g extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}g.prototype.bytesPerElement=2,Qe("StructArrayLayout1ui2",g);class T extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,p)}emplace(e,r,l,p,_){const y=4*e;return this.float32[y+0]=r,this.float32[y+1]=l,this.float32[y+2]=p,this.float32[y+3]=_,e}}T.prototype.bytesPerElement=16,Qe("StructArrayLayout4f16",T);class S extends Er{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _e(this.anchorPointX,this.anchorPointY)}}S.prototype.size=20;class C extends eu{get(e){return new S(this,e)}}Qe("CollisionBoxArray",C);class M extends Er{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}M.prototype.size=48;class A extends Qt{get(e){return new M(this,e)}}Qe("PlacedSymbolArray",A);class R extends Er{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}R.prototype.size=64;class V extends m{get(e){return new R(this,e)}}Qe("SymbolInstanceArray",V);class K extends t{getoffsetX(e){return this.float32[1*e+0]}}Qe("GlyphOffsetArray",K);class X extends Vs{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Qe("SymbolLineVertexArray",X);class Q extends Er{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Q.prototype.size=12;class W extends a{get(e){return new Q(this,e)}}Qe("TextAnchorOffsetArray",W);class he extends Er{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}he.prototype.size=8;class be extends c{get(e){return new he(this,e)}}Qe("FeatureIndexArray",be);class ie extends as{}class fe extends as{}class Ee extends as{}class Pe extends wi{}class Me extends Zs{}class Be extends Ro{}class De extends ls{}class Ve extends Ql{}class lt extends $s{}class $t extends Bo{}class Xe extends bc{}class wt extends Tc{}class st extends Cu{}class mi extends f{}const Vt=zi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dt}=Vt;class bt{constructor(e=[]){this.segments=e}prepareSegment(e,r,l,p){let _=this.segments[this.segments.length-1];return e>bt.MAX_VERTEX_ARRAY_LENGTH&&Ut(`Max vertices per segment is ${bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!_||_.vertexLength+e>bt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:r.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,p){return new bt([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Ui(i,e){return 256*(i=pe(Math.floor(i),0,255))+pe(Math.floor(e),0,255)}bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qe("SegmentVector",bt);const li=zi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Hn={exports:{}},fn={exports:{}};fn.exports=function(i,e){var r,l,p,_,y,w,E,k;for(l=i.length-(r=3&i.length),p=e,y=3432918353,w=461845907,k=0;k<l;)E=255&i.charCodeAt(k)|(255&i.charCodeAt(++k))<<8|(255&i.charCodeAt(++k))<<16|(255&i.charCodeAt(++k))<<24,++k,p=27492+(65535&(_=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(E=0,r){case 3:E^=(255&i.charCodeAt(k+2))<<16;case 2:E^=(255&i.charCodeAt(k+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(k)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Xi=fn.exports,sr={exports:{}};sr.exports=function(i,e){for(var r,l=i.length,p=e^l,_=0;l>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),l-=4,++_;switch(l){case 3:p^=(255&i.charCodeAt(_+2))<<16;case 2:p^=(255&i.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var fo=Xi,us=sr.exports;Hn.exports=fo,Hn.exports.murmur3=fo,Hn.exports.murmur2=us;var cs=H(Hn.exports);class js{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,l,p){this.ids.push(ba(e)),this.positions.push(r,l,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=ba(e);let l=0,p=this.ids.length-1;for(;l<p;){const y=l+p>>1;this.ids[y]>=r?p=y:l=y+1}const _=[];for(;this.ids[l]===r;)_.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return _}static serialize(e,r){const l=new Float64Array(e.ids),p=new Uint32Array(e.positions);return qs(l,p,0,l.length-1),r&&r.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(e){const r=new js;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ba(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:cs(String(i))}function qs(i,e,r,l){for(;r<l;){const p=i[r+l>>1];let _=r-1,y=l+1;for(;;){do _++;while(i[_]<p);do y--;while(i[y]>p);if(_>=y)break;mn(i,_,y),mn(e,3*_,3*y),mn(e,3*_+1,3*y+1),mn(e,3*_+2,3*y+2)}y-r<l-y?(qs(i,e,r,y),r=y+1):(qs(i,e,y+1,l),l=y)}}function mn(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}Qe("FeaturePositionMap",js);class Vi{constructor(e,r){this.gl=e.gl,this.location=r}}class _n extends Vi{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class dl extends Vi{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class tn extends Vi{constructor(e,r){super(e,r),this.current=xt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const gn=new Float32Array(16);function ar(i){return[Ui(255*i.r,255*i.g),Ui(255*i.b,255*i.a)]}class Ai{constructor(e,r,l){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=l}setUniform(e,r,l){e.set(l.constantOr(this.value))}getBinding(e,r,l){return this.type==="color"?new tn(e,r):new _n(e,r)}}class pl{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,l,p){const _=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&e.set(_)}getBinding(e,r,l){return l.substr(0,9)==="u_pattern"?new dl(e,r):new _n(e,r)}}class hs{constructor(e,r,l,p){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,l,p,_){const y=this.paintVertexArray.length,w=this.expression.evaluate(new fi(0),r,{},p,[],_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w)}updatePaintArray(e,r,l,p){const _=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(e,r,_)}_setPaintValue(e,r,l){if(this.type==="color"){const p=ar(l);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mo{constructor(e,r,l,p,_,y){this.expression=e,this.uniformNames=r.map(w=>`u_${w}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=r.map(w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,r,l,p,_){const y=this.expression.evaluate(new fi(this.zoom),r,{},p,[],_),w=this.expression.evaluate(new fi(this.zoom+1),r,{},p,[],_),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,w)}updatePaintArray(e,r,l,p){const _=this.expression.evaluate({zoom:this.zoom},l,p),y=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(e,r,_,y)}_setPaintValue(e,r,l,p){if(this.type==="color"){const _=ar(l),y=ar(p);for(let w=e;w<r;w++)this.paintVertexArray.emplace(w,_[0],_[1],y[0],y[1])}else{for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const l=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=pe(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,r,l){return new _n(e,r)}}class Gs{constructor(e,r,l,p,_,y){this.expression=e,this.type=r,this.useIntegerZoom=l,this.zoom=p,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,p,_){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,r,l,p){if(!p||!l)return;const{min:_,mid:y,max:w}=l,E=p[_],k=p[y],D=p[w];if(E&&k&&D)for(let B=e;B<r;B++)this.zoomInPaintVertexArray.emplace(B,k.tl[0],k.tl[1],k.br[0],k.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],k.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,k.tl[0],k.tl[1],k.br[0],k.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],k.pixelRatio,D.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,li.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,li.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zh{constructor(e,r,l){this.binders={},this._buffers=[];const p=[];for(const _ in e.paint._values){if(!l(_))continue;const y=e.paint.get(_);if(!(y instanceof oe&&zo(y.property.specification)))continue;const w=fl(_,e.type),E=y.value,k=y.property.specification.type,D=y.property.useIntegerZoom,B=y.property.specification["property-type"],N=B==="cross-faded"||B==="cross-faded-data-driven";if(E.kind==="constant")this.binders[_]=N?new pl(E.value,w):new Ai(E.value,w,k),p.push(`/u_${_}`);else if(E.kind==="source"||N){const Z=Sc(_,k,"source");this.binders[_]=N?new Gs(E,k,D,r,Z,e.id):new hs(E,w,k,Z),p.push(`/a_${_}`)}else{const Z=Sc(_,k,"composite");this.binders[_]=new mo(E,w,k,D,r,Z),p.push(`/z_${_}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof hs||r instanceof mo?r.maxValue:0}populatePaintArrays(e,r,l,p,_){for(const y in this.binders){const w=this.binders[y];(w instanceof hs||w instanceof mo||w instanceof Gs)&&w.populatePaintArray(e,r,l,p,_)}}setConstantPatternPositions(e,r){for(const l in this.binders){const p=this.binders[l];p instanceof pl&&p.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,l,p,_){let y=!1;for(const w in e){const E=r.getPositions(w);for(const k of E){const D=l.feature(k.index);for(const B in this.binders){const N=this.binders[B];if((N instanceof hs||N instanceof mo||N instanceof Gs)&&N.expression.isStateDependent===!0){const Z=p.paint.get(B);N.expression=Z.value,N.updatePaintArray(k.start,k.end,D,e[w],_),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Ai||l instanceof pl)&&e.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof hs||l instanceof mo)for(let p=0;p<l.paintVertexAttributes.length;p++)e.push(l.paintVertexAttributes[p].name);else if(l instanceof Gs)for(let p=0;p<li.members.length;p++)e.push(li.members[p].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Ai||l instanceof pl||l instanceof mo)for(const p of l.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const l=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof Ai||_ instanceof pl||_ instanceof mo){for(const y of _.uniformNames)if(r[y]){const w=_.getBinding(e,r[y],y);l.push({name:y,property:p,binding:w})}}}return l}setUniforms(e,r,l,p){for(const{name:_,property:y,binding:w}of r)this.binders[y].setUniform(w,p,l.get(y),_)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const l=this.binders[r];if(e&&l instanceof Gs){const p=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof hs||l instanceof mo)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof hs||l instanceof mo||l instanceof Gs)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof hs||r instanceof mo||r instanceof Gs)&&r.destroy()}}}class Ta{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new zh(p,r,l);this.needsUpload=!1,this._featureMap=new js,this._bufferOffset=0}populatePaintArrays(e,r,l,p,_,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,r,p,_,y);r.id!==void 0&&this._featureMap.add(r.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,p){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function fl(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Sc(i,e,r){const l={color:{source:Ro,composite:T},number:{source:t,composite:Ro}},p=function(_){return{"line-pattern":{source:De,composite:De},"fill-pattern":{source:De,composite:De},"fill-extrusion-pattern":{source:De,composite:De}}[_]}(i);return p&&p[r]||l[e][r]}Qe("ConstantBinder",Ai),Qe("CrossFadedConstantBinder",pl),Qe("SourceExpressionBinder",hs),Qe("CrossFadedCompositeBinder",Gs),Qe("CompositeExpressionBinder",mo),Qe("ProgramConfiguration",zh,{omit:["_buffers"]}),Qe("ProgramConfigurationSet",Ta);const Li=8192,Iu=Math.pow(2,14)-1,ku=-Iu-1;function Ws(i){const e=Li/i.extent,r=i.loadGeometry();for(let l=0;l<r.length;l++){const p=r[l];for(let _=0;_<p.length;_++){const y=p[_],w=Math.round(y.x*e),E=Math.round(y.y*e);y.x=pe(w,ku,Iu),y.y=pe(E,ku,Iu),(w<y.x||w>y.x+1||E<y.y||E>y.y+1)&&Ut("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function ds(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ws(i):[]}}function Ah(i,e,r,l,p){i.emplaceBack(2*e+(l+1)/2,2*r+(p+1)/2)}class mp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.indexArray=new st,this.segments=new bt,this.programConfigurations=new Ta(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){const p=this.layers[0],_=[];let y=null,w=!1;p.type==="circle"&&(y=p.layout.get("circle-sort-key"),w=!y.isConstant());for(const{feature:E,id:k,index:D,sourceLayerIndex:B}of e){const N=this.layers[0]._featureFilter.needGeometry,Z=ds(E,N);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),Z,l))continue;const j=w?y.evaluate(Z,{},l):void 0,Y={id:k,properties:E.properties,type:E.type,sourceLayerIndex:B,index:D,geometry:N?Z.geometry:Ws(E),patterns:{},sortKey:j};_.push(Y)}w&&_.sort((E,k)=>E.sortKey-k.sortKey);for(const E of _){const{geometry:k,index:D,sourceLayerIndex:B}=E,N=e[D].feature;this.addFeature(E,k,D,l),r.featureIndex.insert(N,k,D,B,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,p){for(const _ of r)for(const y of _){const w=y.x,E=y.y;if(w<0||w>=Li||E<0||E>=Li)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=k.vertexLength;Ah(this.layoutVertexArray,w,E,-1,-1),Ah(this.layoutVertexArray,w,E,1,-1),Ah(this.layoutVertexArray,w,E,1,1),Ah(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},p)}}function w_(i,e){for(let r=0;r<i.length;r++)if(Mu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Mu(i,e[r]))return!0;return!!_p(i,e)}function I0(i,e,r){return!!Mu(i,e)||!!gp(e,i,r)}function b_(i,e){if(i.length===1)return S_(e,i[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let p=0;p<l.length;p++)if(Mu(i,l[p]))return!0}for(let r=0;r<i.length;r++)if(S_(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(_p(i,e[r]))return!0;return!1}function k0(i,e,r){if(i.length>1){if(_p(i,e))return!0;for(let l=0;l<e.length;l++)if(gp(e[l],i,r))return!0}for(let l=0;l<i.length;l++)if(gp(i[l],e,r))return!0;return!1}function _p(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const l=i[r],p=i[r+1];for(let _=0;_<e.length-1;_++)if(M0(l,p,e[_],e[_+1]))return!0}return!1}function M0(i,e,r,l){return ct(i,r,l)!==ct(e,r,l)&&ct(i,e,r)!==ct(i,e,l)}function gp(i,e,r){const l=r*r;if(e.length===1)return i.distSqr(e[0])<l;for(let p=1;p<e.length;p++)if(T_(i,e[p-1],e[p])<l)return!0;return!1}function T_(i,e,r){const l=e.distSqr(r);if(l===0)return i.distSqr(e);const p=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/l;return i.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function S_(i,e){let r,l,p,_=!1;for(let y=0;y<i.length;y++){r=i[y];for(let w=0,E=r.length-1;w<r.length;E=w++)l=r[w],p=r[E],l.y>e.y!=p.y>e.y&&e.x<(p.x-l.x)*(e.y-l.y)/(p.y-l.y)+l.x&&(_=!_)}return _}function Mu(i,e){let r=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const _=i[l],y=i[p];_.y>e.y!=y.y>e.y&&e.x<(y.x-_.x)*(e.y-_.y)/(y.y-_.y)+_.x&&(r=!r)}return r}function z0(i,e,r){const l=r[0],p=r[2];if(i.x<l.x&&e.x<l.x||i.x>p.x&&e.x>p.x||i.y<l.y&&e.y<l.y||i.y>p.y&&e.y>p.y)return!1;const _=ct(i,e,r[0]);return _!==ct(i,e,r[1])||_!==ct(i,e,r[2])||_!==ct(i,e,r[3])}function Ec(i,e,r){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Lh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Dh(i,e,r,l,p){if(!e[0]&&!e[1])return i;const _=_e.convert(e)._mult(p);r==="viewport"&&_._rotate(-l);const y=[];for(let w=0;w<i.length;w++)y.push(i[w].sub(_));return y}let E_,P_;Qe("CircleBucket",mp,{omit:["layers"]});var A0={get paint(){return P_=P_||new Yt({"circle-radius":new Te(Ie.paint_circle["circle-radius"]),"circle-color":new Te(Ie.paint_circle["circle-color"]),"circle-blur":new Te(Ie.paint_circle["circle-blur"]),"circle-opacity":new Te(Ie.paint_circle["circle-opacity"]),"circle-translate":new ce(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new ce(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ce(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ce(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Te(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Te(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Te(Ie.paint_circle["circle-stroke-opacity"])})},get layout(){return E_=E_||new Yt({"circle-sort-key":new Te(Ie.layout_circle["circle-sort-key"])})}},lr=1e-6,zu=typeof Float32Array<"u"?Float32Array:Array;function yp(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function C_(i,e,r){var l=e[0],p=e[1],_=e[2],y=e[3],w=e[4],E=e[5],k=e[6],D=e[7],B=e[8],N=e[9],Z=e[10],j=e[11],Y=e[12],te=e[13],ne=e[14],ge=e[15],le=r[0],xe=r[1],Se=r[2],ze=r[3];return i[0]=le*l+xe*w+Se*B+ze*Y,i[1]=le*p+xe*E+Se*N+ze*te,i[2]=le*_+xe*k+Se*Z+ze*ne,i[3]=le*y+xe*D+Se*j+ze*ge,i[4]=(le=r[4])*l+(xe=r[5])*w+(Se=r[6])*B+(ze=r[7])*Y,i[5]=le*p+xe*E+Se*N+ze*te,i[6]=le*_+xe*k+Se*Z+ze*ne,i[7]=le*y+xe*D+Se*j+ze*ge,i[8]=(le=r[8])*l+(xe=r[9])*w+(Se=r[10])*B+(ze=r[11])*Y,i[9]=le*p+xe*E+Se*N+ze*te,i[10]=le*_+xe*k+Se*Z+ze*ne,i[11]=le*y+xe*D+Se*j+ze*ge,i[12]=(le=r[12])*l+(xe=r[13])*w+(Se=r[14])*B+(ze=r[15])*Y,i[13]=le*p+xe*E+Se*N+ze*te,i[14]=le*_+xe*k+Se*Z+ze*ne,i[15]=le*y+xe*D+Se*j+ze*ge,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Pc,L0=C_;function Rh(i,e,r){var l=e[0],p=e[1],_=e[2],y=e[3];return i[0]=r[0]*l+r[4]*p+r[8]*_+r[12]*y,i[1]=r[1]*l+r[5]*p+r[9]*_+r[13]*y,i[2]=r[2]*l+r[6]*p+r[10]*_+r[14]*y,i[3]=r[3]*l+r[7]*p+r[11]*_+r[15]*y,i}Pc=new zu(4),zu!=Float32Array&&(Pc[0]=0,Pc[1]=0,Pc[2]=0,Pc[3]=0);class D0 extends Mi{constructor(e){super(e,A0)}createBucket(e){return new mp(e)}queryRadius(e){const r=e;return Ec("circle-radius",this,r)+Ec("circle-stroke-width",this,r)+Lh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,l,p,_,y,w,E){const k=Dh(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,w),D=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l),B=this.paint.get("circle-pitch-alignment")==="map",N=B?k:function(j,Y){return j.map(te=>I_(te,Y))}(k,E),Z=B?D*w:D;for(const j of p)for(const Y of j){const te=B?Y:I_(Y,E);let ne=Z;const ge=Rh([],[Y.x,Y.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ne*=ge[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ne*=y.cameraToCenterDistance/ge[3]),I0(N,te,ne))return!0}return!1}}function I_(i,e){const r=Rh([],[i.x,i.y,0,1],e);return new _e(r[0]/r[3],r[1]/r[3])}class k_ extends mp{}let M_;Qe("HeatmapBucket",k_,{omit:["layers"]});var R0={get paint(){return M_=M_||new Yt({"heatmap-radius":new Te(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Te(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ce(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ft(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ce(Ie.paint_heatmap["heatmap-opacity"])})}};function vp(i,{width:e,height:r},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*r*l}`)}else p=new Uint8Array(e*r*l);return i.width=e,i.height=r,i.data=p,i}function z_(i,{width:e,height:r},l){if(e===i.width&&r===i.height)return;const p=vp({},{width:e,height:r},l);xp(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},l),i.width=e,i.height=r,i.data=p.data}function xp(i,e,r,l,p,_){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||r.x>i.width-p.width||r.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||l.x>e.width-p.width||l.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,w=e.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<p.height;E++){const k=((r.y+E)*i.width+r.x)*_,D=((l.y+E)*e.width+l.x)*_;for(let B=0;B<p.width*_;B++)w[D+B]=y[k+B]}return e}class Cc{constructor(e,r){vp(this,e,1,r)}resize(e){z_(this,e,1)}clone(){return new Cc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,p,_){xp(e,r,l,p,_,1)}}class _o{constructor(e,r){vp(this,e,4,r)}resize(e){z_(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _o({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,p,_){xp(e,r,l,p,_,4)}}function A_(i){const e={},r=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new _o({width:r,height:l});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const _=(y,w,E)=>{e[i.evaluationKey]=E;const k=i.expression.evaluate(e);p.data[y+w+0]=Math.floor(255*k.r/k.a),p.data[y+w+1]=Math.floor(255*k.g/k.a),p.data[y+w+2]=Math.floor(255*k.b/k.a),p.data[y+w+3]=Math.floor(255*k.a)};if(i.clips)for(let y=0,w=0;y<l;++y,w+=4*r)for(let E=0,k=0;E<r;E++,k+=4){const D=E/(r-1),{start:B,end:N}=i.clips[y];_(w,k,B*(1-D)+N*D)}else for(let y=0,w=0;y<r;y++,w+=4)_(0,w,y/(r-1));return p}Qe("AlphaImage",Cc),Qe("RGBAImage",_o);class B0 extends Mi{createBucket(e){return new k_(e)}constructor(e){super(e,R0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=A_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let L_;var O0={get paint(){return L_=L_||new Yt({"hillshade-illumination-direction":new ce(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ce(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ce(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ce(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ce(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ce(Ie.paint_hillshade["hillshade-accent-color"])})}};class F0 extends Mi{constructor(e){super(e,O0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const N0=zi([{name:"a_pos",components:2,type:"Int16"}],4),{members:U0}=N0;var wp={exports:{}};function Bh(i,e,r){r=r||2;var l,p,_,y,w,E,k,D=e&&e.length,B=D?e[0]*r:i.length,N=D_(i,0,B,r,!0),Z=[];if(!N||N.next===N.prev)return Z;if(D&&(N=function(Y,te,ne,ge){var le,xe,Se,ze=[];for(le=0,xe=te.length;le<xe;le++)(Se=D_(Y,te[le]*ge,le<xe-1?te[le+1]*ge:Y.length,ge,!1))===Se.next&&(Se.steiner=!0),ze.push(H0(Se));for(ze.sort(q0),le=0;le<ze.length;le++)ne=G0(ze[le],ne);return ne}(i,e,N,r)),i.length>80*r){l=_=i[0],p=y=i[1];for(var j=r;j<B;j+=r)(w=i[j])<l&&(l=w),(E=i[j+1])<p&&(p=E),w>_&&(_=w),E>y&&(y=E);k=(k=Math.max(_-l,y-p))!==0?32767/k:0}return Ic(N,Z,r,l,p,k,0),Z}function D_(i,e,r,l,p){var _,y;if(p===Sp(i,e,r,l)>0)for(_=e;_<r;_+=l)y=O_(_,i[_],i[_+1],y);else for(_=r-l;_>=e;_-=l)y=O_(_,i[_],i[_+1],y);return y&&Oh(y,y.next)&&(Mc(y),y=y.next),y}function tu(i,e){if(!i)return i;e||(e=i);var r,l=i;do if(r=!1,l.steiner||!Oh(l,l.next)&&Ki(l.prev,l,l.next)!==0)l=l.next;else{if(Mc(l),(l=e=l.prev)===l.next)break;r=!0}while(r||l!==e);return e}function Ic(i,e,r,l,p,_,y){if(i){!y&&_&&function(D,B,N,Z){var j=D;do j.z===0&&(j.z=bp(j.x,j.y,B,N,Z)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==D);j.prevZ.nextZ=null,j.prevZ=null,function(Y){var te,ne,ge,le,xe,Se,ze,et,ut=1;do{for(ne=Y,Y=null,xe=null,Se=0;ne;){for(Se++,ge=ne,ze=0,te=0;te<ut&&(ze++,ge=ge.nextZ);te++);for(et=ut;ze>0||et>0&&ge;)ze!==0&&(et===0||!ge||ne.z<=ge.z)?(le=ne,ne=ne.nextZ,ze--):(le=ge,ge=ge.nextZ,et--),xe?xe.nextZ=le:Y=le,le.prevZ=xe,xe=le;ne=ge}xe.nextZ=null,ut*=2}while(Se>1)}(j)}(i,l,p,_);for(var w,E,k=i;i.prev!==i.next;)if(w=i.prev,E=i.next,_?Z0(i,l,p,_):V0(i))e.push(w.i/r|0),e.push(i.i/r|0),e.push(E.i/r|0),Mc(i),i=E.next,k=E.next;else if((i=E)===k){y?y===1?Ic(i=$0(tu(i),e,r),e,r,l,p,_,2):y===2&&j0(i,e,r,l,p,_):Ic(tu(i),e,r,l,p,_,1);break}}}function V0(i){var e=i.prev,r=i,l=i.next;if(Ki(e,r,l)>=0)return!1;for(var p=e.x,_=r.x,y=l.x,w=e.y,E=r.y,k=l.y,D=p<_?p<y?p:y:_<y?_:y,B=w<E?w<k?w:k:E<k?E:k,N=p>_?p>y?p:y:_>y?_:y,Z=w>E?w>k?w:k:E>k?E:k,j=l.next;j!==e;){if(j.x>=D&&j.x<=N&&j.y>=B&&j.y<=Z&&Au(p,w,_,E,y,k,j.x,j.y)&&Ki(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Z0(i,e,r,l){var p=i.prev,_=i,y=i.next;if(Ki(p,_,y)>=0)return!1;for(var w=p.x,E=_.x,k=y.x,D=p.y,B=_.y,N=y.y,Z=w<E?w<k?w:k:E<k?E:k,j=D<B?D<N?D:N:B<N?B:N,Y=w>E?w>k?w:k:E>k?E:k,te=D>B?D>N?D:N:B>N?B:N,ne=bp(Z,j,e,r,l),ge=bp(Y,te,e,r,l),le=i.prevZ,xe=i.nextZ;le&&le.z>=ne&&xe&&xe.z<=ge;){if(le.x>=Z&&le.x<=Y&&le.y>=j&&le.y<=te&&le!==p&&le!==y&&Au(w,D,E,B,k,N,le.x,le.y)&&Ki(le.prev,le,le.next)>=0||(le=le.prevZ,xe.x>=Z&&xe.x<=Y&&xe.y>=j&&xe.y<=te&&xe!==p&&xe!==y&&Au(w,D,E,B,k,N,xe.x,xe.y)&&Ki(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;le&&le.z>=ne;){if(le.x>=Z&&le.x<=Y&&le.y>=j&&le.y<=te&&le!==p&&le!==y&&Au(w,D,E,B,k,N,le.x,le.y)&&Ki(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;xe&&xe.z<=ge;){if(xe.x>=Z&&xe.x<=Y&&xe.y>=j&&xe.y<=te&&xe!==p&&xe!==y&&Au(w,D,E,B,k,N,xe.x,xe.y)&&Ki(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function $0(i,e,r){var l=i;do{var p=l.prev,_=l.next.next;!Oh(p,_)&&R_(p,l,l.next,_)&&kc(p,_)&&kc(_,p)&&(e.push(p.i/r|0),e.push(l.i/r|0),e.push(_.i/r|0),Mc(l),Mc(l.next),l=i=_),l=l.next}while(l!==i);return tu(l)}function j0(i,e,r,l,p,_){var y=i;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&X0(y,w)){var E=B_(y,w);return y=tu(y,y.next),E=tu(E,E.next),Ic(y,e,r,l,p,_,0),void Ic(E,e,r,l,p,_,0)}w=w.next}y=y.next}while(y!==i)}function q0(i,e){return i.x-e.x}function G0(i,e){var r=function(p,_){var y,w=_,E=p.x,k=p.y,D=-1/0;do{if(k<=w.y&&k>=w.next.y&&w.next.y!==w.y){var B=w.x+(k-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(B<=E&&B>D&&(D=B,y=w.x<w.next.x?w:w.next,B===E))return y}w=w.next}while(w!==_);if(!y)return null;var N,Z=y,j=y.x,Y=y.y,te=1/0;w=y;do E>=w.x&&w.x>=j&&E!==w.x&&Au(k<Y?E:D,k,j,Y,k<Y?D:E,k,w.x,w.y)&&(N=Math.abs(k-w.y)/(E-w.x),kc(w,p)&&(N<te||N===te&&(w.x>y.x||w.x===y.x&&W0(y,w)))&&(y=w,te=N)),w=w.next;while(w!==Z);return y}(i,e);if(!r)return e;var l=B_(r,i);return tu(l,l.next),tu(r,r.next)}function W0(i,e){return Ki(i.prev,i,e.prev)<0&&Ki(e.next,i,i.next)<0}function bp(i,e,r,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function H0(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Au(i,e,r,l,p,_,y,w){return(p-y)*(e-w)>=(i-y)*(_-w)&&(i-y)*(l-w)>=(r-y)*(e-w)&&(r-y)*(_-w)>=(p-y)*(l-w)}function X0(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,l){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==l.i&&p.next.i!==l.i&&R_(p,p.next,r,l))return!0;p=p.next}while(p!==r);return!1}(i,e)&&(kc(i,e)&&kc(e,i)&&function(r,l){var p=r,_=!1,y=(r.x+l.x)/2,w=(r.y+l.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&y<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==r);return _}(i,e)&&(Ki(i.prev,i,e.prev)||Ki(i,e.prev,e))||Oh(i,e)&&Ki(i.prev,i,i.next)>0&&Ki(e.prev,e,e.next)>0)}function Ki(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Oh(i,e){return i.x===e.x&&i.y===e.y}function R_(i,e,r,l){var p=Nh(Ki(i,e,r)),_=Nh(Ki(i,e,l)),y=Nh(Ki(r,l,i)),w=Nh(Ki(r,l,e));return p!==_&&y!==w||!(p!==0||!Fh(i,r,e))||!(_!==0||!Fh(i,l,e))||!(y!==0||!Fh(r,i,l))||!(w!==0||!Fh(r,e,l))}function Fh(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Nh(i){return i>0?1:i<0?-1:0}function kc(i,e){return Ki(i.prev,i,i.next)<0?Ki(i,e,i.next)>=0&&Ki(i,i.prev,e)>=0:Ki(i,e,i.prev)<0||Ki(i,i.next,e)<0}function B_(i,e){var r=new Tp(i.i,i.x,i.y),l=new Tp(e.i,e.x,e.y),p=i.next,_=e.prev;return i.next=e,e.prev=i,r.next=p,p.prev=r,l.next=r,r.prev=l,_.next=l,l.prev=_,l}function O_(i,e,r,l){var p=new Tp(i,e,r);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function Mc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Tp(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sp(i,e,r,l){for(var p=0,_=e,y=r-l;_<r;_+=l)p+=(i[y]-i[_])*(i[_+1]+i[y+1]),y=_;return p}wp.exports=Bh,wp.exports.default=Bh,Bh.deviation=function(i,e,r,l){var p=e&&e.length,_=Math.abs(Sp(i,0,p?e[0]*r:i.length,r));if(p)for(var y=0,w=e.length;y<w;y++)_-=Math.abs(Sp(i,e[y]*r,y<w-1?e[y+1]*r:i.length,r));var E=0;for(y=0;y<l.length;y+=3){var k=l[y]*r,D=l[y+1]*r,B=l[y+2]*r;E+=Math.abs((i[k]-i[B])*(i[D+1]-i[k+1])-(i[k]-i[D])*(i[B+1]-i[k+1]))}return _===0&&E===0?0:Math.abs((E-_)/_)},Bh.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},l=0,p=0;p<i.length;p++){for(var _=0;_<i[p].length;_++)for(var y=0;y<e;y++)r.vertices.push(i[p][_][y]);p>0&&r.holes.push(l+=i[p-1].length)}return r};var F_=H(wp.exports);function K0(i,e,r,l,p){N_(i,e,r||0,l||i.length-1,p||Y0)}function N_(i,e,r,l,p){for(;l>r;){if(l-r>600){var _=l-r+1,y=e-r+1,w=Math.log(_),E=.5*Math.exp(2*w/3),k=.5*Math.sqrt(w*E*(_-E)/_)*(y-_/2<0?-1:1);N_(i,e,Math.max(r,Math.floor(e-y*E/_+k)),Math.min(l,Math.floor(e+(_-y)*E/_+k)),p)}var D=i[e],B=r,N=l;for(zc(i,r,e),p(i[l],D)>0&&zc(i,r,l);B<N;){for(zc(i,B,N),B++,N--;p(i[B],D)<0;)B++;for(;p(i[N],D)>0;)N--}p(i[r],D)===0?zc(i,r,N):zc(i,++N,l),N<=e&&(r=N+1),e<=N&&(l=N-1)}}function zc(i,e,r){var l=i[e];i[e]=i[r],i[r]=l}function Y0(i,e){return i<e?-1:i>e?1:0}function Ep(i,e){const r=i.length;if(r<=1)return[i];const l=[];let p,_;for(let y=0;y<r;y++){const w=ei(i[y]);w!==0&&(i[y].area=Math.abs(w),_===void 0&&(_=w<0),_===w<0?(p&&l.push(p),p=[i[y]]):p.push(i[y]))}if(p&&l.push(p),e>1)for(let y=0;y<l.length;y++)l[y].length<=e||(K0(l[y],e,1,l[y].length-1,J0),l[y]=l[y].slice(0,e));return l}function J0(i,e){return e.area-i.area}function Pp(i,e,r){const l=r.patternDependencies;let p=!1;for(const _ of e){const y=_.paint.get(`${i}-pattern`);y.isConstant()||(p=!0);const w=y.constantOr(null);w&&(p=!0,l[w.to]=!0,l[w.from]=!0)}return p}function Cp(i,e,r,l,p){const _=p.patternDependencies;for(const y of e){const w=y.paint.get(`${i}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:l-1},r,{},p.availableImages),k=w.evaluate({zoom:l},r,{},p.availableImages),D=w.evaluate({zoom:l+1},r,{},p.availableImages);E=E&&E.name?E.name:E,k=k&&k.name?k.name:k,D=D&&D.name?D.name:D,_[E]=!0,_[k]=!0,_[D]=!0,r.patterns[y.id]={min:E,mid:k,max:D}}}return r}class Ip{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ee,this.indexArray=new st,this.indexArray2=new mi,this.programConfigurations=new Ta(e.layers,e.zoom),this.segments=new bt,this.segments2=new bt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.hasPattern=Pp("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),_=!p.isConstant(),y=[];for(const{feature:w,id:E,index:k,sourceLayerIndex:D}of e){const B=this.layers[0]._featureFilter.needGeometry,N=ds(w,B);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),N,l))continue;const Z=_?p.evaluate(N,{},l,r.availableImages):void 0,j={id:E,properties:w.properties,type:w.type,sourceLayerIndex:D,index:k,geometry:B?N.geometry:Ws(w),patterns:{},sortKey:Z};y.push(j)}_&&y.sort((w,E)=>w.sortKey-E.sortKey);for(const w of y){const{geometry:E,index:k,sourceLayerIndex:D}=w;if(this.hasPattern){const B=Cp("fill",this.layers,w,this.zoom,r);this.patternFeatures.push(B)}else this.addFeature(w,E,k,l,{});r.featureIndex.insert(e[k].feature,E,k,D,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}addFeatures(e,r,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,U0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,l,p,_){for(const y of Ep(r,500)){let w=0;for(const Z of y)w+=Z.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),k=E.vertexLength,D=[],B=[];for(const Z of y){if(Z.length===0)continue;Z!==y[0]&&B.push(D.length/2);const j=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),Y=j.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(Y+Z.length-1,Y),D.push(Z[0].x),D.push(Z[0].y);for(let te=1;te<Z.length;te++)this.layoutVertexArray.emplaceBack(Z[te].x,Z[te].y),this.indexArray2.emplaceBack(Y+te-1,Y+te),D.push(Z[te].x),D.push(Z[te].y);j.vertexLength+=Z.length,j.primitiveLength+=Z.length}const N=F_(D,B);for(let Z=0;Z<N.length;Z+=3)this.indexArray.emplaceBack(k+N[Z],k+N[Z+1],k+N[Z+2]);E.vertexLength+=w,E.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,_,p)}}let U_,V_;Qe("FillBucket",Ip,{omit:["layers","patternFeatures"]});var Q0={get paint(){return V_=V_||new Yt({"fill-antialias":new ce(Ie.paint_fill["fill-antialias"]),"fill-opacity":new Te(Ie.paint_fill["fill-opacity"]),"fill-color":new Te(Ie.paint_fill["fill-color"]),"fill-outline-color":new Te(Ie.paint_fill["fill-outline-color"]),"fill-translate":new ce(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new ce(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new it(Ie.paint_fill["fill-pattern"])})},get layout(){return U_=U_||new Yt({"fill-sort-key":new Te(Ie.layout_fill["fill-sort-key"])})}};class e1 extends Mi{constructor(e){super(e,Q0)}recalculate(e,r){super.recalculate(e,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ip(e)}queryRadius(){return Lh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,l,p,_,y,w){return b_(Dh(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,w),p)}isTileClipped(){return!0}}const t1=zi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),i1=zi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:n1}=t1;var ml={},r1=q,Z_=Lu;function Lu(i,e,r,l,p){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=p,i.readFields(o1,this,e)}function o1(i,e,r){i==1?e.id=r.readVarint():i==2?function(l,p){for(var _=l.readVarint()+l.pos;l.pos<_;){var y=p._keys[l.readVarint()],w=p._values[l.readVarint()];p.properties[y]=w}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function s1(i){for(var e,r,l=0,p=0,_=i.length,y=_-1;p<_;y=p++)l+=((r=i[y]).x-(e=i[p]).x)*(e.y+r.y);return l}Lu.types=["Unknown","Point","LineString","Polygon"],Lu.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,l=1,p=0,_=0,y=0,w=[];i.pos<r;){if(p<=0){var E=i.readVarint();l=7&E,p=E>>3}if(p--,l===1||l===2)_+=i.readSVarint(),y+=i.readSVarint(),l===1&&(e&&w.push(e),e=[]),e.push(new r1(_,y));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&w.push(e),w},Lu.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,l=0,p=0,_=0,y=1/0,w=-1/0,E=1/0,k=-1/0;i.pos<e;){if(l<=0){var D=i.readVarint();r=7&D,l=D>>3}if(l--,r===1||r===2)(p+=i.readSVarint())<y&&(y=p),p>w&&(w=p),(_+=i.readSVarint())<E&&(E=_),_>k&&(k=_);else if(r!==7)throw new Error("unknown command "+r)}return[y,E,w,k]},Lu.prototype.toGeoJSON=function(i,e,r){var l,p,_=this.extent*Math.pow(2,r),y=this.extent*i,w=this.extent*e,E=this.loadGeometry(),k=Lu.types[this.type];function D(Z){for(var j=0;j<Z.length;j++){var Y=Z[j];Z[j]=[360*(Y.x+y)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(Y.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(l=0;l<E.length;l++)B[l]=E[l][0];D(E=B);break;case 2:for(l=0;l<E.length;l++)D(E[l]);break;case 3:for(E=function(Z){var j=Z.length;if(j<=1)return[Z];for(var Y,te,ne=[],ge=0;ge<j;ge++){var le=s1(Z[ge]);le!==0&&(te===void 0&&(te=le<0),te===le<0?(Y&&ne.push(Y),Y=[Z[ge]]):Y.push(Z[ge]))}return Y&&ne.push(Y),ne}(E),l=0;l<E.length;l++)for(p=0;p<E[l].length;p++)D(E[l][p])}E.length===1?E=E[0]:k="Multi"+k;var N={type:"Feature",geometry:{type:k,coordinates:E},properties:this.properties};return"id"in this&&(N.id=this.id),N};var a1=Z_,$_=j_;function j_(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(l1,this,e),this.length=this._features.length}function l1(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(l){for(var p=null,_=l.readVarint()+l.pos;l.pos<_;){var y=l.readVarint()>>3;p=y===1?l.readString():y===2?l.readFloat():y===3?l.readDouble():y===4?l.readVarint64():y===5?l.readVarint():y===6?l.readSVarint():y===7?l.readBoolean():null}return p}(r))}j_.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new a1(this._pbf,e,this.extent,this._keys,this._values)};var u1=$_;function c1(i,e,r){if(i===3){var l=new u1(r,r.readVarint()+r.pos);l.length&&(e[l.name]=l)}}ml.VectorTile=function(i,e){this.layers=i.readFields(c1,{},e)},ml.VectorTileFeature=Z_,ml.VectorTileLayer=$_;const h1=ml.VectorTileFeature.types,kp=Math.pow(2,13);function Ac(i,e,r,l,p,_,y,w){i.emplaceBack(e,r,2*Math.floor(l*kp)+y,p*kp*2,_*kp*2,Math.round(w))}class Mp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Pe,this.centroidVertexArray=new ie,this.indexArray=new st,this.programConfigurations=new Ta(e.layers,e.zoom),this.segments=new bt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.features=[],this.hasPattern=Pp("fill-extrusion",this.layers,r);for(const{feature:p,id:_,index:y,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,k=ds(p,E);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),k,l))continue;const D={id:_,sourceLayerIndex:w,index:y,geometry:E?k.geometry:Ws(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Cp("fill-extrusion",this.layers,D,this.zoom,r)):this.addFeature(D,D.geometry,y,l,{}),r.featureIndex.insert(p,D.geometry,y,w,this.index,!0)}}addFeatures(e,r,l){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,r,l)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,i1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,l,p,_){const y={x:0,y:0,vertexCount:0};for(const w of Ep(r,500)){let E=0;for(const j of w)E+=j.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const j of w){if(j.length===0||p1(j))continue;let Y=0;for(let te=0;te<j.length;te++){const ne=j[te];if(te>=1){const ge=j[te-1];if(!d1(ne,ge)){k.vertexLength+4>bt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const le=ne.sub(ge)._perp()._unit(),xe=ge.dist(ne);Y+xe>32768&&(Y=0),Ac(this.layoutVertexArray,ne.x,ne.y,le.x,le.y,0,0,Y),Ac(this.layoutVertexArray,ne.x,ne.y,le.x,le.y,0,1,Y),y.x+=2*ne.x,y.y+=2*ne.y,y.vertexCount+=2,Y+=xe,Ac(this.layoutVertexArray,ge.x,ge.y,le.x,le.y,0,0,Y),Ac(this.layoutVertexArray,ge.x,ge.y,le.x,le.y,0,1,Y),y.x+=2*ge.x,y.y+=2*ge.y,y.vertexCount+=2;const Se=k.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+E>bt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray)),h1[e.type]!=="Polygon")continue;const D=[],B=[],N=k.vertexLength;for(const j of w)if(j.length!==0){j!==w[0]&&B.push(D.length/2);for(let Y=0;Y<j.length;Y++){const te=j[Y];Ac(this.layoutVertexArray,te.x,te.y,0,0,1,1,0),y.x+=te.x,y.y+=te.y,y.vertexCount+=1,D.push(te.x),D.push(te.y)}}const Z=F_(D,B);for(let j=0;j<Z.length;j+=3)this.indexArray.emplaceBack(N+Z[j],N+Z[j+2],N+Z[j+1]);k.primitiveLength+=Z.length/3,k.vertexLength+=E}for(let w=0;w<y.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,_,p)}}function d1(i,e){return i.x===e.x&&(i.x<0||i.x>Li)||i.y===e.y&&(i.y<0||i.y>Li)}function p1(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Li)||i.every(e=>e.y<0)||i.every(e=>e.y>Li)}let q_;Qe("FillExtrusionBucket",Mp,{omit:["layers","features"]});var f1={get paint(){return q_=q_||new Yt({"fill-extrusion-opacity":new ce(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ce(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ce(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new it(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ce(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class m1 extends Mi{constructor(e){super(e,f1)}createBucket(e){return new Mp(e)}queryRadius(){return Lh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,l,p,_,y,w,E){const k=Dh(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,w),D=this.paint.get("fill-extrusion-height").evaluate(r,l),B=this.paint.get("fill-extrusion-base").evaluate(r,l),N=function(j,Y,te,ne){const ge=[];for(const le of j){const xe=[le.x,le.y,0,1];Rh(xe,xe,Y),ge.push(new _e(xe[0]/xe[3],xe[1]/xe[3]))}return ge}(k,E),Z=function(j,Y,te,ne){const ge=[],le=[],xe=ne[8]*Y,Se=ne[9]*Y,ze=ne[10]*Y,et=ne[11]*Y,ut=ne[8]*te,Je=ne[9]*te,Ke=ne[10]*te,Ze=ne[11]*te;for(const nt of j){const Ge=[],Oe=[];for(const gt of nt){const pt=gt.x,Nt=gt.y,bi=ne[0]*pt+ne[4]*Nt+ne[12],Pi=ne[1]*pt+ne[5]*Nt+ne[13],cn=ne[2]*pt+ne[6]*Nt+ne[14],Gr=ne[3]*pt+ne[7]*Nt+ne[15],ur=cn+ze,nn=Gr+et,yn=bi+ut,On=Pi+Je,Cr=cn+Ke,cr=Gr+Ze,rn=new _e((bi+xe)/nn,(Pi+Se)/nn);rn.z=ur/nn,Ge.push(rn);const hn=new _e(yn/cr,On/cr);hn.z=Cr/cr,Oe.push(hn)}ge.push(Ge),le.push(Oe)}return[ge,le]}(p,B,D,E);return function(j,Y,te){let ne=1/0;b_(te,Y)&&(ne=G_(te,Y[0]));for(let ge=0;ge<Y.length;ge++){const le=Y[ge],xe=j[ge];for(let Se=0;Se<le.length-1;Se++){const ze=le[Se],et=[ze,le[Se+1],xe[Se+1],xe[Se],ze];w_(te,et)&&(ne=Math.min(ne,G_(te,et)))}}return ne!==1/0&&ne}(Z[0],Z[1],N)}}function Lc(i,e){return i.x*e.x+i.y*e.y}function G_(i,e){if(i.length===1){let r=0;const l=e[r++];let p;for(;!p||l.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){const _=e[r],y=i[0],w=p.sub(l),E=_.sub(l),k=y.sub(l),D=Lc(w,w),B=Lc(w,E),N=Lc(E,E),Z=Lc(k,w),j=Lc(k,E),Y=D*N-B*B,te=(N*Z-B*j)/Y,ne=(D*j-B*Z)/Y,ge=l.z*(1-te-ne)+p.z*te+_.z*ne;if(isFinite(ge))return ge}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}const _1=zi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:g1}=_1,y1=zi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:v1}=y1,x1=ml.VectorTileFeature.types,w1=Math.cos(Math.PI/180*37.5),W_=Math.pow(2,14)/.5;class zp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new Be,this.indexArray=new st,this.programConfigurations=new Ta(e.layers,e.zoom),this.segments=new bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.hasPattern=Pp("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),_=!p.isConstant(),y=[];for(const{feature:w,id:E,index:k,sourceLayerIndex:D}of e){const B=this.layers[0]._featureFilter.needGeometry,N=ds(w,B);if(!this.layers[0]._featureFilter.filter(new fi(this.zoom),N,l))continue;const Z=_?p.evaluate(N,{},l):void 0,j={id:E,properties:w.properties,type:w.type,sourceLayerIndex:D,index:k,geometry:B?N.geometry:Ws(w),patterns:{},sortKey:Z};y.push(j)}_&&y.sort((w,E)=>w.sortKey-E.sortKey);for(const w of y){const{geometry:E,index:k,sourceLayerIndex:D}=w;if(this.hasPattern){const B=Cp("line",this.layers,w,this.zoom,r);this.patternFeatures.push(B)}else this.addFeature(w,E,k,l,{});r.featureIndex.insert(e[k].feature,E,k,D,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}addFeatures(e,r,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,v1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,l,p,_){const y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),E=y.get("line-cap"),k=y.get("line-miter-limit"),D=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of r)this.addLine(B,e,w,E,k,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,_,p)}addLine(e,r,l,p,_,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<e.length-1;ne++)this.totalDistance+=e[ne].dist(e[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=x1[r.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let k=0;for(;k<E-1&&e[k].equals(e[k+1]);)k++;if(E<(w?3:2))return;l==="bevel"&&(_=1.05);const D=this.overscaling<=16?15*Li/(512*this.overscaling):0,B=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let N,Z,j,Y,te;this.e1=this.e2=-1,w&&(N=e[E-2],te=e[k].sub(N)._unit()._perp());for(let ne=k;ne<E;ne++){if(j=ne===E-1?w?e[k+1]:void 0:e[ne+1],j&&e[ne].equals(j))continue;te&&(Y=te),N&&(Z=N),N=e[ne],te=j?j.sub(N)._unit()._perp():Y,Y=Y||te;let ge=Y.add(te);ge.x===0&&ge.y===0||ge._unit();const le=Y.x*te.x+Y.y*te.y,xe=ge.x*te.x+ge.y*te.y,Se=xe!==0?1/xe:1/0,ze=2*Math.sqrt(2-2*xe),et=xe<w1&&Z&&j,ut=Y.x*te.y-Y.y*te.x>0;if(et&&ne>k){const Ze=N.dist(Z);if(Ze>2*D){const nt=N.sub(N.sub(Z)._mult(D/Ze)._round());this.updateDistance(Z,nt),this.addCurrentVertex(nt,Y,0,0,B),Z=nt}}const Je=Z&&j;let Ke=Je?l:w?"butt":p;if(Je&&Ke==="round"&&(Se<y?Ke="miter":Se<=2&&(Ke="fakeround")),Ke==="miter"&&Se>_&&(Ke="bevel"),Ke==="bevel"&&(Se>2&&(Ke="flipbevel"),Se<_&&(Ke="miter")),Z&&this.updateDistance(Z,N),Ke==="miter")ge._mult(Se),this.addCurrentVertex(N,ge,0,0,B);else if(Ke==="flipbevel"){if(Se>100)ge=te.mult(-1);else{const Ze=Se*Y.add(te).mag()/Y.sub(te).mag();ge._perp()._mult(Ze*(ut?-1:1))}this.addCurrentVertex(N,ge,0,0,B),this.addCurrentVertex(N,ge.mult(-1),0,0,B)}else if(Ke==="bevel"||Ke==="fakeround"){const Ze=-Math.sqrt(Se*Se-1),nt=ut?Ze:0,Ge=ut?0:Ze;if(Z&&this.addCurrentVertex(N,Y,nt,Ge,B),Ke==="fakeround"){const Oe=Math.round(180*ze/Math.PI/20);for(let gt=1;gt<Oe;gt++){let pt=gt/Oe;if(pt!==.5){const bi=pt-.5;pt+=pt*bi*(pt-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*bi*bi+(.848013+le*(.215638*le-1.06021)))}const Nt=te.sub(Y)._mult(pt)._add(Y)._unit()._mult(ut?-1:1);this.addHalfVertex(N,Nt.x,Nt.y,!1,ut,0,B)}}j&&this.addCurrentVertex(N,te,-nt,-Ge,B)}else if(Ke==="butt")this.addCurrentVertex(N,ge,0,0,B);else if(Ke==="square"){const Ze=Z?1:-1;this.addCurrentVertex(N,ge,Ze,Ze,B)}else Ke==="round"&&(Z&&(this.addCurrentVertex(N,Y,0,0,B),this.addCurrentVertex(N,Y,1,1,B,!0)),j&&(this.addCurrentVertex(N,te,-1,-1,B,!0),this.addCurrentVertex(N,te,0,0,B)));if(et&&ne<E-1){const Ze=N.dist(j);if(Ze>2*D){const nt=N.add(j.sub(N)._mult(D/Ze)._round());this.updateDistance(N,nt),this.addCurrentVertex(nt,te,0,0,B),N=nt}}}}addCurrentVertex(e,r,l,p,_,y=!1){const w=r.y*p-r.x,E=-r.y-r.x*p;this.addHalfVertex(e,r.x+r.y*l,r.y-r.x*l,y,!1,l,_),this.addHalfVertex(e,w,E,y,!0,-p,_),this.distance>W_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,l,p,_,y))}addHalfVertex({x:e,y:r},l,p,_,y,w,E){const k=.5*(this.lineClips?this.scaledDistance*(W_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(r<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let H_,X_;Qe("LineBucket",zp,{omit:["layers","patternFeatures"]});var K_={get paint(){return X_=X_||new Yt({"line-opacity":new Te(Ie.paint_line["line-opacity"]),"line-color":new Te(Ie.paint_line["line-color"]),"line-translate":new ce(Ie.paint_line["line-translate"]),"line-translate-anchor":new ce(Ie.paint_line["line-translate-anchor"]),"line-width":new Te(Ie.paint_line["line-width"]),"line-gap-width":new Te(Ie.paint_line["line-gap-width"]),"line-offset":new Te(Ie.paint_line["line-offset"]),"line-blur":new Te(Ie.paint_line["line-blur"]),"line-dasharray":new Pt(Ie.paint_line["line-dasharray"]),"line-pattern":new it(Ie.paint_line["line-pattern"]),"line-gradient":new Ft(Ie.paint_line["line-gradient"])})},get layout(){return H_=H_||new Yt({"line-cap":new ce(Ie.layout_line["line-cap"]),"line-join":new Te(Ie.layout_line["line-join"]),"line-miter-limit":new ce(Ie.layout_line["line-miter-limit"]),"line-round-limit":new ce(Ie.layout_line["line-round-limit"]),"line-sort-key":new Te(Ie.layout_line["line-sort-key"])})}};class b1 extends Te{possiblyEvaluate(e,r){return r=new fi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,p){return r=ye({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,p)}}let Uh;class T1 extends Mi{constructor(e){super(e,K_),this.gradientVersion=0,Uh||(Uh=new b1(K_.paint.properties["line-width"].specification),Uh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){e==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Xo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Uh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new zp(e)}queryRadius(e){const r=e,l=Y_(Ec("line-width",this,r),Ec("line-gap-width",this,r)),p=Ec("line-offset",this,r);return l/2+Math.abs(p)+Lh(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,l,p,_,y,w){const E=Dh(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,w),k=w/2*Y_(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),D=this.paint.get("line-offset").evaluate(r,l);return D&&(p=function(B,N){const Z=[];for(let j=0;j<B.length;j++){const Y=B[j],te=[];for(let ne=0;ne<Y.length;ne++){const ge=Y[ne-1],le=Y[ne],xe=Y[ne+1],Se=ne===0?new _e(0,0):le.sub(ge)._unit()._perp(),ze=ne===Y.length-1?new _e(0,0):xe.sub(le)._unit()._perp(),et=Se._add(ze)._unit(),ut=et.x*ze.x+et.y*ze.y;ut!==0&&et._mult(1/ut),te.push(et._mult(N)._add(le))}Z.push(te)}return Z}(p,D*w)),function(B,N,Z){for(let j=0;j<N.length;j++){const Y=N[j];if(B.length>=3){for(let te=0;te<Y.length;te++)if(Mu(B,Y[te]))return!0}if(k0(B,Y,Z))return!0}return!1}(E,p,k)}isTileClipped(){return!0}}function Y_(i,e){return e>0?e+2*i:i}const S1=zi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),E1=zi([{name:"a_projected_pos",components:3,type:"Float32"}],4);zi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const P1=zi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);zi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const J_=zi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),C1=zi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function I1(i,e,r){return i.sections.forEach(l=>{l.text=function(p,_,y){const w=_.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Wn.applyArabicShaping&&(p=Wn.applyArabicShaping(p)),p}(l.text,e,r)}),i}zi([{name:"triangle",components:3,type:"Uint16"}]),zi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),zi([{type:"Float32",name:"offsetX"}]),zi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),zi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Dc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var un=24,Q_=ci,eg=function(i,e,r,l,p){var _,y,w=8*p-l-1,E=(1<<w)-1,k=E>>1,D=-7,B=r?p-1:0,N=r?-1:1,Z=i[e+B];for(B+=N,_=Z&(1<<-D)-1,Z>>=-D,D+=w;D>0;_=256*_+i[e+B],B+=N,D-=8);for(y=_&(1<<-D)-1,_>>=-D,D+=l;D>0;y=256*y+i[e+B],B+=N,D-=8);if(_===0)_=1-k;else{if(_===E)return y?NaN:1/0*(Z?-1:1);y+=Math.pow(2,l),_-=k}return(Z?-1:1)*y*Math.pow(2,_-l)},tg=function(i,e,r,l,p,_){var y,w,E,k=8*_-p-1,D=(1<<k)-1,B=D>>1,N=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=l?0:_-1,j=l?1:-1,Y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,y=D):(y=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-y))<1&&(y--,E*=2),(e+=y+B>=1?N/E:N*Math.pow(2,1-B))*E>=2&&(y++,E/=2),y+B>=D?(w=0,y=D):y+B>=1?(w=(e*E-1)*Math.pow(2,p),y+=B):(w=e*Math.pow(2,B-1)*Math.pow(2,p),y=0));p>=8;i[r+Z]=255&w,Z+=j,w/=256,p-=8);for(y=y<<p|w,k+=p;k>0;i[r+Z]=255&y,Z+=j,y/=256,k-=8);i[r+Z-j]|=128*Y};function ci(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ci.Varint=0,ci.Fixed64=1,ci.Bytes=2,ci.Fixed32=5;var Ap=4294967296,ig=1/Ap,ng=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sa(i){return i.type===ci.Bytes?i.readVarint()+i.pos:i.pos+1}function Du(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function rg(i,e,r){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(l);for(var p=r.pos-1;p>=i;p--)r.buf[p+l]=r.buf[p]}function k1(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function M1(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function z1(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function A1(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function L1(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function D1(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function R1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function B1(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function O1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Vh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ru(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function og(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}ci.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var l=this.readVarint(),p=l>>3,_=this.pos;this.type=7&l,i(p,e,this),this.pos===_&&this.skip(l)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Vh(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=og(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Vh(this.buf,this.pos)+Vh(this.buf,this.pos+4)*Ap;return this.pos+=8,i},readSFixed64:function(){var i=Vh(this.buf,this.pos)+og(this.buf,this.pos+4)*Ap;return this.pos+=8,i},readFloat:function(){var i=eg(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=eg(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,l=this.buf;return e=127&(r=l[this.pos++]),r<128?e:(e|=(127&(r=l[this.pos++]))<<7,r<128?e:(e|=(127&(r=l[this.pos++]))<<14,r<128?e:(e|=(127&(r=l[this.pos++]))<<21,r<128?e:function(p,_,y){var w,E,k=y.buf;if(w=(112&(E=k[y.pos++]))>>4,E<128||(w|=(127&(E=k[y.pos++]))<<3,E<128)||(w|=(127&(E=k[y.pos++]))<<10,E<128)||(w|=(127&(E=k[y.pos++]))<<17,E<128)||(w|=(127&(E=k[y.pos++]))<<24,E<128)||(w|=(1&(E=k[y.pos++]))<<31,E<128))return Du(p,w,_);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&ng?function(r,l,p){return ng.decode(r.subarray(l,p))}(this.buf,e,i):function(r,l,p){for(var _="",y=l;y<p;){var w,E,k,D=r[y],B=null,N=D>239?4:D>223?3:D>191?2:1;if(y+N>p)break;N===1?D<128&&(B=D):N===2?(192&(w=r[y+1]))==128&&(B=(31&D)<<6|63&w)<=127&&(B=null):N===3?(E=r[y+2],(192&(w=r[y+1]))==128&&(192&E)==128&&((B=(15&D)<<12|(63&w)<<6|63&E)<=2047||B>=55296&&B<=57343)&&(B=null)):N===4&&(E=r[y+2],k=r[y+3],(192&(w=r[y+1]))==128&&(192&E)==128&&(192&k)==128&&((B=(15&D)<<18|(63&w)<<12|(63&E)<<6|63&k)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,N=1):B>65535&&(B-=65536,_+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),_+=String.fromCharCode(B),y+=N}return _}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==ci.Bytes)return i.push(this.readVarint(e));var r=Sa(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==ci.Bytes)return i.push(this.readSVarint());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ci.Bytes)return i.push(this.readBoolean());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ci.Bytes)return i.push(this.readFloat());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ci.Bytes)return i.push(this.readDouble());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ci.Bytes)return i.push(this.readFixed32());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ci.Bytes)return i.push(this.readSFixed32());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ci.Bytes)return i.push(this.readFixed64());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ci.Bytes)return i.push(this.readSFixed64());var e=Sa(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===ci.Varint)for(;this.buf[this.pos++]>127;);else if(e===ci.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ci.Fixed32)this.pos+=4;else{if(e!==ci.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ru(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ru(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ru(this.buf,-1&i,this.pos),Ru(this.buf,Math.floor(i*ig),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ru(this.buf,-1&i,this.pos),Ru(this.buf,Math.floor(i*ig),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var l,p;if(e>=0?(l=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(_,y,w){w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7)}(l,0,r),function(_,y){var w=(7&_)<<4;y.buf[y.pos++]|=w|((_>>>=3)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_)))))}(p,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(l,p,_){for(var y,w,E=0;E<p.length;E++){if((y=p.charCodeAt(E))>55295&&y<57344){if(!w){y>56319||E+1===p.length?(l[_++]=239,l[_++]=191,l[_++]=189):w=y;continue}if(y<56320){l[_++]=239,l[_++]=191,l[_++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(l[_++]=239,l[_++]=191,l[_++]=189,w=null);y<128?l[_++]=y:(y<2048?l[_++]=y>>6|192:(y<65536?l[_++]=y>>12|224:(l[_++]=y>>18|240,l[_++]=y>>12&63|128),l[_++]=y>>6&63|128),l[_++]=63&y|128)}return _}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&rg(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),tg(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),tg(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var l=this.pos-r;l>=128&&rg(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,e,r){this.writeTag(i,ci.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,k1,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,M1,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,L1,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,z1,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,A1,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,D1,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,R1,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,B1,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,O1,e)},writeBytesField:function(i,e){this.writeTag(i,ci.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,ci.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,ci.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,ci.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,ci.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,ci.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,ci.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,ci.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,ci.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,ci.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Lp=H(Q_);const Dp=3;function F1(i,e,r){i===1&&r.readMessage(N1,e)}function N1(i,e,r){if(i===3){const{id:l,bitmap:p,width:_,height:y,left:w,top:E,advance:k}=r.readMessage(U1,{});e.push({id:l,bitmap:new Cc({width:_+2*Dp,height:y+2*Dp},p),metrics:{width:_,height:y,left:w,top:E,advance:k}})}}function U1(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const sg=Dp;function ag(i){let e=0,r=0;for(const y of i)e+=y.w*y.h,r=Math.max(r,y.w);i.sort((y,w)=>w.h-y.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let p=0,_=0;for(const y of i)for(let w=l.length-1;w>=0;w--){const E=l[w];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,_=Math.max(_,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===E.w&&y.h===E.h){const k=l.pop();w<l.length&&(l[w]=k)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(l.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:p,h:_,fill:e/(p*_)||0}}const Pr=1;class Rp{constructor(e,{pixelRatio:r,version:l,stretchX:p,stretchY:_,content:y}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=_,this.content=y,this.version=l}get tl(){return[this.paddedRect.x+Pr,this.paddedRect.y+Pr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Pr,this.paddedRect.y+this.paddedRect.h-Pr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Pr)/this.pixelRatio,(this.paddedRect.h-2*Pr)/this.pixelRatio]}}class lg{constructor(e,r){const l={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,l,_),this.addImages(r,p,_);const{w:y,h:w}=ag(_),E=new _o({width:y||1,height:w||1});for(const k in e){const D=e[k],B=l[k].paddedRect;_o.copy(D.data,E,{x:0,y:0},{x:B.x+Pr,y:B.y+Pr},D.data)}for(const k in r){const D=r[k],B=p[k].paddedRect,N=B.x+Pr,Z=B.y+Pr,j=D.data.width,Y=D.data.height;_o.copy(D.data,E,{x:0,y:0},{x:N,y:Z},D.data),_o.copy(D.data,E,{x:0,y:Y-1},{x:N,y:Z-1},{width:j,height:1}),_o.copy(D.data,E,{x:0,y:0},{x:N,y:Z+Y},{width:j,height:1}),_o.copy(D.data,E,{x:j-1,y:0},{x:N-1,y:Z},{width:1,height:Y}),_o.copy(D.data,E,{x:0,y:0},{x:N+j,y:Z},{width:1,height:Y})}this.image=E,this.iconPositions=l,this.patternPositions=p}addImages(e,r,l){for(const p in e){const _=e[p],y={x:0,y:0,w:_.data.width+2*Pr,h:_.data.height+2*Pr};l.push(y),r[p]=new Rp(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),r),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),r)}patchUpdatedImage(e,r,l){if(!e||!r||e.version===r.version)return;e.version=r.version;const[p,_]=e.tl;l.update(r.data,void 0,{x:p,y:_})}}var _l;Qe("ImagePosition",Rp),Qe("ImageAtlas",lg),u.WritingMode=void 0,(_l=u.WritingMode||(u.WritingMode={}))[_l.none=0]="none",_l[_l.horizontal=1]="horizontal",_l[_l.vertical=2]="vertical",_l[_l.horizontalOnly=3]="horizontalOnly";const Rc=-17;class Bc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const l=new Bc;return l.scale=e||1,l.fontStack=r,l}static forImage(e){const r=new Bc;return r.imageName=e,r}}class Bu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const l=new Bu;for(let p=0;p<e.sections.length;p++){const _=e.sections[p];_.image?l.addImageSection(_):l.addTextSection(_,r)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let l=0;l<e.length;l++){const p=e.charCodeAt(l+1)||null,_=e.charCodeAt(l-1)||null;r+=p&&sl(p)&&!Dc[e[l+1]]||_&&sl(_)&&!Dc[e[l-1]]||!Dc[e[l]]?e[l]:Dc[e[l]]}return r}(this.text)}trim(){let e=0;for(let l=0;l<this.text.length&&$h[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&$h[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const l=new Bu;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Bc.forText(e.scale,e.fontStack||r));const l=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(l)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ut("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Bc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ut("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zh(i,e,r,l,p,_,y,w,E,k,D,B,N,Z,j,Y){const te=Bu.fromFeature(i,p);let ne;B===u.WritingMode.vertical&&te.verticalizePunctuation();const{processBidirectionalText:ge,processStyledBidirectionalText:le}=Wn;if(ge&&te.sections.length===1){ne=[];const ze=ge(te.toString(),Bp(te,k,_,e,l,Z,j));for(const et of ze){const ut=new Bu;ut.text=et,ut.sections=te.sections;for(let Je=0;Je<et.length;Je++)ut.sectionIndex.push(0);ne.push(ut)}}else if(le){ne=[];const ze=le(te.text,te.sectionIndex,Bp(te,k,_,e,l,Z,j));for(const et of ze){const ut=new Bu;ut.text=et[0],ut.sectionIndex=et[1],ut.sections=te.sections,ne.push(ut)}}else ne=function(ze,et){const ut=[],Je=ze.text;let Ke=0;for(const Ze of et)ut.push(ze.substring(Ke,Ze)),Ke=Ze;return Ke<Je.length&&ut.push(ze.substring(Ke,Je.length)),ut}(te,Bp(te,k,_,e,l,Z,j));const xe=[],Se={positionedLines:xe,text:te.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(ze,et,ut,Je,Ke,Ze,nt,Ge,Oe,gt,pt,Nt){let bi=0,Pi=Rc,cn=0,Gr=0;const ur=Ge==="right"?1:Ge==="left"?0:.5;let nn=0;for(const rn of Ke){rn.trim();const hn=rn.getMaxScale(),Xn=(hn-1)*un,hr={positionedGlyphs:[],lineOffset:0};ze.positionedLines[nn]=hr;const Ir=hr.positionedGlyphs;let kr=0;if(!rn.length()){Pi+=Ze,++nn;continue}for(let Fn=0;Fn<rn.length();Fn++){const jt=rn.getSection(Fn),Wr=rn.getSectionIndex(Fn),Nn=rn.getCharCode(Fn);let dr=0,Oo=null,ps=null,fs=null,Ea=un;const Fo=!(Oe===u.WritingMode.horizontal||!pt&&!ss(Nn)||pt&&($h[Nn]||(yn=Nn,Ye.Arabic(yn)||Ye["Arabic Supplement"](yn)||Ye["Arabic Extended-A"](yn)||Ye["Arabic Presentation Forms-A"](yn)||Ye["Arabic Presentation Forms-B"](yn))));if(jt.imageName){const yo=Je[jt.imageName];if(!yo)continue;fs=jt.imageName,ze.iconsInText=ze.iconsInText||!0,ps=yo.paddedRect;const Mr=yo.displaySize;jt.scale=jt.scale*un/Nt,Oo={width:Mr[0],height:Mr[1],left:Pr,top:-sg,advance:Fo?Mr[1]:Mr[0]},dr=Xn+(un-Mr[1]*jt.scale),Ea=Oo.advance;const Pa=Fo?Mr[0]*jt.scale-un*hn:Mr[1]*jt.scale-un*hn;Pa>0&&Pa>kr&&(kr=Pa)}else{const yo=ut[jt.fontStack],Mr=yo&&yo[Nn];if(Mr&&Mr.rect)ps=Mr.rect,Oo=Mr.metrics;else{const Pa=et[jt.fontStack],Vc=Pa&&Pa[Nn];if(!Vc)continue;Oo=Vc.metrics}dr=(hn-jt.scale)*un}Fo?(ze.verticalizable=!0,Ir.push({glyph:Nn,imageName:fs,x:bi,y:Pi+dr,vertical:Fo,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Wr,metrics:Oo,rect:ps}),bi+=Ea*jt.scale+gt):(Ir.push({glyph:Nn,imageName:fs,x:bi,y:Pi+dr,vertical:Fo,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Wr,metrics:Oo,rect:ps}),bi+=Oo.advance*jt.scale+gt)}Ir.length!==0&&(cn=Math.max(bi-gt,cn),$1(Ir,0,Ir.length-1,ur,kr)),bi=0;const Zi=Ze*hn+kr;hr.lineOffset=Math.max(kr,Xn),Pi+=Zi,Gr=Math.max(Zi,Gr),++nn}var yn;const On=Pi-Rc,{horizontalAlign:Cr,verticalAlign:cr}=Op(nt);(function(rn,hn,Xn,hr,Ir,kr,Zi,Fn,jt){const Wr=(hn-Xn)*Ir;let Nn=0;Nn=kr!==Zi?-Fn*hr-Rc:(-hr*jt+.5)*Zi;for(const dr of rn)for(const Oo of dr.positionedGlyphs)Oo.x+=Wr,Oo.y+=Nn})(ze.positionedLines,ur,Cr,cr,cn,Gr,Ze,On,Ke.length),ze.top+=-cr*On,ze.bottom=ze.top+On,ze.left+=-Cr*cn,ze.right=ze.left+cn}(Se,e,r,l,ne,y,w,E,B,k,N,Y),!function(ze){for(const et of ze)if(et.positionedGlyphs.length!==0)return!1;return!0}(xe)&&Se}const $h={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},V1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ug(i,e,r,l,p,_){if(e.imageName){const y=l[e.imageName];return y?y.displaySize[0]*e.scale*un/_+p:0}{const y=r[e.fontStack],w=y&&y[i];return w?w.metrics.advance*e.scale+p:0}}function cg(i,e,r,l){const p=Math.pow(i-e,2);return l?i<e?p/2:2*p:p+Math.abs(r)*r}function Z1(i,e,r){let l=0;return i===10&&(l-=1e4),r&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function hg(i,e,r,l,p,_){let y=null,w=cg(e,r,p,_);for(const E of l){const k=cg(e-E.x,r,p,_)+E.badness;k<=w&&(y=E,w=k)}return{index:i,x:e,priorBreak:y,badness:w}}function dg(i){return i?dg(i.priorBreak).concat(i.index):[]}function Bp(i,e,r,l,p,_,y){if(_!=="point")return[];if(!i)return[];const w=[],E=function(N,Z,j,Y,te,ne){let ge=0;for(let le=0;le<N.length();le++){const xe=N.getSection(le);ge+=ug(N.getCharCode(le),xe,Y,te,Z,ne)}return ge/Math.max(1,Math.ceil(ge/j))}(i,e,r,l,p,y),k=i.text.indexOf("")>=0;let D=0;for(let N=0;N<i.length();N++){const Z=i.getSection(N),j=i.getCharCode(N);if($h[j]||(D+=ug(j,Z,l,p,e,y)),N<i.length()-1){const Y=!((B=j)<11904||!(Ye["Bopomofo Extended"](B)||Ye.Bopomofo(B)||Ye["CJK Compatibility Forms"](B)||Ye["CJK Compatibility Ideographs"](B)||Ye["CJK Compatibility"](B)||Ye["CJK Radicals Supplement"](B)||Ye["CJK Strokes"](B)||Ye["CJK Symbols and Punctuation"](B)||Ye["CJK Unified Ideographs Extension A"](B)||Ye["CJK Unified Ideographs"](B)||Ye["Enclosed CJK Letters and Months"](B)||Ye["Halfwidth and Fullwidth Forms"](B)||Ye.Hiragana(B)||Ye["Ideographic Description Characters"](B)||Ye["Kangxi Radicals"](B)||Ye["Katakana Phonetic Extensions"](B)||Ye.Katakana(B)||Ye["Vertical Forms"](B)||Ye["Yi Radicals"](B)||Ye["Yi Syllables"](B)));(V1[j]||Y||Z.imageName)&&w.push(hg(N+1,D,E,w,Z1(j,i.getCharCode(N+1),Y&&k),!1))}}var B;return dg(hg(i.length(),D,E,w,0,!0))}function Op(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function $1(i,e,r,l,p){if(!l&&!p)return;const _=i[r],y=(i[r].x+_.metrics.advance*_.scale)*l;for(let w=e;w<=r;w++)i[w].x-=y,i[w].y+=p}function j1(i,e,r){const{horizontalAlign:l,verticalAlign:p}=Op(r),_=e[0]-i.displaySize[0]*l,y=e[1]-i.displaySize[1]*p;return{image:i,top:y,bottom:y+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function pg(i,e,r,l,p,_){const y=i.image;let w;if(y.content){const te=y.content,ne=y.pixelRatio||1;w=[te[0]/ne,te[1]/ne,y.displaySize[0]-te[2]/ne,y.displaySize[1]-te[3]/ne]}const E=e.left*_,k=e.right*_;let D,B,N,Z;r==="width"||r==="both"?(Z=p[0]+E-l[3],B=p[0]+k+l[1]):(Z=p[0]+(E+k-y.displaySize[0])/2,B=Z+y.displaySize[0]);const j=e.top*_,Y=e.bottom*_;return r==="height"||r==="both"?(D=p[1]+j-l[0],N=p[1]+Y+l[2]):(D=p[1]+(j+Y-y.displaySize[1])/2,N=D+y.displaySize[1]),{image:y,top:D,right:B,bottom:N,left:Z,collisionPadding:w}}const Oc=255,Hs=128,gl=Oc*Hs;function fg(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new fi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=r;let _=0;for(;_<l.length&&l[_]<=i;)_++;_=Math.max(0,_-1);let y=_;for(;y<l.length&&l[y]<i+1;)y++;y=Math.min(l.length-1,y);const w=l[_],E=l[y];return r.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:E,minSize:r.evaluate(new fi(w)),maxSize:r.evaluate(new fi(E)),interpolationType:p}}}function Fp(i,e,r){let l="never";const p=i.get(e);return p?l=p:i.get(r)&&(l="always"),l}const q1=ml.VectorTileFeature.types,G1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jh(i,e,r,l,p,_,y,w,E,k,D,B,N){const Z=w?Math.min(gl,Math.round(w[0])):0,j=w?Math.min(gl,Math.round(w[1])):0;i.emplaceBack(e,r,Math.round(32*l),Math.round(32*p),_,y,(Z<<1)+(E?1:0),j,16*k,16*D,256*B,256*N)}function Np(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function W1(i){for(const e of i.sections)if(al(e.text))return!0;return!1}class Up{constructor(e){this.layoutVertexArray=new Ve,this.indexArray=new st,this.programConfigurations=e,this.segments=new bt,this.dynamicLayoutVertexArray=new lt,this.opacityVertexArray=new $t,this.hasVisibleVertices=!1,this.placedSymbolArray=new A}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,E1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,G1,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qe("SymbolBuffers",Up);class Vp{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new bt,this.collisionVertexArray=new wt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,P1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Qe("CollisionBuffers",Vp);class Ou{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yp([]),this.placementViewportMatrix=yp([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fg(this.zoom,r["text-size"]),this.iconSizeData=fg(this.zoom,r["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=Fp(l,"text-overlap","text-allow-overlap")!=="never"||Fp(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(y=>u.WritingMode[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Up(new Ta(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Up(new Ta(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new K,this.lineVertexArray=new X,this.symbolInstances=new V,this.textAnchorOffsets=new W}calculateGlyphDependencies(e,r,l,p,_){for(let y=0;y<e.length;y++)if(r[e.charCodeAt(y)]=!0,(l||p)&&_){const w=Dc[e.charAt(y)];w&&(r[w.charCodeAt(0)]=!0)}}populate(e,r,l){const p=this.layers[0],_=p.layout,y=_.get("text-font"),w=_.get("text-field"),E=_.get("icon-image"),k=(w.value.kind!=="constant"||w.value.value instanceof ki&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,B=_.get("symbol-sort-key");if(this.features=[],!k&&!D)return;const N=r.iconDependencies,Z=r.glyphDependencies,j=r.availableImages,Y=new fi(this.zoom);for(const{feature:te,id:ne,index:ge,sourceLayerIndex:le}of e){const xe=p._featureFilter.needGeometry,Se=ds(te,xe);if(!p._featureFilter.filter(Y,Se,l))continue;let ze,et;if(xe||(Se.geometry=Ws(te)),k){const Je=p.getValueAndResolveTokens("text-field",Se,l,j),Ke=ki.factory(Je);W1(Ke)&&(this.hasRTLText=!0),(!this.hasRTLText||Yl()==="unavailable"||this.hasRTLText&&Wn.isParsed())&&(ze=I1(Ke,p,Se))}if(D){const Je=p.getValueAndResolveTokens("icon-image",Se,l,j);et=Je instanceof nr?Je:nr.fromString(Je)}if(!ze&&!et)continue;const ut=this.sortFeaturesByKey?B.evaluate(Se,{},l):void 0;if(this.features.push({id:ne,text:ze,icon:et,index:ge,sourceLayerIndex:le,geometry:Se.geometry,properties:te.properties,type:q1[te.type],sortKey:ut}),et&&(N[et.name]=!0),ze){const Je=y.evaluate(Se,{},l).join(","),Ke=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.WritingMode.vertical)>=0;for(const Ze of ze.sections)if(Ze.image)N[Ze.image.name]=!0;else{const nt=xa(ze.toString()),Ge=Ze.fontStack||Je,Oe=Z[Ge]=Z[Ge]||{};this.calculateGlyphDependencies(Ze.text,Oe,Ke,this.allowVerticalPlacement,nt)}}}_.get("symbol-placement")==="line"&&(this.features=function(te){const ne={},ge={},le=[];let xe=0;function Se(Je){le.push(te[Je]),xe++}function ze(Je,Ke,Ze){const nt=ge[Je];return delete ge[Je],ge[Ke]=nt,le[nt].geometry[0].pop(),le[nt].geometry[0]=le[nt].geometry[0].concat(Ze[0]),nt}function et(Je,Ke,Ze){const nt=ne[Ke];return delete ne[Ke],ne[Je]=nt,le[nt].geometry[0].shift(),le[nt].geometry[0]=Ze[0].concat(le[nt].geometry[0]),nt}function ut(Je,Ke,Ze){const nt=Ze?Ke[0][Ke[0].length-1]:Ke[0][0];return`${Je}:${nt.x}:${nt.y}`}for(let Je=0;Je<te.length;Je++){const Ke=te[Je],Ze=Ke.geometry,nt=Ke.text?Ke.text.toString():null;if(!nt){Se(Je);continue}const Ge=ut(nt,Ze),Oe=ut(nt,Ze,!0);if(Ge in ge&&Oe in ne&&ge[Ge]!==ne[Oe]){const gt=et(Ge,Oe,Ze),pt=ze(Ge,Oe,le[gt].geometry);delete ne[Ge],delete ge[Oe],ge[ut(nt,le[pt].geometry,!0)]=pt,le[gt].geometry=null}else Ge in ge?ze(Ge,Oe,Ze):Oe in ne?et(Ge,Oe,Ze):(Se(Je),ne[Ge]=xe-1,ge[Oe]=xe-1)}return le.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,ne)=>te.sortKey-ne.sortKey)}update(e,r,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(r[e.segment+1]),_=e.dist(r[e.segment]);const y={};for(let w=e.segment+1;w<r.length;w++)y[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:p},w<r.length-1&&(p+=r[w+1].dist(r[w]));for(let w=e.segment||0;w>=0;w--)y[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=r[w-1].dist(r[w]));for(let w=0;w<r.length;w++){const E=y[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,p,_,y,w,E,k,D,B,N){const Z=e.indexArray,j=e.layoutVertexArray,Y=e.segments.prepareSegment(4*r.length,j,Z,this.canOverlap?y.sortKey:void 0),te=this.glyphOffsetArray.length,ne=Y.vertexLength,ge=this.allowVerticalPlacement&&w===u.WritingMode.vertical?Math.PI/2:0,le=y.text&&y.text.sections;for(let xe=0;xe<r.length;xe++){const{tl:Se,tr:ze,bl:et,br:ut,tex:Je,pixelOffsetTL:Ke,pixelOffsetBR:Ze,minFontScaleX:nt,minFontScaleY:Ge,glyphOffset:Oe,isSDF:gt,sectionIndex:pt}=r[xe],Nt=Y.vertexLength,bi=Oe[1];jh(j,E.x,E.y,Se.x,bi+Se.y,Je.x,Je.y,l,gt,Ke.x,Ke.y,nt,Ge),jh(j,E.x,E.y,ze.x,bi+ze.y,Je.x+Je.w,Je.y,l,gt,Ze.x,Ke.y,nt,Ge),jh(j,E.x,E.y,et.x,bi+et.y,Je.x,Je.y+Je.h,l,gt,Ke.x,Ze.y,nt,Ge),jh(j,E.x,E.y,ut.x,bi+ut.y,Je.x+Je.w,Je.y+Je.h,l,gt,Ze.x,Ze.y,nt,Ge),Np(e.dynamicLayoutVertexArray,E,ge),Z.emplaceBack(Nt,Nt+1,Nt+2),Z.emplaceBack(Nt+1,Nt+2,Nt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oe[0]),xe!==r.length-1&&pt===r[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,y,y.index,{},N,le&&le[pt])}e.placedSymbolArray.emplaceBack(E.x,E.y,te,this.glyphOffsetArray.length-te,ne,k,D,E.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],w,0,!1,0,B)}_addCollisionDebugVertex(e,r,l,p,_,y){return r.emplaceBack(0,0),e.emplaceBack(l.x,l.y,p,_,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,r,l,p,_,y,w){const E=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),k=E.vertexLength,D=_.layoutVertexArray,B=_.collisionVertexArray,N=w.anchorX,Z=w.anchorY;this._addCollisionDebugVertex(D,B,y,N,Z,new _e(e,r)),this._addCollisionDebugVertex(D,B,y,N,Z,new _e(l,r)),this._addCollisionDebugVertex(D,B,y,N,Z,new _e(l,p)),this._addCollisionDebugVertex(D,B,y,N,Z,new _e(e,p)),E.vertexLength+=4;const j=_.indexArray;j.emplaceBack(k,k+1),j.emplaceBack(k+1,k+2),j.emplaceBack(k+2,k+3),j.emplaceBack(k+3,k),E.primitiveLength+=4}addDebugCollisionBoxes(e,r,l,p){for(let _=e;_<r;_++){const y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,p?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vp(Xe,J_.members,mi),this.iconCollisionBox=new Vp(Xe,J_.members,mi);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,l,p,_,y,w,E,k){const D={};for(let B=r;B<l;B++){const N=e.get(B);D.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.textFeatureIndex=N.featureIndex;break}for(let B=p;B<_;B++){const N=e.get(B);D.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalTextFeatureIndex=N.featureIndex;break}for(let B=y;B<w;B++){const N=e.get(B);D.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.iconFeatureIndex=N.featureIndex;break}for(let B=E;B<k;B++){const N=e.get(B);D.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalIconFeatureIndex=N.featureIndex;break}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),p=l.vertexStartIndex+4*l.numGlyphs;for(let _=l.vertexStartIndex;_<p;_+=4)e.indexArray.emplaceBack(_,_+1,_+2),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),p=[],_=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const E=this.symbolInstances.get(w);p.push(0|Math.round(r*E.anchorX+l*E.anchorY)),_.push(E.featureIndex)}return y.sort((w,E)=>p[w]-p[E]||_[E]-_[w]),y}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,_,y)=>{p>=0&&y.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mg,_g;Qe("SymbolBucket",Ou,{omit:["layers","collisionBoxArray","features","compareText"]}),Ou.MAX_GLYPHS=65535,Ou.addDynamicAttributes=Np;var Zp={get paint(){return _g=_g||new Yt({"icon-opacity":new Te(Ie.paint_symbol["icon-opacity"]),"icon-color":new Te(Ie.paint_symbol["icon-color"]),"icon-halo-color":new Te(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Te(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Te(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new ce(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new ce(Ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new Te(Ie.paint_symbol["text-opacity"]),"text-color":new Te(Ie.paint_symbol["text-color"],{runtimeType:ln,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Te(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new Te(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Te(Ie.paint_symbol["text-halo-blur"]),"text-translate":new ce(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new ce(Ie.paint_symbol["text-translate-anchor"])})},get layout(){return mg=mg||new Yt({"symbol-placement":new ce(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new ce(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ce(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Te(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ce(Ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ce(Ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ce(Ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ce(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new ce(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ce(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Te(Ie.layout_symbol["icon-size"]),"icon-text-fit":new ce(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ce(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Te(Ie.layout_symbol["icon-image"]),"icon-rotate":new Te(Ie.layout_symbol["icon-rotate"]),"icon-padding":new Te(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new ce(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Te(Ie.layout_symbol["icon-offset"]),"icon-anchor":new Te(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ce(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ce(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ce(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new Te(Ie.layout_symbol["text-field"]),"text-font":new Te(Ie.layout_symbol["text-font"]),"text-size":new Te(Ie.layout_symbol["text-size"]),"text-max-width":new Te(Ie.layout_symbol["text-max-width"]),"text-line-height":new ce(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Te(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new Te(Ie.layout_symbol["text-justify"]),"text-radial-offset":new Te(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ce(Ie.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Te(Ie.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Te(Ie.layout_symbol["text-anchor"]),"text-max-angle":new ce(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new ce(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new Te(Ie.layout_symbol["text-rotate"]),"text-padding":new ce(Ie.layout_symbol["text-padding"]),"text-keep-upright":new ce(Ie.layout_symbol["text-keep-upright"]),"text-transform":new Te(Ie.layout_symbol["text-transform"]),"text-offset":new Te(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new ce(Ie.layout_symbol["text-allow-overlap"]),"text-overlap":new ce(Ie.layout_symbol["text-overlap"]),"text-ignore-placement":new ce(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new ce(Ie.layout_symbol["text-optional"])})}};class gg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Po,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qe("FormatSectionOverride",gg,{omit:["defaultValue"]});class qh extends Mi{constructor(e){super(e,Zp)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const _ of l)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,l,p){const _=this.layout.get(e).evaluate(r,{},l,p),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Ao(y.value)||!_?_:function(w,E){return E.replace(/{([^{}]+)}/g,(k,D)=>D in w?String(w[D]):"")}(r.properties,_)}createBucket(e){return new Ou(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Zp.paint.overridableProperties){if(!qh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new gg(r),p=new Si(l,r.property.specification);let _=null;_=r.value.kind==="constant"||r.value.kind==="source"?new Rs("source",p):new ui("composite",p,r.value.zoomStops),this.paint._values[e]=new oe(r.property,_,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&qh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),p=Zp.paint.properties[r];let _=!1;const y=w=>{for(const E of w)if(p.overrides&&p.overrides.hasOverride(E))return void(_=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ki)y(l.value.value.sections);else if(l.value.kind==="source"){const w=k=>{_||(k instanceof yr&&Ci(k.value)===zn?y(k.value.sections):k instanceof Wa?y(k.sections):k.eachChild(w))},E=l.value;E._styleExpression&&w(E._styleExpression.expression)}return _}}let yg;var H1={get paint(){return yg=yg||new Yt({"background-color":new ce(Ie.paint_background["background-color"]),"background-pattern":new Pt(Ie.paint_background["background-pattern"]),"background-opacity":new ce(Ie.paint_background["background-opacity"])})}};class X1 extends Mi{constructor(e){super(e,H1)}}let vg;var K1={get paint(){return vg=vg||new Yt({"raster-opacity":new ce(Ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new ce(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ce(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ce(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new ce(Ie.paint_raster["raster-saturation"]),"raster-contrast":new ce(Ie.paint_raster["raster-contrast"]),"raster-resampling":new ce(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new ce(Ie.paint_raster["raster-fade-duration"])})}};class Y1 extends Mi{constructor(e){super(e,K1)}}class J1 extends Mi{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Q1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const $p=63710088e-1;class yl{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yl(ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,p=e.lat*r,_=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return $p*Math.acos(Math.min(_,1))}static convert(e){if(e instanceof yl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new yl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new yl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xg=2*Math.PI*$p;function wg(i){return xg*Math.cos(i*Math.PI/180)}function bg(i){return(180+i)/360}function Tg(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Sg(i,e){return i/wg(e)}function jp(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Gh{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=yl.convert(e);return new Gh(bg(l.lng),Tg(l.lat),Sg(r,l.lat))}toLngLat(){return new yl(360*this.x-180,jp(this.y))}toAltitude(){return this.z*wg(jp(this.y))}meterInMercatorCoordinateUnits(){return 1/xg*(e=jp(this.y),1/Math.cos(e*Math.PI/180));var e}}function Eg(i,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class qp{constructor(e,r,l){if(e<0||e>25||l<0||l>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=l,this.key=Fc(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,l){const p=(y=this.y,w=this.z,E=Eg(256*(_=this.x),256*(y=Math.pow(2,w)-y-1),w),k=Eg(256*(_+1),256*(y+1),w),E[0]+","+E[1]+","+k[0]+","+k[1]);var _,y,w,E,k;const D=function(B,N,Z){let j,Y="";for(let te=B;te>0;te--)j=1<<te-1,Y+=(N&j?1:0)+(Z&j?2:0);return Y}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new _e((e.x*r-this.x)*Li,(e.y*r-this.y)*Li)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pg{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Fc(e,r.z,r.z,r.x,r.y)}}class go{constructor(e,r,l,p,_){if(e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=r,this.canonical=new qp(l,+p,+_),this.key=Fc(r,e,l,p,_)}clone(){return new go(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new go(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new go(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Fc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Fc(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new go(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new go(r,this.wrap,r,l,p),new go(r,this.wrap,r,l+1,p),new go(r,this.wrap,r,l,p+1),new go(r,this.wrap,r,l+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new go(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new go(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Gh(e.x-this.wrap,e.y))}}function Fc(i,e,r,l,p){(i*=2)<0&&(i=-1*i-1);const _=1<<r;return(_*_*i+_*p+l).toString(36)+r.toString(36)+e.toString(36)}Qe("CanonicalTileID",qp),Qe("OverscaledTileID",go,{omit:["posMatrix"]});class Cg{constructor(e,r,l){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Ut(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=l||"mapbox";for(let _=0;_<p;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(p,_)]=this.data[this._idx(p-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,p)]=this.data[this._idx(_,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let _=0;_<p;_++)for(let y=0;y<p;y++){const w=this.get(_,y);w>this.max&&(this.max=w),w<this.min&&(this.min=w)}}get(e,r){const l=new Uint8Array(this.data.buffer),p=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[p],l[p+1],l[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,l){return(256*e*256+256*r+l)/10-1e4}_unpackTerrarium(e,r,l){return 256*e+r+l/256-32768}getPixels(){return new _o({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,_=r*this.dim+this.dim,y=l*this.dim,w=l*this.dim+this.dim;switch(r){case-1:p=_-1;break;case 1:_=p+1}switch(l){case-1:y=w-1;break;case 1:w=y+1}const E=-r*this.dim,k=-l*this.dim;for(let D=y;D<w;D++)for(let B=p;B<_;B++)this.data[this._idx(B,D)]=e.data[this._idx(B+E,D+k)]}}Qe("DEMData",Cg);class Ig{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class kg{constructor(e,r,l,p,_){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=l,e._y=p,this.properties=e.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Mg{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new jr(Li,16,0),this.grid3D=new jr(Li,16,0),this.featureIndexArray=new be,this.promoteId=r}insert(e,r,l,p,_,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,_);const E=y?this.grid3D:this.grid;for(let k=0;k<r.length;k++){const D=r[k],B=[1/0,1/0,-1/0,-1/0];for(let N=0;N<D.length;N++){const Z=D[N];B[0]=Math.min(B[0],Z.x),B[1]=Math.min(B[1],Z.y),B[2]=Math.max(B[2],Z.x),B[3]=Math.max(B[3],Z.y)}B[0]<Li&&B[1]<Li&&B[2]>=0&&B[3]>=0&&E.insert(w,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ml.VectorTile(new Lp(this.rawTileData)).layers,this.sourceLayerCoder=new Ig(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,l,p){this.loadVTLayers();const _=e.params||{},y=Li/e.tileSize/e.scale,w=Ja(_.filter),E=e.queryGeometry,k=e.queryPadding*y,D=Ag(E),B=this.grid.query(D.minX-k,D.minY-k,D.maxX+k,D.maxY+k),N=Ag(e.cameraQueryGeometry),Z=this.grid3D.query(N.minX-k,N.minY-k,N.maxX+k,N.maxY+k,(te,ne,ge,le)=>function(xe,Se,ze,et,ut){for(const Ke of xe)if(Se<=Ke.x&&ze<=Ke.y&&et>=Ke.x&&ut>=Ke.y)return!0;const Je=[new _e(Se,ze),new _e(Se,ut),new _e(et,ut),new _e(et,ze)];if(xe.length>2){for(const Ke of Je)if(Mu(xe,Ke))return!0}for(let Ke=0;Ke<xe.length-1;Ke++)if(z0(xe[Ke],xe[Ke+1],Je))return!0;return!1}(e.cameraQueryGeometry,te-k,ne-k,ge+k,le+k));for(const te of Z)B.push(te);B.sort(ew);const j={};let Y;for(let te=0;te<B.length;te++){const ne=B[te];if(ne===Y)continue;Y=ne;const ge=this.featureIndexArray.get(ne);let le=null;this.loadMatchingFeature(j,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,w,_.layers,_.availableImages,r,l,p,(xe,Se,ze)=>(le||(le=Ws(xe)),Se.queryIntersectsFeature(E,xe,ze,le,this.z,e.transform,y,e.pixelPosMatrix)))}return j}loadMatchingFeature(e,r,l,p,_,y,w,E,k,D,B){const N=this.bucketLayerIDs[r];if(y&&!function(te,ne){for(let ge=0;ge<te.length;ge++)if(ne.indexOf(te[ge])>=0)return!0;return!1}(y,N))return;const Z=this.sourceLayerCoder.decode(l),j=this.vtLayers[Z].feature(p);if(_.needGeometry){const te=ds(j,!0);if(!_.filter(new fi(this.tileID.overscaledZ),te,this.tileID.canonical))return}else if(!_.filter(new fi(this.tileID.overscaledZ),j))return;const Y=this.getId(j,Z);for(let te=0;te<N.length;te++){const ne=N[te];if(y&&y.indexOf(ne)<0)continue;const ge=E[ne];if(!ge)continue;let le={};Y&&D&&(le=D.getState(ge.sourceLayer||"_geojsonTileLayer",Y));const xe=ye({},k[ne]);xe.paint=zg(xe.paint,ge.paint,j,le,w),xe.layout=zg(xe.layout,ge.layout,j,le,w);const Se=!B||B(j,ge,le);if(!Se)continue;const ze=new kg(j,this.z,this.x,this.y,Y);ze.layer=xe;let et=e[ne];et===void 0&&(et=e[ne]=[]),et.push({featureIndex:p,feature:ze,intersectionZ:Se})}}lookupSymbolFeatures(e,r,l,p,_,y,w,E){const k={};this.loadVTLayers();const D=Ja(_);for(const B of e)this.loadMatchingFeature(k,l,p,B,D,y,w,E,r);return k}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;return this.promoteId&&(l=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof l=="boolean"&&(l=Number(l))),l}}function zg(i,e,r,l,p){return tt(i,(_,y)=>{const w=e instanceof we?e.get(y):null;return w&&w.evaluate?w.evaluate(r,l,p):w})}function Ag(i){let e=1/0,r=1/0,l=-1/0,p=-1/0;for(const _ of i)e=Math.min(e,_.x),r=Math.min(r,_.y),l=Math.max(l,_.x),p=Math.max(p,_.y);return{minX:e,minY:r,maxX:l,maxY:p}}function ew(i,e){return e-i}function Lg(i,e,r,l,p){const _=[];for(let y=0;y<i.length;y++){const w=i[y];let E;for(let k=0;k<w.length-1;k++){let D=w[k],B=w[k+1];D.x<e&&B.x<e||(D.x<e?D=new _e(e,D.y+(e-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x<e&&(B=new _e(e,D.y+(e-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y<r&&B.y<r||(D.y<r?D=new _e(D.x+(r-D.y)/(B.y-D.y)*(B.x-D.x),r)._round():B.y<r&&(B=new _e(D.x+(r-D.y)/(B.y-D.y)*(B.x-D.x),r)._round()),D.x>=l&&B.x>=l||(D.x>=l?D=new _e(l,D.y+(l-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x>=l&&(B=new _e(l,D.y+(l-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y>=p&&B.y>=p||(D.y>=p?D=new _e(D.x+(p-D.y)/(B.y-D.y)*(B.x-D.x),p)._round():B.y>=p&&(B=new _e(D.x+(p-D.y)/(B.y-D.y)*(B.x-D.x),p)._round()),E&&D.equals(E[E.length-1])||(E=[D],_.push(E)),E.push(B)))))}}return _}Qe("FeatureIndex",Mg,{omit:["rawTileData","sourceLayerCoder"]});class vl extends _e{constructor(e,r,l,p){super(e,r),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new vl(this.x,this.y,this.angle,this.segment)}}function Dg(i,e,r,l,p){if(e.segment===void 0||r===0)return!0;let _=e,y=e.segment+1,w=0;for(;w>-r/2;){if(y--,y<0)return!1;w-=i[y].dist(_),_=i[y]}w+=i[y].dist(i[y+1]),y++;const E=[];let k=0;for(;w<r/2;){const D=i[y],B=i[y+1];if(!B)return!1;let N=i[y-1].angleTo(D)-D.angleTo(B);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:N}),k+=N;w-E[0].distance>l;)k-=E.shift().angleDelta;if(k>p)return!1;y++,w+=D.dist(B)}return!0}function Rg(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Bg(i,e,r){return i?.6*e*r:0}function Og(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function tw(i,e,r,l,p,_){const y=Bg(r,p,_),w=Og(r,l)*_;let E=0;const k=Rg(i)/2;for(let D=0;D<i.length-1;D++){const B=i[D],N=i[D+1],Z=B.dist(N);if(E+Z>k){const j=(k-E)/Z,Y=Gi.number(B.x,N.x,j),te=Gi.number(B.y,N.y,j),ne=new vl(Y,te,N.angleTo(B),D);return ne._round(),!y||Dg(i,ne,w,y,e)?ne:void 0}E+=Z}}function iw(i,e,r,l,p,_,y,w,E){const k=Bg(l,_,y),D=Og(l,p),B=D*y,N=i[0].x===0||i[0].x===E||i[0].y===0||i[0].y===E;return e-B<e/4&&(e=B+e/4),Fg(i,N?e/2*w%e:(D/2+2*_)*y*w%e,e,k,r,B,N,!1,E)}function Fg(i,e,r,l,p,_,y,w,E){const k=_/2,D=Rg(i);let B=0,N=e-r,Z=[];for(let j=0;j<i.length-1;j++){const Y=i[j],te=i[j+1],ne=Y.dist(te),ge=te.angleTo(Y);for(;N+r<B+ne;){N+=r;const le=(N-B)/ne,xe=Gi.number(Y.x,te.x,le),Se=Gi.number(Y.y,te.y,le);if(xe>=0&&xe<E&&Se>=0&&Se<E&&N-k>=0&&N+k<=D){const ze=new vl(xe,Se,ge,j);ze._round(),l&&!Dg(i,ze,_,l,p)||Z.push(ze)}}B+=ne}return w||Z.length||y||(Z=Fg(i,B/2,r,l,p,_,y,!0,E)),Z}Qe("Anchor",vl);const Fu=Pr;function Ng(i,e,r,l){const p=[],_=i.image,y=_.pixelRatio,w=_.paddedRect.w-2*Fu,E=_.paddedRect.h-2*Fu,k=i.right-i.left,D=i.bottom-i.top,B=_.stretchX||[[0,w]],N=_.stretchY||[[0,E]],Z=(Ze,nt)=>Ze+nt[1]-nt[0],j=B.reduce(Z,0),Y=N.reduce(Z,0),te=w-j,ne=E-Y;let ge=0,le=j,xe=0,Se=Y,ze=0,et=te,ut=0,Je=ne;if(_.content&&l){const Ze=_.content;ge=Wh(B,0,Ze[0]),xe=Wh(N,0,Ze[1]),le=Wh(B,Ze[0],Ze[2]),Se=Wh(N,Ze[1],Ze[3]),ze=Ze[0]-ge,ut=Ze[1]-xe,et=Ze[2]-Ze[0]-le,Je=Ze[3]-Ze[1]-Se}const Ke=(Ze,nt,Ge,Oe)=>{const gt=Hh(Ze.stretch-ge,le,k,i.left),pt=Xh(Ze.fixed-ze,et,Ze.stretch,j),Nt=Hh(nt.stretch-xe,Se,D,i.top),bi=Xh(nt.fixed-ut,Je,nt.stretch,Y),Pi=Hh(Ge.stretch-ge,le,k,i.left),cn=Xh(Ge.fixed-ze,et,Ge.stretch,j),Gr=Hh(Oe.stretch-xe,Se,D,i.top),ur=Xh(Oe.fixed-ut,Je,Oe.stretch,Y),nn=new _e(gt,Nt),yn=new _e(Pi,Nt),On=new _e(Pi,Gr),Cr=new _e(gt,Gr),cr=new _e(pt/y,bi/y),rn=new _e(cn/y,ur/y),hn=e*Math.PI/180;if(hn){const Ir=Math.sin(hn),kr=Math.cos(hn),Zi=[kr,-Ir,Ir,kr];nn._matMult(Zi),yn._matMult(Zi),Cr._matMult(Zi),On._matMult(Zi)}const Xn=Ze.stretch+Ze.fixed,hr=nt.stretch+nt.fixed;return{tl:nn,tr:yn,bl:Cr,br:On,tex:{x:_.paddedRect.x+Fu+Xn,y:_.paddedRect.y+Fu+hr,w:Ge.stretch+Ge.fixed-Xn,h:Oe.stretch+Oe.fixed-hr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:rn,minFontScaleX:et/y/k,minFontScaleY:Je/y/D,isSDF:r}};if(l&&(_.stretchX||_.stretchY)){const Ze=Ug(B,te,j),nt=Ug(N,ne,Y);for(let Ge=0;Ge<Ze.length-1;Ge++){const Oe=Ze[Ge],gt=Ze[Ge+1];for(let pt=0;pt<nt.length-1;pt++)p.push(Ke(Oe,nt[pt],gt,nt[pt+1]))}}else p.push(Ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return p}function Wh(i,e,r){let l=0;for(const p of i)l+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return l}function Ug(i,e,r){const l=[{fixed:-Fu,stretch:0}];for(const[p,_]of i){const y=l[l.length-1];l.push({fixed:p-y.stretch,stretch:y.stretch}),l.push({fixed:p-y.stretch,stretch:y.stretch+(_-p)})}return l.push({fixed:e+Fu,stretch:r}),l}function Hh(i,e,r,l){return i/e*r+l}function Xh(i,e,r,l){return i-e*r/l}class Kh{constructor(e,r,l,p,_,y,w,E,k,D){if(this.boxStartIndex=e.length,k){let B=y.top,N=y.bottom;const Z=y.collisionPadding;Z&&(B-=Z[1],N+=Z[3]);let j=N-B;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let B=y.top*w-E[0],N=y.bottom*w+E[2],Z=y.left*w-E[3],j=y.right*w+E[1];const Y=y.collisionPadding;if(Y&&(Z-=Y[0]*w,B-=Y[1]*w,j+=Y[2]*w,N+=Y[3]*w),D){const te=new _e(Z,B),ne=new _e(j,B),ge=new _e(Z,N),le=new _e(j,N),xe=D*Math.PI/180;te._rotate(xe),ne._rotate(xe),ge._rotate(xe),le._rotate(xe),Z=Math.min(te.x,ne.x,ge.x,le.x),j=Math.max(te.x,ne.x,ge.x,le.x),B=Math.min(te.y,ne.y,ge.y,le.y),N=Math.max(te.y,ne.y,ge.y,le.y)}e.emplaceBack(r.x,r.y,Z,B,j,N,l,p,_)}this.boxEndIndex=e.length}}class nw{constructor(e=[],r=rw){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,p=r[e];for(;e>0;){const _=e-1>>1,y=r[_];if(l(p,y)>=0)break;r[e]=y,e=_}r[e]=p}_down(e){const{data:r,compare:l}=this,p=this.length>>1,_=r[e];for(;e<p;){let y=1+(e<<1),w=r[y];const E=y+1;if(E<this.length&&l(r[E],w)<0&&(y=E,w=r[E]),l(w,_)>=0)break;r[e]=w,e=y}r[e]=_}}function rw(i,e){return i<e?-1:i>e?1:0}function ow(i,e=1,r=!1){let l=1/0,p=1/0,_=-1/0,y=-1/0;const w=i[0];for(let Z=0;Z<w.length;Z++){const j=w[Z];(!Z||j.x<l)&&(l=j.x),(!Z||j.y<p)&&(p=j.y),(!Z||j.x>_)&&(_=j.x),(!Z||j.y>y)&&(y=j.y)}const E=Math.min(_-l,y-p);let k=E/2;const D=new nw([],sw);if(E===0)return new _e(l,p);for(let Z=l;Z<_;Z+=E)for(let j=p;j<y;j+=E)D.push(new Nu(Z+k,j+k,k,i));let B=function(Z){let j=0,Y=0,te=0;const ne=Z[0];for(let ge=0,le=ne.length,xe=le-1;ge<le;xe=ge++){const Se=ne[ge],ze=ne[xe],et=Se.x*ze.y-ze.x*Se.y;Y+=(Se.x+ze.x)*et,te+=(Se.y+ze.y)*et,j+=3*et}return new Nu(Y/j,te/j,0,Z)}(i),N=D.length;for(;D.length;){const Z=D.pop();(Z.d>B.d||!B.d)&&(B=Z,r&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,N)),Z.max-B.d<=e||(k=Z.h/2,D.push(new Nu(Z.p.x-k,Z.p.y-k,k,i)),D.push(new Nu(Z.p.x+k,Z.p.y-k,k,i)),D.push(new Nu(Z.p.x-k,Z.p.y+k,k,i)),D.push(new Nu(Z.p.x+k,Z.p.y+k,k,i)),N+=4)}return r&&(console.log(`num probes: ${N}`),console.log(`best distance: ${B.d}`)),B.p}function sw(i,e){return e.max-i.max}function Nu(i,e,r,l){this.p=new _e(i,e),this.h=r,this.d=function(p,_){let y=!1,w=1/0;for(let E=0;E<_.length;E++){const k=_[E];for(let D=0,B=k.length,N=B-1;D<B;N=D++){const Z=k[D],j=k[N];Z.y>p.y!=j.y>p.y&&p.x<(j.x-Z.x)*(p.y-Z.y)/(j.y-Z.y)+Z.x&&(y=!y),w=Math.min(w,T_(p,Z,j))}}return(y?1:-1)*Math.sqrt(w)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var Bn;u.TextAnchorEnum=void 0,(Bn=u.TextAnchorEnum||(u.TextAnchorEnum={}))[Bn.center=1]="center",Bn[Bn.left=2]="left",Bn[Bn.right=3]="right",Bn[Bn.top=4]="top",Bn[Bn.bottom=5]="bottom",Bn[Bn["top-left"]=6]="top-left",Bn[Bn["top-right"]=7]="top-right",Bn[Bn["bottom-left"]=8]="bottom-left",Bn[Bn["bottom-right"]=9]="bottom-right";const xl=7,Gp=Number.POSITIVE_INFINITY;function Vg(i,e){return e[1]!==Gp?function(r,l,p){let _=0,y=0;switch(l=Math.abs(l),p=Math.abs(p),r){case"top-right":case"top-left":case"top":y=p-xl;break;case"bottom-right":case"bottom-left":case"bottom":y=-p+xl}switch(r){case"top-right":case"bottom-right":case"right":_=-l;break;case"top-left":case"bottom-left":case"left":_=l}return[_,y]}(i,e[0],e[1]):function(r,l){let p=0,_=0;l<0&&(l=0);const y=l/Math.sqrt(2);switch(r){case"top-right":case"top-left":_=y-xl;break;case"bottom-right":case"bottom-left":_=-y+xl;break;case"bottom":_=-l+xl;break;case"top":_=l-xl}switch(r){case"top-right":case"bottom-right":p=-y;break;case"top-left":case"bottom-left":p=y;break;case"left":p=l;break;case"right":p=-l}return[p,_]}(i,e[0])}function Zg(i,e,r){var l;const p=i.layout,_=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},r);if(_){const w=_.values,E=[];for(let k=0;k<w.length;k+=2){const D=E[k]=w[k],B=w[k+1].map(N=>N*un);D.startsWith("top")?B[1]-=xl:D.startsWith("bottom")&&(B[1]+=xl),E[k+1]=B}return new pn(E)}const y=p.get("text-variable-anchor");if(y){let w;w=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(e,{},r)*un,Gp]:p.get("text-offset").evaluate(e,{},r).map(k=>k*un);const E=[];for(const k of y)E.push(k,Vg(k,w));return new pn(E)}return null}function Wp(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function aw(i,e,r,l,p,_,y,w,E,k,D){let B=_.textMaxSize.evaluate(e,{});B===void 0&&(B=y);const N=i.layers[0].layout,Z=N.get("icon-offset").evaluate(e,{},D),j=jg(r.horizontal),Y=y/24,te=i.tilePixelRatio*Y,ne=i.tilePixelRatio*B/24,ge=i.tilePixelRatio*w,le=i.tilePixelRatio*N.get("symbol-spacing"),xe=N.get("text-padding")*i.tilePixelRatio,Se=function(Oe,gt,pt,Nt=1){const bi=Oe.get("icon-padding").evaluate(gt,{},pt),Pi=bi&&bi.values;return[Pi[0]*Nt,Pi[1]*Nt,Pi[2]*Nt,Pi[3]*Nt]}(N,e,D,i.tilePixelRatio),ze=N.get("text-max-angle")/180*Math.PI,et=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",ut=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Je=N.get("symbol-placement"),Ke=le/2,Ze=N.get("icon-text-fit");let nt;l&&Ze!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(nt=pg(l,r.vertical,Ze,N.get("icon-text-fit-padding"),Z,Y)),j&&(l=pg(l,j,Ze,N.get("icon-text-fit-padding"),Z,Y)));const Ge=(Oe,gt)=>{gt.x<0||gt.x>=Li||gt.y<0||gt.y>=Li||function(pt,Nt,bi,Pi,cn,Gr,ur,nn,yn,On,Cr,cr,rn,hn,Xn,hr,Ir,kr,Zi,Fn,jt,Wr,Nn,dr,Oo){const ps=pt.addToLineVertexArray(Nt,bi);let fs,Ea,Fo,yo,Mr=0,Pa=0,Vc=0,Hg=0,tf=-1,nf=-1;const Ca={};let Xg=cs("");if(pt.allowVerticalPlacement&&Pi.vertical){const Kn=nn.layout.get("text-rotate").evaluate(jt,{},dr)+90;Fo=new Kh(yn,Nt,On,Cr,cr,Pi.vertical,rn,hn,Xn,Kn),ur&&(yo=new Kh(yn,Nt,On,Cr,cr,ur,Ir,kr,Xn,Kn))}if(cn){const Kn=nn.layout.get("icon-rotate").evaluate(jt,{}),vo=nn.layout.get("icon-text-fit")!=="none",iu=Ng(cn,Kn,Nn,vo),_s=ur?Ng(ur,Kn,Nn,vo):void 0;Ea=new Kh(yn,Nt,On,Cr,cr,cn,Ir,kr,!1,Kn),Mr=4*iu.length;const nu=pt.iconSizeData;let Xs=null;nu.kind==="source"?(Xs=[Hs*nn.layout.get("icon-size").evaluate(jt,{})],Xs[0]>gl&&Ut(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Oc}. Reduce your "icon-size".`)):nu.kind==="composite"&&(Xs=[Hs*Wr.compositeIconSizes[0].evaluate(jt,{},dr),Hs*Wr.compositeIconSizes[1].evaluate(jt,{},dr)],(Xs[0]>gl||Xs[1]>gl)&&Ut(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Oc}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,iu,Xs,Fn,Zi,jt,u.WritingMode.none,Nt,ps.lineStartIndex,ps.lineLength,-1,dr),tf=pt.icon.placedSymbolArray.length-1,_s&&(Pa=4*_s.length,pt.addSymbols(pt.icon,_s,Xs,Fn,Zi,jt,u.WritingMode.vertical,Nt,ps.lineStartIndex,ps.lineLength,-1,dr),nf=pt.icon.placedSymbolArray.length-1)}const Kg=Object.keys(Pi.horizontal);for(const Kn of Kg){const vo=Pi.horizontal[Kn];if(!fs){Xg=cs(vo.text);const _s=nn.layout.get("text-rotate").evaluate(jt,{},dr);fs=new Kh(yn,Nt,On,Cr,cr,vo,rn,hn,Xn,_s)}const iu=vo.positionedLines.length===1;if(Vc+=$g(pt,Nt,vo,Gr,nn,Xn,jt,hr,ps,Pi.vertical?u.WritingMode.horizontal:u.WritingMode.horizontalOnly,iu?Kg:[Kn],Ca,tf,Wr,dr),iu)break}Pi.vertical&&(Hg+=$g(pt,Nt,Pi.vertical,Gr,nn,Xn,jt,hr,ps,u.WritingMode.vertical,["vertical"],Ca,nf,Wr,dr));const cw=fs?fs.boxStartIndex:pt.collisionBoxArray.length,hw=fs?fs.boxEndIndex:pt.collisionBoxArray.length,dw=Fo?Fo.boxStartIndex:pt.collisionBoxArray.length,pw=Fo?Fo.boxEndIndex:pt.collisionBoxArray.length,fw=Ea?Ea.boxStartIndex:pt.collisionBoxArray.length,mw=Ea?Ea.boxEndIndex:pt.collisionBoxArray.length,_w=yo?yo.boxStartIndex:pt.collisionBoxArray.length,gw=yo?yo.boxEndIndex:pt.collisionBoxArray.length;let ms=-1;const Jh=(Kn,vo)=>Kn&&Kn.circleDiameter?Math.max(Kn.circleDiameter,vo):vo;ms=Jh(fs,ms),ms=Jh(Fo,ms),ms=Jh(Ea,ms),ms=Jh(yo,ms);const Yg=ms>-1?1:0;Yg&&(ms*=Oo/un),pt.glyphOffsetArray.length>=Ou.MAX_GLYPHS&&Ut("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jt.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,jt.sortKey);const yw=Zg(nn,jt,dr),[vw,xw]=function(Kn,vo){const iu=Kn.length,_s=vo==null?void 0:vo.values;if((_s==null?void 0:_s.length)>0)for(let nu=0;nu<_s.length;nu+=2){const Xs=_s[nu+1];Kn.emplaceBack(u.TextAnchorEnum[_s[nu]],Xs[0],Xs[1])}return[iu,Kn.length]}(pt.textAnchorOffsets,yw);pt.symbolInstances.emplaceBack(Nt.x,Nt.y,Ca.right>=0?Ca.right:-1,Ca.center>=0?Ca.center:-1,Ca.left>=0?Ca.left:-1,Ca.vertical||-1,tf,nf,Xg,cw,hw,dw,pw,fw,mw,_w,gw,On,Vc,Hg,Mr,Pa,Yg,0,rn,ms,vw,xw)}(i,gt,Oe,r,l,p,nt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,te,[xe,xe,xe,xe],et,E,ge,Se,ut,Z,e,_,k,D,y)};if(Je==="line")for(const Oe of Lg(e.geometry,0,0,Li,Li)){const gt=iw(Oe,le,ze,r.vertical||j,l,24,ne,i.overscaling,Li);for(const pt of gt)j&&lw(i,j.text,Ke,pt)||Ge(Oe,pt)}else if(Je==="line-center"){for(const Oe of e.geometry)if(Oe.length>1){const gt=tw(Oe,ze,r.vertical||j,l,24,ne);gt&&Ge(Oe,gt)}}else if(e.type==="Polygon")for(const Oe of Ep(e.geometry,0)){const gt=ow(Oe,16);Ge(Oe[0],new vl(gt.x,gt.y,0))}else if(e.type==="LineString")for(const Oe of e.geometry)Ge(Oe,new vl(Oe[0].x,Oe[0].y,0));else if(e.type==="Point")for(const Oe of e.geometry)for(const gt of Oe)Ge([gt],new vl(gt.x,gt.y,0))}function $g(i,e,r,l,p,_,y,w,E,k,D,B,N,Z,j){const Y=function(ge,le,xe,Se,ze,et,ut,Je){const Ke=Se.layout.get("text-rotate").evaluate(et,{})*Math.PI/180,Ze=[];for(const nt of le.positionedLines)for(const Ge of nt.positionedGlyphs){if(!Ge.rect)continue;const Oe=Ge.rect||{};let gt=sg+1,pt=!0,Nt=1,bi=0;const Pi=(ze||Je)&&Ge.vertical,cn=Ge.metrics.advance*Ge.scale/2;if(Je&&le.verticalizable&&(bi=nt.lineOffset/2-(Ge.imageName?-(un-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*un)),Ge.imageName){const Zi=ut[Ge.imageName];pt=Zi.sdf,Nt=Zi.pixelRatio,gt=Pr/Nt}const Gr=ze?[Ge.x+cn,Ge.y]:[0,0];let ur=ze?[0,0]:[Ge.x+cn+xe[0],Ge.y+xe[1]-bi],nn=[0,0];Pi&&(nn=ur,ur=[0,0]);const yn=(Ge.metrics.left-gt)*Ge.scale-cn+ur[0],On=(-Ge.metrics.top-gt)*Ge.scale+ur[1],Cr=yn+Oe.w*Ge.scale/Nt,cr=On+Oe.h*Ge.scale/Nt,rn=new _e(yn,On),hn=new _e(Cr,On),Xn=new _e(yn,cr),hr=new _e(Cr,cr);if(Pi){const Zi=new _e(-cn,cn-Rc),Fn=-Math.PI/2,jt=un/2-cn,Wr=new _e(5-Rc-jt,-(Ge.imageName?jt:0)),Nn=new _e(...nn);rn._rotateAround(Fn,Zi)._add(Wr)._add(Nn),hn._rotateAround(Fn,Zi)._add(Wr)._add(Nn),Xn._rotateAround(Fn,Zi)._add(Wr)._add(Nn),hr._rotateAround(Fn,Zi)._add(Wr)._add(Nn)}if(Ke){const Zi=Math.sin(Ke),Fn=Math.cos(Ke),jt=[Fn,-Zi,Zi,Fn];rn._matMult(jt),hn._matMult(jt),Xn._matMult(jt),hr._matMult(jt)}const Ir=new _e(0,0),kr=new _e(0,0);Ze.push({tl:rn,tr:hn,bl:Xn,br:hr,tex:Oe,writingMode:le.writingMode,glyphOffset:Gr,sectionIndex:Ge.sectionIndex,isSDF:pt,pixelOffsetTL:Ir,pixelOffsetBR:kr,minFontScaleX:0,minFontScaleY:0})}return Ze}(0,r,w,p,_,y,l,i.allowVerticalPlacement),te=i.textSizeData;let ne=null;te.kind==="source"?(ne=[Hs*p.layout.get("text-size").evaluate(y,{})],ne[0]>gl&&Ut(`${i.layerIds[0]}: Value for "text-size" is >= ${Oc}. Reduce your "text-size".`)):te.kind==="composite"&&(ne=[Hs*Z.compositeTextSizes[0].evaluate(y,{},j),Hs*Z.compositeTextSizes[1].evaluate(y,{},j)],(ne[0]>gl||ne[1]>gl)&&Ut(`${i.layerIds[0]}: Value for "text-size" is >= ${Oc}. Reduce your "text-size".`)),i.addSymbols(i.text,Y,ne,w,_,y,k,e,E.lineStartIndex,E.lineLength,N,j);for(const ge of D)B[ge]=i.text.placedSymbolArray.length-1;return 4*Y.length}function jg(i){for(const e in i)return i[e];return null}function lw(i,e,r,l){const p=i.compareText;if(e in p){const _=p[e];for(let y=_.length-1;y>=0;y--)if(l.dist(_[y])<r)return!0}else p[e]=[];return p[e].push(l),!1}const qg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=qg[15&l];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new Hp(w,y,_,e)}constructor(e,r=64,l=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=qg.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Xp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:w}=this,E=[0,_.length-1,0],k=[];for(;E.length;){const D=E.pop()||0,B=E.pop()||0,N=E.pop()||0;if(B-N<=w){for(let te=N;te<=B;te++){const ne=y[2*te],ge=y[2*te+1];ne>=e&&ne<=l&&ge>=r&&ge<=p&&k.push(_[te])}continue}const Z=N+B>>1,j=y[2*Z],Y=y[2*Z+1];j>=e&&j<=l&&Y>=r&&Y<=p&&k.push(_[Z]),(D===0?e<=j:r<=Y)&&(E.push(N),E.push(Z-1),E.push(1-D)),(D===0?l>=j:p>=Y)&&(E.push(Z+1),E.push(B),E.push(1-D))}return k}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:y}=this,w=[0,p.length-1,0],E=[],k=l*l;for(;w.length;){const D=w.pop()||0,B=w.pop()||0,N=w.pop()||0;if(B-N<=y){for(let te=N;te<=B;te++)Wg(_[2*te],_[2*te+1],e,r)<=k&&E.push(p[te]);continue}const Z=N+B>>1,j=_[2*Z],Y=_[2*Z+1];Wg(j,Y,e,r)<=k&&E.push(p[Z]),(D===0?e-l<=j:r-l<=Y)&&(w.push(N),w.push(Z-1),w.push(1-D)),(D===0?e+l>=j:r+l>=Y)&&(w.push(Z+1),w.push(B),w.push(1-D))}return E}}function Xp(i,e,r,l,p,_){if(p-l<=r)return;const y=l+p>>1;Gg(i,e,y,l,p,_),Xp(i,e,r,l,y-1,1-_),Xp(i,e,r,y+1,p,1-_)}function Gg(i,e,r,l,p,_){for(;p>l;){if(p-l>600){const k=p-l+1,D=r-l+1,B=Math.log(k),N=.5*Math.exp(2*B/3),Z=.5*Math.sqrt(B*N*(k-N)/k)*(D-k/2<0?-1:1);Gg(i,e,r,Math.max(l,Math.floor(r-D*N/k+Z)),Math.min(p,Math.floor(r+(k-D)*N/k+Z)),_)}const y=e[2*r+_];let w=l,E=p;for(Nc(i,e,l,r),e[2*p+_]>y&&Nc(i,e,l,p);w<E;){for(Nc(i,e,w,E),w++,E--;e[2*w+_]<y;)w++;for(;e[2*E+_]>y;)E--}e[2*l+_]===y?Nc(i,e,l,E):(E++,Nc(i,e,E,p)),E<=r&&(l=E+1),r<=E&&(p=E-1)}}function Nc(i,e,r,l){Kp(i,r,l),Kp(e,2*r,2*l),Kp(e,2*r+1,2*l+1)}function Kp(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}function Wg(i,e,r,l){const p=i-r,_=e-l;return p*p+_*_}var Yp;u.PerformanceMarkers=void 0,(Yp=u.PerformanceMarkers||(u.PerformanceMarkers={})).create="create",Yp.load="load",Yp.fullLoad="fullLoad";let Yh=null,Uc=[];const Jp=1e3/60,Qp="loadTime",ef="fullLoadTime",uw={mark(i){performance.mark(i)},frame(i){const e=i;Yh!=null&&Uc.push(e-Yh),Yh=e},clearMetrics(){Yh=null,Uc=[],performance.clearMeasures(Qp),performance.clearMeasures(ef);for(const i in u.PerformanceMarkers)performance.clearMarks(u.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(Qp,u.PerformanceMarkers.create,u.PerformanceMarkers.load),performance.measure(ef,u.PerformanceMarkers.create,u.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(Qp)[0].duration,e=performance.getEntriesByName(ef)[0].duration,r=Uc.length,l=1/(Uc.reduce((_,y)=>_+y,0)/r/1e3),p=Uc.filter(_=>_>Jp).reduce((_,y)=>_+(y-Jp)/Jp,0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:p/(r+p)*100,totalFrames:r}}};u.AJAXError=St,u.ARRAY_TYPE=zu,u.Actor=class{constructor(i,e,r){this.receive=l=>{const p=l.data,_=p.id;if(_&&(!p.targetMapId||this.mapId===p.targetMapId))if(p.type==="<cancel>"){delete this.tasks[_];const y=this.cancelCallbacks[_];delete this.cancelCallbacks[_],y&&y()}else ri()||p.mustQueue?(this.tasks[_]=p,this.taskQueue.push(_),this.invoker.trigger()):this.processTask(_,p)},this.process=()=>{if(!this.taskQueue.length)return;const l=this.taskQueue.shift(),p=this.tasks[l];delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),p&&this.processTask(l,p)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Q1(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ri()?i:window}send(i,e,r,l,p=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[_]=r);const y=sn(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!r,targetMapId:l,mustQueue:p,sourceMapId:this.mapId,data:Tr(e,y)},y),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Ns(e.error)):r(null,Ns(e.data)))}else{let r=!1;const l=sn(this.globalScope)?void 0:[],p=e.hasCallback?(w,E)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:w?Tr(w):null,data:Tr(E,l)},l)}:w=>{r=!0};let _=null;const y=Ns(e.data);if(this.parent[e.type])_=this.parent[e.type](e.sourceMapId,y,p);else if(this.parent.getWorkerSource){const w=e.type.split(".");_=this.parent.getWorkerSource(e.sourceMapId,w[0],y.source)[w[1]](y,p)}else p(new Error(`Could not find function ${e.type}`));!r&&_&&_.cancel&&(this.cancelCallbacks[i]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.AlphaImage=Cc,u.CanonicalTileID=qp,u.CollisionBoxArray=C,u.CollisionCircleLayoutArray=class extends Pu{},u.Color=xt,u.DEMData=Cg,u.DataConstantProperty=ce,u.DictionaryCoder=Ig,u.EXTENT=Li,u.ErrorEvent=er,u.EvaluationParameters=fi,u.Event=Mn,u.Evented=tr,u.FeatureIndex=Mg,u.FillBucket=Ip,u.FillExtrusionBucket=Mp,u.GeoJSONFeature=kg,u.ImageAtlas=lg,u.ImagePosition=Rp,u.KDBush=Hp,u.LineBucket=zp,u.LineStripIndexArray=class extends g{},u.LngLat=yl,u.MercatorCoordinate=Gh,u.ONE_EM=un,u.OverscaledTileID=go,u.PerformanceUtils=uw,u.Point=_e,u.Pos3dArray=class extends Vs{},u.PosArray=ie,u.Properties=Yt,u.Protobuf=Lp,u.QuadTriangleArray=class extends Cu{},u.RGBAImage=_o,u.RasterBoundsArray=class extends wa{},u.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},u.SegmentVector=bt,u.SymbolBucket=Ou,u.Transitionable=x,u.TriangleIndexArray=st,u.Uniform1f=_n,u.Uniform1i=class extends Vi{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},u.Uniform2f=class extends Vi{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},u.Uniform3f=class extends Vi{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},u.Uniform4f=dl,u.UniformColor=tn,u.UniformMatrix4f=class extends Vi{constructor(i,e){super(i,e),this.current=gn}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},u.UnwrappedTileID=Pg,u.ValidationError=qe,u.ZoomHistory=co,u.addDynamicAttributes=Np,u.arrayBufferToImage=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=hi})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(l):hi},u.arrayBufferToImageBitmap=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(l=>{e(null,l)}).catch(l=>{e(new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},u.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let l=i.length;const p=new Array(i.length);let _=null;i.forEach((y,w)=>{e(y,(E,k)=>{E&&(_=E),p[w]=k,--l==0&&r(_,p)})})},u.bezier=Fe,u.browser=kt,u.clamp=pe,u.clipLine=Lg,u.clone=function(i){var e=new zu(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},u.clone$1=rt,u.collisionCircleLayout=C1,u.config=He,u.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},u.create=function(){var i=new zu(16);return zu!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},u.createExpression=Et,u.createFilter=Ja,u.createLayout=zi,u.createStyleLayer=function(i){if(i.type==="custom")return new J1(i);switch(i.type){case"background":return new X1(i);case"circle":return new D0(i);case"fill":return new e1(i);case"fill-extrusion":return new m1(i);case"heatmap":return new B0(i);case"hillshade":return new F0(i);case"line":return new T1(i);case"raster":return new Y1(i);case"symbol":return new qh(i)}},u.deepEqual=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],r[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const l in e)if(!i(e[l],r[l]))return!1;return!0}return e===r},u.defaultEasing=Bt,u.derefLayers=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=qo(i[r],e[i[r].ref]));return i},u.diffStyles=function(i,e){if(!i)return[{command:Xt.setStyle,args:[e]}];let r=[];try{if(!ii(i.version,e.version))return[{command:Xt.setStyle,args:[e]}];ii(i.center,e.center)||r.push({command:Xt.setCenter,args:[e.center]}),ii(i.zoom,e.zoom)||r.push({command:Xt.setZoom,args:[e.zoom]}),ii(i.bearing,e.bearing)||r.push({command:Xt.setBearing,args:[e.bearing]}),ii(i.pitch,e.pitch)||r.push({command:Xt.setPitch,args:[e.pitch]}),ii(i.sprite,e.sprite)||r.push({command:Xt.setSprite,args:[e.sprite]}),ii(i.glyphs,e.glyphs)||r.push({command:Xt.setGlyphs,args:[e.glyphs]}),ii(i.transition,e.transition)||r.push({command:Xt.setTransition,args:[e.transition]}),ii(i.light,e.light)||r.push({command:Xt.setLight,args:[e.light]});const l={},p=[];(function(y,w,E,k){let D;for(D in w=w||{},y=y||{})Object.prototype.hasOwnProperty.call(y,D)&&(Object.prototype.hasOwnProperty.call(w,D)||Go(D,E,k));for(D in w)Object.prototype.hasOwnProperty.call(w,D)&&(Object.prototype.hasOwnProperty.call(y,D)?ii(y[D],w[D])||(y[D].type==="geojson"&&w[D].type==="geojson"&&Ss(y,w,D)?E.push({command:Xt.setGeoJSONSourceData,args:[D,w[D].data]}):ia(D,w,E,k)):Or(D,w,E))})(i.sources,e.sources,p,l);const _=[];i.layers&&i.layers.forEach(y=>{l[y.source]?r.push({command:Xt.removeLayer,args:[y.id]}):_.push(y)}),r=r.concat(p),function(y,w,E){w=w||[];const k=(y=y||[]).map(Es),D=w.map(Es),B=y.reduce(Ps,{}),N=w.reduce(Ps,{}),Z=k.slice(),j=Object.create(null);let Y,te,ne,ge,le,xe,Se;for(Y=0,te=0;Y<k.length;Y++)ne=k[Y],Object.prototype.hasOwnProperty.call(N,ne)?te++:(E.push({command:Xt.removeLayer,args:[ne]}),Z.splice(Z.indexOf(ne,te),1));for(Y=0,te=0;Y<D.length;Y++)ne=D[D.length-1-Y],Z[Z.length-1-Y]!==ne&&(Object.prototype.hasOwnProperty.call(B,ne)?(E.push({command:Xt.removeLayer,args:[ne]}),Z.splice(Z.lastIndexOf(ne,Z.length-te),1)):te++,xe=Z[Z.length-Y],E.push({command:Xt.addLayer,args:[N[ne],xe]}),Z.splice(Z.length-Y,0,ne),j[ne]=!0);for(Y=0;Y<D.length;Y++)if(ne=D[Y],ge=B[ne],le=N[ne],!j[ne]&&!ii(ge,le))if(ii(ge.source,le.source)&&ii(ge["source-layer"],le["source-layer"])&&ii(ge.type,le.type)){for(Se in gi(ge.layout,le.layout,E,ne,null,Xt.setLayoutProperty),gi(ge.paint,le.paint,E,ne,null,Xt.setPaintProperty),ii(ge.filter,le.filter)||E.push({command:Xt.setFilter,args:[ne,le.filter]}),ii(ge.minzoom,le.minzoom)&&ii(ge.maxzoom,le.maxzoom)||E.push({command:Xt.setLayerZoomRange,args:[ne,le.minzoom,le.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?gi(ge[Se],le[Se],E,ne,Se.slice(6),Xt.setPaintProperty):ii(ge[Se],le[Se])||E.push({command:Xt.setLayerProperty,args:[ne,Se,le[Se]]}));for(Se in le)Object.prototype.hasOwnProperty.call(le,Se)&&!Object.prototype.hasOwnProperty.call(ge,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?gi(ge[Se],le[Se],E,ne,Se.slice(6),Xt.setPaintProperty):ii(ge[Se],le[Se])||E.push({command:Xt.setLayerProperty,args:[ne,Se,le[Se]]}))}else E.push({command:Xt.removeLayer,args:[ne]}),xe=Z[Z.lastIndexOf(ne)+1],E.push({command:Xt.addLayer,args:[le,xe]})}(_,e.layers,r)}catch(l){console.warn("Unable to compute style diff:",l),r=[{command:Xt.setStyle,args:[e]}]}return r},u.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},u.earthRadius=$p,u.emitValidationErrors=Tu,u.emptyStyle=function(){const i={},e=Ie.$version;for(const r in Ie.$root){const l=Ie.$root[r];if(l.required){let p=null;p=r==="version"?e:l.type==="array"?[]:{},p!=null&&(i[r]=p)}}return i},u.equals=function(i,e){var r=i[0],l=i[1],p=i[2],_=i[3],y=i[4],w=i[5],E=i[6],k=i[7],D=i[8],B=i[9],N=i[10],Z=i[11],j=i[12],Y=i[13],te=i[14],ne=i[15],ge=e[0],le=e[1],xe=e[2],Se=e[3],ze=e[4],et=e[5],ut=e[6],Je=e[7],Ke=e[8],Ze=e[9],nt=e[10],Ge=e[11],Oe=e[12],gt=e[13],pt=e[14],Nt=e[15];return Math.abs(r-ge)<=lr*Math.max(1,Math.abs(r),Math.abs(ge))&&Math.abs(l-le)<=lr*Math.max(1,Math.abs(l),Math.abs(le))&&Math.abs(p-xe)<=lr*Math.max(1,Math.abs(p),Math.abs(xe))&&Math.abs(_-Se)<=lr*Math.max(1,Math.abs(_),Math.abs(Se))&&Math.abs(y-ze)<=lr*Math.max(1,Math.abs(y),Math.abs(ze))&&Math.abs(w-et)<=lr*Math.max(1,Math.abs(w),Math.abs(et))&&Math.abs(E-ut)<=lr*Math.max(1,Math.abs(E),Math.abs(ut))&&Math.abs(k-Je)<=lr*Math.max(1,Math.abs(k),Math.abs(Je))&&Math.abs(D-Ke)<=lr*Math.max(1,Math.abs(D),Math.abs(Ke))&&Math.abs(B-Ze)<=lr*Math.max(1,Math.abs(B),Math.abs(Ze))&&Math.abs(N-nt)<=lr*Math.max(1,Math.abs(N),Math.abs(nt))&&Math.abs(Z-Ge)<=lr*Math.max(1,Math.abs(Z),Math.abs(Ge))&&Math.abs(j-Oe)<=lr*Math.max(1,Math.abs(j),Math.abs(Oe))&&Math.abs(Y-gt)<=lr*Math.max(1,Math.abs(Y),Math.abs(gt))&&Math.abs(te-pt)<=lr*Math.max(1,Math.abs(te),Math.abs(pt))&&Math.abs(ne-Nt)<=lr*Math.max(1,Math.abs(ne),Math.abs(Nt))},u.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/Hs:i.kind==="composite"?Gi.number(l/Hs,p/Hs,r):e},u.evaluateSizeForZoom=function(i,e){let r=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:y}=i,w=p?pe(En.interpolationFactor(p,e,_,y),0,1):0;i.kind==="camera"?l=Gi.number(i.minSize,i.maxSize,w):r=w}return{uSizeT:r,uSize:l}},u.evented=hl,u.extend=ye,u.filterObject=ht,u.findLineIntersection=function(i,e,r,l){const p=e.y-i.y,_=e.x-i.x,y=l.y-r.y,w=l.x-r.x,E=y*_-w*p;if(E===0)return null;const k=(w*(i.y-r.y)-y*(i.x-r.x))/E;return new _e(i.x+k*_,i.y+k*p)},u.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},u.getAnchorAlignment=Op,u.getAnchorJustification=Wp,u.getArrayBuffer=zt,u.getDefaultExportFromCjs=H,u.getJSON=function(i,e){return Zt(ye(i,{type:"json"}),e)},u.getOverlapMode=Fp,u.getProtocolAction=ti,u.getRTLTextPluginStatus=Yl,u.getReferrer=Rt,u.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let l=0;l<i.length;l++){const p=window.document.createElement("source");Bi(i[l])||(r.crossOrigin="Anonymous"),p.src=i[l],r.appendChild(p)}return{cancel:()=>{}}},u.groupByLayout=function(i,e){const r={};for(let p=0;p<i.length;p++){const _=e&&e[i[p].id]||pa(i[p]);e&&(e[i[p].id]=_);let y=r[_];y||(y=r[_]=[]),y.push(i[p])}const l=[];for(const p in r)l.push(r[p]);return l},u.identity=yp,u.interpolate=Gi,u.invert=function(i,e){var r=e[0],l=e[1],p=e[2],_=e[3],y=e[4],w=e[5],E=e[6],k=e[7],D=e[8],B=e[9],N=e[10],Z=e[11],j=e[12],Y=e[13],te=e[14],ne=e[15],ge=r*w-l*y,le=r*E-p*y,xe=r*k-_*y,Se=l*E-p*w,ze=l*k-_*w,et=p*k-_*E,ut=D*Y-B*j,Je=D*te-N*j,Ke=D*ne-Z*j,Ze=B*te-N*Y,nt=B*ne-Z*Y,Ge=N*ne-Z*te,Oe=ge*Ge-le*nt+xe*Ze+Se*Ke-ze*Je+et*ut;return Oe?(i[0]=(w*Ge-E*nt+k*Ze)*(Oe=1/Oe),i[1]=(p*nt-l*Ge-_*Ze)*Oe,i[2]=(Y*et-te*ze+ne*Se)*Oe,i[3]=(N*ze-B*et-Z*Se)*Oe,i[4]=(E*Ke-y*Ge-k*Je)*Oe,i[5]=(r*Ge-p*Ke+_*Je)*Oe,i[6]=(te*xe-j*et-ne*le)*Oe,i[7]=(D*et-N*xe+Z*le)*Oe,i[8]=(y*nt-w*Ke+k*ut)*Oe,i[9]=(l*Ke-r*nt-_*ut)*Oe,i[10]=(j*ze-Y*xe+ne*ge)*Oe,i[11]=(B*xe-D*ze-Z*ge)*Oe,i[12]=(w*Je-y*Ze-E*ut)*Oe,i[13]=(r*Ze-l*Je+p*ut)*Oe,i[14]=(Y*le-j*Se-te*ge)*Oe,i[15]=(D*Se-B*le+N*ge)*Oe,i):null},u.isImageBitmap=Rr,u.isSafari=sn,u.isWorker=ri,u.keysDifference=function(i,e){const r=[];for(const l in i)l in e||r.push(l);return r},u.lazyLoadRTLTextPlugin=function(){Wn.isLoading()||Wn.isLoaded()||Yl()!=="deferred"||Jl()},u.makeRequest=Zt,u.mapObject=tt,u.mercatorXfromLng=bg,u.mercatorYfromLat=Tg,u.mercatorZfromAltitude=Sg,u.mul=L0,u.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},u.multiply=C_,u.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},u.operations=Xt,u.ortho=function(i,e,r,l,p,_,y){var w=1/(e-r),E=1/(l-p),k=1/(_-y);return i[0]=-2*w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*k,i[11]=0,i[12]=(e+r)*w,i[13]=(p+l)*E,i[14]=(y+_)*k,i[15]=1,i},u.parseCacheControl=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,p,_)=>{const y=p||_;return e[l]=!y||y.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},u.parseGlyphPbf=function(i){return new Lp(i).readFields(F1,[])},u.pbf=Q_,u.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Li/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,l=e._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new fi(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new fi(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new fi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:D}=i.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new fi(k),i.canonical),l["text-size"].possiblyEvaluate(new fi(D),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:D}=i.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new fi(k),i.canonical),l["icon-size"].possiblyEvaluate(new fi(D),i.canonical)]}const _=r.get("text-line-height")*un,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",w=r.get("text-keep-upright"),E=r.get("text-size");for(const k of i.bucket.features){const D=r.get("text-font").evaluate(k,{},i.canonical).join(","),B=E.evaluate(k,{},i.canonical),N=p.layoutTextSize.evaluate(k,{},i.canonical),Z=p.layoutIconSize.evaluate(k,{},i.canonical),j={horizontal:{},vertical:void 0},Y=k.text;let te,ne=[0,0];if(Y){const xe=Y.toString(),Se=r.get("text-letter-spacing").evaluate(k,{},i.canonical)*un,ze=wc(xe)?Se:0,et=r.get("text-anchor").evaluate(k,{},i.canonical),ut=Zg(e,k,i.canonical);if(!ut){const Ge=r.get("text-radial-offset").evaluate(k,{},i.canonical);ne=Ge?Vg(et,[Ge*un,Gp]):r.get("text-offset").evaluate(k,{},i.canonical).map(Oe=>Oe*un)}let Je=y?"center":r.get("text-justify").evaluate(k,{},i.canonical);const Ke=r.get("symbol-placement"),Ze=Ke==="point"?r.get("text-max-width").evaluate(k,{},i.canonical)*un:0,nt=()=>{i.bucket.allowVerticalPlacement&&xa(xe)&&(j.vertical=Zh(Y,i.glyphMap,i.glyphPositions,i.imagePositions,D,Ze,_,et,"left",ze,ne,u.WritingMode.vertical,!0,Ke,N,B))};if(!y&&ut){const Ge=new Set;if(Je==="auto")for(let gt=0;gt<ut.values.length;gt+=2)Ge.add(Wp(ut.values[gt]));else Ge.add(Je);let Oe=!1;for(const gt of Ge)if(!j.horizontal[gt])if(Oe)j.horizontal[gt]=j.horizontal[0];else{const pt=Zh(Y,i.glyphMap,i.glyphPositions,i.imagePositions,D,Ze,_,"center",gt,ze,ne,u.WritingMode.horizontal,!1,Ke,N,B);pt&&(j.horizontal[gt]=pt,Oe=pt.positionedLines.length===1)}nt()}else{Je==="auto"&&(Je=Wp(et));const Ge=Zh(Y,i.glyphMap,i.glyphPositions,i.imagePositions,D,Ze,_,et,Je,ze,ne,u.WritingMode.horizontal,!1,Ke,N,B);Ge&&(j.horizontal[Je]=Ge),nt(),xa(xe)&&y&&w&&(j.vertical=Zh(Y,i.glyphMap,i.glyphPositions,i.imagePositions,D,Ze,_,et,Je,ze,ne,u.WritingMode.vertical,!1,Ke,N,B))}}let ge=!1;if(k.icon&&k.icon.name){const xe=i.imageMap[k.icon.name];xe&&(te=j1(i.imagePositions[k.icon.name],r.get("icon-offset").evaluate(k,{},i.canonical),r.get("icon-anchor").evaluate(k,{},i.canonical)),ge=!!xe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ge:i.bucket.sdfIcons!==ge&&Ut("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const le=jg(j.horizontal)||j.vertical;i.bucket.iconsInText=!!le&&le.iconsInText,(le||te)&&aw(i.bucket,k,j,te,i.imageMap,p,N,Z,ne,ge,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},u.perspective=function(i,e,r,l,p){var _,y=1/Math.tan(e/2);return i[0]=y/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+l)*(_=1/(l-p)),i[14]=2*p*l*_):(i[10]=-1,i[14]=-2*l),i},u.pick=function(i,e){const r={};for(let l=0;l<e.length;l++){const p=e[l];p in i&&(r[p]=i[p])}return r},u.plugin=Wn,u.pointGeometry=q,u.polygonIntersectsPolygon=w_,u.potpack=ag,u.register=Qe,u.registerForPluginStateChange=function(i){return i({pluginStatus:Pn,pluginURL:qr}),hl.on("pluginStateChange",i),i},u.renderColorRamp=A_,u.rotateX=function(i,e,r){var l=Math.sin(r),p=Math.cos(r),_=e[4],y=e[5],w=e[6],E=e[7],k=e[8],D=e[9],B=e[10],N=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=_*p+k*l,i[5]=y*p+D*l,i[6]=w*p+B*l,i[7]=E*p+N*l,i[8]=k*p-_*l,i[9]=D*p-y*l,i[10]=B*p-w*l,i[11]=N*p-E*l,i},u.rotateZ=function(i,e,r){var l=Math.sin(r),p=Math.cos(r),_=e[0],y=e[1],w=e[2],E=e[3],k=e[4],D=e[5],B=e[6],N=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*p+k*l,i[1]=y*p+D*l,i[2]=w*p+B*l,i[3]=E*p+N*l,i[4]=k*p-_*l,i[5]=D*p-y*l,i[6]=B*p-w*l,i[7]=N*p-E*l,i},u.sameOrigin=Bi,u.scale=function(i,e,r){var l=r[0],p=r[1],_=r[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*_,i[9]=e[9]*_,i[10]=e[10]*_,i[11]=e[11]*_,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},u.setRTLTextPlugin=function(i,e,r=!1){if(Pn===ho||Pn===ll||Pn===ul)throw new Error("setRTLTextPlugin cannot be called multiple times.");qr=kt.resolveURL(i),Pn=ho,Xl=e,cl(),r||Jl()},u.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},u.toEvaluationFeature=ds,u.transformMat4=Rh,u.translate=function(i,e,r){var l,p,_,y,w,E,k,D,B,N,Z,j,Y=r[0],te=r[1],ne=r[2];return e===i?(i[12]=e[0]*Y+e[4]*te+e[8]*ne+e[12],i[13]=e[1]*Y+e[5]*te+e[9]*ne+e[13],i[14]=e[2]*Y+e[6]*te+e[10]*ne+e[14],i[15]=e[3]*Y+e[7]*te+e[11]*ne+e[15]):(p=e[1],_=e[2],y=e[3],w=e[4],E=e[5],k=e[6],D=e[7],B=e[8],N=e[9],Z=e[10],j=e[11],i[0]=l=e[0],i[1]=p,i[2]=_,i[3]=y,i[4]=w,i[5]=E,i[6]=k,i[7]=D,i[8]=B,i[9]=N,i[10]=Z,i[11]=j,i[12]=l*Y+w*te+B*ne+e[12],i[13]=p*Y+E*te+N*ne+e[13],i[14]=_*Y+k*te+Z*ne+e[14],i[15]=y*Y+D*te+j*ne+e[15]),i},u.triggerPluginCompletionEvent=Kl,u.unicodeBlockLookup=Ye,u.uniqueId=function(){return Ne++},u.v8Spec=Ie,u.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateLight=va,u.validateStyle=Os,u.vectorTile=ml,u.warnOnce=Ut,u.wrap=ue}),I(["./shared"],function(u){class H{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,U){for(const ee of F){this._layerConfigs[ee.id]=ee;const re=this._layers[ee.id]=u.createStyleLayer(ee);re._featureFilter=u.createFilter(re.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(const ee of U)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const G=u.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const ee of G){const re=ee.map(Ae=>this._layers[Ae.id]),me=re[0];if(me.visibility==="none")continue;const ae=me.source||"";let se=this.familiesBySource[ae];se||(se=this.familiesBySource[ae]={});const de=me.sourceLayer||"_geojsonTileLayer";let ve=se[de];ve||(ve=se[de]=[]),ve.push(re)}}}class q{constructor(F){const U={},G=[];for(const ae in F){const se=F[ae],de=U[ae]={};for(const ve in se){const Ae=se[+ve];if(!Ae||Ae.bitmap.width===0||Ae.bitmap.height===0)continue;const Le={x:0,y:0,w:Ae.bitmap.width+2,h:Ae.bitmap.height+2};G.push(Le),de[ve]={rect:Le,metrics:Ae.metrics}}}const{w:ee,h:re}=u.potpack(G),me=new u.AlphaImage({width:ee||1,height:re||1});for(const ae in F){const se=F[ae];for(const de in se){const ve=se[+de];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const Ae=U[ae][de].rect;u.AlphaImage.copy(ve.bitmap,me,{x:0,y:0},{x:Ae.x+1,y:Ae.y+1},ve.bitmap)}}this.image=me,this.positions=U}}u.register("GlyphAtlas",q);class ke{constructor(F){this.tileID=new u.OverscaledTileID(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(F,U,G,ee,re){this.status="parsing",this.data=F,this.collisionBoxArray=new u.CollisionBoxArray;const me=new u.DictionaryCoder(Object.keys(F.layers).sort()),ae=new u.FeatureIndex(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const se={},de={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},ve=U.familiesBySource[this.source];for(const Ot in ve){const Gt=F.layers[Ot];if(!Gt)continue;Gt.version===1&&u.warnOnce(`Vector tile source "${this.source}" layer "${Ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const An=me.encode(Ot),xt=[];for(let Oi=0;Oi<Gt.length;Oi++){const Fi=Gt.feature(Oi),ki=ae.getId(Fi,Ot);xt.push({feature:Fi,id:ki,index:Oi,sourceLayerIndex:An})}for(const Oi of ve[Ot]){const Fi=Oi[0];Fi.source!==this.source&&u.warnOnce(`layer.source = ${Fi.source} does not equal this.source = ${this.source}`),Fi.minzoom&&this.zoom<Math.floor(Fi.minzoom)||Fi.maxzoom&&this.zoom>=Fi.maxzoom||Fi.visibility!=="none"&&(_e(Oi,this.zoom,G),(se[Fi.id]=Fi.createBucket({index:ae.bucketLayerIDs.length,layers:Oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:An,sourceID:this.source})).populate(xt,de,this.tileID.canonical),ae.bucketLayerIDs.push(Oi.map(ki=>ki.id)))}}let Ae,Le,_t,It;const ot=u.mapObject(de.glyphDependencies,Ot=>Object.keys(Ot).map(Number));this.inFlightDependencies.forEach(Ot=>Ot==null?void 0:Ot.cancel()),this.inFlightDependencies=[];const ft=++this.dependencySentinel;Object.keys(ot).length?this.inFlightDependencies.push(ee.send("getGlyphs",{uid:this.uid,stacks:ot,source:this.source,tileID:this.tileID,type:"glyphs"},(Ot,Gt)=>{ft===this.dependencySentinel&&(Ae||(Ae=Ot,Le=Gt,oi.call(this)))})):Le={};const vt=Object.keys(de.iconDependencies);vt.length?this.inFlightDependencies.push(ee.send("getImages",{icons:vt,source:this.source,tileID:this.tileID,type:"icons"},(Ot,Gt)=>{ft===this.dependencySentinel&&(Ae||(Ae=Ot,_t=Gt,oi.call(this)))})):_t={};const qt=Object.keys(de.patternDependencies);function oi(){if(Ae)return re(Ae);if(Le&&_t&&It){const Ot=new q(Le),Gt=new u.ImageAtlas(_t,It);for(const An in se){const xt=se[An];xt instanceof u.SymbolBucket?(_e(xt.layers,this.zoom,G),u.performSymbolLayout({bucket:xt,glyphMap:Le,glyphPositions:Ot.positions,imageMap:_t,imagePositions:Gt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):xt.hasPattern&&(xt instanceof u.LineBucket||xt instanceof u.FillBucket||xt instanceof u.FillExtrusionBucket)&&(_e(xt.layers,this.zoom,G),xt.addFeatures(de,this.tileID.canonical,Gt.patternPositions))}this.status="done",re(null,{buckets:Object.values(se).filter(An=>!An.isEmpty()),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ot.image,imageAtlas:Gt,glyphMap:this.returnDependencies?Le:null,iconMap:this.returnDependencies?_t:null,glyphPositions:this.returnDependencies?Ot.positions:null})}}qt.length?this.inFlightDependencies.push(ee.send("getImages",{icons:qt,source:this.source,tileID:this.tileID,type:"patterns"},(Ot,Gt)=>{ft===this.dependencySentinel&&(Ae||(Ae=Ot,It=Gt,oi.call(this)))})):It={},oi.call(this)}}function _e(J,F,U){const G=new u.EvaluationParameters(F);for(const ee of J)ee.recalculate(G,U)}function Ce(J,F){const U=u.getArrayBuffer(J.request,(G,ee,re,me)=>{G?F(G):ee&&F(null,{vectorTile:new u.vectorTile.VectorTile(new u.Protobuf(ee)),rawData:ee,cacheControl:re,expires:me})});return()=>{U.cancel(),F()}}class Ue{constructor(F,U,G,ee){this.actor=F,this.layerIndex=U,this.availableImages=G,this.loadVectorData=ee||Ce,this.fetching={},this.loading={},this.loaded={}}loadTile(F,U){const G=F.uid;this.loading||(this.loading={});const ee=!!(F&&F.request&&F.request.collectResourceTiming)&&new u.RequestPerformance(F.request),re=this.loading[G]=new ke(F);re.abort=this.loadVectorData(F,(me,ae)=>{if(delete this.loading[G],me||!ae)return re.status="done",this.loaded[G]=re,U(me);const se=ae.rawData,de={};ae.expires&&(de.expires=ae.expires),ae.cacheControl&&(de.cacheControl=ae.cacheControl);const ve={};if(ee){const Ae=ee.finish();Ae&&(ve.resourceTiming=JSON.parse(JSON.stringify(Ae)))}re.vectorTile=ae.vectorTile,re.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ae,Le)=>{if(delete this.fetching[G],Ae||!Le)return U(Ae);U(null,u.extend({rawTileData:se.slice(0)},Le,de,ve))}),this.loaded=this.loaded||{},this.loaded[G]=re,this.fetching[G]={rawTileData:se,cacheControl:de,resourceTiming:ve}})}reloadTile(F,U){const G=this.loaded,ee=F.uid;if(G&&G[ee]){const re=G[ee];re.showCollisionBoxes=F.showCollisionBoxes,re.status==="parsing"?re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,(me,ae)=>{if(me||!ae)return U(me,ae);let se;if(this.fetching[ee]){const{rawTileData:de,cacheControl:ve,resourceTiming:Ae}=this.fetching[ee];delete this.fetching[ee],se=u.extend({rawTileData:de.slice(0)},ae,ve,Ae)}else se=ae;U(null,se)}):re.status==="done"&&(re.vectorTile?re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,U):U())}}abortTile(F,U){const G=this.loading,ee=F.uid;G&&G[ee]&&G[ee].abort&&(G[ee].abort(),delete G[ee]),U()}removeTile(F,U){const G=this.loaded,ee=F.uid;G&&G[ee]&&delete G[ee],U()}}class We{constructor(){this.loaded={}}loadTile(F,U){const{uid:G,encoding:ee,rawImageData:re}=F,me=u.isImageBitmap(re)?this.getImageData(re):re,ae=new u.DEMData(G,me,ee);this.loaded=this.loaded||{},this.loaded[G]=ae,U(null,ae)}getImageData(F){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const U=this.offscreenCanvasContext.getImageData(-1,-1,F.width+2,F.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:U.width,height:U.height},U.data)}removeTile(F){const U=this.loaded,G=F.uid;U&&U[G]&&delete U[G]}}function Fe(J,F){if(J.length!==0){Bt(J[0],F);for(var U=1;U<J.length;U++)Bt(J[U],!F)}}function Bt(J,F){for(var U=0,G=0,ee=0,re=J.length,me=re-1;ee<re;me=ee++){var ae=(J[ee][0]-J[me][0])*(J[me][1]+J[ee][1]),se=U+ae;G+=Math.abs(U)>=Math.abs(ae)?U-se+ae:ae-se+U,U=se}U+G>=0!=!!F&&J.reverse()}var pe=u.getDefaultExportFromCjs(function J(F,U){var G,ee=F&&F.type;if(ee==="FeatureCollection")for(G=0;G<F.features.length;G++)J(F.features[G],U);else if(ee==="GeometryCollection")for(G=0;G<F.geometries.length;G++)J(F.geometries[G],U);else if(ee==="Feature")J(F.geometry,U);else if(ee==="Polygon")Fe(F.coordinates,U);else if(ee==="MultiPolygon")for(G=0;G<F.coordinates.length;G++)Fe(F.coordinates[G],U);return F});const ue=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;var ye={exports:{}},Ne=u.pointGeometry,tt=u.vectorTile.VectorTileFeature,ht=rt;function rt(J,F){this.options=F||{},this.features=J,this.length=J.length}function dt(J,F){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=F||4096}rt.prototype.feature=function(J){return new dt(this.features[J],this.options.extent)},dt.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var F=0;F<J.length;F++){for(var U=J[F],G=[],ee=0;ee<U.length;ee++)G.push(new Ne(U[ee][0],U[ee][1]));this.geometry.push(G)}return this.geometry},dt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,F=1/0,U=-1/0,G=1/0,ee=-1/0,re=0;re<J.length;re++)for(var me=J[re],ae=0;ae<me.length;ae++){var se=me[ae];F=Math.min(F,se.x),U=Math.max(U,se.x),G=Math.min(G,se.y),ee=Math.max(ee,se.y)}return[F,G,U,ee]},dt.prototype.toGeoJSON=tt.prototype.toGeoJSON;var Ut=u.pbf,ct=ht;function ei(J){var F=new Ut;return function(U,G){for(var ee in U.layers)G.writeMessage(3,ri,U.layers[ee])}(J,F),F.finish()}function ri(J,F){var U;F.writeVarintField(15,J.version||1),F.writeStringField(1,J.name||""),F.writeVarintField(5,J.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<J.length;U++)G.feature=J.feature(U),F.writeMessage(2,xn,G);var ee=G.keys;for(U=0;U<ee.length;U++)F.writeStringField(3,ee[U]);var re=G.values;for(U=0;U<re.length;U++)F.writeMessage(4,Re,re[U])}function xn(J,F){var U=J.feature;U.id!==void 0&&F.writeVarintField(1,U.id),F.writeMessage(2,sn,J),F.writeVarintField(3,U.type),F.writeMessage(4,kn,U)}function sn(J,F){var U=J.feature,G=J.keys,ee=J.values,re=J.keycache,me=J.valuecache;for(var ae in U.properties){var se=U.properties[ae],de=re[ae];if(se!==null){de===void 0&&(G.push(ae),re[ae]=de=G.length-1),F.writeVarint(de);var ve=typeof se;ve!=="string"&&ve!=="boolean"&&ve!=="number"&&(se=JSON.stringify(se));var Ae=ve+":"+se,Le=me[Ae];Le===void 0&&(ee.push(se),me[Ae]=Le=ee.length-1),F.writeVarint(Le)}}}function Rr(J,F){return(F<<3)+(7&J)}function hi(J){return J<<1^J>>31}function kn(J,F){for(var U=J.loadGeometry(),G=J.type,ee=0,re=0,me=U.length,ae=0;ae<me;ae++){var se=U[ae],de=1;G===1&&(de=se.length),F.writeVarint(Rr(1,de));for(var ve=G===3?se.length-1:se.length,Ae=0;Ae<ve;Ae++){Ae===1&&G!==1&&F.writeVarint(Rr(2,ve-1));var Le=se[Ae].x-ee,_t=se[Ae].y-re;F.writeVarint(hi(Le)),F.writeVarint(hi(_t)),ee+=Le,re+=_t}G===3&&F.writeVarint(Rr(7,1))}}function Re(J,F){var U=typeof J;U==="string"?F.writeStringField(1,J):U==="boolean"?F.writeBooleanField(7,J):U==="number"&&(J%1!=0?F.writeDoubleField(3,J):J<0?F.writeSVarintField(6,J):F.writeVarintField(5,J))}ye.exports=ei,ye.exports.fromVectorTileJs=ei,ye.exports.fromGeojsonVt=function(J,F){F=F||{};var U={};for(var G in J)U[G]=new ct(J[G].features,F),U[G].name=G,U[G].version=F.version,U[G].extent=F.extent;return ei({layers:U})},ye.exports.GeoJSONWrapper=ct;var kt=u.getDefaultExportFromCjs(ye.exports);const He={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},St=Math.fround||(Rt=new Float32Array(1),J=>(Rt[0]=+J,Rt[0]));var Rt;const ti=3,Ct=5,Zt=6;class zt{constructor(F){this.options=Object.assign(Object.create(He),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:U,minZoom:G,maxZoom:ee}=this.options;U&&console.time("total time");const re=`prepare ${F.length} points`;U&&console.time(re),this.points=F;const me=[];for(let se=0;se<F.length;se++){const de=F[se];if(!de.geometry)continue;const[ve,Ae]=de.geometry.coordinates,Le=St(Br(ve)),_t=St(Mn(Ae));me.push(Le,_t,1/0,se,-1,1),this.options.reduce&&me.push(0)}let ae=this.trees[ee+1]=this._createTree(me);U&&console.timeEnd(re);for(let se=ee;se>=G;se--){const de=+Date.now();ae=this.trees[se]=this._createTree(this._cluster(ae,se)),U&&console.log("z%d: %d clusters in %dms",se,ae.numItems,+Date.now()-de)}return U&&console.timeEnd("total time"),this}getClusters(F,U){let G=((F[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,F[1]));let re=F[2]===180?180:((F[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)G=-180,re=180;else if(G>re){const Ae=this.getClusters([G,ee,180,me],U),Le=this.getClusters([-180,ee,re,me],U);return Ae.concat(Le)}const ae=this.trees[this._limitZoom(U)],se=ae.range(Br(G),Mn(me),Br(re),Mn(ee)),de=ae.data,ve=[];for(const Ae of se){const Le=this.stride*Ae;ve.push(de[Le+Ct]>1?Bi(de,Le,this.clusterProps):this.points[de[Le+ti]])}return ve}getChildren(F){const U=this._getOriginId(F),G=this._getOriginZoom(F),ee="No cluster with the specified id.",re=this.trees[G];if(!re)throw new Error(ee);const me=re.data;if(U*this.stride>=me.length)throw new Error(ee);const ae=this.options.radius/(this.options.extent*Math.pow(2,G-1)),se=re.within(me[U*this.stride],me[U*this.stride+1],ae),de=[];for(const ve of se){const Ae=ve*this.stride;me[Ae+4]===F&&de.push(me[Ae+Ct]>1?Bi(me,Ae,this.clusterProps):this.points[me[Ae+ti]])}if(de.length===0)throw new Error(ee);return de}getLeaves(F,U,G){const ee=[];return this._appendLeaves(ee,F,U=U||10,G=G||0,0),ee}getTile(F,U,G){const ee=this.trees[this._limitZoom(F)],re=Math.pow(2,F),{extent:me,radius:ae}=this.options,se=ae/me,de=(G-se)/re,ve=(G+1+se)/re,Ae={features:[]};return this._addTileFeatures(ee.range((U-se)/re,de,(U+1+se)/re,ve),ee.data,U,G,re,Ae),U===0&&this._addTileFeatures(ee.range(1-se/re,de,1,ve),ee.data,re,G,re,Ae),U===re-1&&this._addTileFeatures(ee.range(0,de,se/re,ve),ee.data,-1,G,re,Ae),Ae.features.length?Ae:null}getClusterExpansionZoom(F){let U=this._getOriginZoom(F)-1;for(;U<=this.options.maxZoom;){const G=this.getChildren(F);if(U++,G.length!==1)break;F=G[0].properties.cluster_id}return U}_appendLeaves(F,U,G,ee,re){const me=this.getChildren(U);for(const ae of me){const se=ae.properties;if(se&&se.cluster?re+se.point_count<=ee?re+=se.point_count:re=this._appendLeaves(F,se.cluster_id,G,ee,re):re<ee?re++:F.push(ae),F.length===G)break}return re}_createTree(F){const U=new u.KDBush(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<F.length;G+=this.stride)U.add(F[G],F[G+1]);return U.finish(),U.data=F,U}_addTileFeatures(F,U,G,ee,re,me){for(const ae of F){const se=ae*this.stride,de=U[se+Ct]>1;let ve,Ae,Le;if(de)ve=Zn(U,se,this.clusterProps),Ae=U[se],Le=U[se+1];else{const ot=this.points[U[se+ti]];ve=ot.properties;const[ft,vt]=ot.geometry.coordinates;Ae=Br(ft),Le=Mn(vt)}const _t={type:1,geometry:[[Math.round(this.options.extent*(Ae*re-G)),Math.round(this.options.extent*(Le*re-ee))]],tags:ve};let It;It=de||this.options.generateId?U[se+ti]:this.points[U[se+ti]].id,It!==void 0&&(_t.id=It),me.features.push(_t)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,U){const{radius:G,extent:ee,reduce:re,minPoints:me}=this.options,ae=G/(ee*Math.pow(2,U)),se=F.data,de=[],ve=this.stride;for(let Ae=0;Ae<se.length;Ae+=ve){if(se[Ae+2]<=U)continue;se[Ae+2]=U;const Le=se[Ae],_t=se[Ae+1],It=F.within(se[Ae],se[Ae+1],ae),ot=se[Ae+Ct];let ft=ot;for(const vt of It){const qt=vt*ve;se[qt+2]>U&&(ft+=se[qt+Ct])}if(ft>ot&&ft>=me){let vt,qt=Le*ot,oi=_t*ot,Ot=-1;const Gt=((Ae/ve|0)<<5)+(U+1)+this.points.length;for(const An of It){const xt=An*ve;if(se[xt+2]<=U)continue;se[xt+2]=U;const Oi=se[xt+Ct];qt+=se[xt]*Oi,oi+=se[xt+1]*Oi,se[xt+4]=Gt,re&&(vt||(vt=this._map(se,Ae,!0),Ot=this.clusterProps.length,this.clusterProps.push(vt)),re(vt,this._map(se,xt)))}se[Ae+4]=Gt,de.push(qt/ft,oi/ft,1/0,Gt,-1,ft),re&&de.push(Ot)}else{for(let vt=0;vt<ve;vt++)de.push(se[Ae+vt]);if(ft>1)for(const vt of It){const qt=vt*ve;if(!(se[qt+2]<=U)){se[qt+2]=U;for(let oi=0;oi<ve;oi++)de.push(se[qt+oi])}}}}return de}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,U,G){if(F[U+Ct]>1){const me=this.clusterProps[F[U+Zt]];return G?Object.assign({},me):me}const ee=this.points[F[U+ti]].properties,re=this.options.map(ee);return G&&re===ee?Object.assign({},re):re}}function Bi(J,F,U){return{type:"Feature",id:J[F+ti],properties:Zn(J,F,U),geometry:{type:"Point",coordinates:[(G=J[F],360*(G-.5)),er(J[F+1])]}};var G}function Zn(J,F,U){const G=J[F+Ct],ee=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,re=J[F+Zt],me=re===-1?{}:Object.assign({},U[re]);return Object.assign(me,{cluster:!0,cluster_id:J[F+ti],point_count:G,point_count_abbreviated:ee})}function Br(J){return J/360+.5}function Mn(J){const F=Math.sin(J*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function er(J){const F=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function tr(J,F,U,G){for(var ee,re=G,me=U-F>>1,ae=U-F,se=J[F],de=J[F+1],ve=J[U],Ae=J[U+1],Le=F+3;Le<U;Le+=3){var _t=Ie(J[Le],J[Le+1],se,de,ve,Ae);if(_t>re)ee=Le,re=_t;else if(_t===re){var It=Math.abs(Le-me);It<ae&&(ee=Le,ae=It)}}re>G&&(ee-F>3&&tr(J,F,ee,G),J[ee+2]=re,U-ee>3&&tr(J,ee,U,G))}function Ie(J,F,U,G,ee,re){var me=ee-U,ae=re-G;if(me!==0||ae!==0){var se=((J-U)*me+(F-G)*ae)/(me*me+ae*ae);se>1?(U=ee,G=re):se>0&&(U+=me*se,G+=ae*se)}return(me=J-U)*me+(ae=F-G)*ae}function Qr(J,F,U,G){var ee={id:J===void 0?null:J,type:F,geometry:U,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(re){var me=re.geometry,ae=re.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")qo(re,me);else if(ae==="Polygon"||ae==="MultiLineString")for(var se=0;se<me.length;se++)qo(re,me[se]);else if(ae==="MultiPolygon")for(se=0;se<me.length;se++)for(var de=0;de<me[se].length;de++)qo(re,me[se][de])}(ee),ee}function qo(J,F){for(var U=0;U<F.length;U+=3)J.minX=Math.min(J.minX,F[U]),J.minY=Math.min(J.minY,F[U+1]),J.maxX=Math.max(J.maxX,F[U]),J.maxY=Math.max(J.maxY,F[U+1])}function ii(J,F,U,G){if(F.geometry){var ee=F.geometry.coordinates,re=F.geometry.type,me=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),ae=[],se=F.id;if(U.promoteId?se=F.properties[U.promoteId]:U.generateId&&(se=G||0),re==="Point")Xt(ee,ae);else if(re==="MultiPoint")for(var de=0;de<ee.length;de++)Xt(ee[de],ae);else if(re==="LineString")Or(ee,ae,me,!1);else if(re==="MultiLineString"){if(U.lineMetrics){for(de=0;de<ee.length;de++)Or(ee[de],ae=[],me,!1),J.push(Qr(se,"LineString",ae,F.properties));return}Go(ee,ae,me,!1)}else if(re==="Polygon")Go(ee,ae,me,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(de=0;de<F.geometry.geometries.length;de++)ii(J,{id:se,geometry:F.geometry.geometries[de],properties:F.properties},U,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(de=0;de<ee.length;de++){var ve=[];Go(ee[de],ve,me,!0),ae.push(ve)}}J.push(Qr(se,re,ae,F.properties))}}function Xt(J,F){F.push(ia(J[0])),F.push(Ss(J[1])),F.push(0)}function Or(J,F,U,G){for(var ee,re,me=0,ae=0;ae<J.length;ae++){var se=ia(J[ae][0]),de=Ss(J[ae][1]);F.push(se),F.push(de),F.push(0),ae>0&&(me+=G?(ee*de-se*re)/2:Math.sqrt(Math.pow(se-ee,2)+Math.pow(de-re,2))),ee=se,re=de}var ve=F.length-3;F[2]=1,tr(F,0,ve,U),F[ve+2]=1,F.size=Math.abs(me),F.start=0,F.end=F.size}function Go(J,F,U,G){for(var ee=0;ee<J.length;ee++){var re=[];Or(J[ee],re,U,G),F.push(re)}}function ia(J){return J/360+.5}function Ss(J){var F=Math.sin(J*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function gi(J,F,U,G,ee,re,me,ae){if(G/=F,re>=(U/=F)&&me<G)return J;if(me<U||re>=G)return null;for(var se=[],de=0;de<J.length;de++){var ve=J[de],Ae=ve.geometry,Le=ve.type,_t=ee===0?ve.minX:ve.minY,It=ee===0?ve.maxX:ve.maxY;if(_t>=U&&It<G)se.push(ve);else if(!(It<U||_t>=G)){var ot=[];if(Le==="Point"||Le==="MultiPoint")Es(Ae,ot,U,G,ee);else if(Le==="LineString")Ps(Ae,ot,U,G,ee,!1,ae.lineMetrics);else if(Le==="MultiLineString")an(Ae,ot,U,G,ee,!1);else if(Le==="Polygon")an(Ae,ot,U,G,ee,!0);else if(Le==="MultiPolygon")for(var ft=0;ft<Ae.length;ft++){var vt=[];an(Ae[ft],vt,U,G,ee,!0),vt.length&&ot.push(vt)}if(ot.length){if(ae.lineMetrics&&Le==="LineString"){for(ft=0;ft<ot.length;ft++)se.push(Qr(ve.id,Le,ot[ft],ve.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(ot.length===1?(Le="LineString",ot=ot[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=ot.length===3?"Point":"MultiPoint"),se.push(Qr(ve.id,Le,ot,ve.tags))}}}return se.length?se:null}function Es(J,F,U,G,ee){for(var re=0;re<J.length;re+=3){var me=J[re+ee];me>=U&&me<=G&&(F.push(J[re]),F.push(J[re+1]),F.push(J[re+2]))}}function Ps(J,F,U,G,ee,re,me){for(var ae,se,de=qe(J),ve=ee===0?Fr:Po,Ae=J.start,Le=0;Le<J.length-3;Le+=3){var _t=J[Le],It=J[Le+1],ot=J[Le+2],ft=J[Le+3],vt=J[Le+4],qt=ee===0?_t:It,oi=ee===0?ft:vt,Ot=!1;me&&(ae=Math.sqrt(Math.pow(_t-ft,2)+Math.pow(It-vt,2))),qt<U?oi>U&&(se=ve(de,_t,It,ft,vt,U),me&&(de.start=Ae+ae*se)):qt>G?oi<G&&(se=ve(de,_t,It,ft,vt,G),me&&(de.start=Ae+ae*se)):wn(de,_t,It,ot),oi<U&&qt>=U&&(se=ve(de,_t,It,ft,vt,U),Ot=!0),oi>G&&qt<=G&&(se=ve(de,_t,It,ft,vt,G),Ot=!0),!re&&Ot&&(me&&(de.end=Ae+ae*se),F.push(de),de=qe(J)),me&&(Ae+=ae)}var Gt=J.length-3;_t=J[Gt],It=J[Gt+1],ot=J[Gt+2],(qt=ee===0?_t:It)>=U&&qt<=G&&wn(de,_t,It,ot),Gt=de.length-3,re&&Gt>=3&&(de[Gt]!==de[0]||de[Gt+1]!==de[1])&&wn(de,de[0],de[1],de[2]),de.length&&F.push(de)}function qe(J){var F=[];return F.size=J.size,F.start=J.start,F.end=J.end,F}function an(J,F,U,G,ee,re){for(var me=0;me<J.length;me++)Ps(J[me],F,U,G,ee,re,!1)}function wn(J,F,U,G){J.push(F),J.push(U),J.push(G)}function Fr(J,F,U,G,ee,re){var me=(re-F)/(G-F);return J.push(re),J.push(U+(ee-U)*me),J.push(1),me}function Po(J,F,U,G,ee,re){var me=(re-U)/(ee-U);return J.push(F+(G-F)*me),J.push(re),J.push(1),me}function je(J,F){for(var U=[],G=0;G<J.length;G++){var ee,re=J[G],me=re.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")ee=Mt(re.geometry,F);else if(me==="MultiLineString"||me==="Polygon"){ee=[];for(var ae=0;ae<re.geometry.length;ae++)ee.push(Mt(re.geometry[ae],F))}else if(me==="MultiPolygon")for(ee=[],ae=0;ae<re.geometry.length;ae++){for(var se=[],de=0;de<re.geometry[ae].length;de++)se.push(Mt(re.geometry[ae][de],F));ee.push(se)}U.push(Qr(re.id,me,ee,re.tags))}return U}function Mt(J,F){var U=[];U.size=J.size,J.start!==void 0&&(U.start=J.start,U.end=J.end);for(var G=0;G<J.length;G+=3)U.push(J[G]+F,J[G+1],J[G+2]);return U}function At(J,F){if(J.transformed)return J;var U,G,ee,re=1<<J.z,me=J.x,ae=J.y;for(U=0;U<J.features.length;U++){var se=J.features[U],de=se.geometry,ve=se.type;if(se.geometry=[],ve===1)for(G=0;G<de.length;G+=2)se.geometry.push(ln(de[G],de[G+1],F,re,me,ae));else for(G=0;G<de.length;G++){var Ae=[];for(ee=0;ee<de[G].length;ee+=2)Ae.push(ln(de[G][ee],de[G][ee+1],F,re,me,ae));se.geometry.push(Ae)}}return J.transformed=!0,J}function ln(J,F,U,G,ee,re){return[Math.round(U*(J*G-ee)),Math.round(U*(F*G-re))]}function gr(J,F,U,G,ee){for(var re=F===ee.maxZoom?0:ee.tolerance/((1<<F)*ee.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:G,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<J.length;ae++){me.numFeatures++,yt(me,J[ae],re,ee);var se=J[ae].minX,de=J[ae].minY,ve=J[ae].maxX,Ae=J[ae].maxY;se<me.minX&&(me.minX=se),de<me.minY&&(me.minY=de),ve>me.maxX&&(me.maxX=ve),Ae>me.maxY&&(me.maxY=Ae)}return me}function yt(J,F,U,G){var ee=F.geometry,re=F.type,me=[];if(re==="Point"||re==="MultiPoint")for(var ae=0;ae<ee.length;ae+=3)me.push(ee[ae]),me.push(ee[ae+1]),J.numPoints++,J.numSimplified++;else if(re==="LineString")Nr(me,ee,J,U,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(ae=0;ae<ee.length;ae++)Nr(me,ee[ae],J,U,re==="Polygon",ae===0);else if(re==="MultiPolygon")for(var se=0;se<ee.length;se++){var de=ee[se];for(ae=0;ae<de.length;ae++)Nr(me,de[ae],J,U,!0,ae===0)}if(me.length){var ve=F.tags||null;if(re==="LineString"&&G.lineMetrics){for(var Ae in ve={},F.tags)ve[Ae]=F.tags[Ae];ve.mapbox_clip_start=ee.start/ee.size,ve.mapbox_clip_end=ee.end/ee.size}var Le={geometry:me,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:ve};F.id!==null&&(Le.id=F.id),J.features.push(Le)}}function Nr(J,F,U,G,ee,re){var me=G*G;if(G>0&&F.size<(ee?me:G))U.numPoints+=F.length/3;else{for(var ae=[],se=0;se<F.length;se+=3)(G===0||F[se+2]>me)&&(U.numSimplified++,ae.push(F[se]),ae.push(F[se+1])),U.numPoints++;ee&&function(de,ve){for(var Ae=0,Le=0,_t=de.length,It=_t-2;Le<_t;It=Le,Le+=2)Ae+=(de[Le]-de[It])*(de[Le+1]+de[It+1]);if(Ae>0===ve)for(Le=0,_t=de.length;Le<_t/2;Le+=2){var ot=de[Le],ft=de[Le+1];de[Le]=de[_t-2-Le],de[Le+1]=de[_t-1-Le],de[_t-2-Le]=ot,de[_t-1-Le]=ft}}(ae,re),J.push(ae)}}function zn(J,F){var U=(F=this.options=function(ee,re){for(var me in re)ee[me]=re[me];return ee}(Object.create(this.options),F)).debug;if(U&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var G=function(ee,re){var me=[];if(ee.type==="FeatureCollection")for(var ae=0;ae<ee.features.length;ae++)ii(me,ee.features[ae],re,ae);else ii(me,ee.type==="Feature"?ee:{geometry:ee},re);return me}(J,F);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(ee,re){var me=re.buffer/re.extent,ae=ee,se=gi(ee,1,-1-me,me,0,-1,2,re),de=gi(ee,1,1-me,2+me,0,-1,2,re);return(se||de)&&(ae=gi(ee,1,-me,1+me,0,-1,2,re)||[],se&&(ae=je(se,1).concat(ae)),de&&(ae=ae.concat(je(de,-1)))),ae}(G,F),G.length&&this.splitTile(G,0,0,0),U&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Co(J,F,U){return 32*((1<<J)*U+F)+J}function ir(J,F){return F?J.properties[F]:J.id}function eo(J,F){if(J==null)return!0;if(J.type==="Feature")return ir(J,F)!=null;if(J.type==="FeatureCollection"){const U=new Set;for(const G of J.features){const ee=ir(G,F);if(ee==null||U.has(ee))return!1;U.add(ee)}return!0}return!1}function en(J,F){const U=new Map;if(J!=null)if(J.type==="Feature")U.set(ir(J,F),J);else for(const G of J.features)U.set(ir(G,F),G);return U}function ai(J,F){const U=J.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const G=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!G)return F(null,null);const ee=new class{constructor(me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=me.length,this._features=me}feature(me){return new class{constructor(ae){this._feature=ae,this.extent=u.EXTENT,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(this._feature.type===1){const ae=[];for(const se of this._feature.geometry)ae.push([new u.Point(se[0],se[1])]);return ae}{const ae=[];for(const se of this._feature.geometry){const de=[];for(const ve of se)de.push(new u.Point(ve[0],ve[1]));ae.push(de)}return ae}}toGeoJSON(ae,se,de){return ue.call(this,ae,se,de)}}(this._features[me])}}(G.features);let re=kt(ee);re.byteOffset===0&&re.byteLength===re.buffer.byteLength||(re=new Uint8Array(re)),F(null,{vectorTile:ee,rawData:re.buffer})}zn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},zn.prototype.splitTile=function(J,F,U,G,ee,re,me){for(var ae=[J,F,U,G],se=this.options,de=se.debug;ae.length;){G=ae.pop(),U=ae.pop(),F=ae.pop(),J=ae.pop();var ve=1<<F,Ae=Co(F,U,G),Le=this.tiles[Ae];if(!Le&&(de>1&&console.time("creation"),Le=this.tiles[Ae]=gr(J,F,U,G,se),this.tileCoords.push({z:F,x:U,y:G}),de)){de>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,U,G,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var _t="z"+F;this.stats[_t]=(this.stats[_t]||0)+1,this.total++}if(Le.source=J,ee){if(F===se.maxZoom||F===ee)continue;var It=1<<ee-F;if(U!==Math.floor(re/It)||G!==Math.floor(me/It))continue}else if(F===se.indexMaxZoom||Le.numPoints<=se.indexMaxPoints)continue;if(Le.source=null,J.length!==0){de>1&&console.time("clipping");var ot,ft,vt,qt,oi,Ot,Gt=.5*se.buffer/se.extent,An=.5-Gt,xt=.5+Gt,Oi=1+Gt;ot=ft=vt=qt=null,oi=gi(J,ve,U-Gt,U+xt,0,Le.minX,Le.maxX,se),Ot=gi(J,ve,U+An,U+Oi,0,Le.minX,Le.maxX,se),J=null,oi&&(ot=gi(oi,ve,G-Gt,G+xt,1,Le.minY,Le.maxY,se),ft=gi(oi,ve,G+An,G+Oi,1,Le.minY,Le.maxY,se),oi=null),Ot&&(vt=gi(Ot,ve,G-Gt,G+xt,1,Le.minY,Le.maxY,se),qt=gi(Ot,ve,G+An,G+Oi,1,Le.minY,Le.maxY,se),Ot=null),de>1&&console.timeEnd("clipping"),ae.push(ot||[],F+1,2*U,2*G),ae.push(ft||[],F+1,2*U,2*G+1),ae.push(vt||[],F+1,2*U+1,2*G),ae.push(qt||[],F+1,2*U+1,2*G+1)}}},zn.prototype.getTile=function(J,F,U){var G=this.options,ee=G.extent,re=G.debug;if(J<0||J>24)return null;var me=1<<J,ae=Co(J,F=(F%me+me)%me,U);if(this.tiles[ae])return At(this.tiles[ae],ee);re>1&&console.log("drilling down to z%d-%d-%d",J,F,U);for(var se,de=J,ve=F,Ae=U;!se&&de>0;)de--,ve=Math.floor(ve/2),Ae=Math.floor(Ae/2),se=this.tiles[Co(de,ve,Ae)];return se&&se.source?(re>1&&console.log("found parent tile z%d-%d-%d",de,ve,Ae),re>1&&console.time("drilling down"),this.splitTile(se.source,de,ve,Ae,J,F,U),re>1&&console.timeEnd("drilling down"),this.tiles[ae]?At(this.tiles[ae],ee):null):null};class na extends Ue{constructor(F,U,G,ee){super(F,U,G,ai),this._dataUpdateable=new Map,this.loadGeoJSON=(re,me)=>{const{promoteId:ae}=re;if(re.request)return u.getJSON(re.request,(se,de,ve,Ae)=>{this._dataUpdateable=eo(de,ae)?en(de,ae):void 0,me(se,de,ve,Ae)});if(typeof re.data=="string")try{const se=JSON.parse(re.data);this._dataUpdateable=eo(se,ae)?en(se,ae):void 0,me(null,se)}catch{me(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}else re.dataDiff?this._dataUpdateable?(function(se,de,ve){var Ae,Le,_t,It;if(de.removeAll&&se.clear(),de.remove)for(const ot of de.remove)se.delete(ot);if(de.add)for(const ot of de.add){const ft=ir(ot,ve);ft!=null&&se.set(ft,ot)}if(de.update)for(const ot of de.update){let ft=se.get(ot.id);if(ft==null)continue;const vt=!ot.removeAllProperties&&(((Ae=ot.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0||((Le=ot.addOrUpdateProperties)===null||Le===void 0?void 0:Le.length)>0);if((ot.newGeometry||ot.removeAllProperties||vt)&&(ft={...ft},se.set(ot.id,ft),vt&&(ft.properties={...ft.properties})),ot.newGeometry&&(ft.geometry=ot.newGeometry),ot.removeAllProperties)ft.properties={};else if(((_t=ot.removeProperties)===null||_t===void 0?void 0:_t.length)>0)for(const qt of ot.removeProperties)Object.prototype.hasOwnProperty.call(ft.properties,qt)&&delete ft.properties[qt];if(((It=ot.addOrUpdateProperties)===null||It===void 0?void 0:It.length)>0)for(const{key:qt,value:oi}of ot.addOrUpdateProperties)ft.properties[qt]=oi}}(this._dataUpdateable,re.dataDiff,ae),me(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):me(new Error(`Cannot update existing geojson data in ${re.source}`)):me(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},ee&&(this.loadGeoJSON=ee)}loadData(F,U){var G;(G=this._pendingRequest)===null||G===void 0||G.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const ee=!!(F&&F.request&&F.request.collectResourceTiming)&&new u.RequestPerformance(F.request);this._pendingCallback=U,this._pendingRequest=this.loadGeoJSON(F,(re,me)=>{if(delete this._pendingCallback,delete this._pendingRequest,re||!me)return U(re);if(typeof me!="object")return U(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{pe(me,!0);try{if(F.filter){const se=u.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(ve=>se.value.evaluate({zoom:0},ve))}}this._geoJSONIndex=F.cluster?new zt(function({superclusterOptions:se,clusterProperties:de}){if(!de||!se)return se;const ve={},Ae={},Le={accumulated:null,zoom:0},_t={properties:null},It=Object.keys(de);for(const ot of It){const[ft,vt]=de[ot],qt=u.createExpression(vt),oi=u.createExpression(typeof ft=="string"?[ft,["accumulated"],["get",ot]]:ft);ve[ot]=qt.value,Ae[ot]=oi.value}return se.map=ot=>{_t.properties=ot;const ft={};for(const vt of It)ft[vt]=ve[vt].evaluate(Le,_t);return ft},se.reduce=(ot,ft)=>{_t.properties=ft;for(const vt of It)Le.accumulated=ot[vt],ot[vt]=Ae[vt].evaluate(Le,_t)},se}(F)).load(me.features):function(se,de){return new zn(se,de)}(me,F.geojsonVtOptions)}catch(se){return U(se)}this.loaded={};const ae={};if(ee){const se=ee.finish();se&&(ae.resourceTiming={},ae.resourceTiming[F.source]=JSON.parse(JSON.stringify(se)))}U(null,ae)}})}reloadTile(F,U){const G=this.loaded;return G&&G[F.uid]?super.reloadTile(F,U):this.loadTile(F,U)}removeSource(F,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),U()}getClusterExpansionZoom(F,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(G){U(G)}}getClusterChildren(F,U){try{U(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(G){U(G)}}getClusterLeaves(F,U){try{U(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(G){U(G)}}}class Ur{constructor(F){this.self=F,this.actor=new u.Actor(F,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ue,geojson:na},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,G)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=G},this.self.registerRTLTextPlugin=U=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=U.applyArabicShaping,u.plugin.processBidirectionalText=U.processBidirectionalText,u.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}setReferrer(F,U){this.referrer=U}setImages(F,U,G){this.availableImages[F]=U;for(const ee in this.workerSources[F]){const re=this.workerSources[F][ee];for(const me in re)re[me].availableImages=U}G()}setLayers(F,U,G){this.getLayerIndex(F).replace(U),G()}updateLayers(F,U,G){this.getLayerIndex(F).update(U.layers,U.removedIds),G()}loadTile(F,U,G){this.getWorkerSource(F,U.type,U.source).loadTile(U,G)}loadDEMTile(F,U,G){this.getDEMWorkerSource(F,U.source).loadTile(U,G)}reloadTile(F,U,G){this.getWorkerSource(F,U.type,U.source).reloadTile(U,G)}abortTile(F,U,G){this.getWorkerSource(F,U.type,U.source).abortTile(U,G)}removeTile(F,U,G){this.getWorkerSource(F,U.type,U.source).removeTile(U,G)}removeDEMTile(F,U){this.getDEMWorkerSource(F,U.source).removeTile(U)}removeSource(F,U,G){if(!this.workerSources[F]||!this.workerSources[F][U.type]||!this.workerSources[F][U.type][U.source])return;const ee=this.workerSources[F][U.type][U.source];delete this.workerSources[F][U.type][U.source],ee.removeSource!==void 0?ee.removeSource(U,G):G()}loadWorkerSource(F,U,G){try{this.self.importScripts(U.url),G()}catch(ee){G(ee.toString())}}syncRTLPluginState(F,U,G){try{u.plugin.setState(U);const ee=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);const re=u.plugin.isParsed();G(re?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),re)}}catch(ee){G(ee.toString())}}getAvailableImages(F){let U=this.availableImages[F];return U||(U=[]),U}getLayerIndex(F){let U=this.layerIndexes[F];return U||(U=this.layerIndexes[F]=new H),U}getWorkerSource(F,U,G){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][U]||(this.workerSources[F][U]={}),!this.workerSources[F][U][G]){const ee={send:(re,me,ae)=>{this.actor.send(re,me,ae,F)}};this.workerSources[F][U][G]=new this.workerSourceTypes[U](ee,this.getLayerIndex(F),this.getAvailableImages(F))}return this.workerSources[F][U][G]}getDEMWorkerSource(F,U){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][U]||(this.demWorkerSources[F][U]=new We),this.demWorkerSources[F][U]}}return u.isWorker()&&(self.worker=new Ur(self)),Ur}),I(["./shared"],function(u){var H="3.3.0";class q{static testProp(t){if(!q.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in q.docStyle)return t[a];return t[0]}static create(t,a,c){const f=window.document.createElement(t);return a!==void 0&&(f.className=a),c&&c.appendChild(f),f}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(t,a){t.style[q.transformProp]=a}static addEventListener(t,a,c,f={}){t.addEventListener(a,c,"passive"in f?f:f.capture)}static removeEventListener(t,a,c,f={}){t.removeEventListener(a,c,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",q.suppressClickInternal,!0)},0)}static mousePos(t,a){const c=t.getBoundingClientRect();return new u.Point(a.clientX-c.left-t.clientLeft,a.clientY-c.top-t.clientTop)}static touchPos(t,a){const c=t.getBoundingClientRect(),f=[];for(let g=0;g<a.length;g++)f.push(new u.Point(a[g].clientX-c.left-t.clientLeft,a[g].clientY-c.top-t.clientTop));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);const ke={supported:!1,testSupport:function(m){!Ue&&Ce&&(We?Fe(m):_e=m)}};let _e,Ce,Ue=!1,We=!1;function Fe(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Ce),m.isContextLost())return;ke.supported=!0}catch{}m.deleteTexture(t),Ue=!0}var Bt,pe;typeof document<"u"&&(Ce=document.createElement("img"),Ce.onload=function(){_e&&Fe(_e),_e=null,We=!0},Ce.onerror=function(){Ue=!0,_e=null},Ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let t,a,c,f;m.resetRequestQueue=()=>{t=[],a=0,c=0,f={}},m.addThrottleControl=M=>{const A=c++;return f[A]=M,A},m.removeThrottleControl=M=>{delete f[M],S()},m.getImage=(M,A,R=!0)=>{ke.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*");const V={requestParameters:M,supportImageRefresh:R,callback:A,cancelled:!1,completed:!1,cancel:()=>{V.completed||V.cancelled||(V.cancelled=!0,V.innerRequest&&(V.innerRequest.cancel(),a--),S())}};return t.push(V),S(),V};const g=M=>{const{requestParameters:A,supportImageRefresh:R,callback:V}=M;return u.extend(A,{type:"image"}),(R!==!1||u.isWorker()||u.getProtocolAction(A.url)||A.headers&&!Object.keys(A.headers).reduce((K,X)=>K&&X==="accept",!0)?u.makeRequest:C)(A,(K,X,Q,W)=>{T(M,V,K,X,Q,W)})},T=(M,A,R,V,K,X)=>{R?A(R):V instanceof HTMLImageElement||u.isImageBitmap(V)?A(null,V):V&&((Q,W)=>{typeof createImageBitmap=="function"?u.arrayBufferToImageBitmap(Q,W):u.arrayBufferToImage(Q,W)})(V,(Q,W)=>{Q!=null?A(Q):W!=null&&A(null,W,{cacheControl:K,expires:X})}),M.cancelled||(M.completed=!0,a--,S())},S=()=>{const M=(()=>{const A=Object.keys(f);let R=!1;if(A.length>0){for(const V of A)if(R=f[V](),R)break}return R})()?u.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=a;A<M&&t.length>0;A++){const R=t.shift();if(R.cancelled){A--;continue}const V=g(R);a++,R.innerRequest=V}},C=(M,A)=>{const R=new Image,V=M.url;let K=!1;const X=M.credentials;return X&&X==="include"?R.crossOrigin="use-credentials":(X&&X==="same-origin"||!u.sameOrigin(V))&&(R.crossOrigin="anonymous"),R.fetchPriority="high",R.onload=()=>{A(null,R),R.onerror=R.onload=null},R.onerror=()=>{K||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),R.onerror=R.onload=null},R.src=V,{cancel:()=>{K=!0,R.src=""}}}}(Bt||(Bt={})),Bt.resetRequestQueue(),function(m){m.Glyphs="Glyphs",m.Image="Image",m.Source="Source",m.SpriteImage="SpriteImage",m.SpriteJSON="SpriteJSON",m.Style="Style",m.Tile="Tile",m.Unknown="Unknown"}(pe||(pe={}));class ue{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeSpriteURL(t,a,c){const f=function(g){const T=g.match(ye);if(!T)throw new Error(`Unable to parse URL "${g}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(t);return f.path+=`${a}${c}`,function(g){const T=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${T}`}(f)}setTransformRequest(t){this._transformRequestFn=t}}const ye=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ne(m){var t=new u.ARRAY_TYPE(3);return t[0]=m[0],t[1]=m[1],t[2]=m[2],t}var tt,ht=function(m,t,a){return m[0]=t[0]-a[0],m[1]=t[1]-a[1],m[2]=t[2]-a[2],m};tt=new u.ARRAY_TYPE(3),u.ARRAY_TYPE!=Float32Array&&(tt[0]=0,tt[1]=0,tt[2]=0);var rt=function(m){var t=m[0],a=m[1];return t*t+a*a};function dt(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const a=[];for(const{id:c,url:f}of m){const g=`${c}${f}`;a.indexOf(g)===-1&&(a.push(g),t.push({id:c,url:f}))}}return t}function Ut(m,t,a,c,f){if(c)return void m(c);if(f!==Object.values(t).length||f!==Object.values(a).length)return;const g={};for(const T in t){g[T]={};const S=u.browser.getImageCanvasContext(a[T]),C=t[T];for(const M in C){const{width:A,height:R,x:V,y:K,sdf:X,pixelRatio:Q,stretchX:W,stretchY:he,content:be}=C[M];g[T][M]={data:null,pixelRatio:Q,sdf:X,stretchX:W,stretchY:he,content:be,spriteData:{width:A,height:R,x:V,y:K,context:S}}}}m(null,g)}(function(){var m=new u.ARRAY_TYPE(2);u.ARRAY_TYPE!=Float32Array&&(m[0]=0,m[1]=0)})();class ct{constructor(t,a,c,f){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(a,f)}update(t,a,c){const{width:f,height:g}=t,T=!(this.size&&this.size[0]===f&&this.size[1]===g||c),{context:S}=this,{gl:C}=S;if(this.useMipmap=!!(a&&a.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!a||a.premultiply!==!1)),T)this.size=[f,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.isImageBitmap(t)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,t):C.texImage2D(C.TEXTURE_2D,0,this.format,f,g,0,this.format,C.UNSIGNED_BYTE,t.data);else{const{x:M,y:A}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.isImageBitmap(t)?C.texSubImage2D(C.TEXTURE_2D,0,M,A,C.RGBA,C.UNSIGNED_BYTE,t):C.texSubImage2D(C.TEXTURE_2D,0,M,A,f,g,C.RGBA,C.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(t,a,c){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),c!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,c||t),this.filter=t),a!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ei(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class ri extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:c}of this.requestors)this._notify(a,c);this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new u.RGBAImage({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||a<f[1])return!1;c=f[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,f=c&&c.width||a.data.width,g=c&&c.height||a.data.height;return!(t[0]<0||f<t[0]||t[1]<0||g<t[1]||t[2]<0||f<t[2]||t[3]<0||g<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const f=this.getImage(t);if(c&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let c=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(c=!1);this.isLoaded()||c?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const c={};for(const f of t){let g=this.getImage(f);g||(this.fire(new u.Event("styleimagemissing",{id:f})),g=this.getImage(f)),g?c[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:u.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,c)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},g=new u.ImagePosition(f,c);this.patterns[t]={bin:f,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ct(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:a,h:c}=u.potpack(t),f=this.atlasImage;f.resize({width:a||1,height:c||1});for(const g in this.patterns){const{bin:T}=this.patterns[g],S=T.x+1,C=T.y+1,M=this.getImage(g).data,A=M.width,R=M.height;u.RGBAImage.copy(M,f,{x:0,y:0},{x:S,y:C},{width:A,height:R}),u.RGBAImage.copy(M,f,{x:0,y:R-1},{x:S,y:C-1},{width:A,height:1}),u.RGBAImage.copy(M,f,{x:0,y:0},{x:S,y:C+R},{width:A,height:1}),u.RGBAImage.copy(M,f,{x:A-1,y:0},{x:S-1,y:C},{width:1,height:R}),u.RGBAImage.copy(M,f,{x:0,y:0},{x:S+A,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||u.warnOnce(`Image with ID: "${a}" was not found`),ei(c)&&this.updateImage(a,c)}}}const xn=1e20;function sn(m,t,a,c,f,g,T,S,C){for(let M=t;M<t+c;M++)Rr(m,a*g+M,g,f,T,S,C);for(let M=a;M<a+f;M++)Rr(m,M*g+t,1,c,T,S,C)}function Rr(m,t,a,c,f,g,T){g[0]=0,T[0]=-xn,T[1]=xn,f[0]=m[t];for(let S=1,C=0,M=0;S<c;S++){f[S]=m[t+S*a];const A=S*S;do{const R=g[C];M=(f[S]-f[R]+A-R*R)/(S-R)/2}while(M<=T[C]&&--C>-1);C++,g[C]=S,T[C]=M,T[C+1]=xn}for(let S=0,C=0;S<c;S++){for(;T[C+1]<S;)C++;const M=g[C],A=S-M;m[t+S*a]=f[M]+A*A}}class hi{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t,a){const c=[];for(const f in t)for(const g of t[f])c.push({stack:f,id:g});u.asyncAll(c,({stack:f,id:g},T)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{}});let C=S.glyphs[g];if(C!==void 0)return void T(null,{stack:f,id:g,glyph:C});if(C=this._tinySDF(S,f,g),C)return S.glyphs[g]=C,void T(null,{stack:f,id:g,glyph:C});const M=Math.floor(g/256);if(256*M>65535)return void T(new Error("glyphs > 65535 not supported"));if(S.ranges[M])return void T(null,{stack:f,id:g,glyph:C});if(!this.url)return void T(new Error("glyphsUrl is not set"));let A=S.requests[M];A||(A=S.requests[M]=[],hi.loadGlyphRange(f,M,this.url,this.requestManager,(R,V)=>{if(V){for(const K in V)this._doesCharSupportLocalGlyph(+K)||(S.glyphs[+K]=V[+K]);S.ranges[M]=!0}for(const K of A)K(R,V);delete S.requests[M]})),A.push((R,V)=>{R?T(R):V&&T(null,{stack:f,id:g,glyph:V[g]||null})})},(f,g)=>{if(f)a(f);else if(g){const T={};for(const{stack:S,id:C,glyph:M}of g)(T[S]||(T[S]={}))[C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};a(null,T)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(u.unicodeBlockLookup["CJK Unified Ideographs"](t)||u.unicodeBlockLookup["Hangul Syllables"](t)||u.unicodeBlockLookup.Hiragana(t)||u.unicodeBlockLookup.Katakana(t))}_tinySDF(t,a,c){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let g=t.tinySDF;if(!g){let S="400";/bold/i.test(a)?S="900":/medium/i.test(a)?S="500":/light/i.test(a)&&(S="200"),g=t.tinySDF=new hi.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:f,fontWeight:S})}const T=g.draw(String.fromCharCode(c));return{id:c,bitmap:new u.AlphaImage({width:T.width||30,height:T.height||30},T.data),metrics:{width:T.glyphWidth||24,height:T.glyphHeight||24,left:T.glyphLeft||0,top:T.glyphTop-27||-8,advance:T.glyphAdvance||24}}}}hi.loadGlyphRange=function(m,t,a,c,f){const g=256*t,T=g+255,S=c.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${g}-${T}`),pe.Glyphs);u.getArrayBuffer(S,(C,M)=>{if(C)f(C);else if(M){const A={};for(const R of u.parseGlyphPbf(M))A[R.id]=R;f(null,A)}})},hi.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:T="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=a;const S=this.size=m+4*t,C=this._createCanvas(S),M=this.ctx=C.getContext("2d",{willReadFrequently:!0});M.font=`${T} ${g} ${m}px ${f}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(m),T=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),C=Math.min(this.size-this.buffer,T+Math.ceil(c)),M=S+2*this.buffer,A=C+2*this.buffer,R=Math.max(M*A,0),V=new Uint8ClampedArray(R),K={data:V,width:M,height:A,glyphWidth:S,glyphHeight:C,glyphTop:T,glyphLeft:0,glyphAdvance:t};if(S===0||C===0)return K;const{ctx:X,buffer:Q,gridInner:W,gridOuter:he}=this;X.clearRect(Q,Q,S,C),X.fillText(m,Q,Q+T);const be=X.getImageData(Q,Q,S,C);he.fill(xn,0,R),W.fill(0,0,R);for(let ie=0;ie<C;ie++)for(let fe=0;fe<S;fe++){const Ee=be.data[4*(ie*S+fe)+3]/255;if(Ee===0)continue;const Pe=(ie+Q)*M+fe+Q;if(Ee===1)he[Pe]=0,W[Pe]=xn;else{const Me=.5-Ee;he[Pe]=Me>0?Me*Me:0,W[Pe]=Me<0?Me*Me:0}}sn(he,0,0,M,A,M,this.f,this.v,this.z),sn(W,Q,Q,S,C,M,this.f,this.v,this.z);for(let ie=0;ie<R;ie++){const fe=Math.sqrt(he[ie])-Math.sqrt(W[ie]);V[ie]=Math.round(255-255*(fe/this.radius+this.cutoff))}return K}};class kn{constructor(){this.specification=u.v8Spec.light.position}possiblyEvaluate(t,a){return u.sphericalToCartesian(t.expression.evaluate(a))}interpolate(t,a,c){return{x:u.interpolate.number(t.x,a.x,c),y:u.interpolate.number(t.y,a.y,c),z:u.interpolate.number(t.z,a.z,c)}}}let Re,kt;class He extends u.Evented{constructor(t){super(),Re=Re||new u.Properties({anchor:new u.DataConstantProperty(u.v8Spec.light.anchor),position:new kn,color:new u.DataConstantProperty(u.v8Spec.light.color),intensity:new u.DataConstantProperty(u.v8Spec.light.intensity)}),this._transitionable=new u.Transitionable(Re),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(u.validateLight,t,a))for(const c in t){const f=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),f):this._transitionable.setValue(c,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.v8Spec})))}}class St{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const f=[];let g=t.length%2==1?-t[t.length-1]*c:0,T=t[0]*c,S=!0;f.push({left:g,right:T,isDash:S,zeroLength:t[0]===0});let C=t[0];for(let M=1;M<t.length;M++){S=!S;const A=t[M];g=C*c,C+=A,T=C*c,f.push({left:g,right:T,isDash:S,zeroLength:A===0})}return f}addRoundDash(t,a,c){const f=a/2;for(let g=-c;g<=c;g++){const T=this.width*(this.nextRow+c+g);let S=0,C=t[S];for(let M=0;M<this.width;M++){M/C.right>1&&(C=t[++S]);const A=Math.abs(M-C.left),R=Math.abs(M-C.right),V=Math.min(A,R);let K;const X=g/c*(f+1);if(C.isDash){const Q=f-Math.abs(X);K=Math.sqrt(V*V+Q*Q)}else K=f-Math.sqrt(V*V+X*X);this.data[T+M]=Math.max(0,Math.min(255,K+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const C=t[S],M=t[S+1];C.zeroLength?t.splice(S,1):M&&M.isDash===C.isDash&&(M.left=C.left,t.splice(S,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const f=this.width*this.nextRow;let g=0,T=t[g];for(let S=0;S<this.width;S++){S/T.right>1&&(T=t[++g]);const C=Math.abs(S-T.left),M=Math.abs(S-T.right),A=Math.min(C,M);this.data[f+S]=Math.max(0,Math.min(255,(T.isDash?A:-A)+128))}}addDash(t,a){const c=a?7:0,f=2*c+1;if(this.nextRow+f>this.height)return u.warnOnce("LineAtlas out of space"),null;let g=0;for(let S=0;S<t.length;S++)g+=t[S];if(g!==0){const S=this.width/g,C=this.getDashRanges(t,this.width,S);a?this.addRoundDash(C,S,c):this.addRegularDash(C)}const T={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:g};return this.nextRow+=f,this.dirty=!0,T}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class Rt{constructor(t,a,c){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=c;const f=this.workerPool.acquire(c);for(let g=0;g<f.length;g++){const T=new Rt.Actor(f[g],a,c);T.name=`Worker ${g}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a,c){u.asyncAll(this.actors,(f,g)=>{f.send(t,a,g)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function ti(m,t,a){const c=function(f,g){if(f)return a(f);if(g){const T=u.pick(u.extend(g,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(T.vectorLayers=g.vector_layers,T.vectorLayerIds=T.vectorLayers.map(S=>S.id)),a(null,T)}};return m.url?u.getJSON(t.transformRequest(m.url,pe.Source),c):u.browser.frame(()=>c(null,m))}Rt.Actor=u.Actor;class Ct{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof u.LngLat?new u.LngLat(t.lng,t.lat):u.LngLat.convert(t),this}setSouthWest(t){return this._sw=t instanceof u.LngLat?new u.LngLat(t.lng,t.lat):u.LngLat.convert(t),this}extend(t){const a=this._sw,c=this._ne;let f,g;if(t instanceof u.LngLat)f=t,g=t;else{if(!(t instanceof Ct))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ct.convert(t)):this.extend(u.LngLat.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(u.LngLat.convert(t)):this;if(f=t._sw,g=t._ne,!f||!g)return this}return a||c?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new u.LngLat(f.lng,f.lat),this._ne=new u.LngLat(g.lng,g.lat)),this}getCenter(){return new u.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new u.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=u.LngLat.convert(t);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(t){return t instanceof Ct?t:t&&new Ct(t)}static fromLngLat(t,a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*t.lat);return new Ct(new u.LngLat(t.lng-f,t.lat-c),new u.LngLat(t.lng+f,t.lat+c))}}class Zt{constructor(t,a,c){this.bounds=Ct.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*a),f=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*a),g=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*a),T=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*a);return t.x>=c&&t.x<g&&t.y>=f&&t.y<T}}class zt extends u.Evented{constructor(t,a,c,f){if(super(),this.load=()=>{this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ti(this._options,this.map._requestManager,(g,T)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new u.ErrorEvent(g)):T&&(u.extend(this,T),T.bounds&&(this.tileBounds=new Zt(T.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>u.extend({},this._options),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(a,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,a){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(c,pe.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(T,S){return delete t.request,t.aborted?a(null):T&&T.status!==404?a(T):(S&&S.resourceTiming&&(t.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&t.setExpiryData(S),t.loadVectorData(S,this.map.painter),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",f,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",f,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Bi extends u.Evented{constructor(t,a,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},a),u.extend(this,u.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ti(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):a&&(u.extend(this,a),a.bounds&&(this.tileBounds=new Zt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Bt.getImage(this.map._requestManager.transformRequest(c,pe.Tile),(f,g,T)=>{if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(f)t.state="errored",a(f);else if(g){this.map._refreshExpiredTiles&&T&&t.setExpiryData(T);const S=this.map.painter.context,C=S.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new ct(S,g,C.RGBA,{useMipmap:!0}),t.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&C.texParameterf(C.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),t.state="loaded",a(null)}},this.map._refreshExpiredTiles)}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}class Zn extends Bi{constructor(t,a,c,f){super(t,a,c,f),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(t,a){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function f(g,T){g&&(t.state="errored",a(g)),T&&(t.dem=T,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",a(null))}t.request=Bt.getImage(this.map._requestManager.transformRequest(c,pe.Tile),(function(g,T){if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(g)t.state="errored",a(g);else if(T){this.map._refreshExpiredTiles&&t.setExpiryData(T),delete T.cacheControl,delete T.expires;const S=u.isImageBitmap(T)&&(kt==null&&(kt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),kt)?T:u.browser.getImageData(T,1),C={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:S,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,f.bind(this)))}}).bind(this),this.map._refreshExpiredTiles),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),f=(a.x-1+c)%c,g=a.x===0?t.wrap-1:t.wrap,T=(a.x+1+c)%c,S=a.x+1===c?t.wrap+1:t.wrap,C={};return C[new u.OverscaledTileID(t.overscaledZ,g,a.z,f,a.y).key]={backfilled:!1},C[new u.OverscaledTileID(t.overscaledZ,S,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(C[new u.OverscaledTileID(t.overscaledZ,g,a.z,f,a.y-1).key]={backfilled:!1},C[new u.OverscaledTileID(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},C[new u.OverscaledTileID(t.overscaledZ,S,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<c&&(C[new u.OverscaledTileID(t.overscaledZ,g,a.z,f,a.y+1).key]={backfilled:!1},C[new u.OverscaledTileID(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},C[new u.OverscaledTileID(t.overscaledZ,S,a.z,T,a.y+1).key]={backfilled:!1}),C}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Br extends u.Evented{constructor(t,a,c,f){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>u.extend({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(f),this._data=a.data,this._options=u.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const g=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*g,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*g,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.EXTENT,radius:(a.clusterRadius||50)*g,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},a),this}getClusterChildren(t,a){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},a),this}getClusterLeaves(t,a,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:a,offset:c},f),this}_updateWorkerData(t){const a=u.extend({},this.workerOptions);t?a.dataDiff=t:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(u.browser.resolveURL(this._data),pe.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(c,f)=>{if(this._pendingLoads--,this._removed||f&&f.abandoned)return void this.fire(new u.Event("dataabort",{dataType:"source"}));let g=null;if(f&&f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0)),c)return void this.fire(new u.ErrorEvent(c));const T={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&u.extend(T,{resourceTiming:g}),this.fire(new u.Event("data",{...T,sourceDataType:"metadata"})),this.fire(new u.Event("data",{...T,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(t,a){const c=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(c,f,(g,T)=>(delete t.request,t.unloadVectorData(),t.aborted?a(null):g?a(g):(t.loadVectorData(T,this.map.painter,c==="reloadTile"),a(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Mn=u.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class er extends u.Evented{constructor(t,a,c,f){super(),this.load=(g,T)=>{this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Bt.getImage(this.map._requestManager.transformRequest(this.url,pe.Image),(S,C)=>{this._request=null,this._loaded=!0,S?this.fire(new u.ErrorEvent(S)):C&&(this.image=C,g&&(this.coordinates=g),T&&T(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,T=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Mn.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ct(g,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let S=!1;for(const C in this.tiles){const M=this.tiles[C];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,S=!0)}S&&this.fire(new u.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(u.MercatorCoordinate.fromLngLat);this.tileID=function(f){let g=1/0,T=1/0,S=-1/0,C=-1/0;for(const V of f)g=Math.min(g,V.x),T=Math.min(T,V.y),S=Math.max(S,V.x),C=Math.max(C,V.y);const M=Math.max(S-g,C-T),A=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),R=Math.pow(2,A);return new u.CanonicalTileID(A,Math.floor((g+S)/2*R),Math.floor((T+C)/2*R))}(a),this.minzoom=this.maxzoom=this.tileID.z;const c=a.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new u.RasterBoundsArray,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,u.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,u.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}hasTransition(){return!1}}class tr extends er{constructor(t,a,c,f){super(t,a,c,f),this.load=()=>{this._loaded=!1;const g=this.options;this.urls=[];for(const T of g.urls)this.urls.push(this.map._requestManager.transformRequest(T,pe.Source).url);u.getVideo(this.urls,(T,S)=>{this._loaded=!0,T?this.fire(new u.ErrorEvent(T)):S&&(this.video=S,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,T=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Mn.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.texSubImage2D(T.TEXTURE_2D,0,0,0,T.RGBA,T.UNSIGNED_BYTE,this.video)):(this.texture=new ct(g,this.video,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let S=!1;for(const C in this.tiles){const M=this.tiles[C];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,S=!0)}S&&this.fire(new u.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=a}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Ie extends er{constructor(t,a,c,f){super(t,a,c,f),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const T=this.map.painter.context,S=T.gl;this.boundsBuffer||(this.boundsBuffer=T.createVertexBuffer(this._boundsArray,Mn.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ct(T,this.canvas,S.RGBA,{premultiply:!0});let C=!1;for(const M in this.tiles){const A=this.tiles[M];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,C=!0)}C&&this.fire(new u.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(T=>typeof T!="number"))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Qr={},qo=m=>{switch(m){case"geojson":return Br;case"image":return er;case"raster":return Bi;case"raster-dem":return Zn;case"vector":return zt;case"video":return tr;case"canvas":return Ie}return Qr[m]};function ii(m,t){const a=u.create();return u.translate(a,a,[1,1,0]),u.scale(a,a,[.5*m.width,.5*m.height,1]),u.multiply(a,a,m.calculatePosMatrix(t.toUnwrapped()))}function Xt(m,t,a,c,f,g){const T=function(R,V,K){if(R)for(const X of R){const Q=V[X];if(Q&&Q.source===K&&Q.type==="fill-extrusion")return!0}else for(const X in V){const Q=V[X];if(Q.source===K&&Q.type==="fill-extrusion")return!0}return!1}(f&&f.layers,t,m.id),S=g.maxPitchScaleFactor(),C=m.tilesIn(c,S,T);C.sort(Or);const M=[];for(const R of C)M.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(t,a,m._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,f,g,S,ii(m.transform,R.tileID))});const A=function(R){const V={},K={};for(const X of R){const Q=X.queryResults,W=X.wrappedTileID,he=K[W]=K[W]||{};for(const be in Q){const ie=Q[be],fe=he[be]=he[be]||{},Ee=V[be]=V[be]||[];for(const Pe of ie)fe[Pe.featureIndex]||(fe[Pe.featureIndex]=!0,Ee.push(Pe))}}return V}(M);for(const R in A)A[R].forEach(V=>{const K=V.feature,X=m.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=X});return A}function Or(m,t){const a=m.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}class Go{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=u.uniqueId(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(f,g){const T={};if(!g)return T;for(const S of f){const C=S.layerIds.map(M=>g.getLayer(M)).filter(Boolean);if(C.length!==0){S.layers=C,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(M=>C.filter(A=>A.id===M)[0]));for(const M of C)T[M.id]=S}}return T}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof u.SymbolBucket){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof u.SymbolBucket&&g.hasRTLText){this.hasRTLText=!0,u.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ct(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ct(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,f,g,T,S,C,M,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:g,scale:T,tileSize:this.tileSize,pixelPosMatrix:A,transform:C,params:S,queryPadding:this.queryPadding*M},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),g=a&&a.sourceLayer?a.sourceLayer:"",T=f._geojsonTileLayer||f[g];if(!T)return;const S=u.createFilter(a&&a.filter),{z:C,x:M,y:A}=this.tileID.canonical,R={z:C,x:M,y:A};for(let V=0;V<T.length;V++){const K=T.feature(V);if(S.needGeometry){const W=u.toEvaluationFeature(K,!0);if(!S.filter(new u.EvaluationParameters(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!S.filter(new u.EvaluationParameters(this.tileID.overscaledZ),K))continue;const X=c.getId(K,g),Q=new u.GeoJSONFeature(K,C,M,A,X);Q.tile=R,t.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=u.parseCacheControl(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const g=this.expirationTime-a;g?this.expirationTime=c+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const g=this.buckets[f],T=g.layers[0].sourceLayer||"_geojsonTileLayer",S=c[T],C=t[T];if(!S||!C||Object.keys(C).length===0)continue;g.update(C,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=a&&a.style&&a.style.getLayer(f);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<u.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=u.browser.now()+t}setDependencies(t,a){const c={};for(const f of a)c[f]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const f=this.dependencies[c];if(f){for(const g of a)if(f[g])return!0}}return!1}}class ia{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,c){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const g={value:a,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},c)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const c=t.wrapped().key,f=a===void 0?0:this.data[c].indexOf(a),g=this.data[c][f];return this.data[c].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const c in this.data)for(const f of this.data[c])t(f.value)||a.push(f);for(const c of a)this.remove(c.value.tileID,c)}}class Ss{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const f=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},u.extend(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==f&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const g in this.state[t][f])c[g]||(this.deletedStates[t][f][g]=null)}else for(const g in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][g]===null&&delete this.deletedStates[t][f][g]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const f=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),f=u.extend({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][a];if(g===null)return{};for(const T in g)delete f[T]}return f}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const T in this.stateChanges[f])this.state[f][T]||(this.state[f][T]={}),u.extend(this.state[f][T],this.stateChanges[f][T]),g[T]=this.state[f][T];c[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const T in this.state[f])g[T]={},this.state[f][T]={};else for(const T in this.deletedStates[f]){if(this.deletedStates[f][T]===null)this.state[f][T]={};else for(const S of Object.keys(this.deletedStates[f][T]))delete this.state[f][T][S];g[T]=this.state[f][T]}c[f]=c[f]||{},u.extend(c[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in t)t[f].setFeatureState(c,a)}}class gi extends u.Evented{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,g,T,S)=>{const C=new(qo(g.type))(f,g,T,S);if(C.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${C.id}`);return C})(t,a,c,this),this._tiles={},this._cache=new ia(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ss,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a){return this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new u.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const c=this._tiles[a];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Es).map(t=>t.key)}getRenderableIds(t){const a=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&a.push(this._tiles[c]);return t?a.sort((c,f)=>{const g=c.tileID,T=f.tileID,S=new u.Point(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),C=new u.Point(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-T.overscaledZ||C.y-S.y||C.x-S.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(Es).map(c=>c.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=a),this._loadTile(c,this._tileLoaded.bind(this,c,t,a)))}_tileLoaded(t,a,c,f){if(f)return t.state="errored",void(f.status!==404?this._source.fire(new u.ErrorEvent(f,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=u.browser.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let f=0;f<a.length;f++){const g=a[f];if(t.neighboringTiles&&t.neighboringTiles[g]){const T=this.getTileByID(g);c(t,T),c(T,t)}}function c(f,g){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let T=g.tileID.canonical.x-f.tileID.canonical.x;const S=g.tileID.canonical.y-f.tileID.canonical.y,C=Math.pow(2,f.tileID.canonical.z),M=g.tileID.key;T===0&&S===0||Math.abs(S)>1||(Math.abs(T)>1&&(Math.abs(T+C)===1?T+=C:Math.abs(T-C)===1&&(T-=C)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,T,S),f.neighboringTiles&&f.neighboringTiles[M]&&(f.neighboringTiles[M].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,c,f){for(const g in this._tiles){let T=this._tiles[g];if(f[g]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>c)continue;let S=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const M=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[M.key],T&&T.hasData()&&(S=M)}let C=S;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){f[S.key]=S;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=t.overscaledZ-1;c>=a;c--){const f=t.scaledTo(c),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?u.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const c={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),c[g.tileID.key]=g}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(t,a){if(this.transform=t,this.terrain=a,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new u.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(c=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(c=c.filter(A=>this._source.hasTile(A)))):c=[];const f=t.coveringZoomLevel(this._source),g=Math.max(f-gi.maxOverzooming,this._source.minzoom),T=Math.max(f+gi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const R of c)if(R.canonical.z>this._source.minzoom){const V=R.scaledTo(R.canonical.z-1);A[V.key]=V;const K=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));A[K.key]=K}c=c.concat(Object.values(A))}const S=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new u.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(c,f);if(Ps(this._source.type)){const A={},R={},V=Object.keys(C),K=u.browser.now();for(const X of V){const Q=C[X],W=this._tiles[X];if(!W||W.fadeEndTime!==0&&W.fadeEndTime<=K)continue;const he=this.findLoadedParent(Q,g);he&&(this._addTile(he.tileID),A[he.tileID.key]=he.tileID),R[X]=Q}this._retainLoadedChildren(R,f,T,C);for(const X in A)C[X]||(this._coveredTiles[X]=!0,C[X]=A[X]);if(a){const X={},Q={};for(const W of c)this._tiles[W.key].hasData()?X[W.key]=W:Q[W.key]=W;for(const W in Q){const he=Q[W].children(this._source.maxzoom);this._tiles[he[0].key]&&this._tiles[he[1].key]&&this._tiles[he[2].key]&&this._tiles[he[3].key]&&(X[he[0].key]=C[he[0].key]=he[0],X[he[1].key]=C[he[1].key]=he[1],X[he[2].key]=C[he[2].key]=he[2],X[he[3].key]=C[he[3].key]=he[3],delete Q[W])}for(const W in Q){const he=this.findLoadedParent(Q[W],this._source.minzoom);if(he){X[he.tileID.key]=C[he.tileID.key]=he.tileID;for(const be in X)X[be].isChildOf(he.tileID)&&delete X[be]}}for(const W in this._tiles)X[W]||(this._coveredTiles[W]=!0)}}for(const A in C)this._tiles[A].clearFadeHold();const M=u.keysDifference(this._tiles,C);for(const A of M){const R=this._tiles[A];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){const c={},f={},g=Math.max(a-gi.maxOverzooming,this._source.minzoom),T=Math.max(a+gi.maxUnderzooming,this._source.minzoom),S={};for(const C of t){const M=this._addTile(C);c[C.key]=C,M.hasData()||a<this._source.maxzoom&&(S[C.key]=C)}this._retainLoadedChildren(S,a,T,c);for(const C of t){let M=this._tiles[C.key];if(M.hasData())continue;if(a+1>this._source.maxzoom){const R=C.children(this._source.maxzoom)[0],V=this.getTile(R);if(V&&V.hasData()){c[R.key]=R;continue}}else{const R=C.children(this._source.maxzoom);if(c[R[0].key]&&c[R[1].key]&&c[R[2].key]&&c[R[3].key])continue}let A=M.wasRequested();for(let R=C.overscaledZ-1;R>=g;--R){const V=C.scaledTo(R);if(f[V.key])break;if(f[V.key]=!0,M=this.getTile(V),!M&&A&&(M=this._addTile(V)),M){const K=M.hasData();if((A||K)&&(c[V.key]=V),A=M.wasRequested(),K)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let c,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}a.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;f=g}for(const g of a)this._loadedParentTiles[g]=c}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const c=a;return a||(a=new Go(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))),a.uses++,this._tiles[t.key]=a,c||this._source.fire(new u.Event("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,c){const f=[],g=this.transform;if(!g)return f;const T=c?g.getCameraQueryGeometry(t):t,S=t.map(X=>g.pointCoordinate(X,this.terrain)),C=T.map(X=>g.pointCoordinate(X,this.terrain)),M=this.getIds();let A=1/0,R=1/0,V=-1/0,K=-1/0;for(const X of C)A=Math.min(A,X.x),R=Math.min(R,X.y),V=Math.max(V,X.x),K=Math.max(K,X.y);for(let X=0;X<M.length;X++){const Q=this._tiles[M[X]];if(Q.holdingForFade())continue;const W=Q.tileID,he=Math.pow(2,g.zoom-Q.tileID.overscaledZ),be=a*Q.queryPadding*u.EXTENT/Q.tileSize/he,ie=[W.getTilePoint(new u.MercatorCoordinate(A,R)),W.getTilePoint(new u.MercatorCoordinate(V,K))];if(ie[0].x-be<u.EXTENT&&ie[0].y-be<u.EXTENT&&ie[1].x+be>=0&&ie[1].y+be>=0){const fe=S.map(Pe=>W.getTilePoint(Pe)),Ee=C.map(Pe=>W.getTilePoint(Pe));f.push({tile:Q,tileID:W,queryGeometry:fe,cameraQueryGeometry:Ee,scale:he})}}return f}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of a)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Ps(this._source.type)){const t=u.browser.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=t)return!0}return!1}setFeatureState(t,a,c){this._state.updateState(t=t||"_geojsonTileLayer",a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,c)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,c){const f=this._tiles[t];f&&f.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c in this._tiles)this._tiles[c].hasDependency(t,a)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,a))}}function Es(m,t){const a=Math.abs(2*m.wrap)-+(m.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return m.overscaledZ-t.overscaledZ||c-a||t.canonical.y-m.canonical.y||t.canonical.x-m.canonical.x}function Ps(m){return m==="raster"||m==="image"||m==="video"}gi.maxOverzooming=10,gi.maxUnderzooming=3;const qe="mapboxgl_preloaded_worker_pool";class an{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<an.workerCount;)this.workers.push(new Worker(u.config.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qe]}numActive(){return Object.keys(this.active).length}}const wn=Math.floor(u.browser.hardwareConcurrency/2);let Fr;function Po(){return Fr||(Fr=new an),Fr}an.workerCount=u.isSafari(globalThis)?Math.max(Math.min(wn,3),1):1;class je{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.clamp(t,0,1);let a=1,c=this._distances[a];const f=t*this.paddedLength+this.padding;for(;c<f&&a<this._distances.length;)c=this._distances[++a];const g=a-1,T=this._distances[g],S=c-T,C=S>0?(f-T)/S:0;return this.points[g].mult(1-C).add(this.points[a].mult(C))}}function Mt(m,t){let a=!0;return m==="always"||m!=="never"&&t!=="never"||(a=!1),a}class At{constructor(t,a,c){const f=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let T=0;T<this.xCellCount*this.yCellCount;T++)f.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,f,g){this._forEachCell(a,c,f,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g)}insertCircle(t,a,c,f){this._forEachCell(a-f,c-f,a+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,a,c,f,g,T){this.boxCells[g].push(T)}_insertCircleCell(t,a,c,f,g,T){this.circleCells[g].push(T)}_query(t,a,c,f,g,T,S){if(c<0||t>this.width||f<0||a>this.height)return[];const C=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=f){if(g)return[{key:null,x1:t,y1:a,x2:c,y2:f}];for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const A=this.circles[3*M],R=this.circles[3*M+1],V=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:A-V,y1:R-V,x2:A+V,y2:R+V})}}else this._forEachCell(t,a,c,f,this._queryCell,C,{hitTest:g,overlapMode:T,seenUids:{box:{},circle:{}}},S);return C}query(t,a,c,f){return this._query(t,a,c,f,!1,null)}hitTest(t,a,c,f,g,T){return this._query(t,a,c,f,!0,g,T).length>0}hitTestCircle(t,a,c,f,g){const T=t-c,S=t+c,C=a-c,M=a+c;if(S<0||T>this.width||M<0||C>this.height)return!1;const A=[];return this._forEachCell(T,C,S,M,this._queryCellCircle,A,{hitTest:!0,overlapMode:f,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},g),A.length>0}_queryCell(t,a,c,f,g,T,S,C){const{seenUids:M,hitTest:A,overlapMode:R}=S,V=this.boxCells[g];if(V!==null){const X=this.bboxes;for(const Q of V)if(!M.box[Q]){M.box[Q]=!0;const W=4*Q,he=this.boxKeys[Q];if(t<=X[W+2]&&a<=X[W+3]&&c>=X[W+0]&&f>=X[W+1]&&(!C||C(he))&&(!A||!Mt(R,he.overlapMode))&&(T.push({key:he,x1:X[W],y1:X[W+1],x2:X[W+2],y2:X[W+3]}),A))return!0}}const K=this.circleCells[g];if(K!==null){const X=this.circles;for(const Q of K)if(!M.circle[Q]){M.circle[Q]=!0;const W=3*Q,he=this.circleKeys[Q];if(this._circleAndRectCollide(X[W],X[W+1],X[W+2],t,a,c,f)&&(!C||C(he))&&(!A||!Mt(R,he.overlapMode))){const be=X[W],ie=X[W+1],fe=X[W+2];if(T.push({key:he,x1:be-fe,y1:ie-fe,x2:be+fe,y2:ie+fe}),A)return!0}}}return!1}_queryCellCircle(t,a,c,f,g,T,S,C){const{circle:M,seenUids:A,overlapMode:R}=S,V=this.boxCells[g];if(V!==null){const X=this.bboxes;for(const Q of V)if(!A.box[Q]){A.box[Q]=!0;const W=4*Q,he=this.boxKeys[Q];if(this._circleAndRectCollide(M.x,M.y,M.radius,X[W+0],X[W+1],X[W+2],X[W+3])&&(!C||C(he))&&!Mt(R,he.overlapMode))return T.push(!0),!0}}const K=this.circleCells[g];if(K!==null){const X=this.circles;for(const Q of K)if(!A.circle[Q]){A.circle[Q]=!0;const W=3*Q,he=this.circleKeys[Q];if(this._circlesCollide(X[W],X[W+1],X[W+2],M.x,M.y,M.radius)&&(!C||C(he))&&!Mt(R,he.overlapMode))return T.push(!0),!0}}}_forEachCell(t,a,c,f,g,T,S,C){const M=this._convertToXCellCoord(t),A=this._convertToYCellCoord(a),R=this._convertToXCellCoord(c),V=this._convertToYCellCoord(f);for(let K=M;K<=R;K++)for(let X=A;X<=V;X++)if(g.call(this,t,a,c,f,this.xCellCount*X+K,T,S,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,f,g,T){const S=f-t,C=g-a,M=c+T;return M*M>S*S+C*C}_circleAndRectCollide(t,a,c,f,g,T,S){const C=(T-f)/2,M=Math.abs(t-(f+C));if(M>C+c)return!1;const A=(S-g)/2,R=Math.abs(a-(g+A));if(R>A+c)return!1;if(M<=C||R<=A)return!0;const V=M-C,K=R-A;return V*V+K*K<=c*c}}function ln(m,t,a,c,f){const g=u.create();return t?(u.scale(g,g,[1/f,1/f,1]),a||u.rotateZ(g,g,c.angle)):u.multiply(g,c.labelPlaneMatrix,m),g}function gr(m,t,a,c,f){if(t){const g=u.clone(m);return u.scale(g,g,[f,f,1]),a||u.rotateZ(g,g,-c.angle),g}return c.glCoordMatrix}function yt(m,t,a){let c;a?(c=[m.x,m.y,a(m.x,m.y),1],u.transformMat4(c,c,t)):(c=[m.x,m.y,0,1],ee(c,c,t));const f=c[3];return{point:new u.Point(c[0]/f,c[1]/f),signedDistanceFromCamera:f}}function Nr(m,t){return .5+m/t*.5}function zn(m,t){const a=m[0]/m[3],c=m[1]/m[3];return a>=-t[0]&&a<=t[0]&&c>=-t[1]&&c<=t[1]}function Co(m,t,a,c,f,g,T,S,C,M){const A=c?m.textSizeData:m.iconSizeData,R=u.evaluateSizeForZoom(A,a.transform.zoom),V=[256/a.width*2+1,256/a.height*2+1],K=c?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;K.clear();const X=m.lineVertexArray,Q=c?m.text.placedSymbolArray:m.icon.placedSymbolArray,W=a.transform.width/a.transform.height;let he=!1;for(let be=0;be<Q.length;be++){const ie=Q.get(be);if(ie.hidden||ie.writingMode===u.WritingMode.vertical&&!he){G(ie.numGlyphs,K);continue}let fe;if(he=!1,M?(fe=[ie.anchorX,ie.anchorY,M(ie.anchorX,ie.anchorY),1],u.transformMat4(fe,fe,t)):(fe=[ie.anchorX,ie.anchorY,0,1],ee(fe,fe,t)),!zn(fe,V)){G(ie.numGlyphs,K);continue}const Ee=Nr(a.transform.cameraToCenterDistance,fe[3]),Pe=u.evaluateSizeForFeature(A,R,ie),Me=T?Pe/Ee:Pe*Ee,Be=new u.Point(ie.anchorX,ie.anchorY),De=yt(Be,f,M).point,Ve={projections:{},offsets:{}},lt=en(ie,Me,!1,S,t,f,g,m.glyphOffsetArray,X,K,De,Be,Ve,W,C,M);he=lt.useVertical,(lt.notEnoughRoom||he||lt.needsFlipping&&en(ie,Me,!0,S,t,f,g,m.glyphOffsetArray,X,K,De,Be,Ve,W,C,M).notEnoughRoom)&&G(ie.numGlyphs,K)}c?m.text.dynamicLayoutVertexBuffer.updateData(K):m.icon.dynamicLayoutVertexBuffer.updateData(K)}function ir(m,t,a,c,f,g,T,S,C,M,A,R,V){const K=S.glyphStartIndex+S.numGlyphs,X=S.lineStartIndex,Q=S.lineStartIndex+S.lineLength,W=t.getoffsetX(S.glyphStartIndex),he=t.getoffsetX(K-1),be=F(m*W,a,c,f,g,T,S.segment,X,Q,C,M,A,R,V);if(!be)return null;const ie=F(m*he,a,c,f,g,T,S.segment,X,Q,C,M,A,R,V);return ie?{first:be,last:ie}:null}function eo(m,t,a,c){return m===u.WritingMode.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(m===u.WritingMode.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function en(m,t,a,c,f,g,T,S,C,M,A,R,V,K,X,Q){const W=t/24,he=m.lineOffsetX*W,be=m.lineOffsetY*W;let ie;if(m.numGlyphs>1){const fe=m.glyphStartIndex+m.numGlyphs,Ee=m.lineStartIndex,Pe=m.lineStartIndex+m.lineLength,Me=ir(W,S,he,be,a,A,R,m,C,g,V,X,Q);if(!Me)return{notEnoughRoom:!0};const Be=yt(Me.first.point,T,Q).point,De=yt(Me.last.point,T,Q).point;if(c&&!a){const Ve=eo(m.writingMode,Be,De,K);if(Ve)return Ve}ie=[Me.first];for(let Ve=m.glyphStartIndex+1;Ve<fe-1;Ve++)ie.push(F(W*S.getoffsetX(Ve),he,be,a,A,R,m.segment,Ee,Pe,C,g,V,X,Q));ie.push(Me.last)}else{if(c&&!a){const Ee=yt(R,f,Q).point,Pe=m.lineStartIndex+m.segment+1,Me=new u.Point(C.getx(Pe),C.gety(Pe)),Be=yt(Me,f,Q),De=Be.signedDistanceFromCamera>0?Be.point:ai(R,Me,Ee,1,f,Q),Ve=eo(m.writingMode,Ee,De,K);if(Ve)return Ve}const fe=F(W*S.getoffsetX(m.glyphStartIndex),he,be,a,A,R,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,C,g,V,X,Q);if(!fe)return{notEnoughRoom:!0};ie=[fe]}for(const fe of ie)u.addDynamicAttributes(M,fe.point,fe.angle);return{}}function ai(m,t,a,c,f,g){const T=yt(m.add(m.sub(t)._unit()),f,g).point,S=a.sub(T);return a.add(S._mult(c/S.mag()))}function na(m,t){const{projectionCache:a,lineVertexArray:c,labelPlaneMatrix:f,tileAnchorPoint:g,distanceFromAnchor:T,getElevation:S,previousVertex:C,direction:M,absOffsetX:A}=t;if(a.projections[m])return a.projections[m];const R=new u.Point(c.getx(m),c.gety(m)),V=yt(R,f,S);if(V.signedDistanceFromCamera>0)return a.projections[m]=V.point,V.point;const K=m-M;return ai(T===0?g:new u.Point(c.getx(K),c.gety(K)),R,C,A-T+1,f,S)}function Ur(m,t,a){return m._unit()._perp()._mult(t*a)}function J(m,t,a,c,f,g,T,S){const{projectionCache:C,direction:M}=S;if(C.offsets[m])return C.offsets[m];const A=a.add(t);if(m+M<c||m+M>=f)return C.offsets[m]=A,A;const R=na(m+M,S),V=Ur(R.sub(a),T,M),K=a.add(V),X=R.add(V);return C.offsets[m]=u.findLineIntersection(g,A,K,X)||A,C.offsets[m]}function F(m,t,a,c,f,g,T,S,C,M,A,R,V,K){const X=c?m-t:m+t;let Q=X>0?1:-1,W=0;c&&(Q*=-1,W=Math.PI),Q<0&&(W+=Math.PI);let he,be,ie=Q>0?S+T:S+T+1,fe=f,Ee=f,Pe=0,Me=0;const Be=Math.abs(X),De=[];let Ve;for(;Pe+Me<=Be;){if(ie+=Q,ie<S||ie>=C)return null;Pe+=Me,Ee=fe,be=he;const Xe={projectionCache:R,lineVertexArray:M,labelPlaneMatrix:A,tileAnchorPoint:g,distanceFromAnchor:Pe,getElevation:K,previousVertex:Ee,direction:Q,absOffsetX:Be};if(fe=na(ie,Xe),a===0)De.push(Ee),Ve=fe.sub(Ee);else{let wt;const st=fe.sub(Ee);wt=st.mag()===0?Ur(na(ie+Q,Xe).sub(fe),a,Q):Ur(st,a,Q),be||(be=Ee.add(wt)),he=J(ie,wt,fe,S,C,be,a,Xe),De.push(be),Ve=he.sub(be)}Me=Ve.mag()}const lt=Ve._mult((Be-Pe)/Me)._add(be||Ee),$t=W+Math.atan2(fe.y-Ee.y,fe.x-Ee.x);return De.push(lt),{point:lt,angle:V?$t:0,path:De}}const U=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function G(m,t){for(let a=0;a<m;a++){const c=t.length;t.resize(c+4),t.float32.set(U,3*c)}}function ee(m,t,a){const c=t[0],f=t[1];return m[0]=a[0]*c+a[4]*f+a[12],m[1]=a[1]*c+a[5]*f+a[13],m[3]=a[3]*c+a[7]*f+a[15],m}const re=100;class me{constructor(t,a=new At(t.width+200,t.height+200,25),c=new At(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+re,this.screenBottomBoundary=t.height+re,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,f,g,T){const S=this.projectAndGetPerspectiveRatio(f,t.anchorPointX,t.anchorPointY,T),C=c*S.perspectiveRatio,M=t.x1*C+S.point.x,A=t.y1*C+S.point.y,R=t.x2*C+S.point.x,V=t.y2*C+S.point.y;return!this.isInsideGrid(M,A,R,V)||a!=="always"&&this.grid.hitTest(M,A,R,V,a,g)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[M,A,R,V],offscreen:this.isOffscreen(M,A,R,V)}}placeCollisionCircles(t,a,c,f,g,T,S,C,M,A,R,V,K,X){const Q=[],W=new u.Point(a.anchorX,a.anchorY),he=yt(W,T,X),be=Nr(this.transform.cameraToCenterDistance,he.signedDistanceFromCamera),ie=(A?g/be:g*be)/u.ONE_EM,fe=yt(W,S,X).point,Ee=ir(ie,f,a.lineOffsetX*ie,a.lineOffsetY*ie,!1,fe,W,a,c,S,{projections:{},offsets:{}},!1,X);let Pe=!1,Me=!1,Be=!0;if(Ee){const De=.5*V*be+K,Ve=new u.Point(-100,-100),lt=new u.Point(this.screenRightBoundary,this.screenBottomBoundary),$t=new je,Xe=Ee.first,wt=Ee.last;let st=[];for(let Dt=Xe.path.length-1;Dt>=1;Dt--)st.push(Xe.path[Dt]);for(let Dt=1;Dt<wt.path.length;Dt++)st.push(wt.path[Dt]);const mi=2.5*De;if(C){const Dt=st.map(bt=>yt(bt,C,X));st=Dt.some(bt=>bt.signedDistanceFromCamera<=0)?[]:Dt.map(bt=>bt.point)}let Vt=[];if(st.length>0){const Dt=st[0].clone(),bt=st[0].clone();for(let Ui=1;Ui<st.length;Ui++)Dt.x=Math.min(Dt.x,st[Ui].x),Dt.y=Math.min(Dt.y,st[Ui].y),bt.x=Math.max(bt.x,st[Ui].x),bt.y=Math.max(bt.y,st[Ui].y);Vt=Dt.x>=Ve.x&&bt.x<=lt.x&&Dt.y>=Ve.y&&bt.y<=lt.y?[st]:bt.x<Ve.x||Dt.x>lt.x||bt.y<Ve.y||Dt.y>lt.y?[]:u.clipLine([st],Ve.x,Ve.y,lt.x,lt.y)}for(const Dt of Vt){$t.reset(Dt,.25*De);let bt=0;bt=$t.length<=.5*De?1:Math.ceil($t.paddedLength/mi)+1;for(let Ui=0;Ui<bt;Ui++){const li=Ui/Math.max(bt-1,1),Hn=$t.lerp(li),fn=Hn.x+re,Xi=Hn.y+re;Q.push(fn,Xi,De,0);const sr=fn-De,fo=Xi-De,us=fn+De,cs=Xi+De;if(Be=Be&&this.isOffscreen(sr,fo,us,cs),Me=Me||this.isInsideGrid(sr,fo,us,cs),t!=="always"&&this.grid.hitTestCircle(fn,Xi,De,t,R)&&(Pe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Pe}}}}return{circles:!M&&Pe||!Me||be<this.perspectiveRatioCutoff?[]:Q,offscreen:Be,collisionDetected:Pe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let c=1/0,f=1/0,g=-1/0,T=-1/0;for(const A of t){const R=new u.Point(A.x+re,A.y+re);c=Math.min(c,R.x),f=Math.min(f,R.y),g=Math.max(g,R.x),T=Math.max(T,R.y),a.push(R)}const S=this.grid.query(c,f,g,T).concat(this.ignoredGrid.query(c,f,g,T)),C={},M={};for(const A of S){const R=A.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const V=[new u.Point(A.x1,A.y1),new u.Point(A.x2,A.y1),new u.Point(A.x2,A.y2),new u.Point(A.x1,A.y2)];u.polygonIntersectsPolygon(a,V)&&(C[R.bucketInstanceId][R.featureIndex]=!0,M[R.bucketInstanceId]===void 0&&(M[R.bucketInstanceId]=[]),M[R.bucketInstanceId].push(R.featureIndex))}return M}insertCollisionBox(t,a,c,f,g,T){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:T,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,f,g,T){const S=c?this.ignoredGrid:this.grid,C={bucketInstanceId:f,featureIndex:g,collisionGroupID:T,overlapMode:a};for(let M=0;M<t.length;M+=4)S.insertCircle(C,t[M],t[M+1],t[M+2])}projectAndGetPerspectiveRatio(t,a,c,f){let g;return f?(g=[a,c,f(a,c),1],u.transformMat4(g,g,t)):(g=[a,c,0,1],ee(g,g,t)),{point:new u.Point((g[0]/g[3]+1)/2*this.transform.width+re,(-g[1]/g[3]+1)/2*this.transform.height+re),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,a,c,f){return c<re||t>=this.screenRightBoundary||f<re||a>this.screenBottomBoundary}isInsideGrid(t,a,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=u.identity([]);return u.translate(t,t,[-100,-100,0]),t}}function ae(m,t,a){return t*(u.EXTENT/(m.tileSize*Math.pow(2,a-m.tileID.overscaledZ)))}class se{constructor(t,a,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class de{constructor(t,a,c,f,g){this.text=new se(t?t.text:null,a,c,g),this.icon=new se(t?t.icon:null,a,f,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ve{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class Ae{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Le{constructor(t,a,c,f,g){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=g}}class _t{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function It(m,t,a,c,f){const{horizontalAlign:g,verticalAlign:T}=u.getAnchorAlignment(m);return new u.Point(-(g-.5)*t+c[0]*f,-(T-.5)*a+c[1]*f)}function ot(m,t,a,c,f,g){const{x1:T,x2:S,y1:C,y2:M,anchorPointX:A,anchorPointY:R}=m,V=new u.Point(t,a);return c&&V._rotate(f?g:-g),{x1:T+V.x,y1:C+V.y,x2:S+V.x,y2:M+V.y,anchorPointX:A,anchorPointY:R}}class ft{constructor(t,a,c,f,g){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new me(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new _t(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,c,f){const g=c.getBucket(a),T=c.latestFeatureIndex;if(!g||!T||a.id!==g.layerIds[0])return;const S=c.collisionBoxArray,C=g.layers[0].layout,M=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),A=c.tileSize/u.EXTENT,R=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),V=C.get("text-pitch-alignment")==="map",K=C.get("text-rotation-alignment")==="map",X=ae(c,1,this.transform.zoom),Q=ln(R,V,K,this.transform,X);let W=null;if(V){const be=gr(R,V,K,this.transform,X);W=u.multiply([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[g.bucketInstanceId]=new Le(g.bucketInstanceId,T,g.sourceLayerIndex,g.index,c.tileID);const he={bucket:g,layout:C,posMatrix:R,textLabelPlaneMatrix:Q,labelToScreenMatrix:W,scale:M,textPixelRatio:A,holdingForFade:c.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(f)for(const be of g.sortKeyRanges){const{sortKey:ie,symbolInstanceStart:fe,symbolInstanceEnd:Ee}=be;t.push({sortKey:ie,symbolInstanceStart:fe,symbolInstanceEnd:Ee,parameters:he})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:he})}attemptAnchorPlacement(t,a,c,f,g,T,S,C,M,A,R,V,K,X,Q,W){const he=u.TextAnchorEnum[t.textAnchor],be=[t.textOffset0,t.textOffset1],ie=It(he,c,f,be,g),fe=this.collisionIndex.placeCollisionBox(ot(a,ie.x,ie.y,T,S,this.transform.angle),R,C,M,A.predicate,W);if((!Q||this.collisionIndex.placeCollisionBox(ot(Q,ie.x,ie.y,T,S,this.transform.angle),R,C,M,A.predicate,W).box.length!==0)&&fe.box.length>0){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:be,width:c,height:f,anchor:he,textBoxScale:g,prevAnchor:Ee},this.markUsedJustification(K,he,V,X),K.allowVerticalPlacement&&(this.markUsedOrientation(K,X,V),this.placedOrientations[V.crossTileID]=X),{shift:ie,placedGlyphBoxes:fe}}}placeLayerBucketPart(t,a,c){const{bucket:f,layout:g,posMatrix:T,textLabelPlaneMatrix:S,labelToScreenMatrix:C,textPixelRatio:M,holdingForFade:A,collisionBoxArray:R,partiallyEvaluatedTextSize:V,collisionGroup:K}=t.parameters,X=g.get("text-optional"),Q=g.get("icon-optional"),W=u.getOverlapMode(g,"text-overlap","text-allow-overlap"),he=W==="always",be=u.getOverlapMode(g,"icon-overlap","icon-allow-overlap"),ie=be==="always",fe=g.get("text-rotation-alignment")==="map",Ee=g.get("text-pitch-alignment")==="map",Pe=g.get("icon-text-fit")!=="none",Me=g.get("symbol-z-order")==="viewport-y",Be=he&&(ie||!f.hasIconData()||Q),De=ie&&(he||!f.hasTextData()||X);!f.collisionArrays&&R&&f.deserializeCollisionBoxes(R);const Ve=this.retainedQueryData[f.bucketInstanceId].tileID,lt=this.terrain?(Xe,wt)=>this.terrain.getElevation(Ve,Xe,wt):null,$t=(Xe,wt)=>{var st,mi;if(a[Xe.crossTileID])return;if(A)return void(this.placements[Xe.crossTileID]=new ve(!1,!1,!1));let Vt=!1,Dt=!1,bt=!0,Ui=null,li={box:null,offscreen:null},Hn={box:null,offscreen:null},fn=null,Xi=null,sr=null,fo=0,us=0,cs=0;wt.textFeatureIndex?fo=wt.textFeatureIndex:Xe.useRuntimeCollisionCircles&&(fo=Xe.featureIndex),wt.verticalTextFeatureIndex&&(us=wt.verticalTextFeatureIndex);const js=wt.textBox;if(js){const mn=tn=>{let gn=u.WritingMode.horizontal;if(f.allowVerticalPlacement&&!tn&&this.prevPlacement){const ar=this.prevPlacement.placedOrientations[Xe.crossTileID];ar&&(this.placedOrientations[Xe.crossTileID]=ar,gn=ar,this.markUsedOrientation(f,gn,Xe))}return gn},Vi=(tn,gn)=>{if(f.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&wt.verticalTextBox){for(const ar of f.writingModes)if(ar===u.WritingMode.vertical?(li=gn(),Hn=li):li=tn(),li&&li.box&&li.box.length)break}else li=tn()},_n=Xe.textAnchorOffsetStartIndex,dl=Xe.textAnchorOffsetEndIndex;if(dl===_n){const tn=(gn,ar)=>{const Ai=this.collisionIndex.placeCollisionBox(gn,W,M,T,K.predicate,lt);return Ai&&Ai.box&&Ai.box.length&&(this.markUsedOrientation(f,ar,Xe),this.placedOrientations[Xe.crossTileID]=ar),Ai};Vi(()=>tn(js,u.WritingMode.horizontal),()=>{const gn=wt.verticalTextBox;return f.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&gn?tn(gn,u.WritingMode.vertical):{box:null,offscreen:null}}),mn(li&&li.box&&li.box.length)}else{let tn=u.TextAnchorEnum[(mi=(st=this.prevPlacement)===null||st===void 0?void 0:st.variableOffsets[Xe.crossTileID])===null||mi===void 0?void 0:mi.anchor];const gn=(Ai,pl,hs)=>{const mo=Ai.x2-Ai.x1,Gs=Ai.y2-Ai.y1,zh=Xe.textBoxScale,Ta=Pe&&be==="never"?pl:null;let fl={box:[],offscreen:!1},Sc=W==="never"?1:2,Li="never";tn&&Sc++;for(let Iu=0;Iu<Sc;Iu++){for(let ku=_n;ku<dl;ku++){const Ws=f.textAnchorOffsets.get(ku);if(tn&&Ws.textAnchor!==tn)continue;const ds=this.attemptAnchorPlacement(Ws,Ai,mo,Gs,zh,fe,Ee,M,T,K,Li,Xe,f,hs,Ta,lt);if(ds&&(fl=ds.placedGlyphBoxes,fl&&fl.box&&fl.box.length))return Vt=!0,Ui=ds.shift,fl}tn?tn=null:Li=W}return fl};Vi(()=>gn(js,wt.iconBox,u.WritingMode.horizontal),()=>{const Ai=wt.verticalTextBox;return f.allowVerticalPlacement&&!(li&&li.box&&li.box.length)&&Xe.numVerticalGlyphVertices>0&&Ai?gn(Ai,wt.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),li&&(Vt=li.box,bt=li.offscreen);const ar=mn(li&&li.box);if(!Vt&&this.prevPlacement){const Ai=this.prevPlacement.variableOffsets[Xe.crossTileID];Ai&&(this.variableOffsets[Xe.crossTileID]=Ai,this.markUsedJustification(f,Ai.anchor,Xe,ar))}}}if(fn=li,Vt=fn&&fn.box&&fn.box.length>0,bt=fn&&fn.offscreen,Xe.useRuntimeCollisionCircles){const mn=f.text.placedSymbolArray.get(Xe.centerJustifiedTextSymbolIndex),Vi=u.evaluateSizeForFeature(f.textSizeData,V,mn),_n=g.get("text-padding");Xi=this.collisionIndex.placeCollisionCircles(W,mn,f.lineVertexArray,f.glyphOffsetArray,Vi,T,S,C,c,Ee,K.predicate,Xe.collisionCircleDiameter,_n,lt),Xi.circles.length&&Xi.collisionDetected&&!c&&u.warnOnce("Collisions detected, but collision boxes are not shown"),Vt=he||Xi.circles.length>0&&!Xi.collisionDetected,bt=bt&&Xi.offscreen}if(wt.iconFeatureIndex&&(cs=wt.iconFeatureIndex),wt.iconBox){const mn=Vi=>{const _n=Pe&&Ui?ot(Vi,Ui.x,Ui.y,fe,Ee,this.transform.angle):Vi;return this.collisionIndex.placeCollisionBox(_n,be,M,T,K.predicate,lt)};Hn&&Hn.box&&Hn.box.length&&wt.verticalIconBox?(sr=mn(wt.verticalIconBox),Dt=sr.box.length>0):(sr=mn(wt.iconBox),Dt=sr.box.length>0),bt=bt&&sr.offscreen}const ba=X||Xe.numHorizontalGlyphVertices===0&&Xe.numVerticalGlyphVertices===0,qs=Q||Xe.numIconVertices===0;if(ba||qs?qs?ba||(Dt=Dt&&Vt):Vt=Dt&&Vt:Dt=Vt=Dt&&Vt,Vt&&fn&&fn.box&&this.collisionIndex.insertCollisionBox(fn.box,W,g.get("text-ignore-placement"),f.bucketInstanceId,Hn&&Hn.box&&us?us:fo,K.ID),Dt&&sr&&this.collisionIndex.insertCollisionBox(sr.box,be,g.get("icon-ignore-placement"),f.bucketInstanceId,cs,K.ID),Xi&&(Vt&&this.collisionIndex.insertCollisionCircles(Xi.circles,W,g.get("text-ignore-placement"),f.bucketInstanceId,fo,K.ID),c)){const mn=f.bucketInstanceId;let Vi=this.collisionCircleArrays[mn];Vi===void 0&&(Vi=this.collisionCircleArrays[mn]=new Ae);for(let _n=0;_n<Xi.circles.length;_n+=4)Vi.circles.push(Xi.circles[_n+0]),Vi.circles.push(Xi.circles[_n+1]),Vi.circles.push(Xi.circles[_n+2]),Vi.circles.push(Xi.collisionDetected?1:0)}if(Xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Xe.crossTileID]=new ve(Vt||Be,Dt||De,bt||f.justReloaded),a[Xe.crossTileID]=!0};if(Me){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Xe=f.getSortedSymbolIndexes(this.transform.angle);for(let wt=Xe.length-1;wt>=0;--wt){const st=Xe[wt];$t(f.symbolInstances.get(st),f.collisionArrays[st])}}else for(let Xe=t.symbolInstanceStart;Xe<t.symbolInstanceEnd;Xe++)$t(f.symbolInstances.get(Xe),f.collisionArrays[Xe]);if(c&&f.bucketInstanceId in this.collisionCircleArrays){const Xe=this.collisionCircleArrays[f.bucketInstanceId];u.invert(Xe.invProjMatrix,T),Xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(t,a,c,f){let g;g=f===u.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(a)];const T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const S of T)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:c.crossTileID)}markUsedOrientation(t,a,c){const f=a===u.WritingMode.horizontal||a===u.WritingMode.horizontalOnly?a:0,g=a===u.WritingMode.vertical?a:0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const S of T)t.text.placedSymbolArray.get(S).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(t):1,g=a?a.opacities:{},T=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(const C in this.placements){const M=this.placements[C],A=g[C];A?(this.opacities[C]=new de(A,f,M.text,M.icon),c=c||M.text!==A.text.placed||M.icon!==A.icon.placed):(this.opacities[C]=new de(null,f,M.text,M.icon,M.skipFade),c=c||M.text||M.icon)}for(const C in g){const M=g[C];if(!this.opacities[C]){const A=new de(M,f,!1,!1);A.isHidden()||(this.opacities[C]=A,c=c||M.text.placed||M.icon.placed)}}for(const C in T)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=T[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const f of a){const g=f.getBucket(t);g&&f.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,c,f.collisionBoxArray)}}updateBucketOpacities(t,a,c){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const f=t.layers[0],g=f.layout,T=new de(null,0,!1,!1,!0),S=g.get("text-allow-overlap"),C=g.get("icon-allow-overlap"),M=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=g.get("text-rotation-alignment")==="map",R=g.get("text-pitch-alignment")==="map",V=g.get("icon-text-fit")!=="none",K=new de(null,0,S&&(C||!t.hasIconData()||g.get("icon-optional")),C&&(S||!t.hasTextData()||g.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const X=(Q,W,he)=>{for(let be=0;be<W/4;be++)Q.opacityVertexArray.emplaceBack(he);Q.hasVisibleVertices=Q.hasVisibleVertices||he!==ki};for(let Q=0;Q<t.symbolInstances.length;Q++){const W=t.symbolInstances.get(Q),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:be,crossTileID:ie}=W;let fe=this.opacities[ie];a[ie]?fe=T:fe||(fe=K,this.opacities[ie]=fe),a[ie]=!0;const Ee=W.numIconVertices>0,Pe=this.placedOrientations[W.crossTileID],Me=Pe===u.WritingMode.vertical,Be=Pe===u.WritingMode.horizontal||Pe===u.WritingMode.horizontalOnly;if(he>0||be>0){const De=Fi(fe.text);X(t.text,he,Me?ki:De),X(t.text,be,Be?ki:De);const Ve=fe.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Xe=>{Xe>=0&&(t.text.placedSymbolArray.get(Xe).hidden=Ve||Me?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Ve||Be?1:0);const lt=this.variableOffsets[W.crossTileID];lt&&this.markUsedJustification(t,lt.anchor,W,Pe);const $t=this.placedOrientations[W.crossTileID];$t&&(this.markUsedJustification(t,"left",W,$t),this.markUsedOrientation(t,$t,W))}if(Ee){const De=Fi(fe.icon),Ve=!(V&&W.verticalPlacedIconSymbolIndex&&Me);W.placedIconSymbolIndex>=0&&(X(t.icon,W.numIconVertices,Ve?De:ki),t.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=fe.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(X(t.icon,W.numVerticalIconVertices,Ve?ki:De),t.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const De=t.collisionArrays[Q];if(De){let Ve=new u.Point(0,0);if(De.textBox||De.verticalTextBox){let $t=!0;if(M){const Xe=this.variableOffsets[ie];Xe?(Ve=It(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textBoxScale),A&&Ve._rotate(R?this.transform.angle:-this.transform.angle)):$t=!1}De.textBox&&vt(t.textCollisionBox.collisionVertexArray,fe.text.placed,!$t||Me,Ve.x,Ve.y),De.verticalTextBox&&vt(t.textCollisionBox.collisionVertexArray,fe.text.placed,!$t||Be,Ve.x,Ve.y)}const lt=!!(!Be&&De.verticalIconBox);De.iconBox&&vt(t.iconCollisionBox.collisionVertexArray,fe.icon.placed,lt,V?Ve.x:0,V?Ve.y:0),De.verticalIconBox&&vt(t.iconCollisionBox.collisionVertexArray,fe.icon.placed,!lt,V?Ve.x:0,V?Ve.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Q.invProjMatrix,t.placementViewportMatrix=Q.viewportMatrix,t.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function vt(m,t,a,c,f){m.emplaceBack(t?1:0,a?1:0,c||0,f||0),m.emplaceBack(t?1:0,a?1:0,c||0,f||0),m.emplaceBack(t?1:0,a?1:0,c||0,f||0),m.emplaceBack(t?1:0,a?1:0,c||0,f||0)}const qt=Math.pow(2,25),oi=Math.pow(2,24),Ot=Math.pow(2,17),Gt=Math.pow(2,16),An=Math.pow(2,9),xt=Math.pow(2,8),Oi=Math.pow(2,1);function Fi(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,a=Math.floor(127*m.opacity);return a*qt+t*oi+a*Ot+t*Gt+a*An+t*xt+a*Oi+t}const ki=0;class $n{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,f,g){const T=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(T,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<T.length;)if(a.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,g())return!0;return!1}}class mc{constructor(t,a,c,f,g,T,S,C){this.placement=new ft(t,a,T,S,C),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const f=u.browser.now(),g=()=>!this._forceFullPlacement&&u.browser.now()-f>2;for(;this._currentPlacementIndex>=0;){const T=a[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new $n(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const pn=512/u.EXTENT/2;class nr{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let g=0;g<a.length;g++){const T=a.get(g),S=T.key,C=f.get(S);C?C.push(T):f.set(S,[T])}for(const[g,T]of f){const S={positions:T.map(C=>({x:Math.floor(C.anchorX*pn),y:Math.floor(C.anchorY*pn)})),crossTileIDs:T.map(C=>C.crossTileID)};if(S.positions.length>128){const C=new u.KDBush(S.positions.length,16,Uint16Array);for(const{x:M,y:A}of S.positions)C.add(M,A);C.finish(),delete S.positions,S.index=C}this._symbolsByKey[g]=S}}getScaledCoordinates(t,a){const{x:c,y:f,z:g}=this.tileID.canonical,{x:T,y:S,z:C}=a.canonical,M=pn/Math.pow(2,C-g),A=(S*u.EXTENT+t.anchorY)*M,R=f*u.EXTENT*pn;return{x:Math.floor((T*u.EXTENT+t.anchorX)*M-c*u.EXTENT*pn),y:Math.floor(A-R)}}findMatches(t,a,c){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<t.length;g++){const T=t.get(g);if(T.crossTileID)continue;const S=this._symbolsByKey[T.key];if(!S)continue;const C=this.getScaledCoordinates(T,a);if(S.index){const M=S.index.range(C.x-f,C.y-f,C.x+f,C.y+f).sort();for(const A of M){const R=S.crossTileIDs[A];if(!c[R]){c[R]=!0,T.crossTileID=R;break}}}else if(S.positions)for(let M=0;M<S.positions.length;M++){const A=S.positions[M],R=S.crossTileIDs[M];if(Math.abs(A.x-C.x)<=f&&Math.abs(A.y-C.y)<=f&&!c[R]){c[R]=!0,T.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Fa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Io{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const f=this.indexes[c],g={};for(const T in f){const S=f[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),g[S.tileID.key]=S}this.indexes[c]=g}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const T=this.indexes[g];if(Number(g)>t.overscaledZ)for(const S in T){const C=T[S];C.tileID.isChildOf(t)&&C.findMatches(a.symbolInstances,t,f)}else{const S=T[t.scaledTo(Number(g)).key];S&&S.findMatches(a.symbolInstances,t,f)}}for(let g=0;g<a.symbolInstances.length;g++){const T=a.symbolInstances.get(g);T.crossTileID||(T.crossTileID=c.generate(),f[T.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new nr(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const f=this.indexes[c];for(const g in f)t[f[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[g]),delete f[g],a=!0)}return a}}class Ci{constructor(){this.layerIndexes={},this.crossTileIDs=new Fa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Io);let g=!1;const T={};f.handleWrapJump(c);for(const S of a){const C=S.getBucket(t);C&&t.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(S.tileID,C,this.crossTileIDs)&&(g=!0),T[C.bucketInstanceId]=!0)}return f.removeStaleBuckets(T)&&(g=!0),g}pruneUnusedLayers(t){const a={};t.forEach(c=>{a[c]=!0});for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}const to=(m,t)=>u.emitValidationErrors(m,t&&t.filter(a=>a.identifier!=="source.canvas")),yr=u.pick(u.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Tt=u.pick(u.operations,["setCenter","setZoom","setBearing","setPitch"]),di=u.emptyStyle();class qi extends u.Evented{constructor(t,a={}){super(),this.map=t,this.dispatcher=new Rt(Po(),this,t._getMapId()),this.imageManager=new ri,this.imageManager.setEventedParent(this),this.glyphManager=new hi(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new St(256,512),this.crossTileSymbolIndex=new Ci,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const c=this;this._rtlTextPluginCallback=qi.registerForPluginStateChange(f=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(g,T)=>{if(u.triggerPluginCompletionEvent(g),T&&T.every(S=>S))for(const S in c.sourceCaches){const C=c.sourceCaches[S].getSource().type;C!=="vector"&&C!=="geojson"||c.sourceCaches[S].reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.sourceCaches[f.sourceId];if(!g)return;const T=g.getSource();if(T&&T.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===T.id&&this._validateLayer(C)}})}loadURL(t,a={},c){this.fire(new u.Event("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(t,pe.Style);this._request=u.getJSON(f,(g,T)=>{this._request=null,g?this.fire(new u.ErrorEvent(g)):T&&this._load(T,a,c)})}loadJSON(t,a={},c){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.browser.frame(()=>{this._request=null,a.validate=a.validate!==!1,this._load(t,a,c)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(di,{validate:!1})}_load(t,a,c){const f=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!to(this,u.validateStyle(f))){this._loaded=!0,this.stylesheet=f;for(const g in f.sources)this.addSource(g,f.sources[g],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new He(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}}_createLayers(){const t=u.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of t){const c=u.createStyleLayer(a);c.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=c}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(f,g,T,S){const C=dt(f),M=C.length,A=T>1?"@2x":"",R={},V={},K={};for(const{id:X,url:Q}of C){const W=g.transformRequest(g.normalizeSpriteURL(Q,A,".json"),pe.SpriteJSON),he=`${X}_${W.url}`;R[he]=u.getJSON(W,(fe,Ee)=>{delete R[he],V[X]=Ee,Ut(S,V,K,fe,M)});const be=g.transformRequest(g.normalizeSpriteURL(Q,A,".png"),pe.SpriteImage),ie=`${X}_${be.url}`;R[ie]=Bt.getImage(be,(fe,Ee)=>{delete R[ie],K[X]=Ee,Ut(S,V,K,fe,M)})}return{cancel(){for(const X of Object.values(R))X.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(f,g)=>{if(this._spriteRequest=null,f)this.fire(new u.ErrorEvent(f));else if(g)for(const T in g){this._spritesImagesIds[T]=[];const S=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(C=>!(C in g)):[];for(const C of S)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in g[T]){const M=T==="default"?C:`${T}:${C}`;this._spritesImagesIds[T].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,g[T][C],!1):this.imageManager.addImage(M,g[T][C]),a&&(this._changedImages[M]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"})),c&&c(f)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new u.ErrorEvent(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a);const c=[];for(const f of t)a[f]&&c.push(a[f]);return c}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const f=this._layers[c];f.type!=="custom"&&(t[c]=f.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(f.length||g.length)&&this._updateWorkerLayers(f,g);for(const T in this._updatedSources){const S=this._updatedSources[T];if(S==="reload")this._reloadSource(T);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const c={};for(const f in this.sourceCaches){const g=this.sourceCaches[f];c[f]=g.used,g.used=!1}for(const f of this._order){const g=this._layers[f];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const f in c){const g=this.sourceCaches[f];c[f]!==g.used&&g.fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){this._checkLoaded();const c=this.serialize();if(t=a.transformStyle?a.transformStyle(c,t):t,to(this,u.validateStyle(t)))return!1;(t=u.clone$1(t)).layers=u.derefLayers(t.layers);const f=u.diffStyles(c,t).filter(T=>!(T.command in Tt));if(f.length===0)return!1;const g=f.filter(T=>!(T.command in yr));if(g.length>0)throw new Error(`Unimplemented: ${g.map(T=>T.command).join(", ")}.`);for(const T of f)T.command!=="setTransition"&&this[T.command].apply(this,T.args);return this.stylesheet=t,!0}addImage(t,a){if(this.getImage(t))return this.fire(new u.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(u.validateStyle.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.sourceCaches[t]=new gi(t,a,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t})),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new u.ErrorEvent(new Error(`Layer "${f}" already exists on this map.`)));let g;if(t.type==="custom"){if(to(this,u.validateCustomStyleLayer(t)))return;g=u.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=u.clone$1(t),t=u.extend(t,{source:f})),this._validate(u.validateStyle.layer,`layers.${f}`,t,{arrayIndex:-1},c))return;g=u.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:f}})}const T=a?this._order.indexOf(a):this._order.length;if(a&&T===-1)this.fire(new u.ErrorEvent(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(T,0,f),this._layerOrderChanged=!0,this._layers[f]=g,this._removedLayers[f]&&g.source&&g.type!=="custom"){const S=this._removedLayers[f];delete this._removedLayers[f],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new u.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new u.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===a&&f.maxzoom===c||(a!=null&&(f.minzoom=a),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new u.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!u.deepEqual(f.filter,a))return a==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(u.validateStyle.filter,`layers.${f.id}.filter`,a,null,c)||(f.filter=u.clone$1(a),this._updateLayer(f)))}else this.fire(new u.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,a,c,f={}){this._checkLoaded();const g=this.getLayer(t);g?u.deepEqual(g.getLayoutProperty(a),c)||(g.setLayoutProperty(a,c,f),this._updateLayer(g)):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new u.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,f={}){this._checkLoaded();const g=this.getLayer(t);g?u.deepEqual(g.getPaintProperty(a),c)||(g.setPaintProperty(a,c,f)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,f=t.sourceLayer,g=this.sourceCaches[c];if(g===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const T=g.getSource().type;T==="geojson"&&f?this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||f?(t.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),g.setFeatureState(f,t.id,a)):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,f=this.sourceCaches[c];if(f===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const g=f.getSource().type,T=g==="vector"?t.sourceLayer:void 0;g!=="vector"||T?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(T,t.id,a):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,f=this.sourceCaches[a];if(f!==void 0)return f.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,t.id)):void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=u.mapObject(this.sourceCaches,f=>f.serialize()),a=this._serializeByIds(this._order),c=this.stylesheet;return u.filterObject({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:a},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=T=>this._layers[T].type==="fill-extrusion",c={},f=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(a(S)){c[S]=T;for(const C of t){const M=C[S];if(M)for(const A of M)f.push(A)}}}f.sort((T,S)=>S.intersectionZ-T.intersectionZ);const g=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(a(S))for(let C=f.length-1;C>=0;C--){const M=f[C].feature;if(c[M.layer.id]<T)break;g.push(M),f.pop()}else for(const C of t){const M=C[S];if(M)for(const A of M)g.push(A.feature)}}return g}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of a.layers){const C=this._layers[S];if(!C)return this.fire(new u.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];f[C.source]=!0}}const g=[];a.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const S in this.sourceCaches)a.layers&&!f[S]||g.push(Xt(this.sourceCaches[S],this._layers,T,t,a,c));return this.placement&&g.push(function(S,C,M,A,R,V,K){const X={},Q=V.queryRenderedSymbols(A),W=[];for(const he of Object.keys(Q).map(Number))W.push(K[he]);W.sort(Or);for(const he of W){const be=he.featureIndex.lookupSymbolFeatures(Q[he.bucketInstanceId],C,he.bucketIndex,he.sourceLayerIndex,R.filter,R.layers,R.availableImages,S);for(const ie in be){const fe=X[ie]=X[ie]||[],Ee=be[ie];Ee.sort((Pe,Me)=>{const Be=he.featureSortOrder;if(Be){const De=Be.indexOf(Pe.featureIndex);return Be.indexOf(Me.featureIndex)-De}return Me.featureIndex-Pe.featureIndex});for(const Pe of Ee)fe.push(Pe)}}for(const he in X)X[he].forEach(be=>{const ie=be.feature,fe=M[S[he].source].getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=fe});return X}(this._layers,T,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,a){a&&a.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.sourceCaches[t];return c?function(f,g){const T=f.getRenderableIds().map(M=>f.getTileByID(M)),S=[],C={};for(let M=0;M<T.length;M++){const A=T[M],R=A.tileID.canonical.key;C[R]||(C[R]=!0,A.querySourceFeatures(S,g))}return S}(c,a):[]}addSourceType(t,a,c){return qo(t)?c(new Error(`A source type called "${t}" already exists.`)):(((f,g)=>{Qr[f]=g})(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const T in t)if(!u.deepEqual(t[T],c[T])){f=!0;break}if(!f)return;const g={now:u.browser.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(g)}_validate(t,a,c,f,g={}){return(!g||g.validate!==!1)&&to(this,t.call(u.validateStyle,u.extend({key:a,style:this.serialize(),value:c,styleSpec:u.v8Spec},f)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const c=this.sourceCaches[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,c,f,g=!1){let T=!1,S=!1;const C={};for(const M of this._order){const A=this._layers[M];if(A.type!=="symbol")continue;if(!C[A.source]){const V=this.sourceCaches[A.source];C[A.source]=V.getRenderableIds(!0).map(K=>V.getTileByID(K)).sort((K,X)=>X.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(X.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(A,C[A.source],t.center.lng);T=T||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.browser.now(),t.zoom))&&(this.pauseablePlacement=new mc(t,this.map.terrain,this._order,g,a,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.browser.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const M of this._order){const A=this._layers[M];A.type==="symbol"&&this.placement.updateLayerOpacities(A,C[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.browser.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,c){this.imageManager.getImages(a.icons,c),this._updateTilesForChangedImages();const f=this.sourceCaches[a.source];f&&f.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(t,a,c){this.glyphManager.getGlyphs(a.stacks,c);const f=this.sourceCaches[a.source];f&&f.setDependencies(a.tileID.key,a.type,[""])}getResource(t,a,c){return u.makeRequest(a,c)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(u.validateStyle.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,a,c={},f){this._checkLoaded();const g=[{id:t,url:a}],T=[...dt(this.stylesheet.sprite),...g];this._validate(u.validateStyle.sprite,"sprite",T,null,c)||(this.stylesheet.sprite=T,this._loadSprite(g,!0,f))}removeSprite(t){this._checkLoaded();const a=dt(this.stylesheet.sprite);if(a.find(c=>c.id===t)){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex(c=>c.id===t),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}else this.fire(new u.ErrorEvent(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return dt(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(u.validateStyle.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}}qi.registerForPluginStateChange=u.registerForPluginStateChange;var io=u.createLayout([{name:"a_pos",type:"Int16",components:2}]),bn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Wo={prelude:at(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:at(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:at(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:at(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:at("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:at(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:at(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:at("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:at("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:at("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:at(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:at(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:at(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:at(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:at(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:at(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:at(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:at(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:at(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:at(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:at(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:at(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:at(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:at(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:at(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:at(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:at("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",bn),terrainDepth:at("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",bn),terrainCoords:at("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",bn)};function at(m,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/attribute ([\w]+) ([\w]+)/g),f=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=g?g.concat(f):f,S={};return{fragmentSource:m=m.replace(a,(C,M,A,R,V)=>(S[V]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${A} ${R} ${V};
#else
uniform ${A} ${R} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${A} ${R} ${V} = u_${V};
#endif
`)),vertexSource:t=t.replace(a,(C,M,A,R,V)=>{const K=R==="float"?"vec2":"vec4",X=V.match(/color/)?"color":K;return S[V]?M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${A} ${K} a_${V};
varying ${A} ${R} ${V};
#else
uniform ${A} ${R} u_${V};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${A} ${R} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${X}(a_${V}, u_${V}_t);
#else
    ${A} ${R} ${V} = u_${V};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${A} ${K} a_${V};
#else
uniform ${A} ${R} u_${V};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${A} ${R} ${V} = a_${V};
#else
    ${A} ${R} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${A} ${R} ${V} = unpack_mix_${X}(a_${V}, u_${V}_t);
#else
    ${A} ${R} ${V} = u_${V};
#endif
`}),staticAttributes:c,staticUniforms:T}}class yi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,f,g,T,S,C,M){this.context=t;let A=this.boundPaintVertexBuffers.length!==f.length;for(let R=0;!A&&R<f.length;R++)this.boundPaintVertexBuffers[R]!==f[R]&&(A=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||A||this.boundIndexBuffer!==g||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==M?this.freshBind(a,c,f,g,T,S,C,M):(t.bindVertexArray.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),C&&C.bind(),M&&M.bind())}freshBind(t,a,c,f,g,T,S,C){const M=t.numAttributes,A=this.context,R=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=C,a.enableAttributes(R,t);for(const V of c)V.enableAttributes(R,t);T&&T.enableAttributes(R,t),S&&S.enableAttributes(R,t),C&&C.enableAttributes(R,t),a.bind(),a.setVertexAttribPointers(R,t,g);for(const V of c)V.bind(),V.setVertexAttribPointers(R,t,g);T&&(T.bind(),T.setVertexAttribPointers(R,t,g)),f&&f.bind(),S&&(S.bind(),S.setVertexAttribPointers(R,t,g)),C&&(C.bind(),C.setVertexAttribPointers(R,t,g)),A.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ko(m){const t=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;const c=m[a].split(" ");t.push(c.pop())}return t}class vr{constructor(t,a,c,f,g,T){const S=t.gl;this.program=S.createProgram();const C=ko(a.staticAttributes),M=c?c.getBinderAttributes():[],A=C.concat(M),R=Wo.prelude.staticUniforms?ko(Wo.prelude.staticUniforms):[],V=a.staticUniforms?ko(a.staticUniforms):[],K=c?c.getBinderUniforms():[],X=R.concat(V).concat(K),Q=[];for(const Pe of X)Q.indexOf(Pe)<0&&Q.push(Pe);const W=c?c.defines():[];g&&W.push("#define OVERDRAW_INSPECTOR;"),T&&W.push("#define TERRAIN3D;");const he=W.concat(Wo.prelude.fragmentSource,a.fragmentSource).join(`
`),be=W.concat(Wo.prelude.vertexSource,a.vertexSource).join(`
`),ie=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ie,he),S.compileShader(ie),S.attachShader(this.program,ie);const fe=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(fe,be),S.compileShader(fe),S.attachShader(this.program,fe),this.attributes={};const Ee={};this.numAttributes=A.length;for(let Pe=0;Pe<this.numAttributes;Pe++)A[Pe]&&(S.bindAttribLocation(this.program,Pe,A[Pe]),this.attributes[A[Pe]]=Pe);S.linkProgram(this.program),S.deleteShader(fe),S.deleteShader(ie);for(let Pe=0;Pe<Q.length;Pe++){const Me=Q[Pe];if(Me&&!Ee[Me]){const Be=S.getUniformLocation(this.program,Me);Be&&(Ee[Me]=Be)}}this.fixedUniforms=f(t,Ee),this.terrainUniforms=((Pe,Me)=>({u_depth:new u.Uniform1i(Pe,Me.u_depth),u_terrain:new u.Uniform1i(Pe,Me.u_terrain),u_terrain_dim:new u.Uniform1f(Pe,Me.u_terrain_dim),u_terrain_matrix:new u.UniformMatrix4f(Pe,Me.u_terrain_matrix),u_terrain_unpack:new u.Uniform4f(Pe,Me.u_terrain_unpack),u_terrain_exaggeration:new u.Uniform1f(Pe,Me.u_terrain_exaggeration)}))(t,Ee),this.binderUniforms=c?c.getUniforms(t,Ee):[]}draw(t,a,c,f,g,T,S,C,M,A,R,V,K,X,Q,W,he,be){const ie=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(f),t.setColorMode(g),t.setCullFace(T),C){t.activeTexture.set(ie.TEXTURE2),ie.bindTexture(ie.TEXTURE_2D,C.depthTexture),t.activeTexture.set(ie.TEXTURE3),ie.bindTexture(ie.TEXTURE_2D,C.texture);for(const Ee in this.terrainUniforms)this.terrainUniforms[Ee].set(C[Ee])}for(const Ee in this.fixedUniforms)this.fixedUniforms[Ee].set(S[Ee]);Q&&Q.setUniforms(t,this.binderUniforms,K,{zoom:X});let fe=0;switch(a){case ie.LINES:fe=2;break;case ie.TRIANGLES:fe=3;break;case ie.LINE_STRIP:fe=1}for(const Ee of V.get()){const Pe=Ee.vaos||(Ee.vaos={});(Pe[M]||(Pe[M]=new yi)).bind(t,this,A,Q?Q.getPaintVertexBuffers():[],R,Ee.vertexOffset,W,he,be),ie.drawElements(a,Ee.primitiveLength*fe,ie.UNSIGNED_SHORT,Ee.primitiveOffset*fe*2)}}}function Tn(m,t,a){const c=1/ae(a,1,t.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,t.transform.tileZoom)/f,T=g*(a.tileID.canonical.x+a.tileID.wrap*f),S=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[T>>16,S>>16],u_pixel_coord_lower:[65535&T,65535&S]}}const ra=(m,t,a,c)=>{const f=t.style.light,g=f.properties.get("position"),T=[g.x,g.y,g.z],S=function(){var M=new u.ARRAY_TYPE(9);return u.ARRAY_TYPE!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();f.properties.get("anchor")==="viewport"&&function(M,A){var R=Math.sin(A),V=Math.cos(A);M[0]=V,M[1]=R,M[2]=0,M[3]=-R,M[4]=V,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(S,-t.transform.angle),function(M,A,R){var V=A[0],K=A[1],X=A[2];M[0]=V*R[0]+K*R[3]+X*R[6],M[1]=V*R[1]+K*R[4]+X*R[7],M[2]=V*R[2]+K*R[5]+X*R[8]}(T,T,S);const C=f.properties.get("color");return{u_matrix:m,u_lightpos:T,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+a,u_opacity:c}},Na=(m,t,a,c,f,g,T)=>u.extend(ra(m,t,a,c),Tn(g,t,T),{u_height_factor:-Math.pow(2,f.overscaledZ)/T.tileSize/8}),Mo=m=>({u_matrix:m}),Ti=(m,t,a,c)=>u.extend(Mo(m),Tn(a,t,c)),Ho=(m,t)=>({u_matrix:m,u_world:t}),Cs=(m,t,a,c,f)=>u.extend(Ti(m,t,a,c),{u_world:f}),oa=(m,t,a,c)=>{const f=m.transform;let g,T;if(c.paint.get("circle-pitch-alignment")==="map"){const S=ae(a,1,f.zoom);g=!0,T=[S,S]}else g=!1,T=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(t.posMatrix,a,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:T}},Ua=(m,t,a)=>{const c=ae(a,1,t.zoom),f=Math.pow(2,t.zoom-a.tileID.overscaledZ),g=a.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[t.pixelsToGLUnits[0]/(c*f),t.pixelsToGLUnits[1]/(c*f)],u_overscale_factor:g}},Is=(m,t,a=1)=>({u_matrix:m,u_color:t,u_overlay:0,u_overlay_scale:a}),ks=m=>({u_matrix:m}),Va=(m,t,a,c)=>({u_matrix:m,u_extrude_scale:ae(t,1,a),u_intensity:c});function sa(m,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new u.MercatorCoordinate(0,c/a).toLngLat().lat,new u.MercatorCoordinate(0,(c+1)/a).toLngLat().lat]}const Ms=(m,t,a,c)=>{const f=m.transform;return{u_matrix:la(m,t,a,c),u_ratio:1/ae(t,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Za=(m,t,a,c,f)=>u.extend(Ms(m,t,a,f),{u_image:0,u_image_height:c}),Vr=(m,t,a,c,f)=>{const g=m.transform,T=Sn(t,g);return{u_matrix:la(m,t,a,f),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ae(t,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[T,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},aa=(m,t,a,c,f,g)=>{const T=m.lineAtlas,S=Sn(t,m.transform),C=a.layout.get("line-cap")==="round",M=T.getDash(c.from,C),A=T.getDash(c.to,C),R=M.width*f.fromScale,V=A.width*f.toScale;return u.extend(Ms(m,t,a,g),{u_patternscale_a:[S/R,-M.height/2],u_patternscale_b:[S/V,-A.height/2],u_sdfgamma:T.width/(256*Math.min(R,V)*m.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:A.y,u_mix:f.t})};function Sn(m,t){return 1/ae(m,1,t.tileZoom)}function la(m,t,a,c){return m.translatePosMatrix(c?c.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Lt=(m,t,a,c,f)=>{return{u_matrix:m,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(T=f.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(g=f.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Ln(f.paint.get("raster-hue-rotate"))};var g,T};function Ln(m){m*=Math.PI/180;const t=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ni=(m,t,a,c,f,g,T,S,C,M)=>{const A=f.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:A.width/A.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+c,u_texsize:M,u_texture:0}},zs=(m,t,a,c,f,g,T,S,C,M,A)=>{const R=f.transform;return u.extend(ni(m,t,a,c,f,g,T,S,C,M),{u_gamma_scale:c?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+A})},Xo=(m,t,a,c,f,g,T,S,C,M)=>u.extend(zs(m,t,a,c,f,g,T,S,!0,C,!0),{u_texsize_icon:M,u_texture_icon:1}),no=(m,t,a)=>({u_matrix:m,u_opacity:t,u_color:a}),As=(m,t,a,c,f,g)=>u.extend(function(T,S,C,M){const A=C.imageManager.getPattern(T.from.toString()),R=C.imageManager.getPattern(T.to.toString()),{width:V,height:K}=C.imageManager.getPixelSize(),X=Math.pow(2,M.tileID.overscaledZ),Q=M.tileSize*Math.pow(2,C.transform.tileZoom)/X,W=Q*(M.tileID.canonical.x+M.tileID.wrap*X),he=Q*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[V,K],u_mix:S.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/ae(M,1,C.transform.tileZoom),u_pixel_coord_upper:[W>>16,he>>16],u_pixel_coord_lower:[65535&W,65535&he]}}(c,g,a,f),{u_matrix:m,u_opacity:t}),Gi={fillExtrusion:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_lightpos:new u.Uniform3f(m,t.u_lightpos),u_lightintensity:new u.Uniform1f(m,t.u_lightintensity),u_lightcolor:new u.Uniform3f(m,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(m,t.u_vertical_gradient),u_opacity:new u.Uniform1f(m,t.u_opacity)}),fillExtrusionPattern:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_lightpos:new u.Uniform3f(m,t.u_lightpos),u_lightintensity:new u.Uniform1f(m,t.u_lightintensity),u_lightcolor:new u.Uniform3f(m,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(m,t.u_vertical_gradient),u_height_factor:new u.Uniform1f(m,t.u_height_factor),u_image:new u.Uniform1i(m,t.u_image),u_texsize:new u.Uniform2f(m,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(m,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(m,t.u_scale),u_fade:new u.Uniform1f(m,t.u_fade),u_opacity:new u.Uniform1f(m,t.u_opacity)}),fill:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix)}),fillPattern:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_image:new u.Uniform1i(m,t.u_image),u_texsize:new u.Uniform2f(m,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(m,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(m,t.u_scale),u_fade:new u.Uniform1f(m,t.u_fade)}),fillOutline:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_world:new u.Uniform2f(m,t.u_world)}),fillOutlinePattern:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_world:new u.Uniform2f(m,t.u_world),u_image:new u.Uniform1i(m,t.u_image),u_texsize:new u.Uniform2f(m,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(m,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(m,t.u_scale),u_fade:new u.Uniform1f(m,t.u_fade)}),circle:(m,t)=>({u_camera_to_center_distance:new u.Uniform1f(m,t.u_camera_to_center_distance),u_scale_with_map:new u.Uniform1i(m,t.u_scale_with_map),u_pitch_with_map:new u.Uniform1i(m,t.u_pitch_with_map),u_extrude_scale:new u.Uniform2f(m,t.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(m,t.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(m,t.u_matrix)}),collisionBox:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_camera_to_center_distance:new u.Uniform1f(m,t.u_camera_to_center_distance),u_pixels_to_tile_units:new u.Uniform1f(m,t.u_pixels_to_tile_units),u_extrude_scale:new u.Uniform2f(m,t.u_extrude_scale),u_overscale_factor:new u.Uniform1f(m,t.u_overscale_factor)}),collisionCircle:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_inv_matrix:new u.UniformMatrix4f(m,t.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(m,t.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new u.UniformColor(m,t.u_color),u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_overlay:new u.Uniform1i(m,t.u_overlay),u_overlay_scale:new u.Uniform1f(m,t.u_overlay_scale)}),clippingMask:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix)}),heatmap:(m,t)=>({u_extrude_scale:new u.Uniform1f(m,t.u_extrude_scale),u_intensity:new u.Uniform1f(m,t.u_intensity),u_matrix:new u.UniformMatrix4f(m,t.u_matrix)}),heatmapTexture:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_world:new u.Uniform2f(m,t.u_world),u_image:new u.Uniform1i(m,t.u_image),u_color_ramp:new u.Uniform1i(m,t.u_color_ramp),u_opacity:new u.Uniform1f(m,t.u_opacity)}),hillshade:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_image:new u.Uniform1i(m,t.u_image),u_latrange:new u.Uniform2f(m,t.u_latrange),u_light:new u.Uniform2f(m,t.u_light),u_shadow:new u.UniformColor(m,t.u_shadow),u_highlight:new u.UniformColor(m,t.u_highlight),u_accent:new u.UniformColor(m,t.u_accent)}),hillshadePrepare:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_image:new u.Uniform1i(m,t.u_image),u_dimension:new u.Uniform2f(m,t.u_dimension),u_zoom:new u.Uniform1f(m,t.u_zoom),u_unpack:new u.Uniform4f(m,t.u_unpack)}),line:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_ratio:new u.Uniform1f(m,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(m,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_ratio:new u.Uniform1f(m,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(m,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(m,t.u_units_to_pixels),u_image:new u.Uniform1i(m,t.u_image),u_image_height:new u.Uniform1f(m,t.u_image_height)}),linePattern:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_texsize:new u.Uniform2f(m,t.u_texsize),u_ratio:new u.Uniform1f(m,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(m,t.u_device_pixel_ratio),u_image:new u.Uniform1i(m,t.u_image),u_units_to_pixels:new u.Uniform2f(m,t.u_units_to_pixels),u_scale:new u.Uniform3f(m,t.u_scale),u_fade:new u.Uniform1f(m,t.u_fade)}),lineSDF:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_ratio:new u.Uniform1f(m,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(m,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(m,t.u_units_to_pixels),u_patternscale_a:new u.Uniform2f(m,t.u_patternscale_a),u_patternscale_b:new u.Uniform2f(m,t.u_patternscale_b),u_sdfgamma:new u.Uniform1f(m,t.u_sdfgamma),u_image:new u.Uniform1i(m,t.u_image),u_tex_y_a:new u.Uniform1f(m,t.u_tex_y_a),u_tex_y_b:new u.Uniform1f(m,t.u_tex_y_b),u_mix:new u.Uniform1f(m,t.u_mix)}),raster:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_tl_parent:new u.Uniform2f(m,t.u_tl_parent),u_scale_parent:new u.Uniform1f(m,t.u_scale_parent),u_buffer_scale:new u.Uniform1f(m,t.u_buffer_scale),u_fade_t:new u.Uniform1f(m,t.u_fade_t),u_opacity:new u.Uniform1f(m,t.u_opacity),u_image0:new u.Uniform1i(m,t.u_image0),u_image1:new u.Uniform1i(m,t.u_image1),u_brightness_low:new u.Uniform1f(m,t.u_brightness_low),u_brightness_high:new u.Uniform1f(m,t.u_brightness_high),u_saturation_factor:new u.Uniform1f(m,t.u_saturation_factor),u_contrast_factor:new u.Uniform1f(m,t.u_contrast_factor),u_spin_weights:new u.Uniform3f(m,t.u_spin_weights)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new u.Uniform1i(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(m,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(m,t.u_size_t),u_size:new u.Uniform1f(m,t.u_size),u_camera_to_center_distance:new u.Uniform1f(m,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(m,t.u_pitch),u_rotate_symbol:new u.Uniform1i(m,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(m,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(m,t.u_fade_change),u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(m,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(m,t.u_coord_matrix),u_is_text:new u.Uniform1i(m,t.u_is_text),u_pitch_with_map:new u.Uniform1i(m,t.u_pitch_with_map),u_texsize:new u.Uniform2f(m,t.u_texsize),u_texture:new u.Uniform1i(m,t.u_texture)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new u.Uniform1i(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(m,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(m,t.u_size_t),u_size:new u.Uniform1f(m,t.u_size),u_camera_to_center_distance:new u.Uniform1f(m,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(m,t.u_pitch),u_rotate_symbol:new u.Uniform1i(m,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(m,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(m,t.u_fade_change),u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(m,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(m,t.u_coord_matrix),u_is_text:new u.Uniform1i(m,t.u_is_text),u_pitch_with_map:new u.Uniform1i(m,t.u_pitch_with_map),u_texsize:new u.Uniform2f(m,t.u_texsize),u_texture:new u.Uniform1i(m,t.u_texture),u_gamma_scale:new u.Uniform1f(m,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(m,t.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(m,t.u_is_halo)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new u.Uniform1i(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(m,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(m,t.u_size_t),u_size:new u.Uniform1f(m,t.u_size),u_camera_to_center_distance:new u.Uniform1f(m,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(m,t.u_pitch),u_rotate_symbol:new u.Uniform1i(m,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(m,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(m,t.u_fade_change),u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(m,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(m,t.u_coord_matrix),u_is_text:new u.Uniform1i(m,t.u_is_text),u_pitch_with_map:new u.Uniform1i(m,t.u_pitch_with_map),u_texsize:new u.Uniform2f(m,t.u_texsize),u_texsize_icon:new u.Uniform2f(m,t.u_texsize_icon),u_texture:new u.Uniform1i(m,t.u_texture),u_texture_icon:new u.Uniform1i(m,t.u_texture_icon),u_gamma_scale:new u.Uniform1f(m,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(m,t.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(m,t.u_is_halo)}),background:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_opacity:new u.Uniform1f(m,t.u_opacity),u_color:new u.UniformColor(m,t.u_color)}),backgroundPattern:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_opacity:new u.Uniform1f(m,t.u_opacity),u_image:new u.Uniform1i(m,t.u_image),u_pattern_tl_a:new u.Uniform2f(m,t.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(m,t.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(m,t.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(m,t.u_pattern_br_b),u_texsize:new u.Uniform2f(m,t.u_texsize),u_mix:new u.Uniform1f(m,t.u_mix),u_pattern_size_a:new u.Uniform2f(m,t.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(m,t.u_pattern_size_b),u_scale_a:new u.Uniform1f(m,t.u_scale_a),u_scale_b:new u.Uniform1f(m,t.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_texture:new u.Uniform1i(m,t.u_texture),u_ele_delta:new u.Uniform1f(m,t.u_ele_delta)}),terrainDepth:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_ele_delta:new u.Uniform1f(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_matrix:new u.UniformMatrix4f(m,t.u_matrix),u_texture:new u.Uniform1i(m,t.u_texture),u_terrain_coords_id:new u.Uniform1f(m,t.u_terrain_coords_id),u_ele_delta:new u.Uniform1f(m,t.u_ele_delta)})};class En{constructor(t,a,c){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ko={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ni{constructor(t,a,c,f){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const f=a.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,a,c){for(let f=0;f<this.attributes.length;f++){const g=this.attributes[f],T=a.attributes[g.name];T!==void 0&&t.vertexAttribPointer(T,g.components,t[Ko[g.type]],!1,this.itemSize,g.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const rr=new WeakMap;function Yo(m){if(rr.has(m))return rr.get(m);{const t=m.getParameter(m.VERSION).startsWith("WebGL 2.0");return rr.set(m,t),t}}class Wt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $a extends Wt{getDefault(){return u.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ja extends Wt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ua extends Wt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qa extends Wt{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vl extends Wt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ht extends Wt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ls extends Wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class xr extends Wt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ca extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class yu extends Wt{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class _c extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Zl extends Wt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class gc extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Ga extends Wt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Wa extends Wt{getDefault(){return u.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class $l extends Wt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ha extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Ds extends Wt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class wr extends Wt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class vu extends Wt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ha extends Wt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Dn extends Wt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class jl extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Jo extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zo extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class xu extends Wt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xa extends Wt{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Kt extends Wt{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Yo(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ka extends Wt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class yc extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ya extends Wt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Qo extends Wt{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class wu extends Qo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class bu extends Qo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class da extends Qo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class es{constructor(t,a,c,f,g){this.context=t,this.width=a,this.height=c;const T=t.gl,S=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new wu(t,S),f)this.depthAttachment=g?new da(t,S):new bu(t,S);else if(g)throw new Error("Stencil cannot be setted without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Si{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}Si.Replace=[1,0],Si.disabled=new Si(Si.Replace,u.Color.transparent,[!1,!1,!1,!1]),Si.unblended=new Si(Si.Replace,u.Color.transparent,[!0,!0,!0,!0]),Si.alphaBlended=new Si([1,771],u.Color.transparent,[!0,!0,!0,!0]);class Ao{constructor(t){var a,c;if(this.gl=t,this.clearColor=new $a(this),this.clearDepth=new ja(this),this.clearStencil=new ua(this),this.colorMask=new qa(this),this.depthMask=new Vl(this),this.stencilMask=new Ht(this),this.stencilFunc=new Ls(this),this.stencilOp=new xr(this),this.stencilTest=new ca(this),this.depthRange=new yu(this),this.depthTest=new _c(this),this.depthFunc=new Zl(this),this.blend=new gc(this),this.blendFunc=new Ga(this),this.blendColor=new Wa(this),this.blendEquation=new $l(this),this.cullFace=new ha(this),this.cullFaceSide=new Ds(this),this.frontFace=new wr(this),this.program=new vu(this),this.activeTexture=new Ha(this),this.viewport=new Dn(this),this.bindFramebuffer=new jl(this),this.bindRenderbuffer=new Jo(this),this.bindTexture=new zo(this),this.bindVertexBuffer=new xu(this),this.bindElementBuffer=new Xa(this),this.bindVertexArray=new Kt(this),this.pixelStoreUnpack=new Ka(this),this.pixelStoreUnpackPremultiplyAlpha=new yc(this),this.pixelStoreUnpackFlipY=new Ya(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Yo(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:f==null?void 0:f.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f==null?void 0:f.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new En(this,t,a)}createVertexBuffer(t,a,c){return new Ni(this,t,a,c)}createRenderbuffer(t,a,c){const f=this.gl,g=f.createRenderbuffer();return this.bindRenderbuffer.set(g),f.renderbufferStorage(f.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),g}createFramebuffer(t,a,c,f){return new es(this,t,a,c,f)}clear({color:t,depth:a,stencil:c}){const f=this.gl;let g=0;t&&(g|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(g|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){u.deepEqual(t.blendFunction,Si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Yo(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Yo(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Et{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);const Rs=7680;class ui{constructor(t,a,c,f,g,T){this.test=t,this.ref=a,this.mask=c,this.fail=f,this.depthFail=g,this.pass=T}}ui.disabled=new ui({func:519,mask:0},0,0,Rs,Rs,Rs);class pi{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}let ro;function ts(m,t,a,c,f,g,T){const S=m.context,C=S.gl,M=m.useProgram("collisionBox"),A=[];let R=0,V=0;for(let ie=0;ie<c.length;ie++){const fe=c[ie],Ee=t.getTile(fe),Pe=Ee.getBucket(a);if(!Pe)continue;let Me=fe.posMatrix;f[0]===0&&f[1]===0||(Me=m.translatePosMatrix(fe.posMatrix,Ee,f,g));const Be=T?Pe.textCollisionBox:Pe.iconCollisionBox,De=Pe.collisionCircleArray;if(De.length>0){const Ve=u.create(),lt=Me;u.mul(Ve,Pe.placementInvProjMatrix,m.transform.glCoordMatrix),u.mul(Ve,Ve,Pe.placementViewportMatrix),A.push({circleArray:De,circleOffset:V,transform:lt,invTransform:Ve,coord:fe}),R+=De.length/4,V=R}Be&&M.draw(S,C.LINES,Et.disabled,ui.disabled,m.colorModeForRenderPass(),pi.disabled,Ua(Me,m.transform,Ee),m.style.map.terrain&&m.style.map.terrain.getTerrainData(fe),a.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,m.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!T||!A.length)return;const K=m.useProgram("collisionCircle"),X=new u.CollisionCircleLayoutArray;X.resize(4*R),X._trim();let Q=0;for(const ie of A)for(let fe=0;fe<ie.circleArray.length/4;fe++){const Ee=4*fe,Pe=ie.circleArray[Ee+0],Me=ie.circleArray[Ee+1],Be=ie.circleArray[Ee+2],De=ie.circleArray[Ee+3];X.emplace(Q++,Pe,Me,Be,De,0),X.emplace(Q++,Pe,Me,Be,De,1),X.emplace(Q++,Pe,Me,Be,De,2),X.emplace(Q++,Pe,Me,Be,De,3)}(!ro||ro.length<2*R)&&(ro=function(ie){const fe=2*ie,Ee=new u.QuadTriangleArray;Ee.resize(fe),Ee._trim();for(let Pe=0;Pe<fe;Pe++){const Me=6*Pe;Ee.uint16[Me+0]=4*Pe+0,Ee.uint16[Me+1]=4*Pe+1,Ee.uint16[Me+2]=4*Pe+2,Ee.uint16[Me+3]=4*Pe+2,Ee.uint16[Me+4]=4*Pe+3,Ee.uint16[Me+5]=4*Pe+0}return Ee}(R));const W=S.createIndexBuffer(ro,!0),he=S.createVertexBuffer(X,u.collisionCircleLayout.members,!0);for(const ie of A){const fe={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(be=m.transform).cameraToCenterDistance,u_viewport_size:[be.width,be.height]};K.draw(S,C.TRIANGLES,Et.disabled,ui.disabled,m.colorModeForRenderPass(),pi.disabled,fe,m.style.map.terrain&&m.style.map.terrain.getTerrainData(ie.coord),a.id,he,W,u.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,m.transform.zoom,null,null,null)}var be;he.destroy(),W.destroy()}pi.disabled=new pi(!1,1029,2305),pi.backCCW=new pi(!0,1029,2305);const ql=u.identity(new Float32Array(16));function vc(m,t,a,c,f,g){const{horizontalAlign:T,verticalAlign:S}=u.getAnchorAlignment(m);return new u.Point((-(T-.5)*t/f+c[0])*g,(-(S-.5)*a/f+c[1])*g)}function Ja(m,t,a,c,f,g,T,S,C,M,A){const R=m.text.placedSymbolArray,V=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,X={};V.clear();for(let Q=0;Q<R.length;Q++){const W=R.get(Q),he=W.hidden||!W.crossTileID||m.allowVerticalPlacement&&!W.placedOrientation?null:c[W.crossTileID];if(he){const be=new u.Point(W.anchorX,W.anchorY),ie=yt(be,a?T:g,A),fe=Nr(f.cameraToCenterDistance,ie.signedDistanceFromCamera);let Ee=u.evaluateSizeForFeature(m.textSizeData,C,W)*fe/u.ONE_EM;a&&(Ee*=m.tilePixelRatio/S);const{width:Pe,height:Me,anchor:Be,textOffset:De,textBoxScale:Ve}=he,lt=vc(Be,Pe,Me,De,Ve,Ee),$t=a?yt(be.add(lt),g,A).point:ie.point.add(t?lt.rotate(-f.angle):lt),Xe=m.allowVerticalPlacement&&W.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let wt=0;wt<W.numGlyphs;wt++)u.addDynamicAttributes(V,$t,Xe);M&&W.associatedIconIndex>=0&&(X[W.associatedIconIndex]={shiftedAnchor:$t,angle:Xe})}else G(W.numGlyphs,V)}if(M){K.clear();const Q=m.icon.placedSymbolArray;for(let W=0;W<Q.length;W++){const he=Q.get(W);if(he.hidden)G(he.numGlyphs,K);else{const be=X[W];if(be)for(let ie=0;ie<he.numGlyphs;ie++)u.addDynamicAttributes(K,be.shiftedAnchor,be.angle);else G(he.numGlyphs,K)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(V)}function xc(m,t,a){return a.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function jn(m,t,a,c,f,g,T,S,C,M,A,R){const V=m.context,K=V.gl,X=m.transform,Q=S==="map",W=C==="map",he=S!=="viewport"&&a.layout.get("symbol-placement")!=="point",be=Q&&!W&&!he,ie=!a.layout.get("symbol-sort-key").isConstant();let fe=!1;const Ee=m.depthModeForSublayer(0,Et.ReadOnly),Pe=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Me=[];for(const Be of c){const De=t.getTile(Be),Ve=De.getBucket(a);if(!Ve)continue;const lt=f?Ve.text:Ve.icon;if(!lt||!lt.segments.get().length||!lt.hasVisibleVertices)continue;const $t=lt.programConfigurations.get(a.id),Xe=f||Ve.sdfIcons,wt=f?Ve.textSizeData:Ve.iconSizeData,st=W||X.pitch!==0,mi=m.useProgram(xc(Xe,f,Ve),$t),Vt=u.evaluateSizeForZoom(wt,X.zoom),Dt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Be);let bt,Ui,li,Hn,fn=[0,0],Xi=null;if(f)Ui=De.glyphAtlasTexture,li=K.LINEAR,bt=De.glyphAtlasTexture.size,Ve.iconsInText&&(fn=De.imageAtlasTexture.size,Xi=De.imageAtlasTexture,Hn=st||m.options.rotating||m.options.zooming||wt.kind==="composite"||wt.kind==="camera"?K.LINEAR:K.NEAREST);else{const tn=a.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;Ui=De.imageAtlasTexture,li=Xe||m.options.rotating||m.options.zooming||tn||st?K.LINEAR:K.NEAREST,bt=De.imageAtlasTexture.size}const sr=ae(De,1,m.transform.zoom),fo=ln(Be.posMatrix,W,Q,m.transform,sr),us=gr(Be.posMatrix,W,Q,m.transform,sr),cs=Pe&&Ve.hasTextData(),js=a.layout.get("icon-text-fit")!=="none"&&cs&&Ve.hasIconData();if(he){const tn=m.style.map.terrain?(ar,Ai)=>m.style.map.terrain.getElevation(Be,ar,Ai):null,gn=a.layout.get("text-rotation-alignment")==="map";Co(Ve,Be.posMatrix,m,f,fo,us,W,M,gn,tn)}const ba=m.translatePosMatrix(Be.posMatrix,De,g,T),qs=he||f&&Pe||js?ql:fo,mn=m.translatePosMatrix(us,De,g,T,!0),Vi=Xe&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let _n;_n=Xe?Ve.iconsInText?Xo(wt.kind,Vt,be,W,m,ba,qs,mn,bt,fn):zs(wt.kind,Vt,be,W,m,ba,qs,mn,f,bt,!0):ni(wt.kind,Vt,be,W,m,ba,qs,mn,f,bt);const dl={program:mi,buffers:lt,uniformValues:_n,atlasTexture:Ui,atlasTextureIcon:Xi,atlasInterpolation:li,atlasInterpolationIcon:Hn,isSDF:Xe,hasHalo:Vi};if(ie&&Ve.canOverlap){fe=!0;const tn=lt.segments.get();for(const gn of tn)Me.push({segments:new u.SegmentVector([gn]),sortKey:gn.sortKey,state:dl,terrainData:Dt})}else Me.push({segments:lt.segments,sortKey:0,state:dl,terrainData:Dt})}fe&&Me.sort((Be,De)=>Be.sortKey-De.sortKey);for(const Be of Me){const De=Be.state;if(V.activeTexture.set(K.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,K.CLAMP_TO_EDGE),De.atlasTextureIcon&&(V.activeTexture.set(K.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),De.isSDF){const Ve=De.uniformValues;De.hasHalo&&(Ve.u_is_halo=1,Zr(De.buffers,Be.segments,a,m,De.program,Ee,A,R,Ve,Be.terrainData)),Ve.u_is_halo=0}Zr(De.buffers,Be.segments,a,m,De.program,Ee,A,R,De.uniformValues,Be.terrainData)}}function Zr(m,t,a,c,f,g,T,S,C,M){const A=c.context;f.draw(A,A.gl.TRIANGLES,g,T,S,pi.disabled,C,M,a.id,m.layoutVertexBuffer,m.indexBuffer,t,a.paint,c.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Qa(m,t,a,c,f){if(!a||!c||!c.imageAtlas)return;const g=c.imageAtlas.patternPositions;let T=g[a.to.toString()],S=g[a.from.toString()];if(!T||!S){const C=f.getPaintProperty(t);T=g[C],S=g[C]}T&&S&&m.setConstantPatternPositions(T,S)}function br(m,t,a,c,f,g,T){const S=m.context.gl,C="fill-pattern",M=a.paint.get(C),A=M&&M.constantOr(1),R=a.getCrossfadeParameters();let V,K,X,Q,W;T?(K=A&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=S.LINES):(K=A?"fillPattern":"fill",V=S.TRIANGLES);const he=M.constantOr(null);for(const be of c){const ie=t.getTile(be);if(A&&!ie.patternsLoaded())continue;const fe=ie.getBucket(a);if(!fe)continue;const Ee=fe.programConfigurations.get(a.id),Pe=m.useProgram(K,Ee),Me=m.style.map.terrain&&m.style.map.terrain.getTerrainData(be);A&&(m.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Ee.updatePaintBuffers(R)),Qa(Ee,C,he,ie,a);const Be=Me?be:null,De=m.translatePosMatrix(Be?Be.posMatrix:be.posMatrix,ie,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(T){Q=fe.indexBuffer2,W=fe.segments2;const Ve=[S.drawingBufferWidth,S.drawingBufferHeight];X=K==="fillOutlinePattern"&&A?Cs(De,m,R,ie,Ve):Ho(De,Ve)}else Q=fe.indexBuffer,W=fe.segments,X=A?Ti(De,m,R,ie):Mo(De);Pe.draw(m.context,V,f,m.stencilModeForClipping(be),g,pi.disabled,X,Me,a.id,fe.layoutVertexBuffer,Q,W,a.paint,m.transform.zoom,Ee)}}function el(m,t,a,c,f,g,T){const S=m.context,C=S.gl,M="fill-extrusion-pattern",A=a.paint.get(M),R=A.constantOr(1),V=a.getCrossfadeParameters(),K=a.paint.get("fill-extrusion-opacity"),X=A.constantOr(null);for(const Q of c){const W=t.getTile(Q),he=W.getBucket(a);if(!he)continue;const be=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),ie=he.programConfigurations.get(a.id),fe=m.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ie);R&&(m.context.activeTexture.set(C.TEXTURE0),W.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ie.updatePaintBuffers(V)),Qa(ie,M,X,W,a);const Ee=m.translatePosMatrix(Q.posMatrix,W,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Pe=a.paint.get("fill-extrusion-vertical-gradient"),Me=R?Na(Ee,m,Pe,K,Q,V,W):ra(Ee,m,Pe,K);fe.draw(S,S.gl.TRIANGLES,f,g,T,pi.backCCW,Me,be,a.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,a.paint,m.transform.zoom,ie,m.style.map.terrain&&he.centroidVertexBuffer)}}function oo(m,t,a,c,f,g,T){const S=m.context,C=S.gl,M=a.fbo;if(!M)return;const A=m.useProgram("hillshade"),R=m.style.map.terrain&&m.style.map.terrain.getTerrainData(t);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),A.draw(S,C.TRIANGLES,f,g,T,pi.disabled,((V,K,X,Q)=>{const W=X.paint.get("hillshade-shadow-color"),he=X.paint.get("hillshade-highlight-color"),be=X.paint.get("hillshade-accent-color");let ie=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(ie-=V.transform.angle);const fe=!V.options.moving;return{u_matrix:Q?Q.posMatrix:V.transform.calculatePosMatrix(K.tileID.toUnwrapped(),fe),u_image:0,u_latrange:sa(0,K.tileID),u_light:[X.paint.get("hillshade-exaggeration"),ie],u_shadow:W,u_highlight:he,u_accent:be}})(m,a,c,R?t:null),R,c.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function Gl(m,t,a,c,f,g){const T=m.context,S=T.gl,C=t.dem;if(C&&C.data){const M=C.dim,A=C.stride,R=C.getPixels();if(T.activeTexture.set(S.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||m.getTileTexture(A),t.demTexture){const K=t.demTexture;K.update(R,{premultiply:!1}),K.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else t.demTexture=new ct(T,R,S.RGBA,{premultiply:!1}),t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);T.activeTexture.set(S.TEXTURE0);let V=t.fbo;if(!V){const K=new ct(T,{width:M,height:M,data:null},S.RGBA);K.bind(S.LINEAR,S.CLAMP_TO_EDGE),V=t.fbo=T.createFramebuffer(M,M,!0,!1),V.colorAttachment.set(K.texture)}T.bindFramebuffer.set(V.framebuffer),T.viewport.set([0,0,M,M]),m.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,c,f,g,pi.disabled,((K,X)=>{const Q=X.stride,W=u.create();return u.ortho(W,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(W,W,[0,-u.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[Q,Q],u_zoom:K.overscaledZ,u_unpack:X.getUnpackVector()}})(t.tileID,C),null,a.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function pa(m,t,a,c,f,g){const T=c.paint.get("raster-fade-duration");if(!g&&T>0){const S=u.browser.now(),C=(S-m.timeAdded)/T,M=t?(S-t.timeAdded)/T:-1,A=a.getSource(),R=f.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-R)>Math.abs(m.tileID.overscaledZ-R),K=V&&m.refreshedUponExpiration?1:u.clamp(V?C:1-M,0,1);return m.refreshedUponExpiration&&C>=1&&(m.refreshedUponExpiration=!1),t?{opacity:1,mix:1-K}:{opacity:K,mix:0}}return{opacity:1,mix:0}}const Wl=new u.Color(1,0,0,1),vi=new u.Color(0,1,0,1),is=new u.Color(0,0,1,1),Wi=new u.Color(1,0,1,1),Bs=new u.Color(0,1,1,1);function tl(m,t,a,c){so(m,0,t+a/2,m.transform.width,a,c)}function fa(m,t,a,c){so(m,t-a/2,0,a,m.transform.height,c)}function so(m,t,a,c,f,g){const T=m.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*m.pixelRatio,a*m.pixelRatio,c*m.pixelRatio,f*m.pixelRatio),T.clear({color:g}),S.disable(S.SCISSOR_TEST)}function qn(m,t,a){const c=m.context,f=c.gl,g=a.posMatrix,T=m.useProgram("debug"),S=Et.disabled,C=ui.disabled,M=m.colorModeForRenderPass(),A="$debug",R=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);c.activeTexture.set(f.TEXTURE0);const V=t.getTileByID(a.key).latestRawTileData,K=Math.floor((V&&V.byteLength||0)/1024),X=t.getTile(a).tileSize,Q=512/Math.min(X,512)*(a.overscaledZ/m.transform.zoom)*.5;let W=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(W+=` => ${a.overscaledZ}`),function(he,be){he.initDebugOverlayCanvas();const ie=he.debugOverlayCanvas,fe=he.context.gl,Ee=he.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,ie.width,ie.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(be,5,5),Ee.strokeText(be,5,5),he.debugOverlayTexture.update(ie),he.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(m,`${W} ${K}kB`),T.draw(c,f.TRIANGLES,S,C,Si.alphaBlended,pi.disabled,Is(g,u.Color.transparent,Q),null,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),T.draw(c,f.LINE_STRIP,S,C,M,pi.disabled,Is(g,u.Color.red),R,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function il(m,t,a){const c=m.context,f=c.gl,g=m.colorModeForRenderPass(),T=new Et(f.LEQUAL,Et.ReadWrite,m.depthRangeFor3D),S=m.useProgram("terrain"),C=t.getTerrainMesh();c.bindFramebuffer.set(null),c.viewport.set([0,0,m.width,m.height]);for(const M of a){const A=m.renderToTexture.getTexture(M),R=t.getTerrainData(M.tileID);c.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,A.texture);const V={u_matrix:m.transform.calculatePosMatrix(M.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(m.transform.zoom)};S.draw(c,f.TRIANGLES,T,ui.disabled,g,pi.backCCW,V,R,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}}class ns{constructor(t,a){this.context=new Ao(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.create(),renderTime:0},this.setup(),this.numSublayers=gi.maxUnderzooming+gi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ci}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,a=new u.PosArray;a.emplaceBack(0,0),a.emplaceBack(u.EXTENT,0),a.emplaceBack(0,u.EXTENT),a.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(a,io.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const c=new u.PosArray;c.emplaceBack(0,0),c.emplaceBack(u.EXTENT,0),c.emplaceBack(0,u.EXTENT),c.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=t.createVertexBuffer(c,io.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const f=new u.RasterBoundsArray;f.emplaceBack(0,0,0,0),f.emplaceBack(u.EXTENT,0,u.EXTENT,0),f.emplaceBack(0,u.EXTENT,0,u.EXTENT),f.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(f,Mn.members),this.rasterBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const g=new u.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,io.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const T=new u.LineStripIndexArray;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(T);const S=new u.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const C=this.context.gl;this.stencilClearMode=new ui({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=u.create();u.ortho(c,0,this.width,this.height,0,0,1),u.scale(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,Et.disabled,this.stencilClearMode,Si.disabled,pi.disabled,ks(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const c=this.context,f=c.gl;this.nextStencilID+a.length>256&&this.clearStencil(),c.setColorMode(Si.disabled),c.setDepthMode(Et.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of a){const S=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);g.draw(c,f.TRIANGLES,Et.disabled,new ui({func:f.ALWAYS,mask:0},S,255,f.KEEP,f.KEEP,f.REPLACE),Si.disabled,pi.disabled,ks(T.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new ui({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new ui({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,c=t.sort((T,S)=>S.overscaledZ-T.overscaledZ),f=c[c.length-1].overscaledZ,g=c[0].overscaledZ-f+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const T={};for(let S=0;S<g;S++)T[S+f]=new ui({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[T,c]}return[{[f]:ui.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Si([t.CONSTANT_COLOR,t.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Si.unblended:Si.alphaBlended}depthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return Et.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Et(c||this.context.gl.LEQUAL,a,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(u.browser.now()),this.imageManager.beginFrame();const c=this.style._order,f=this.style.sourceCaches,g={},T={},S={};for(const C in f){const M=f[C];M.used&&M.prepare(this.context),g[C]=M.getVisibleCoordinates(),T[C]=g[C].slice().reverse(),S[C]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<c.length;C++)if(this.style._layers[c[C]].is3D()){this.opaquePassCutoff=C;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const C=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!u.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||C.length)&&(u.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(M,A){const R=M.context,V=R.gl,K=Si.unblended,X=new Et(V.LEQUAL,Et.ReadWrite,[0,1]),Q=A.getTerrainMesh(),W=A.sourceCache.getRenderableTiles(),he=M.useProgram("terrainDepth");R.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,M.width/devicePixelRatio,M.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1});for(const be of W){const ie=A.getTerrainData(be.tileID),fe={u_matrix:M.transform.calculatePosMatrix(be.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(M.transform.zoom)};he.draw(R,V.TRIANGLES,X,ui.disabled,K,pi.backCCW,fe,ie,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,M.width,M.height])}(this,this.style.map.terrain),function(M,A){const R=M.context,V=R.gl,K=Si.unblended,X=new Et(V.LEQUAL,Et.ReadWrite,[0,1]),Q=A.getTerrainMesh(),W=A.getCoordsTexture(),he=A.sourceCache.getRenderableTiles(),be=M.useProgram("terrainCoords");R.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,M.width/devicePixelRatio,M.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1}),A.coordsIndex=[];for(const ie of he){const fe=A.getTerrainData(ie.tileID);R.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,W.texture);const Ee={u_matrix:M.transform.calculatePosMatrix(ie.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(M.transform.zoom)};be.draw(R,V.TRIANGLES,X,ui.disabled,K,pi.backCCW,Ee,fe,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),A.coordsIndex.push(ie.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,M.width,M.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const C of c){const M=this.style._layers[C];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const A=T[M.source];(M.type==="custom"||A.length)&&this.renderLayer(this,f[M.source],M,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[c[this.currentLayer]],M=f[C.source],A=g[C.source];this._renderTileClippingMasks(C,A),this.renderLayer(this,M,C,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const C=this.style._layers[c[this.currentLayer]],M=f[C.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(C))continue;const A=(C.type==="symbol"?S:T)[C.source];this._renderTileClippingMasks(C,g[C.source]),this.renderLayer(this,M,C,A)}if(this.options.showTileBoundaries){const C=function(M,A){let R=null;const V=Object.values(M._layers).flatMap(W=>W.source&&!W.isHidden(A)?[M.sourceCaches[W.source]]:[]),K=V.filter(W=>W.getSource().type==="vector"),X=V.filter(W=>W.getSource().type!=="vector"),Q=W=>{(!R||R.getSource().maxzoom<W.getSource().maxzoom)&&(R=W)};return K.forEach(W=>Q(W)),R||X.forEach(W=>Q(W)),R}(this.style,this.transform.zoom);C&&function(M,A,R){for(let V=0;V<R.length;V++)qn(M,A,R[V])}(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const M=C.transform.padding;tl(C,C.transform.height-(M.top||0),3,Wl),tl(C,M.bottom||0,3,vi),fa(C,M.left||0,3,is),fa(C,C.transform.width-(M.right||0),3,Wi);const A=C.transform.centerPoint;(function(R,V,K,X){so(R,V-1,K-10,2,20,X),so(R,V-10,K-1,20,2,X)})(C,A.x,C.transform.height-A.y,Bs)}(this),this.context.setDefault()}renderLayer(t,a,c,f){if(!c.isHidden(this.transform.zoom)&&(c.type==="background"||c.type==="custom"||(f||[]).length))switch(this.id=c.id,c.type){case"symbol":(function(g,T,S,C,M){if(g.renderPass!=="translucent")return;const A=ui.disabled,R=g.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(V,K,X,Q,W,he,be){const ie=K.transform,fe=W==="map",Ee=he==="map";for(const Pe of V){const Me=Q.getTile(Pe),Be=Me.getBucket(X);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const De=u.evaluateSizeForZoom(Be.textSizeData,ie.zoom),Ve=ae(Me,1,K.transform.zoom),lt=ln(Pe.posMatrix,Ee,fe,K.transform,Ve),$t=X.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(De){const Xe=Math.pow(2,ie.zoom-Me.tileID.overscaledZ);Ja(Be,fe,Ee,be,ie,lt,Pe.posMatrix,Xe,De,$t,K.style.map.terrain?(wt,st)=>K.style.map.terrain.getElevation(Pe,wt,st):null)}}}(C,g,S,T,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),M),S.paint.get("icon-opacity").constantOr(1)!==0&&jn(g,T,S,C,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),A,R),S.paint.get("text-opacity").constantOr(1)!==0&&jn(g,T,S,C,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),A,R),T.map.showCollisionBoxes&&(ts(g,T,S,C,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),ts(g,T,S,C,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))})(t,a,c,f,this.style.placement.variableOffsets);break;case"circle":(function(g,T,S,C){if(g.renderPass!=="translucent")return;const M=S.paint.get("circle-opacity"),A=S.paint.get("circle-stroke-width"),R=S.paint.get("circle-stroke-opacity"),V=!S.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(A.constantOr(1)===0||R.constantOr(1)===0))return;const K=g.context,X=K.gl,Q=g.depthModeForSublayer(0,Et.ReadOnly),W=ui.disabled,he=g.colorModeForRenderPass(),be=[];for(let ie=0;ie<C.length;ie++){const fe=C[ie],Ee=T.getTile(fe),Pe=Ee.getBucket(S);if(!Pe)continue;const Me=Pe.programConfigurations.get(S.id),Be=g.useProgram("circle",Me),De=Pe.layoutVertexBuffer,Ve=Pe.indexBuffer,lt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(fe),$t={programConfiguration:Me,program:Be,layoutVertexBuffer:De,indexBuffer:Ve,uniformValues:oa(g,fe,Ee,S),terrainData:lt};if(V){const Xe=Pe.segments.get();for(const wt of Xe)be.push({segments:new u.SegmentVector([wt]),sortKey:wt.sortKey,state:$t})}else be.push({segments:Pe.segments,sortKey:0,state:$t})}V&&be.sort((ie,fe)=>ie.sortKey-fe.sortKey);for(const ie of be){const{programConfiguration:fe,program:Ee,layoutVertexBuffer:Pe,indexBuffer:Me,uniformValues:Be,terrainData:De}=ie.state;Ee.draw(K,X.TRIANGLES,Q,W,he,pi.disabled,Be,De,S.id,Pe,Me,ie.segments,S.paint,g.transform.zoom,fe)}})(t,a,c,f);break;case"heatmap":(function(g,T,S,C){if(S.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const M=g.context,A=M.gl,R=ui.disabled,V=new Si([A.ONE,A.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(K,X,Q){const W=K.gl;K.activeTexture.set(W.TEXTURE1),K.viewport.set([0,0,X.width/4,X.height/4]);let he=Q.heatmapFbo;if(he)W.bindTexture(W.TEXTURE_2D,he.colorAttachment.get()),K.bindFramebuffer.set(he.framebuffer);else{const be=W.createTexture();W.bindTexture(W.TEXTURE_2D,be),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),he=Q.heatmapFbo=K.createFramebuffer(X.width/4,X.height/4,!1,!1),function(ie,fe,Ee,Pe){var Me,Be;const De=ie.gl,Ve=(Me=ie.HALF_FLOAT)!==null&&Me!==void 0?Me:De.UNSIGNED_BYTE,lt=(Be=ie.RGBA16F)!==null&&Be!==void 0?Be:De.RGBA;De.texImage2D(De.TEXTURE_2D,0,lt,fe.width/4,fe.height/4,0,De.RGBA,Ve,null),Pe.colorAttachment.set(Ee)}(K,X,be,he)}})(M,g,S),M.clear({color:u.Color.transparent});for(let K=0;K<C.length;K++){const X=C[K];if(T.hasRenderableParent(X))continue;const Q=T.getTile(X),W=Q.getBucket(S);if(!W)continue;const he=W.programConfigurations.get(S.id),be=g.useProgram("heatmap",he),{zoom:ie}=g.transform;be.draw(M,A.TRIANGLES,Et.disabled,R,V,pi.disabled,Va(X.posMatrix,Q,ie,S.paint.get("heatmap-intensity")),null,S.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,S.paint,g.transform.zoom,he)}M.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(M,A){const R=M.context,V=R.gl,K=A.heatmapFbo;if(!K)return;R.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,K.colorAttachment.get()),R.activeTexture.set(V.TEXTURE1);let X=A.colorRampTexture;X||(X=A.colorRampTexture=new ct(R,A.colorRamp,V.RGBA)),X.bind(V.LINEAR,V.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(R,V.TRIANGLES,Et.disabled,ui.disabled,M.colorModeForRenderPass(),pi.disabled,((Q,W,he,be)=>{const ie=u.create();u.ortho(ie,0,Q.width,Q.height,0,0,1);const fe=Q.context.gl;return{u_matrix:ie,u_world:[fe.drawingBufferWidth,fe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}})(M,A),null,A.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,A.paint,M.transform.zoom)}(g,S))})(t,a,c,f);break;case"line":(function(g,T,S,C){if(g.renderPass!=="translucent")return;const M=S.paint.get("line-opacity"),A=S.paint.get("line-width");if(M.constantOr(1)===0||A.constantOr(1)===0)return;const R=g.depthModeForSublayer(0,Et.ReadOnly),V=g.colorModeForRenderPass(),K=S.paint.get("line-dasharray"),X=S.paint.get("line-pattern"),Q=X.constantOr(1),W=S.paint.get("line-gradient"),he=S.getCrossfadeParameters(),be=Q?"linePattern":K?"lineSDF":W?"lineGradient":"line",ie=g.context,fe=ie.gl;let Ee=!0;for(const Pe of C){const Me=T.getTile(Pe);if(Q&&!Me.patternsLoaded())continue;const Be=Me.getBucket(S);if(!Be)continue;const De=Be.programConfigurations.get(S.id),Ve=g.context.program.get(),lt=g.useProgram(be,De),$t=Ee||lt.program!==Ve,Xe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Pe),wt=X.constantOr(null);if(wt&&Me.imageAtlas){const Vt=Me.imageAtlas,Dt=Vt.patternPositions[wt.to.toString()],bt=Vt.patternPositions[wt.from.toString()];Dt&&bt&&De.setConstantPatternPositions(Dt,bt)}const st=Xe?Pe:null,mi=Q?Vr(g,Me,S,he,st):K?aa(g,Me,S,K,he,st):W?Za(g,Me,S,Be.lineClipsArray.length,st):Ms(g,Me,S,st);if(Q)ie.activeTexture.set(fe.TEXTURE0),Me.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),De.updatePaintBuffers(he);else if(K&&($t||g.lineAtlas.dirty))ie.activeTexture.set(fe.TEXTURE0),g.lineAtlas.bind(ie);else if(W){const Vt=Be.gradients[S.id];let Dt=Vt.texture;if(S.gradientVersion!==Vt.version){let bt=256;if(S.stepInterpolant){const Ui=T.getSource().maxzoom,li=Pe.canonical.z===Ui?Math.ceil(1<<g.transform.maxZoom-Pe.canonical.z):1;bt=u.clamp(u.nextPowerOfTwo(Be.maxLineLength/u.EXTENT*1024*li),256,ie.maxTextureSize)}Vt.gradient=u.renderColorRamp({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:bt,image:Vt.gradient||void 0,clips:Be.lineClipsArray}),Vt.texture?Vt.texture.update(Vt.gradient):Vt.texture=new ct(ie,Vt.gradient,fe.RGBA),Vt.version=S.gradientVersion,Dt=Vt.texture}ie.activeTexture.set(fe.TEXTURE0),Dt.bind(S.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}lt.draw(ie,fe.TRIANGLES,R,g.stencilModeForClipping(Pe),V,pi.disabled,mi,Xe,S.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,S.paint,g.transform.zoom,De,Be.layoutVertexBuffer2),Ee=!1}})(t,a,c,f);break;case"fill":(function(g,T,S,C){const M=S.paint.get("fill-color"),A=S.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const R=g.colorModeForRenderPass(),V=S.paint.get("fill-pattern"),K=g.opaquePassEnabledForLayer()&&!V.constantOr(1)&&M.constantOr(u.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===K){const X=g.depthModeForSublayer(1,g.renderPass==="opaque"?Et.ReadWrite:Et.ReadOnly);br(g,T,S,C,X,R,!1)}if(g.renderPass==="translucent"&&S.paint.get("fill-antialias")){const X=g.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);br(g,T,S,C,X,R,!0)}})(t,a,c,f);break;case"fill-extrusion":(function(g,T,S,C){const M=S.paint.get("fill-extrusion-opacity");if(M!==0&&g.renderPass==="translucent"){const A=new Et(g.context.gl.LEQUAL,Et.ReadWrite,g.depthRangeFor3D);if(M!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))el(g,T,S,C,A,ui.disabled,Si.disabled),el(g,T,S,C,A,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const R=g.colorModeForRenderPass();el(g,T,S,C,A,ui.disabled,R)}}})(t,a,c,f);break;case"hillshade":(function(g,T,S,C){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const M=g.context,A=g.depthModeForSublayer(0,Et.ReadOnly),R=g.colorModeForRenderPass(),[V,K]=g.renderPass==="translucent"?g.stencilConfigForOverlap(C):[{},C];for(const X of K){const Q=T.getTile(X);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&g.renderPass==="offscreen"?Gl(g,Q,S,A,ui.disabled,R):g.renderPass==="translucent"&&oo(g,X,Q,S,A,V[X.overscaledZ],R)}M.viewport.set([0,0,g.width,g.height])})(t,a,c,f);break;case"raster":(function(g,T,S,C){if(g.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!C.length)return;const M=g.context,A=M.gl,R=T.getSource(),V=g.useProgram("raster"),K=g.colorModeForRenderPass(),[X,Q]=R instanceof er?[{},C]:g.stencilConfigForOverlap(C),W=Q[Q.length-1].overscaledZ,he=!g.options.moving;for(const be of Q){const ie=g.depthModeForSublayer(be.overscaledZ-W,S.paint.get("raster-opacity")===1?Et.ReadWrite:Et.ReadOnly,A.LESS),fe=T.getTile(be);fe.registerFadeDuration(S.paint.get("raster-fade-duration"));const Ee=T.findLoadedParent(be,0),Pe=pa(fe,Ee,T,S,g.transform,g.style.map.terrain);let Me,Be;const De=S.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;M.activeTexture.set(A.TEXTURE0),fe.texture.bind(De,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(A.TEXTURE1),Ee?(Ee.texture.bind(De,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Me=Math.pow(2,Ee.tileID.overscaledZ-fe.tileID.overscaledZ),Be=[fe.tileID.canonical.x*Me%1,fe.tileID.canonical.y*Me%1]):fe.texture.bind(De,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const Ve=g.style.map.terrain&&g.style.map.terrain.getTerrainData(be),lt=Ve?be:null,$t=lt?lt.posMatrix:g.transform.calculatePosMatrix(be.toUnwrapped(),he),Xe=Lt($t,Be||[0,0],Me||1,Pe,S);R instanceof er?V.draw(M,A.TRIANGLES,ie,ui.disabled,K,pi.disabled,Xe,Ve,S.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments):V.draw(M,A.TRIANGLES,ie,X[be.overscaledZ],K,pi.disabled,Xe,Ve,S.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}})(t,a,c,f);break;case"background":(function(g,T,S,C){const M=S.paint.get("background-color"),A=S.paint.get("background-opacity");if(A===0)return;const R=g.context,V=R.gl,K=g.transform,X=K.tileSize,Q=S.paint.get("background-pattern");if(g.isPatternMissing(Q))return;const W=!Q&&M.a===1&&A===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==W)return;const he=ui.disabled,be=g.depthModeForSublayer(0,W==="opaque"?Et.ReadWrite:Et.ReadOnly),ie=g.colorModeForRenderPass(),fe=g.useProgram(Q?"backgroundPattern":"background"),Ee=C||K.coveringTiles({tileSize:X,terrain:g.style.map.terrain});Q&&(R.activeTexture.set(V.TEXTURE0),g.imageManager.bind(g.context));const Pe=S.getCrossfadeParameters();for(const Me of Ee){const Be=C?Me.posMatrix:g.transform.calculatePosMatrix(Me.toUnwrapped()),De=Q?As(Be,A,g,Q,{tileID:Me,tileSize:X},Pe):no(Be,A,M),Ve=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Me);fe.draw(R,V.TRIANGLES,be,he,ie,pi.disabled,De,Ve,S.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}})(t,0,c,f);break;case"custom":(function(g,T,S){const C=g.context,M=S.implementation;if(g.renderPass==="offscreen"){const A=M.prerender;A&&(g.setCustomLayerDefaults(),C.setColorMode(g.colorModeForRenderPass()),A.call(M,C.gl,g.transform.customLayerMatrix()),C.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),C.setColorMode(g.colorModeForRenderPass()),C.setStencilMode(ui.disabled);const A=M.renderingMode==="3d"?new Et(g.context.gl.LEQUAL,Et.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,Et.ReadOnly);C.setDepthMode(A),M.render(C.gl,g.transform.customLayerMatrix()),C.setDirty(),g.setBaseState(),C.bindFramebuffer.set(null)}})(t,0,c)}}translatePosMatrix(t,a,c,f,g){if(!c[0]&&!c[1])return t;const T=g?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(T){const M=Math.sin(T),A=Math.cos(T);c=[c[0]*A-c[1]*M,c[0]*M+c[1]*A]}const S=[g?c[0]:ae(a,c[0],this.transform.zoom),g?c[1]:ae(a,c[1],this.transform.zoom),0],C=new Float32Array(16);return u.translate(C,t,S),C}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a){this.cache=this.cache||{};const c=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new vr(this.context,Wo[t],a,Gi[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ct(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}class nl{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,c){const f=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const C=1/(S=u.transformMat4([],S,t))[3]/a*f;return u.mul$1(S,S,[C,C,1/S[3],C])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const C=function(V,K){var X=K[0],Q=K[1],W=K[2],he=X*X+Q*Q+W*W;return he>0&&(he=1/Math.sqrt(he)),V[0]=K[0]*he,V[1]=K[1]*he,V[2]=K[2]*he,V}([],function(V,K,X){var Q=K[0],W=K[1],he=K[2],be=X[0],ie=X[1],fe=X[2];return V[0]=W*fe-he*ie,V[1]=he*be-Q*fe,V[2]=Q*ie-W*be,V}([],ht([],g[S[0]],g[S[1]]),ht([],g[S[2]],g[S[1]]))),M=-((A=C)[0]*(R=g[S[1]])[0]+A[1]*R[1]+A[2]*R[2]);var A,R;return C.concat(M)});return new nl(g,T)}}class Gn{constructor(t,a){this.min=t,this.max=a,this.center=function(c,f,g){return c[0]=.5*f[0],c[1]=.5*f[1],c[2]=.5*f[2],c}([],function(c,f,g){return c[0]=f[0]+g[0],c[1]=f[1]+g[1],c[2]=f[2]+g[2],c}([],this.min,this.max))}quadrant(t){const a=[t%2==0,t<2],c=Ne(this.min),f=Ne(this.max);for(let g=0;g<a.length;g++)c[g]=a[g]?this.min[g]:this.center[g],f[g]=a[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new Gn(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let f=0;f<t.planes.length;f++){const g=t.planes[f];let T=0;for(let S=0;S<a.length;S++)u.dot(g,a[S])>=0&&T++;if(T===0)return 0;T!==a.length&&(c=!1)}if(c)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const C=t.points[S][f]-this.min[f];g=Math.min(g,C),T=Math.max(T,C)}if(T<0||g>this.max[f]-this.min[f])return 0}return 1}}class rs{constructor(t=0,a=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=f}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=u.interpolate.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=u.interpolate.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=u.interpolate.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=u.interpolate.number(t.right,a.right,c)),this}getCenter(t,a){const c=u.clamp((this.left+t-this.right)/2,0,t),f=u.clamp((this.top+a-this.bottom)/2,0,a);return new u.Point(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new rs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ma{constructor(t,a,c,f,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=c??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new rs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new ma(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-u.wrap(t,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var c=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c}(),function(c,f,g){var T=f[0],S=f[1],C=f[2],M=f[3],A=Math.sin(g),R=Math.cos(g);c[0]=T*R+C*A,c[1]=S*R+M*A,c[2]=T*-A+C*R,c[3]=S*-A+M*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=u.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new u.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new u.Point(0,0)),f=this.pointCoordinate(new u.Point(this.width,0)),g=this.pointCoordinate(new u.Point(this.width,this.height)),T=this.pointCoordinate(new u.Point(0,this.height)),S=Math.floor(Math.min(c.x,f.x,g.x,T.x)),C=Math.floor(Math.max(c.x,f.x,g.x,T.x)),M=1;for(let A=S-M;A<=C+M;A++)A!==0&&a.push(new u.UnwrappedTileID(A,t))}return a}coveringTiles(t){var a,c;let f=this.coveringZoomLevel(t);const g=f;if(t.minzoom!==void 0&&f<t.minzoom)return[];t.maxzoom!==void 0&&f>t.maxzoom&&(f=t.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),S=u.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,f),M=[C*T.x,C*T.y,0],A=[C*S.x,C*S.y,0],R=nl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let V=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=f);const K=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,X=ie=>({aabb:new Gn([ie*C,0,0],[(ie+1)*C,C,0]),zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),Q=[],W=[],he=f,be=t.reparseOverscaled?g:f;if(this._renderWorldCopies)for(let ie=1;ie<=3;ie++)Q.push(X(-ie)),Q.push(X(ie));for(Q.push(X(0));Q.length>0;){const ie=Q.pop(),fe=ie.x,Ee=ie.y;let Pe=ie.fullyVisible;if(!Pe){const lt=ie.aabb.intersects(R);if(lt===0)continue;Pe=lt===2}const Me=t.terrain?M:A,Be=ie.aabb.distanceX(Me),De=ie.aabb.distanceY(Me),Ve=Math.max(Math.abs(Be),Math.abs(De));if(ie.zoom===he||Ve>K+(1<<he-ie.zoom)-2&&ie.zoom>=V){const lt=he-ie.zoom,$t=M[0]-.5-(fe<<lt),Xe=M[1]-.5-(Ee<<lt);W.push({tileID:new u.OverscaledTileID(ie.zoom===he?be:ie.zoom,ie.wrap,ie.zoom,fe,Ee),distanceSq:rt([A[0]-.5-fe,A[1]-.5-Ee]),tileDistanceToCamera:Math.sqrt($t*$t+Xe*Xe)})}else for(let lt=0;lt<4;lt++){const $t=(fe<<1)+lt%2,Xe=(Ee<<1)+(lt>>1),wt=ie.zoom+1;let st=ie.aabb.quadrant(lt);if(t.terrain){const mi=new u.OverscaledTileID(wt,ie.wrap,wt,$t,Xe),Vt=t.terrain.getMinMaxElevation(mi),Dt=(a=Vt.minElevation)!==null&&a!==void 0?a:this.elevation,bt=(c=Vt.maxElevation)!==null&&c!==void 0?c:this.elevation;st=new Gn([st.min[0],st.min[1],Dt],[st.max[0],st.max[1],bt])}Q.push({aabb:st,zoom:wt,x:$t,y:Xe,wrap:ie.wrap,fullyVisible:Pe})}}return W.sort((ie,fe)=>ie.distanceSq-fe.distanceSq).map(ie=>ie.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=u.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.Point(u.mercatorXfromLng(t.lng)*this.worldSize,u.mercatorYfromLat(a)*this.worldSize)}unproject(t){return new u.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.pointLocation(this.centerPoint,t),c=t.getElevationForLngLatZoom(a,this.tileZoom);if(!(this.elevation-c))return;const f=this.getCameraPosition(),g=u.MercatorCoordinate.fromLngLat(f.lngLat,f.altitude),T=u.MercatorCoordinate.fromLngLat(a,c),S=g.x-T.x,C=g.y-T.y,M=g.z-T.z,A=Math.sqrt(S*S+C*C+M*M),R=this.scaleZoom(this.cameraToCenterDistance/A/this.tileSize);this._elevation=c,this._center=a,this.zoom=R}setLocationAtPoint(t,a){const c=this.pointCoordinate(a),f=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),T=new u.MercatorCoordinate(g.x-(c.x-f.x),g.y-(c.y-f.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),a.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return u.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const V=a.pointCoordinate(t);if(V!=null)return V}const c=[t.x,t.y,0,1],f=[t.x,t.y,1,1];u.transformMat4(c,c,this.pixelMatrixInverse),u.transformMat4(f,f,this.pixelMatrixInverse);const g=c[3],T=f[3],S=c[1]/g,C=f[1]/T,M=c[2]/g,A=f[2]/T,R=M===A?0:(0-M)/(A-M);return new u.MercatorCoordinate(u.interpolate.number(c[0]/g,f[0]/T,R)/this.worldSize,u.interpolate.number(S,C,R)/this.worldSize)}coordinatePoint(t,a=0,c=this.pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,a,1];return u.transformMat4(f,f,c),new u.Point(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ct().extend(this.pointLocation(new u.Point(0,t))).extend(this.pointLocation(new u.Point(this.width,t))).extend(this.pointLocation(new u.Point(this.width,this.height))).extend(this.pointLocation(new u.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ct([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,a=!1){const c=t.key,f=a?this._alignedPosMatrixCache:this._posMatrixCache;if(f[c])return f[c];const g=t.canonical,T=this.worldSize/this.zoomScale(g.z),S=g.x+Math.pow(2,g.z)*t.wrap,C=u.identity(new Float64Array(16));return u.translate(C,C,[S*T,g.y*T,0]),u.scale(C,C,[T/u.EXTENT,T/u.EXTENT,1]),u.multiply(C,a?this.alignedProjMatrix:this.projMatrix,C),f[c]=new Float32Array(C),f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,a,c,f,g=-90,T=90,S=-180,C=180;const M=this.size,A=this._unmodified;if(this.latRange){const K=this.latRange;g=u.mercatorYfromLat(K[1])*this.worldSize,T=u.mercatorYfromLat(K[0])*this.worldSize,t=T-g<M.y?M.y/(T-g):0}if(this.lngRange){const K=this.lngRange;S=u.wrap(u.mercatorXfromLng(K[0])*this.worldSize,0,this.worldSize),C=u.wrap(u.mercatorXfromLng(K[1])*this.worldSize,0,this.worldSize),C<S&&(C+=this.worldSize),a=C-S<M.x?M.x/(C-S):0}const R=this.point,V=Math.max(a||0,t||0);if(V)return this.center=this.unproject(new u.Point(a?(C+S)/2:R.x,t?(T+g)/2:R.y)),this.zoom+=this.scaleZoom(V),this._unmodified=A,void(this._constraining=!1);if(this.latRange){const K=R.y,X=M.y/2;K-X<g&&(f=g+X),K+X>T&&(f=T-X)}if(this.lngRange){const K=(S+C)/2,X=u.wrap(R.x,K-this.worldSize/2,K+this.worldSize/2),Q=M.x/2;X-Q<S&&(c=S+Q),X+Q>C&&(c=C-Q)}c===void 0&&f===void 0||(this.center=this.unproject(new u.Point(c!==void 0?c:R.x,f!==void 0?f:R.y)).wrap()),this._unmodified=A,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let f=u.identity(new Float64Array(16));u.scale(f,f,[this.width/2,-this.height/2,1]),u.translate(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=u.identity(new Float64Array(16)),u.scale(f,f,[1,-1,1]),u.translate(f,f,[-1,-1,0]),u.scale(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f;const g=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this._minEleveationForCurrentTile),S=g-T*this._pixelPerMeter/Math.cos(this._pitch),C=T<0?S:g,M=Math.PI/2+this._pitch,A=this._fov*(.5+t.y/this.height),R=Math.sin(A)*C/Math.sin(u.clamp(Math.PI-M-A,.01,Math.PI-.01)),V=this.getHorizon(),K=2*Math.atan(V/this.cameraToCenterDistance)*(.5+t.y/(2*V)),X=Math.sin(K)*C/Math.sin(u.clamp(Math.PI-M-K,.01,Math.PI-.01)),Q=Math.min(R,X),W=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+C),he=this.height/50;f=new Float64Array(16),u.perspective(f,this._fov,this.width/this.height,he,W),f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,u.scale(f,f,[1,-1,1]),u.translate(f,f,[0,0,-this.cameraToCenterDistance]),u.rotateX(f,f,this._pitch),u.rotateZ(f,f,this.angle),u.translate(f,f,[-a,-c,0]),this.mercatorMatrix=u.scale([],f,[this.worldSize,this.worldSize,this.worldSize]),u.scale(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,f),u.translate(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=u.invert([],f),this.pixelMatrix3D=u.multiply(new Float64Array(16),this.labelPlaneMatrix,f);const be=this.width%2/2,ie=this.height%2/2,fe=Math.cos(this.angle),Ee=Math.sin(this.angle),Pe=a-Math.round(a)+fe*be+Ee*ie,Me=c-Math.round(c)+fe*ie+Ee*be,Be=new Float64Array(f);if(u.translate(Be,Be,[Pe>.5?Pe-1:Pe,Me>.5?Me-1:Me,0]),this.alignedProjMatrix=Be,f=u.invert(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new u.Point(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.transformMat4(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.Point(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let c=a.x,f=a.y,g=a.x,T=a.y;for(const S of t)c=Math.min(c,S.x),f=Math.min(f,S.y),g=Math.max(g,S.x),T=Math.max(T,S.y);return[new u.Point(c,f),new u.Point(g,f),new u.Point(g,T),new u.Point(c,T),new u.Point(c,f)]}}}class ao{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=function(a,c){let f=!1,g=null;const T=()=>{g=null,f&&(a(),g=setTimeout(T,300),f=!1)};return()=>(f=!0,g||T(),g)}(this._updateHashUnthrottled),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,f),T=Math.round(a.lng*g)/g,S=Math.round(a.lat*g)/g,C=this._map.getBearing(),M=this._map.getPitch();let A="";if(A+=t?`/${T}/${S}/${c}`:`${c}/${S}/${T}`,(C||M)&&(A+="/"+Math.round(10*C)/10),M&&(A+=`/${Math.round(M)}`),this._hashName){const R=this._hashName;let V=!1;const K=window.location.hash.slice(1).split("&").map(X=>{const Q=X.split("=")[0];return Q===R?(V=!0,`${Q}=${A}`):X}).filter(X=>X);return V||K.push(`${R}=${A}`),`#${K.join("&")}`}return`#${A}`}}const Lo={linearity:.3,easing:u.bezier(0,0,.3,1)},rl=u.extend({deceleration:2500,maxSpeed:1400},Lo),_a=u.extend({deceleration:20,maxSpeed:1400},Lo),os=u.extend({deceleration:1e3,maxSpeed:360},Lo),ga=u.extend({deceleration:1e3,maxSpeed:90},Lo);class ol{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.browser.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=u.browser.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new u.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const g=ya(a.pan.mag(),c,u.extend({},rl,t||{}));f.offset=a.pan.mult(g.amount/a.pan.mag()),f.center=this._map.transform.center,lo(f,g)}if(a.zoom){const g=ya(a.zoom,c,_a);f.zoom=this._map.transform.zoom+g.amount,lo(f,g)}if(a.bearing){const g=ya(a.bearing,c,os);f.bearing=this._map.transform.bearing+u.clamp(g.amount,-179,179),lo(f,g)}if(a.pitch){const g=ya(a.pitch,c,ga);f.pitch=this._map.transform.pitch+g.amount,lo(f,g)}if(f.zoom||f.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;f.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),u.extend(f,{noMoveStart:!0})}}function lo(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function ya(m,t,a){const{maxSpeed:c,linearity:f,deceleration:g}=a,T=u.clamp(m*f/(t/1e3),-c,c),S=Math.abs(T)/(g*f);return{easing:a.easing,duration:1e3*S,amount:T*(S/2)}}class xi extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,f={}){const g=q.mousePos(a.getCanvasContainer(),c),T=a.unproject(g);super(t,u.extend({point:g,lngLat:T,originalEvent:c},f)),this._defaultPrevented=!1,this.target=a}}class or extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const f=t==="touchend"?c.changedTouches:c.touches,g=q.touchPos(a.getCanvasContainer(),f),T=g.map(C=>a.unproject(C)),S=g.reduce((C,M,A,R)=>C.add(M.div(R.length)),new u.Point(0,0));super(t,{points:g,point:S,lngLats:T,lngLat:a.unproject(S),originalEvent:c}),this._defaultPrevented=!1}}class Hl extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class uo{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Hl(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new xi(t.type,this._map,t))}mouseup(t){this._map.fire(new xi(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new xi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new xi(t.type,this._map,t))}mouseover(t){this._map.fire(new xi(t.type,this._map,t))}mouseout(t){this._map.fire(new xi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new or(t.type,this._map,t))}touchmove(t){this._map.fire(new or(t.type,this._map,t))}touchend(t){this._map.fire(new or(t.type,this._map,t))}touchcancel(t){this._map.fire(new or(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new xi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new xi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class va{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(u.Point.convert(t),this._map.terrain)}}class $r{constructor(t,a){this._map=t,this._tr=new va(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(q.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(f.x,c.x),T=Math.max(f.x,c.x),S=Math.min(f.y,c.y),C=Math.max(f.y,c.y);q.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=T-g+"px",this._box.style.height=C-S+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,f=a;if(this.reset(),q.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new u.Event(t,{originalEvent:a}))}}function Fs(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const a={};for(let c=0;c<m.length;c++)a[m[c].identifier]=t[c];return a}class Tu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(f){const g=new u.Point(0,0);for(const T of f)g._add(T);return g.div(f.length)}(a),this.touches=Fs(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const f=Fs(c,a);for(const g in this.touches){const T=f[g];(!T||T.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class jr{constructor(t){this.singleTap=new Tu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const f=this.singleTap.touchend(t,a,c);if(f){const g=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(f)<30;if(g&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Do{constructor(t){this._tr=new va(t),this._zoomIn=new jr({numTouches:1,numTaps:2}),this._zoomOut=new jr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const f=this._zoomIn.touchend(t,a,c),g=this._zoomOut.touchend(t,a,c),T=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(f)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qe{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=a.length?a[0]:a;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&q.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Su={0:1,2:2};class Tr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=q.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(a,c){const f=Su[c];return a.buttons===void 0||(a.buttons&f)!==f}(t,this._eventButton)}isValidEndEvent(t){return q.mouseButton(t)===this._eventButton}}class Ns{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const co=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=function(t){t.preventDefault()}},Ye=({enable:m,clickTolerance:t,bearingDegreesPerPixelMoved:a=.8})=>{const c=new Tr({checkCorrectEvent:f=>q.mouseButton(f)===0&&f.ctrlKey||q.mouseButton(f)===2});return new Qe({clickTolerance:t,move:(f,g)=>({bearingDelta:(g.x-f.x)*a}),moveStateManager:c,enable:m,assignEvents:co})},xa=({enable:m,clickTolerance:t,pitchDegreesPerPixelMoved:a=-.5})=>{const c=new Tr({checkCorrectEvent:f=>q.mouseButton(f)===0&&f.ctrlKey||q.mouseButton(f)===2});return new Qe({clickTolerance:t,move:(f,g)=>({pitchDelta:(g.y-f.y)*a}),moveStateManager:c,enable:m,assignEvents:co})};class wc{constructor(t,a){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,a,c)}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const f=Fs(c,a),g=new u.Point(0,0),T=new u.Point(0,0);let S=0;for(const M in f){const A=f[M],R=this._touches[M];R&&(g._add(A),T._add(A.sub(R)),S++,f[M]=A)}if(this._touches=f,S<this._minTouches||!T.mag())return;const C=T.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[f,g]=this._firstTwoTouches,T=ss(c,a,f),S=ss(c,a,g);if(!T||!S)return;const C=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],C,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[f,g]=this._firstTwoTouches,T=ss(c,a,f),S=ss(c,a,g);T&&S||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ss(m,t,a){for(let c=0;c<m.length;c++)if(m[c].identifier===a)return t[c]}function sl(m,t){return Math.log(m/t)/Math.LN2}class Us extends Sr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(sl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sl(this._distance,c),pinchAround:a}}}function Eu(m,t){return 180*m.angleWith(t)/Math.PI}class al extends Sr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Eu(this._vector,c),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=Eu(t,this._startVector);return Math.abs(c)<a}}function ho(m){return Math.abs(m.y)>Math.abs(m.x)}class ll extends Sr{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,ho(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,g,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,g=a.mag()>=2;if(!f&&!g)return;if(!f||!g)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const T=t.y>0==a.y>0;return ho(t)&&ho(a)&&T}}const ul={panStep:100,bearingStep:15,pitchStep:10};class Xl{constructor(t){this._tr=new va(t);const a=ul;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,f=0,g=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:S=>{const C=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Pn,zoom:a?Math.round(C.zoom)+a*(t.shiftKey?2:1):C.zoom,bearing:C.bearing+c*this._bearingStep,pitch:C.pitch+f*this._pitchStep,offset:[-g*this._panStep,-T*this._panStep],center:C.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pn(m){return m*(2-m)}const qr=4.000244140625;class Kl{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new va(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=u.browser.now(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%qr==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=q.mousePos(this._el,t),c=this._tr;this._around=u.LngLat.convert(this._aroundCenter?c.center:c.unproject(a)),this._aroundPoint=c.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>qr?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);const M=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(M*C))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,c=this._startZoom,f=this._easing;let g,T=!1;if(this._type==="wheel"&&c&&f){const S=Math.min((u.browser.now()-this._lastWheelEventTime)/200,1),C=f(S);g=u.interpolate.number(c,a,C),S<1?this._frameId||(this._frameId=!0):T=!0}else g=a,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=u.defaultEasing;if(this._prevEase){const c=this._prevEase,f=(u.browser.now()-c.start)/c.duration,g=c.easing(f+.01)-c.easing(f),T=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-T*T);a=u.bezier(T,S,.25,1)}return this._prevEase={start:u.browser.now(),duration:t,easing:a},a}reset(){this._active=!1}}class cl{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hl{constructor(t){this._tr=new va(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yl{constructor(){this._tap=new jr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const f=a[0],g=t.timeStamp-this._tapTime<500,T=this._tapPoint.dist(f)<30;g&&T?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=a[0],g=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(t,a,c);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jl{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wn{constructor(t,a,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fi{constructor(t,a,c,f){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const o=m=>m.zoom||m.drag||m.pitch||m.rotate;class d extends u.Event{}function x(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class P{constructor(t,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,g)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=f.type==="renderFrame"?void 0:f,S={needsRenderFrame:!1},C={},M={},A=f.touches,R=A?this._getMapTouches(A):void 0,V=R?q.touchPos(this._el,R):q.mousePos(this._el,f);for(const{handlerName:Q,handler:W,allowed:he}of this._handlers){if(!W.isEnabled())continue;let be;this._blockedByActive(M,he,Q)?W.reset():W[g||f.type]&&(be=W[g||f.type](f,V,R),this.mergeHandlerResult(S,C,be,Q,T),be&&be.needsRenderFrame&&this._triggerRenderFrame()),(be||W.isActive())&&(M[Q]=W)}const K={};for(const Q in this._previousActiveHandlers)M[Q]||(K[Q]=T);this._previousActiveHandlers=M,(Object.keys(K).length||x(S))&&(this._changes.push([S,C,K]),this._triggerRenderFrame()),(Object.keys(M).length||x(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=S;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ol(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,g,T]of this._listeners)q.addEventListener(f,g,f===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[t,a,c]of this._listeners)q.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new uo(a,t));const f=a.boxZoom=new $r(a,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const g=new Do(a),T=new hl(a);a.doubleClickZoom=new cl(T,g),this._add("tapZoom",g),this._add("clickZoom",T),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const S=new Yl;this._add("tapDragZoom",S);const C=a.touchPitch=new ll(a);this._add("touchPitch",C),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const M=Ye(t),A=xa(t);a.dragRotate=new Wn(t,M,A),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const R=(({enable:he,clickTolerance:be})=>{const ie=new Tr({checkCorrectEvent:fe=>q.mouseButton(fe)===0&&!fe.ctrlKey});return new Qe({clickTolerance:be,move:(fe,Ee)=>({around:Ee,panDelta:Ee.sub(fe)}),activateOnStart:!0,moveStateManager:ie,enable:he,assignEvents:co})})(t),V=new wc(t,a);a.dragPan=new Jl(c,R,V),this._add("mousePan",R),this._add("touchPan",V,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const K=new al,X=new Us;a.touchZoomRotate=new fi(c,X,K,S),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate);const Q=a.scrollZoom=new Kl(a,()=>this._triggerRenderFrame());this._add("scrollZoom",Q,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const W=a.keyboard=new Xl(a);this._add("keyboard",W),t.interactive&&t.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new Os(a))}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!o(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const f in t)if(f!==c&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,f,g){if(!c)return;u.extend(t,c);const T={handlerName:f,originalEvent:c.originalEvent||g};c.zoomDelta!==void 0&&(a.zoom=T),c.panDelta!==void 0&&(a.drag=T),c.pitchDelta!==void 0&&(a.pitch=T),c.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const t={},a={},c={};for(const[f,g,T]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new u.Point(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),u.extend(a,g),u.extend(c,T);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const f=this._map,g=f._getTransformForUpdate(),T=f.terrain;if(!(x(t)||T&&this._terrainMovement))return this._fireEvents(a,c,!0);let{panDelta:S,zoomDelta:C,bearingDelta:M,pitchDelta:A,around:R,pinchAround:V}=t;V!==void 0&&(R=V),f._stop(!0),R=R||f.transform.centerPoint;const K=g.pointLocation(S?R.sub(S):R);M&&(g.bearing+=M),A&&(g.pitch+=A),C&&(g.zoom+=C),T?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?g.center=g.pointLocation(g.centerPoint.sub(S)):g.setLocationAtPoint(K,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,g.setLocationAtPoint(K,R),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,g.recalculateZoom(f.terrain)})):g.setLocationAtPoint(K,R),f._applyUpdatedTransform(g),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_fireEvents(t,a,c){const f=o(this._eventsInProgress),g=o(t),T={};for(const A in t){const{originalEvent:R}=t[A];this._eventsInProgress[A]||(T[`${A}start`]=R),this._eventsInProgress[A]=t[A]}!f&&g&&this._fireEvent("movestart",g.originalEvent);for(const A in T)this._fireEvent(A,T[A]);g&&this._fireEvent("move",g.originalEvent);for(const A in t){const{originalEvent:R}=t[A];this._fireEvent(A,R)}const S={};let C;for(const A in this._eventsInProgress){const{handlerName:R,originalEvent:V}=this._eventsInProgress[A];this._handlersById[R].isActive()||(delete this._eventsInProgress[A],C=a[R]||V,S[`${A}end`]=C)}for(const A in S)this._fireEvent(A,S[A]);const M=o(this._eventsInProgress);if(c&&(f||g)&&!M){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;A?(R(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:C})):(this._map.fire(new u.Event("moveend",{originalEvent:C})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new u.Event(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new d("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class z extends u.Evented{constructor(t,a){super(),this._renderFrameCallback=()=>{const c=Math.min((u.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,c){return t=u.Point.convert(t).mult(-1),this.panTo(this.transform.center,u.extend({offset:t},a),c)}panTo(t,a,c){return this.easeTo(u.extend({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(u.extend({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(u.extend({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,u.extend({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=Ct.convert(t);const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,f){const g={top:0,bottom:0,right:0,left:0};if(typeof(f=u.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const Ee=f.padding;f.padding={top:Ee,bottom:Ee,right:Ee,left:Ee}}f.padding=u.extend(g,f.padding);const T=this.transform,S=T.padding,C=T.project(u.LngLat.convert(t)),M=T.project(u.LngLat.convert(a)),A=C.rotate(-c*Math.PI/180),R=M.rotate(-c*Math.PI/180),V=new u.Point(Math.max(A.x,R.x),Math.max(A.y,R.y)),K=new u.Point(Math.min(A.x,R.x),Math.min(A.y,R.y)),X=V.sub(K),Q=(T.width-(S.left+S.right+f.padding.left+f.padding.right))/X.x,W=(T.height-(S.top+S.bottom+f.padding.top+f.padding.bottom))/X.y;if(W<0||Q<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const he=Math.min(T.scaleZoom(T.scale*Math.min(Q,W)),f.maxZoom),be=u.Point.convert(f.offset),ie=new u.Point((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(c*Math.PI/180),fe=be.add(ie).mult(T.scale/T.zoomScale(he));return{center:T.unproject(C.add(M).div(2).sub(fe)),zoom:he,bearing:c}}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,f,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.Point.convert(t)),this.transform.pointLocation(u.Point.convert(a)),c,f),f,g)}_fitInternal(t,a,c){return t?(delete(a=u.extend(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let f=!1,g=!1,T=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(f=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=u.LngLat.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(g=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(T=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this._applyUpdatedTransform(c),this.fire(new u.Event("movestart",a)).fire(new u.Event("move",a)),f&&this.fire(new u.Event("zoomstart",a)).fire(new u.Event("zoom",a)).fire(new u.Event("zoomend",a)),g&&this.fire(new u.Event("rotatestart",a)).fire(new u.Event("rotate",a)).fire(new u.Event("rotateend",a)),T&&this.fire(new u.Event("pitchstart",a)).fire(new u.Event("pitch",a)).fire(new u.Event("pitchend",a)),this.fire(new u.Event("moveend",a))}calculateCameraOptionsFromTo(t,a,c,f=0){const g=u.MercatorCoordinate.fromLngLat(t,a),T=u.MercatorCoordinate.fromLngLat(c,f),S=T.x-g.x,C=T.y-g.y,M=T.z-g.z,A=Math.hypot(S,C,M);if(A===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(S,C),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),K=180*Math.atan2(S,-C)/Math.PI;let X=180*Math.acos(R/A)/Math.PI;return X=M<0?90-X:90+X,{center:T.toLngLat(),zoom:V,pitch:X,bearing:K}}easeTo(t,a){this._stop(!1,t.easeId),((t=u.extend({offset:[0,0],duration:500,easing:u.defaultEasing},t)).animate===!1||!t.essential&&u.browser.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getZoom(),g=this.getBearing(),T=this.getPitch(),S=this.getPadding(),C="zoom"in t?+t.zoom:f,M="bearing"in t?this._normalizeBearing(t.bearing,g):g,A="pitch"in t?+t.pitch:T,R="padding"in t?t.padding:c.padding,V=u.Point.convert(t.offset);let K=c.centerPoint.add(V);const X=c.pointLocation(K),Q=u.LngLat.convert(t.center||X);this._normalizeCenter(Q);const W=c.project(X),he=c.project(Q).sub(W),be=c.zoomScale(C-f);let ie,fe;t.around&&(ie=u.LngLat.convert(t.around),fe=c.locationPoint(ie));const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||C!==f,this._rotating=this._rotating||g!==M,this._pitching=this._pitching||A!==T,this._padding=!c.isPaddingEqual(R),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Ee),this.terrain&&this._prepareElevation(Q),this._ease(Pe=>{if(this._zooming&&(c.zoom=u.interpolate.number(f,C,Pe)),this._rotating&&(c.bearing=u.interpolate.number(g,M,Pe)),this._pitching&&(c.pitch=u.interpolate.number(T,A,Pe)),this._padding&&(c.interpolatePadding(S,R,Pe),K=c.centerPoint.add(V)),this.terrain&&!t.freezeElevation&&this._updateElevation(Pe),ie)c.setLocationAtPoint(ie,fe);else{const Me=c.zoomScale(c.zoom-f),Be=C>f?Math.min(2,be):Math.max(.5,be),De=Math.pow(Be,1-Pe),Ve=c.unproject(W.add(he.mult(Pe*De)).mult(Me));c.setLocationAtPoint(c.renderWorldCopies?Ve.wrap():Ve,K)}this._applyUpdatedTransform(c),this._fireMoveEvents(a)},Pe=>{this.terrain&&this._finalizeElevation(),this._afterEase(a,Pe)},t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new u.Event("movestart",t)),this._zooming&&!c.zooming&&this.fire(new u.Event("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new u.Event("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new u.Event("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.elevation=u.interpolate.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const a=t.clone(),{center:c,zoom:f,pitch:g,bearing:T,elevation:S}=this.transformCameraUpdate(a);c&&(a.center=c),f!==void 0&&(a.zoom=f),g!==void 0&&(a.pitch=g),T!==void 0&&(a.bearing=T),S!==void 0&&(a.elevation=S),this.transform.apply(a)}_fireMoveEvents(t){this.fire(new u.Event("move",t)),this._zooming&&this.fire(new u.Event("zoom",t)),this._rotating&&this.fire(new u.Event("rotate",t)),this._pitching&&this.fire(new u.Event("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,f=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new u.Event("zoomend",t)),f&&this.fire(new u.Event("rotateend",t)),g&&this.fire(new u.Event("pitchend",t)),this.fire(new u.Event("moveend",t))}flyTo(t,a){if(!t.essential&&u.browser.prefersReducedMotion){const st=u.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,a)}this.stop(),t=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.defaultEasing},t);const c=this._getTransformForUpdate(),f=this.getZoom(),g=this.getBearing(),T=this.getPitch(),S=this.getPadding(),C="zoom"in t?u.clamp(+t.zoom,c.minZoom,c.maxZoom):f,M="bearing"in t?this._normalizeBearing(t.bearing,g):g,A="pitch"in t?+t.pitch:T,R="padding"in t?t.padding:c.padding,V=c.zoomScale(C-f),K=u.Point.convert(t.offset);let X=c.centerPoint.add(K);const Q=c.pointLocation(X),W=u.LngLat.convert(t.center||Q);this._normalizeCenter(W);const he=c.project(Q),be=c.project(W).sub(he);let ie=t.curve;const fe=Math.max(c.width,c.height),Ee=fe/V,Pe=be.mag();if("minZoom"in t){const st=u.clamp(Math.min(t.minZoom,f,C),c.minZoom,c.maxZoom),mi=fe/c.zoomScale(st-f);ie=Math.sqrt(mi/Pe*2)}const Me=ie*ie;function Be(st){const mi=(Ee*Ee-fe*fe+(st?-1:1)*Me*Me*Pe*Pe)/(2*(st?Ee:fe)*Me*Pe);return Math.log(Math.sqrt(mi*mi+1)-mi)}function De(st){return(Math.exp(st)-Math.exp(-st))/2}function Ve(st){return(Math.exp(st)+Math.exp(-st))/2}const lt=Be(!1);let $t=function(st){return Ve(lt)/Ve(lt+ie*st)},Xe=function(st){return fe*((Ve(lt)*(De(mi=lt+ie*st)/Ve(mi))-De(lt))/Me)/Pe;var mi},wt=(Be(!0)-lt)/ie;if(Math.abs(Pe)<1e-6||!isFinite(wt)){if(Math.abs(fe-Ee)<1e-6)return this.easeTo(t,a);const st=Ee<fe?-1:1;wt=Math.abs(Math.log(Ee/fe))/ie,Xe=function(){return 0},$t=function(mi){return Math.exp(st*ie*mi)}}return t.duration="duration"in t?+t.duration:1e3*wt/("screenSpeed"in t?+t.screenSpeed/ie:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==M,this._pitching=A!==T,this._padding=!c.isPaddingEqual(R),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(W),this._ease(st=>{const mi=st*wt,Vt=1/$t(mi);c.zoom=st===1?C:f+c.scaleZoom(Vt),this._rotating&&(c.bearing=u.interpolate.number(g,M,st)),this._pitching&&(c.pitch=u.interpolate.number(T,A,st)),this._padding&&(c.interpolatePadding(S,R,st),X=c.centerPoint.add(K)),this.terrain&&!t.freezeElevation&&this._updateElevation(st);const Dt=st===1?W:c.unproject(he.add(be.mult(Xe(mi))).mult(Vt));c.setLocationAtPoint(c.renderWorldCopies?Dt.wrap():Dt,X),this._applyUpdatedTransform(c),this._fireMoveEvents(a)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(a)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,a)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=u.browser.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=u.wrap(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const c=t.lng-a.center.lng;t.lng+=c>180?-360:c<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(u.LngLat.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class ${constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.sourceCaches;for(const f in a){const g=a[f];if(g.used||g.usedForTerrain){const T=g.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t=t.filter(f=>String(f).trim()),t.sort((f,g)=>f.length-g.length),t=t.filter((f,g)=>{for(let T=g+1;T<t.length;T++)if(t[T].indexOf(f)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class oe{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");const a=q.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class we{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ce={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Te=u.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class it extends u.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];const c={};for(const f of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),u.ortho(f.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),this._tiles[f.key]=new Go(f,this.tileSize));for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID;if(f.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),u.ortho(g.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),a[c]=g}else if(f.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const T=f.canonical.z-t.canonical.z,S=f.canonical.x-(f.canonical.x>>T<<T),C=f.canonical.y-(f.canonical.y>>T<<T),M=u.EXTENT>>T;u.ortho(g.posMatrix,0,M,0,M,0,1),u.translate(g.posMatrix,g.posMatrix,[-S*M,-C*M,0]),a[c]=g}else if(t.canonical.isChildOf(f.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const T=t.canonical.z-f.canonical.z,S=t.canonical.x-(t.canonical.x>>T<<T),C=t.canonical.y-(t.canonical.y>>T<<T),M=u.EXTENT>>T;u.ortho(g.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),u.translate(g.posMatrix,g.posMatrix,[S*M,C*M,0]),u.scale(g.posMatrix,g.posMatrix,[1/2**T,1/2**T,0]),a[c]=g}}return a}getSourceTile(t,a){const c=this.sourceCache._source;let f=t.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&a)for(;f>=c.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(f--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=t)}}class Pt{constructor(t,a,c){this.painter=t,this.sourceCache=new it(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,f=u.EXTENT){var g;if(!(a>=0&&a<f&&c>=0&&c<f))return 0;const T=this.getTerrainData(t),S=(g=T.tile)===null||g===void 0?void 0:g.dem;if(!S)return 0;const C=function(X,Q,W){var he=Q[0],be=Q[1];return X[0]=W[0]*he+W[4]*be+W[12],X[1]=W[1]*he+W[5]*be+W[13],X}([],[a/f*u.EXTENT,c/f*u.EXTENT],T.u_terrain_matrix),M=[C[0]*S.dim,C[1]*S.dim],A=Math.floor(M[0]),R=Math.floor(M[1]),V=M[0]-A,K=M[1]-R;return S.get(A,R)*(1-V)*(1-K)+S.get(A+1,R)*V*(1-K)+S.get(A,R+1)*(1-V)*K+S.get(A+1,R+1)*V*K}getElevationForLngLatZoom(t,a){const{tileID:c,mercatorX:f,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,f%u.EXTENT,g%u.EXTENT,u.EXTENT)}getElevation(t,a,c,f=u.EXTENT){return this.getDEMElevation(t,a,c,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,g=new u.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ct(f,g,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ct(f,new u.RGBAImage({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.identity([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new ct(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const f=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?g=t.canonical.z-f:u.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=t.canonical.x-(t.canonical.x>>g<<g),S=t.canonical.y-(t.canonical.y>>g<<g),C=u.fromScaling(new Float64Array(16),[1/(u.EXTENT<<g),1/(u.EXTENT<<g),0]);u.translate(C,C,[T*u.EXTENT,S*u.EXTENT,0]),this._demMatrixCache[t.key]={matrix:C,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ct(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ct(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,T=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,T+=4)a[T+0]=255&S,a[T+1]=255&g,a[T+2]=S>>8<<4|g>>8,a[T+3]=0;const c=new u.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new ct(t,c,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){const a=new Uint8Array(4),c=this.painter.context,f=c.gl;c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const g=a[0]+(a[2]>>4<<8),T=a[1]+((15&a[2])<<8),S=this.coordsIndex[255-a[3]],C=S&&this.sourceCache.getTileByID(S);if(!C)return null;const M=this._coordsTextureSize,A=(1<<C.tileID.canonical.z)*M;return new u.MercatorCoordinate((C.tileID.canonical.x*M+g)/A,(C.tileID.canonical.y*M+T)/A,this.getElevation(C.tileID,g,T,M))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,a=new u.Pos3dArray,c=new u.TriangleIndexArray,f=this.meshSize,g=u.EXTENT/f,T=f*f;for(let R=0;R<=f;R++)for(let V=0;V<=f;V++)a.emplaceBack(V*g,R*g,0);for(let R=0;R<T;R+=f+1)for(let V=0;V<f;V++)c.emplaceBack(V+R,f+V+R+1,f+V+R+2),c.emplaceBack(V+R,f+V+R+2,V+R+1);const S=a.length,C=S+2*(f+1);for(const R of[0,1])for(let V=0;V<=f;V++)for(const K of[0,1])a.emplaceBack(V*g,R*u.EXTENT,K);for(let R=0;R<2*f;R+=2)c.emplaceBack(C+R,C+R+1,C+R+3),c.emplaceBack(C+R,C+R+3,C+R+2),c.emplaceBack(S+R,S+R+3,S+R+1),c.emplaceBack(S+R,S+R+2,S+R+3);const M=a.length,A=M+2*(f+1);for(const R of[0,1])for(let V=0;V<=f;V++)for(const K of[0,1])a.emplaceBack(R*u.EXTENT,V*g,K);for(let R=0;R<2*f;R+=2)c.emplaceBack(M+R,M+R+1,M+R+3),c.emplaceBack(M+R,M+R+3,M+R+2),c.emplaceBack(A+R,A+R+3,A+R+1),c.emplaceBack(A+R,A+R+2,A+R+3);return this._mesh={indexBuffer:t.createIndexBuffer(c),vertexBuffer:t.createVertexBuffer(a,Te.members),segments:u.SegmentVector.simpleSegment(0,0,a.length,c.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*u.earthRadius/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,a){var c;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=u.MercatorCoordinate.fromLngLat(t.wrap()),f=(1<<a)*u.EXTENT,g=c.x*f,T=c.y*f,S=Math.floor(g/u.EXTENT),C=Math.floor(T/u.EXTENT);return{tileID:new u.OverscaledTileID(a,0,a,S,C),mercatorX:g,mercatorY:T}}}class Ft{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new ct(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>t.id!==a),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Yt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Hi{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Ft(t.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(c=>!t._layers[c].isHidden(a)),this._coordsDescendingInv={};for(const c in t.sourceCaches){this._coordsDescendingInv[c]={};const f=t.sourceCaches[c].getVisibleCoordinates();for(const g of f){const T=this.terrain.sourceCache.getTerrainCoords(g);for(const S in T)this._coordsDescendingInv[c][S]||(this._coordsDescendingInv[c][S]=[]),this._coordsDescendingInv[c][S].push(T[S])}}this._coordsDescendingInvStr={};for(const c of t._order){const f=t._layers[c],g=f.source;if(Yt[f.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const T in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][T]=this._coordsDescendingInv[g][T].map(S=>S.key).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[f][c.tileID.key];g&&g!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const a=t.type,c=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Yt[a]&&(this._prevType&&Yt[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(t.id),!f))return!0;if(Yt[this._prevType]||Yt[a]&&f){this._prevType=a;const g=this._stacks.length-1,T=this._stacks[g]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(il(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[g]){const M=this.pool.getObjectForId(S.rtt[g].id);if(M.stamp===S.rtt[g].stamp){this.pool.useObject(M);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),S.rtt[g]={id:C.id,stamp:C.stamp},c.context.bindFramebuffer.set(C.fbo.framebuffer),c.context.clear({color:u.Color.transparent,stencil:0}),c.currentStencilSource=void 0;for(let M=0;M<T.length;M++){const A=c.style._layers[T[M]],R=A.source?this._coordsDescendingInv[A.source][S.tileID.key]:[S.tileID];c.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),c._renderTileClippingMasks(A,R),c.renderLayer(c,c.style.sourceCaches[A.source],A,R),A.source&&(S.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][S.tileID.key])}}return il(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Yt[a]}return!1}}const Mi=H,Rn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Er=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},Ei={showCompass:!0,showZoom:!0,visualizePitch:!1};class zi{constructor(t,a,c=!1){this.mousedown=T=>{this.startMouse(u.extend({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),q.mousePos(this.element,T)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,q.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const f=t.dragRotate._mouseRotate.getClickTolerance(),g=t.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=Ye({clickTolerance:f,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:S,bearingDegreesPerPixelMoved:C=.8})=>{const M=new Ns;return new Qe({clickTolerance:S,move:(A,R)=>({bearingDelta:(R.x-A.x)*C}),moveStateManager:M,enable:T,assignEvents:Er})})({clickTolerance:f,enable:!0}),this.map=t,c&&(this.mousePitch=xa({clickTolerance:g,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:S,pitchDegreesPerPixelMoved:C=-.5})=>{const M=new Ns;return new Qe({clickTolerance:S,move:(A,R)=>({pitchDelta:(R.y-A.y)*C}),moveStateManager:M,enable:T,assignEvents:Er})})({clickTolerance:g,enable:!0})),q.addEventListener(a,"mousedown",this.mousedown),q.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(a,"touchcancel",this.reset)}startMouse(t,a){this.mouseRotate.dragStart(t,a),this.mousePitch&&this.mousePitch.dragStart(t,a),q.disableDrag()}startTouch(t,a){this.touchRotate.dragStart(t,a),this.touchPitch&&this.touchPitch.dragStart(t,a),q.disableDrag()}moveMouse(t,a){const c=this.map,{bearingDelta:f}=this.mouseRotate.dragMove(t,a)||{};if(f&&c.setBearing(c.getBearing()+f),this.mousePitch){const{pitchDelta:g}=this.mousePitch.dragMove(t,a)||{};g&&c.setPitch(c.getPitch()+g)}}moveTouch(t,a){const c=this.map,{bearingDelta:f}=this.touchRotate.dragMove(t,a)||{};if(f&&c.setBearing(c.getBearing()+f),this.touchPitch){const{pitchDelta:g}=this.touchPitch.dragMove(t,a)||{};g&&c.setPitch(c.getPitch()+g)}}off(){const t=this.element;q.removeEventListener(t,"mousedown",this.mousedown),q.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let po;function as(m,t,a){if(m=new u.LngLat(m.lng,m.lat),t){const c=new u.LngLat(m.lng-360,m.lat),f=new u.LngLat(m.lng+360,m.lat),g=a.locationPoint(m).distSqr(t);a.locationPoint(c).distSqr(t)<g?m=c:a.locationPoint(f).distSqr(t)<g&&(m=f)}for(;Math.abs(m.lng-a.center.lng)>180;){const c=a.locationPoint(m);if(c.x>=0&&c.y>=0&&c.x<=a.width&&c.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m}const Vs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wa(m,t,a){const c=m.classList;for(const f in Vs)c.remove(`maplibregl-${a}-anchor-${f}`);c.add(`maplibregl-${a}-anchor-${t}`)}class wi extends u.Evented{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,f=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=as(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${Vs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const g=this._map.unproject(this._pos),T=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=g.distanceTo(this._lngLat)>20*T?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.Event("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=u.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div"),this._element.setAttribute("aria-label","Map marker");const a=q.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const g=q.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const T=q.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const S=q.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const he of C){const be=q.createNS("http://www.w3.org/2000/svg","ellipse");be.setAttributeNS(null,"opacity","0.04"),be.setAttributeNS(null,"cx","10.5"),be.setAttributeNS(null,"cy","5.80029008"),be.setAttributeNS(null,"rx",he.rx),be.setAttributeNS(null,"ry",he.ry),S.appendChild(be)}const M=q.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const A=q.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(A);const R=q.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const V=q.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(V);const K=q.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(6.0, 7.0)"),K.setAttributeNS(null,"fill","#FFFFFF");const X=q.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=q.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const W=q.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),X.appendChild(Q),X.appendChild(W),T.appendChild(S),T.appendChild(M),T.appendChild(R),T.appendChild(K),T.appendChild(X),a.appendChild(T),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=u.Point.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),wa(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=u.Point.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Zs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ro=0,ls=!1;const Ql={maxWidth:100,unit:"metric"};function $s(m,t,a){const c=a&&a.maxWidth||100,f=m._container.clientHeight/2,g=m.unproject([0,f]),T=m.unproject([c,f]),S=g.distanceTo(T);if(a&&a.unit==="imperial"){const C=3.2808*S;C>5280?Bo(t,c,C/5280,m._getUIString("ScaleControl.Miles")):Bo(t,c,C,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Bo(t,c,S/1852,m._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Bo(t,c,S/1e3,m._getUIString("ScaleControl.Kilometers")):Bo(t,c,S,m._getUIString("ScaleControl.Meters"))}function Bo(m,t,a,c){const f=function(g){const T=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const M=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*M)/M}(S),T*S}(a);m.style.width=t*(f/a)+"px",m.innerHTML=`${f}&nbsp;${c}`}const eu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pu(m){if(m){if(typeof m=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new u.Point(0,0),top:new u.Point(0,m),"top-left":new u.Point(t,t),"top-right":new u.Point(-t,t),bottom:new u.Point(0,-m),"bottom-left":new u.Point(t,-t),"bottom-right":new u.Point(-t,-t),left:new u.Point(m,0),right:new u.Point(-m,0)}}if(m instanceof u.Point||Array.isArray(m)){const t=u.Point.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.Point.convert(m.center||[0,0]),top:u.Point.convert(m.top||[0,0]),"top-left":u.Point.convert(m["top-left"]||[0,0]),"top-right":u.Point.convert(m["top-right"]||[0,0]),bottom:u.Point.convert(m.bottom||[0,0]),"bottom-left":u.Point.convert(m["bottom-left"]||[0,0]),"bottom-right":u.Point.convert(m["bottom-right"]||[0,0]),left:u.Point.convert(m.left||[0,0]),right:u.Point.convert(m.right||[0,0])}}return Pu(new u.Point(0,0))}const Tc={extend:(m,...t)=>u.extend(m,...t),run(m){m()},logToElement(m,t=!1,a="log"){const c=window.document.getElementById(a);c&&(t&&(c.innerHTML=""),c.innerHTML+=`<br>${m}`)}},Cu=H;class Qt{static get version(){return Cu}static get workerCount(){return an.workerCount}static set workerCount(t){an.workerCount=t}static get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){u.config.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return u.config.WORKER_URL}static set workerUrl(t){u.config.WORKER_URL=t}static addProtocol(t,a){u.config.REGISTERED_PROTOCOLS[t]=a}static removeProtocol(t){delete u.config.REGISTERED_PROTOCOLS[t]}}return Qt.Map=class extends z{constructor(m){if(u.PerformanceUtils.mark(u.PerformanceMarkers.create),(m=u.extend({},Rn,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ma(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new we,this._controls=[],this._mapId=u.uniqueId(),this._locale=u.extend({},ce,m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this._imageQueueHandle=Bt.addThrottleControl(()=>this.isMoving()),this._requestManager=new ue(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;this._resizeObserver=new ResizeObserver(a=>{t?this._trackResize&&this.resize(a)._update():t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new P(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new ao(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,u.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new $({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new oe,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new u.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new u.Event(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new u.Event("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,t,a,c)}resize(m){var t;const a=this._containerDimensions(),c=a[0],f=a[1],g=this._getClampedPixelRatio(c,f);if(this._resizeCanvas(c,f,g),this.painter.resize(c,f,g),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const C=this._getClampedPixelRatio(c,f);this._resizeCanvas(c,f,C),this.painter.resize(c,f,C)}this.transform.resize(c,f),(t=this._requestedCameraState)===null||t===void 0||t.resize(c,f);const T=!this._moving;return T&&(this.stop(),this.fire(new u.Event("movestart",m)).fire(new u.Event("move",m))),this.fire(new u.Event("resize",m)),T&&this.fire(new u.Event("moveend",m)),this}_getClampedPixelRatio(m,t){const{0:a,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),g=m*f,T=t*f;return Math.min(g>a?a/g:1,T>c?c/T:1)*f}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Ct.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(m){return this.transform.locationPoint(u.LngLat.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(u.Point.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,a){if(m==="mouseenter"||m==="mouseover"){let c=!1;return{layer:t,listener:a,delegates:{mousemove:g=>{const T=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];T.length?c||(c=!0,a.call(this,new xi(m,this,g.originalEvent,{features:T}))):c=!1},mouseout:()=>{c=!1}}}}if(m==="mouseleave"||m==="mouseout"){let c=!1;return{layer:t,listener:a,delegates:{mousemove:T=>{(this.getLayer(t)?this.queryRenderedFeatures(T.point,{layers:[t]}):[]).length?c=!0:c&&(c=!1,a.call(this,new xi(m,this,T.originalEvent)))},mouseout:T=>{c&&(c=!1,a.call(this,new xi(m,this,T.originalEvent)))}}}}{const c=f=>{const g=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];g.length&&(f.features=g,a.call(this,f),delete f.features)};return{layer:t,listener:a,delegates:{[m]:c}}}}on(m,t,a){if(a===void 0)return super.on(m,t);const c=this._createDelegatedListener(m,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(c);for(const f in c.delegates)this.on(f,c.delegates[f]);return this}once(m,t,a){if(a===void 0)return super.once(m,t);const c=this._createDelegatedListener(m,t,a);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(m,t,a){return a===void 0?super.off(m,t):(this._delegatedListeners&&this._delegatedListeners[m]&&(c=>{const f=this._delegatedListeners[m];for(let g=0;g<f.length;g++){const T=f[g];if(T.layer===t&&T.listener===a){for(const S in T.delegates)this.off(S,T.delegates[S]);return f.splice(g,1),this}}})(),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let a;const c=m instanceof u.Point||Array.isArray(m),f=c?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:m)||{},f instanceof u.Point||typeof f[0]=="number")a=[u.Point.convert(f)];else{const g=u.Point.convert(f[0]),T=u.Point.convert(f[1]);a=[g,new u.Point(T.x,g.y),T,new u.Point(g.x,T.y),g]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,t));const a=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new qi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,a):this.style.loadJSON(m,t,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const a=this._requestManager.transformRequest(m,pe.Style);u.getJSON(a,(c,f)=>{c?this.fire(new u.ErrorEvent(c)):f&&this._updateDiff(f,t)})}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(a){u.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.sourceCaches[m];if(t!==void 0)return t.loaded();this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.sourceCaches[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===m.source&&u.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Pt(this.painter,t,m),this.painter.renderToTexture=new Hi(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.Event("terrain",{terrain:m})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const t in m){const a=m[t]._tiles;for(const c in a){const f=a[c];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(m,t,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,t,a)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,t,a={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:g,stretchY:T,content:S}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||u.isImageBitmap(t))){if(t.width===void 0||t.height===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:M,data:A}=t,R=t;return this.style.addImage(m,{data:new u.RGBAImage({width:C,height:M},new Uint8Array(A)),pixelRatio:c,stretchX:g,stretchY:T,content:S,sdf:f,version:0,userImage:R}),R.onAdd&&R.onAdd(this,m),this}}{const{width:C,height:M,data:A}=u.browser.getImageData(t);this.style.addImage(m,{data:new u.RGBAImage({width:C,height:M},A),pixelRatio:c,stretchX:g,stretchY:T,content:S,sdf:f,version:0})}}updateImage(m,t){const a=this.style.getImage(m);if(!a)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||u.isImageBitmap(t)?u.browser.getImageData(t):t,{width:f,height:g,data:T}=c;if(f===void 0||g===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||g!==a.data.height)return this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||u.isImageBitmap(t));return a.data.replace(T,S),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,t){Bt.getImage(this._requestManager.transformRequest(m,pe.Image),t)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,t,a){return this.style.setLayerZoomRange(m,t,a),this._update(!0)}setFilter(m,t,a={}){return this.style.setFilter(m,t,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,a,c={}){return this.style.setPaintProperty(m,t,a,c),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,a,c={}){return this.style.setLayoutProperty(m,t,a,c),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,a,c=>{c||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,a=>{a||this._update(!0)}),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=q.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const f=this._controlContainer=q.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{g[T]=q.create("div",`maplibregl-ctrl-${T} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=q.create("div","maplibregl-cooperative-gesture-screen",this._container);let m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${m}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){q.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(m,t,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{t={requestedAttributes:m},c&&(t.statusMessage=c.statusMessage,t.type=c.type)},{once:!0});const a=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new ns(a,this.transform),ke.testSupport(a)}_onCooperativeGesture(m,t,a){return!t&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,g=u.browser.now();this.style.zoomHistory.update(f,g);const T=new u.EvaluationParameters(f,{now:g,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=T.crossFadingFactor();S===1&&S===this._crossFadingFactor||(a=!0,this._crossFadingFactor=S),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.load),this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const c=this._sourcesDirty||this._styleDirty||this._placementDirty;return c||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.Event("idle")),!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Bt.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),u.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=u.browser.frame(m=>{u.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Mi}getCameraTargetElevation(){return this.transform.elevation}},Qt.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=u.extend({},Ei,m),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const a=q.create("button",m,this._container);return a.type="button",a.addEventListener("click",t),a}},Qt.GeolocateControl=class extends u.Evented{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.Event("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new u.LngLat(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,f=this._map.getBearing(),g=u.extend({bearing:f},this.options.fitBoundsOptions),T=Ct.fromLngLat(a,c);this._map.fitBounds(T,g,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new u.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ls)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.Event("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new wi({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}},this.options=u.extend({},Zs,m)}onAdd(m){return this._map=m,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,a=!1){po===void 0||a?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(c=>{po=c.state!=="denied",t(po)}).catch(()=>{po=!!window.navigator.geolocation,t(po)}):(po=!!window.navigator.geolocation,t(po)):t(po)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ro=0,ls=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),a=m.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),t=m.getSouthEast(),a=m.getNorthEast(),c=t.distanceTo(a),f=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ro--,ls=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ro++,Ro>1?(m={maximumAge:6e5,timeout:0},ls=!0):(m=this.options.positionOptions,ls=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Qt.AttributionControl=$,Qt.LogoControl=oe,Qt.ScaleControl=class{constructor(m){this._onMove=()=>{$s(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,$s(this._map,this._container,this.options)},this.options=u.extend({},Ql,m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Qt.FullscreenControl=class extends u.Evented{constructor(m={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new u.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Qt.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=m}onAdd(m){return this._map=m,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Qt.Popup=class extends u.Evented{constructor(m){super(),this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=as(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const a=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let c=this.options.anchor;const f=Pu(this.options.offset);if(!c){const T=this._container.offsetWidth,S=this._container.offsetHeight;let C;C=a.y+f.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<T/2?C.push("left"):a.x>this._map.transform.width-T/2&&C.push("right"),c=C.length===0?"bottom":C.join("-")}const g=a.add(f[c]).round();q.setTransform(this._container,`${Vs[c]} translate(${g.x}px,${g.y}px)`),wa(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=u.extend(Object.create(eu),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=u.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=m;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(bc);m&&m.focus()}},Qt.Marker=wi,Qt.Style=qi,Qt.LngLat=u.LngLat,Qt.LngLatBounds=Ct,Qt.Point=u.Point,Qt.MercatorCoordinate=u.MercatorCoordinate,Qt.Evented=u.Evented,Qt.AJAXError=u.AJAXError,Qt.config=u.config,Qt.CanvasSource=Ie,Qt.GeoJSONSource=Br,Qt.ImageSource=er,Qt.RasterDEMTileSource=Zn,Qt.RasterTileSource=Bi,Qt.VectorTileSource=zt,Qt.VideoSource=tr,Qt.setRTLTextPlugin=u.setRTLTextPlugin,Qt.getRTLTextPluginStatus=u.getRTLTextPluginStatus,Qt.prewarm=function(){Po().acquire(qe)},Qt.clearPrewarmedResources=function(){const m=Fr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(qe),Fr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Tc.extend(Qt,{isSafari:u.isSafari,getPerformanceMetrics:u.PerformanceUtils.getPerformanceMetrics}),Qt});var O=b;return O})}(Mf)),Mf.exports}(function(n,s){(function(h,v){n.exports=v(E0(),uT())})(typeof globalThis<"u"?globalThis:Pm||self,function(h,v){h.MaplibreGL=h.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(b){h.setOptions(this,b),this._throttledUpdate=h.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(b){this._container||this._initContainer();var I=this.getPaneName();b.getPane(I).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),b.options.zoomAnimation&&h.DomEvent.on(b._proxy,h.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(b){this._map._proxy&&this._map.options.zoomAnimation&&h.DomEvent.off(this._map._proxy,h.DomUtil.TRANSITION_END,this._transitionEnd,this);var I=this.getPaneName();b.getPane(I).removeChild(this._container),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaplibreMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){var b=this.getSize().multiplyBy(.5),I=this._map.latLngToContainerPoint(this._map.getCenter());return h.latLngBounds(this._map.containerPointToLatLng(I.subtract(b)),this._map.containerPointToLatLng(I.add(b)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_roundPoint:function(b){return{x:Math.round(b.x),y:Math.round(b.y)}},_initContainer:function(){var b=this._container=h.DomUtil.create("div","leaflet-gl-layer"),I=this.getSize(),O=this._map.getSize().multiplyBy(this.options.padding);b.style.width=I.x+"px",b.style.height=I.y+"px";var u=this._map.containerPointToLayerPoint([0,0]).subtract(O);h.DomUtil.setPosition(b,this._roundPoint(u))},_initGL:function(){var b=this._map.getCenter(),I=h.extend({},this.options,{container:this._container,center:[b.lng,b.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new v.Map(I),this._glMap.transform.latRange=null,this._glMap.transform.maxValidLatitude=1/0,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var O=this._glMap._actualCanvas;h.DomUtil.addClass(O,"leaflet-image-layer"),h.DomUtil.addClass(O,"leaflet-zoom-animated"),this.options.interactive&&h.DomUtil.addClass(O,"leaflet-interactive"),this.options.className&&h.DomUtil.addClass(O,this.options.className)},_update:function(b){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var I=this.getSize(),O=this._container,u=this._glMap,H=this._map.getSize().multiplyBy(this.options.padding),q=this._map.containerPointToLayerPoint([0,0]).subtract(H);h.DomUtil.setPosition(O,this._roundPoint(q)),this._transformGL(u),u.transform.width!==I.x||u.transform.height!==I.y?(O.style.width=I.x+"px",O.style.height=I.y+"px",u._resize!==null&&u._resize!==void 0?u._resize():u.resize()):u._update!==null&&u._update!==void 0?u._update():u.update()}},_transformGL:function(b){var I=this._map.getCenter(),O=b.transform;O.center=v.LngLat.convert([I.lng,I.lat]),O.zoom=this._map.getZoom()-1},_pinchZoom:function(b){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(b){var I=this._map.getZoomScale(b.zoom),O=this._map.getSize().multiplyBy(this.options.padding*I),u=this.getSize()._divideBy(2),H=this._map.project(b.center,b.zoom)._subtract(u)._add(this._map._getMapPanePos().add(O))._round(),q=this._map.project(this._map.getBounds().getNorthWest(),b.zoom)._subtract(H);h.DomUtil.setTransform(this._glMap._actualCanvas,q.subtract(this._offset),I)},_zoomStart:function(b){this._zooming=!0},_zoomEnd:function(){var b=this._map.getZoomScale(this._map.getZoom());h.DomUtil.setTransform(this._glMap._actualCanvas,null,b),this._zooming=!1,this._update()},_transitionEnd:function(b){h.Util.requestAnimFrame(function(){var I=this._map.getZoom(),O=this._map.getCenter(),u=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());h.DomUtil.setTransform(this._glMap._actualCanvas,u,1),this._glMap.once("moveend",h.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:O,zoom:I-1})},this)},_resize:function(b){this._transitionEnd(b)}}),h.maplibreGL=function(b){return new h.MaplibreGL(b)}})})(lT);const cT=rT(function({url:s,attribution:h,...v},b){const I=Q2.maplibreGL({style:s,attribution:h,noWrap:!0},S0(v,b));return eT(I,b)},function(s,h,v){oT(s,h,v);const{url:b,attribution:I}=h;b!=null&&b!==v.url&&s.getMaplibreMap().setStyle(b),I!=null&&I!==v.attribution&&(s.options.attribution=I)});function hT(){const n=[51.505,-.09],[s,h]=ji.useState("https://demotiles.maplibre.org/style.json"),[v,b]=ji.useState(s),I=u=>{b(u.currentTarget.value)},O=()=>{h(v)};return Ys.jsxs(Ys.Fragment,{children:[Ys.jsxs("div",{className:"input",children:[Ys.jsx("input",{type:"text",value:v,onChange:I}),Ys.jsx("button",{onClick:O,children:"Send"})]}),Ys.jsx("div",{style:{width:"1200px",height:"600px"},children:Ys.jsx(aT,{style:{width:"1200px",height:"600px"},center:n,zoom:13,children:Ys.jsx(cT,{attribution:"x",url:s})})})]})}Af.createRoot(document.getElementById("root")).render(Ys.jsx(zf.StrictMode,{children:Ys.jsx(hT,{})}));
